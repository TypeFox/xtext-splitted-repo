<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Xtext - Language Development Made Easy!</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description"
		content="The website of Eclipse Xtext, an open-source framework for development of programming langauges and domain-specific languages">
	<meta name="author" content="Sven Efftinge">
	<!--  styles -->
	<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
	<!--[if lt IE 9]>
	  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	
	<!-- Le fav and touch icons -->
	
	<link rel="shortcut icon" href="images/favicon.png">
	
	<link href="css/bootstrap.css" rel="stylesheet" type='text/css'>
	<link href="css/bootstrap-responsive.css" rel="stylesheet" type='text/css'>
	<link href="css/style.css" rel="stylesheet" type='text/css'>
	<link href="css/shield-responsive.css" rel="stylesheet" type='text/css'>
	<link href='css/fonts.css' rel='stylesheet' type='text/css'>
	<link href="css/prettyPhoto.css" rel="stylesheet" media="screen" type='text/css'>
	<link href="google-code-prettify/prettify.css" type="text/css" rel="stylesheet"/>
	<!--[if lt IE 9]>
	<link href="css/iebugs.css" rel="stylesheet" type='text/css'>
	<![endif]-->
	<script src="js/twitter.js" type="text/javascript"></script>
	<script src="js/jquery-1.7.1.min.js"></script>
	<script src="js/jquery.prettyPhoto.js" type="text/javascript"></script>
		<script type="text/javascript">
	     $(document).ready(function() {
					prettyPrint();
	         
					 $('a[data-rel]').each(function() {
	             $(this).attr('rel', $(this).data('rel'));
	         });
	        
					 $("a[rel^='prettyPhoto']").prettyPhoto({
	             animation_speed: 'fast',
	             slideshow: 5000,
	             autoplay_slideshow: false,
	             opacity: 0.80,
	             show_title: true,
	             theme: 'ligh_square',
	             overlay_gallery: false,
	             social_tools: false
	       
	         });
	         
					$('#nav-outline > li > a').live('click', function() {        
						$(this).parent().find('ul').slideToggle();      
					});
	         
					$('.has-popover').popover();
		 	     
		 	     getTwitters('tweet', { 
			        id: 'xtext', 
			        count: 5,
			        includeRT: true,
			        enableLinks: true, 
			        clearContents: true,
			        template : '"%text%" - %time% by <a href="http://twitter.com/%user_screen_name%/statuses/%id_str%/">@%user_screen_name%</a><br/><br/>'
			     });
	         
	         var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
		 	     po.src = 'https://apis.google.com/js/plusone.js';
		 	     var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
	     });
		</script>
	<script type="text/javascript">
		var _gaq = _gaq || [];	
	  	_gaq.push([ '_setAccount', 'UA-2429174-3' ]);
		_gaq.push([ '_trackPageview' ]);
		(function() {
			var ga = document.createElement('script');
			ga.type = 'text/javascript';
			ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl'
					: 'http://www')
					+ '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0];
			s.parentNode.insertBefore(ga, s);
		})();
	</script>
</head>
<body>
	<!-- Navbar -->
	<div class="navbar navbar-fixed-top"
		style="border-bottom: 1px solid #000;">
		<div class="navbar-inner">
			<div class="container">
				<a class="btn btn-navbar" data-toggle="collapse"
					data-target=".nav-collapse"> <span class="icon-bar"></span> <span
					class="icon-bar"></span> <span class="icon-bar"></span>
				</a> <a class="brand" href="index.html"></a>
	
	
				<div class="nav-collapse collapse" style="height: 0px;">
					<ul class="nav">
						<li ><a href="download.html">Download</a></li>
						<li class="dropdown">
							<a href="examples.html" class="dropdown-toggle" data-toggle="dropdown">Examples<b class="caret"></b></a>
							<ul class="dropdown-menu">
								<li><a href="examples.html#introduction">Seven Languages by Seven Geeks</a></li>
								<li><a href="examples1.html#simple">Scripting Language</a></li>
								<li><a href="examples2.html#mongo">DSL for MongoDB</a></li>
								<li><a href="examples3.html#routing">Http Routing Language</a></li>
								<li><a href="examples4.html#templates">Template Language</a></li>
								<li><a href="examples5.html#guice">DSL for Guice</a></li>
								<li><a href="examples6.html#builddsl">Build Language</a></li>
								<li><a href="examples7.html#tortoise">Little Tortoise</a></li>
							</ul>
						</li>
						<li ><a href="documentation.html">Documentation</a></li>
						<li ><a href="community.html">Community</a></li>
						<li><a href="http://www.eclipse.org">Eclipse.org</a></li>
					</ul>
	
				</div>
				<!--/.nav-collapse -->
	
			</div>
		</div>
	</div>
	<!-- Navbar End -->
<!--Container-->
<div id="header_wrapper" class="container" >
	<div class="inner">
		<div class="container">
			<div class="page-heading"><h1>Documentation</h1></div>
		</div> <!-- /.container -->
	</div> <!-- /inner -->
</div>
<div id="page">  
	<div class="inner">
		<div id="maincontainer" class="container">
			<!-- chapter -->
			<section id="mongo" style="padding-top: 68px; margin-top: -68px;">
				<div class="row">
					<div class="span10 offset1">
						<h1>
							DSL for MongoDB
						</h1>
						<hr style="margin-top: 5px; margin-bottom: 5px;">
						<p>
							</p>
							<div class="thumbnail">
								<img src="images/mongobeans_screenshot.png" alt="" width="590" height="441">
							</div>
							<p>
						</p>
						<p>
							<a href="http://www.mongodb.org">MongoDB</a> is a very popular document-based database management system. 
							In mongoDB, database entries (AKA <strong>documents</strong>) have fields, which are essentially <strong>(key, value)</strong> pairs.
							MongoDB is schema free, i.e. there are no rules which fields have to be defined and of what type they are.
							This allows for very flexible and heterogenous data structures and maps perfectly with JSON.
						</p>
						<!--  section -->
						<section id="examples2.html#mongo_motivation" style="padding-top: 68px; margin-top: -68px;">
						<h2 style="padding-top: 15px;">The Problem</h2>
						<p>
							Java is statically typed: The available types, their field names and field types, are known and validated 
							at compile time. The JavaBeans convention defines how instances can be manipulated.
						</p>
						<p>
							OTOH, the standard mongoDB Java driver reflects mongoDB's schema freeness by providing mongo documents as 
							raw Java maps. This results in some major annoyances: First, you loose the benefit from Java's static typing. 
							You can ask a <a href="http://api.mongodb.org/java/2.6/com/mongodb/DBObject.html"><abbr title="com.mongodb.DBObject">DBObject</abbr></a> for the value of a specific field, but you cannot be sure 
							that the returned <a href="http://download.oracle.com/javase/1.5.0/docs/api/java/lang/Object.html"><abbr title="java.lang.Object">Object</abbr></a> is of some expected type. As database entities are likely to 
							play a major role in your application, having them implemented as a generic <a href="http://api.mongodb.org/java/2.6/com/mongodb/DBObject.html"><abbr title="com.mongodb.DBObject">DBObject</abbr></a>
							will likely result poorly readable and unsafe code. Second, additional behavior that would usually go into 
							methods of your entity classes has to be defined by external helper classes. Third, constructing a graph of 
							nested generic maps looks pretty bulky and inconventient in Java and breaks with the JavaBeans conventions.
						</p>
						</section>
						<!--  section -->
						<section id="examples2.html#mongo_solution" style="padding-top: 68px; margin-top: -68px;">
						<h2 style="padding-top: 15px;">A Solution With Xtext</h2>
						<p>
							In this project, we have created a small DSL <strong>mongoBeans</strong> based on Xtext that allows to create basic 
							entity classes that are backed by mongoDB objects but provide a statically typed JavaBeans API. Think of 
							the language as a description how to map mongoDB documents to JavaBeans, in analogy to well known object 
							relational mappers.
						</p>
						<p>
							An example mongoBeans file looks like this:
							</p>
							<pre class="prettyprint lang-mongobeans linenums">
import java.util.*

package org.musicdb {
    // a mongo bean
    Artist {
        String name    // single valued property
        Album* albums  // array property
        // an operation
        Iterable&lt;Track&gt; getOevre() {
            albums.map[track].flatten
        }
    }

    // another mongo bean
    Album {
        String title 
        int year 
        // inline definition of a mongo bean
        Track {        
            String title
            int seconds
        }* tracks
    }
}</pre>
							<p>
						</p>
						<p>
							From each <strong>MongoBean</strong> definition in a <strong>MongoFile</strong> file, we generate a Java class that wraps a 
							<a href="http://api.mongodb.org/java/2.6/com/mongodb/DBObject.html"><abbr title="com.mongodb.DBObject">DBObject</abbr></a>. The class provides statically typed getter and setter methods for all 
							defined <strong>MongoProperties</strong>. In the implementation of these accessor methods we delegate to the wrapped
							<a href="http://api.mongodb.org/java/2.6/com/mongodb/DBObject.html"><abbr title="com.mongodb.DBObject">DBObject</abbr></a> and do all the casting and conversion work. For the <code class="prettyprint lang-xtend">Artist</code> in the 
							above example, this would look like
						</p>
						<p>
							</p>
							<pre class="prettyprint lang-java linenums">
public class Artist implements IMongoBean {

  private DBObject _dbObject;  
  ...
  public String getName() {
    return (String) _dbObject.get("name");
  }
  
  public void setName(final String name) {
     _dbObject.put("name", name);
  }
  ...
}</pre>
							<p>
						</p>
						<p>
							By generating Java code, the rest of the application can use a safe, statically typed and JavaBeans 
							conformant API to access the datamodel. In addition, <strong>MongoBeans</strong> can define <strong>MongoOperations</strong> 
							which are translated to Java methods. We can use <strong>MongoProperties</strong> as well as Java types inside the 
							operations' bodies.
						</p>
						<p>
							Client code could then look like this:
							</p>
							<pre class="prettyprint lang-java linenums">
Artist john = new Artist();
john.setName("John Coltrane");
Album album = new Album();
album.setTitle("A Love Supreme");
john.getAlbums().add(album);
Track...  // create some tracks and add them to the album
 
System.out.println(john.getName() + "'s Oevre");
for(Track track: john.getOevre()) 
  System.out.println(track.getTitle());

DBCollection dbCollection = ... // standard mongoDB driver code
dbCollection.save(john.getDBObject())</pre>
							<p>
						</p>
						<!-- subsection -->
						<section id="mongo_statistics" style="padding-top: 68px; margin-top: -68px;">
						<h3>Some Stats</h3>
						<p>
							</p>
							<table class="table table-bordered table-condensed">
							<tr><td>Language name</td>
							<td>mongoBeans</td>
							</tr>
							<tr><td>Author</td>
							<td>Jan Koehnlein</td>
							</tr>
							<tr><td>Xtext Grammar</td>
							<td>27 LOC, 9 rules</td>
							</tr>
							<tr><td>Xtext extensions</td>
							<td>6 classes</td>
							</tr>
							<tr><td>Execution</td>
							<td>Java code generator</td>
							</tr>
							<tr><td>Runtime library</td>
							<td>4 classes</td>
							</tr>
							<tr><td>Hardest part</td>
							<td>Finding a project name w/o politically incorrect connotation</td>
							</tr>
							</table>
							<p>
						</p>
						</section>
						</section>
						<!--  section -->
						<section id="examples2.html#mongo_running" style="padding-top: 68px; margin-top: -68px;">
						<h2 style="padding-top: 15px;">Running the Example</h2>
						<p>
							In addtion to the <a href="examples.html#common_requirements">common requirements</a>, you need the 
							<a href="http://www.mongodb.org/downloads">mongoDB implementation</a> for your platform. We have included 
							the mongoDB Java driver from <a href="http://download.eclipse.org/tools/orbit/downloads/">Eclipse Orbit</a> 
							in the code base.
						</p>
						<p>
							Import the projects into an Eclipse workspace and run the launch config 
							<strong>Run (org.eclipse.xtext.mongobeans)</strong>. Import the example plug-in into the new workspace and run 
							<code class="prettyprint lang-xtend">MusicDBXtendTest</code> as a JUnit test.
						</p>
						</section>
						<!--  section -->
						<section id="examples2.html#mongo_details" style="padding-top: 68px; margin-top: -68px;">
						<h2 style="padding-top: 15px;">The Solution in Detail</h2>
						<!-- subsection -->
						<section id="mongo_grammar" style="padding-top: 68px; margin-top: -68px;">
						<h3>Grammar</h3>
						<p>
							The complete mongoBenas grammar looks like this:
						</p>
						<p>
							</p>
							<pre class="prettyprint lang-xtext linenums">
grammar org.xtext.mongobeans.MongoBeans with org.eclipse.xtext.xbase.Xbase

generate mongoBeans "http://www.eclipse.org/xtext/mongobeans/MongoBeans"

MongoFile:
  elements+=AbstractElement*;

Import:
  'import' importedNamespace=QualifiedNameWithWildcard;

AbstractElement:
  Import | PackageDeclaration | MongoBean;

PackageDeclaration:
  'package' name=QualifiedName '{'
    elements+=AbstractElement*
  '}';

MongoBean:
  name=ValidID '{'
    features+=AbstractFeature*
  '}';

AbstractFeature:
  MongoOperation | MongoProperty;

MongoProperty:
  (type=JvmTypeReference | inlineType=MongoBean) (many?='*')? name=ValidID;

MongoOperation:
  =&gt;(returnType=JvmTypeReference name=ValidID '(') 
    (parameters+=FullJvmFormalParameter (',' parameters+=FullJvmFormalParameter)*)? 
  ')' 
  body=XBlockExpression;

QualifiedNameWithWildcard:
  QualifiedName (".*")?;</pre>
							<p>
						</p>
						<p>
							The grammar inherits from the grammar of <code class="prettyprint lang-xtend">Xbase</code> in order to allow references to Java elements and Xbase 
							expressions. A <strong>MongoFile</strong> contains any number of <strong>AbstractElements</strong>, which can be <strong>PackageDeclarations</strong>,
							<strong>Imports</strong> or <strong>MongoBeans</strong>. <strong>Imports</strong> use Xtext's naming convention <code class="prettyprint lang-xtend">importedNamespace</code> to automatically 
							shorten qualified names of matching elements. Note that as opposed to Java, <strong>PackageDeclarations</strong> can be nested.     
							<strong>MongoBeans</strong> define statically typed MongoProperties, which can be single-valued or array-valued denoted by an 
							<code class="prettyprint lang-xtend">*</code> following the type name. The type of a <strong>MongoProperty</strong> can also be defined inline. <strong>MongoBeans</strong> can 
							also define <strong>MongoOperations</strong>. Instead of defining all possible expressions for the body of an operation, we 
							leverage Xtext's expression language library Xbase.
						</p>
						</section>
						<!-- subsection -->
						<section id="mongo_inferrer" style="padding-top: 68px; margin-top: -68px;">
						<h3>Translation to Java</h3>
						<p>
							The JVM model inferrencnce is implemented in the <a href="http://download.eclipse.org/modeling/tmf/xtext/javadoc/2.3/org/eclipse/xtext/mongobeans/jvmmodel/MongoBeansJvmModelInferrer.html"><abbr title="org.eclipse.xtext.mongobeans.jvmmodel.MongoBeansJvmModelInferrer">MongoBeansJvmModelInferrer</abbr></a> <a href="https://github.com/eclipse/xtext/blob/v2.3.0/plugins/org.eclipse.xtext/src/org/eclipse/xtext/mongobeans/jvmmodel/MongoBeansJvmModelInferrer.java">(src)</a>.
							As the generated code is quite rich, this is the most complex component of this language.
						</p>
						<p>
							For each <strong>MongoBean</strong>, we create a Java class implementing the interface <abbr title="org.xtext.mongobeans.lib.IMongoBean">IMongoBean</abbr> <a href="https://github.com/xtext-dev/seven-languages-xtext/blob/master/mongobeans/org.xtext.mongobeans.lib/src/org/xtext/mongobeans/lib/IMongoBean.java">(src)</a>.
							This interface is the first type of our small runtime library. The generated Java classes rely on this
							library to work, so it has to be on the classpath at runtime.
						</p>
						<p>
							</p>
							<table class="table table-bordered table-condensed">
							<tr><td>DSL</td>
							<td></p>
							<pre class="prettyprint lang-mongobeans linenums">
package org.musicdb {
  Artist { ...</pre>
							<p></td>
							</tr>
							<tr><td>Java</td>
							<td></p>
							<pre class="prettyprint lang-java linenums">
package org.musicdb;
...
public class Artist implements IMongoBean {  ...</pre>
							<p></td>
							</tr>
							</table>
							<p>
						</p>
						<p>
							The inferrer code responsible for this section looks like this:
							</p>
							<pre class="prettyprint lang-xtend linenums">
@Inject extension JvmTypesBuilder
@Inject extension IQualifiedNameProvider  
...
def dispatch void infer(MongoFile file, IJvmDeclaredTypeAcceptor acceptor, boolean isPreIndexingPhase) {
  for(bean : file.eAllOfType(typeof(MongoBean))) {
       acceptor.accept(bean.toClass(bean.fullyQualifiedName))
         .initializeLater([
           documentation = bean.documentation
           superTypes += newTypeRef(bean, 'org.xtext.mongobeans.IMongoBean')
... // calling various methods to create Java members with from the MongoFeatures
         ])
  }
}</pre>
							<p>
						</p>
						<p>
							First, finds all elements of type <strong>MongoBean</strong> in the given <strong>MongoFile</strong>. For each of these, create a new 
							Java class using the extension method <code class="prettyprint lang-xtend">toClass</code> from the <a href="http://download.eclipse.org/modeling/tmf/xtext/javadoc/2.3/org/eclipse/xtext/xbase/jvmmodel/JvmTypesBuilder.html"><abbr title="org.eclipse.xtext.xbase.jvmmodel.JvmTypesBuilder">JvmTypesBuilder</abbr></a> <a href="https://github.com/eclipse/xtext/blob/v2.3.0/plugins/org.eclipse.xtext.xbase/src/org/eclipse/xtext/xbase/jvmmodel/JvmTypesBuilder.java">(src)</a>. Analogously, the 
							The method <code class="prettyprint lang-xtend">fullyQualifiedName</code> comes actually from the secend injected extension 
							<a href="http://download.eclipse.org/modeling/tmf/xtext/javadoc/2.3/org/eclipse/xtext/naming/IQualifiedNameProvider.html"><abbr title="org.eclipse.xtext.naming.IQualifiedNameProvider">IQualifiedNameProvider</abbr></a> <a href="https://github.com/eclipse/xtext/blob/v2.3.0/plugins/org.eclipse.xtext/src/org/eclipse/xtext/naming/IQualifiedNameProvider.java">(src)</a>. Confused yet? Then better read the <a href="examples.html#xtend_primer">Xtend
							Primer</a> and the <a href="examples1.html#simple">simple example</a> first:
						</p>
						<p>
							The so created Java class is passed to the <code class="prettyprint lang-xtend">acceptor</code> as one of the results of the method. 
							The lambda expression passed to <code class="prettyprint lang-xtend">initializeLater</code> describes what happens to this class in the second
							phase. First the documentation is copied. Note that <code class="prettyprint lang-xtend">documentation = bean.documentation</code> is equivalent to 
							<code class="prettyprint lang-xtend">it.setDocumentation(bean.documentation)</code> or even 
							<code class="prettyprint lang-xtend">it.setDocumentation(_jvmTypesBuilder.getDocumention(bean))</code>. This is the moment where you
							should be really flashed by the awesome syntax of Xtend.
						</p>
						<p>
							The we set the supertype. By using </p>
							<pre class="prettyprint lang-xtend linenums">
_jvmTypesBuilder.newTypeRef(bean,
String)</pre>
							<p>
							 we create a reference to the existing interface <abbr title="org.xtext.mongobeans.lib.IMongoBean">IMongoBean</abbr> <a href="https://github.com/xtext-dev/seven-languages-xtext/blob/master/mongobeans/org.xtext.mongobeans.lib/src/org/xtext/mongobeans/lib/IMongoBean.java">(src)</a>. This
							will also insert a Java import at the appropriate location.
						</p>
						<p>
							Each <strong>MongoBean</strong> wraps a <a href="http://api.mongodb.org/java/2.6/com/mongodb/DBObject.html"><abbr title="com.mongodb.DBObject">DBObject</abbr></a> which is represented as a Java field with a 
							getter. There are two constructors, one for a given <a href="http://api.mongodb.org/java/2.6/com/mongodb/DBObject.html"><abbr title="com.mongodb.DBObject">DBObject</abbr></a> and one that 
							creates a new one. We have to store the class name in the DB object, if we want to be able to restore
							JavaBeans from query results.
						</p>
						<p>
							</p>
							<table class="table table-bordered table-condensed">
							<tr><td>DSL</td>
							<td></p>
							<pre class="prettyprint lang-mongobeans linenums">
Artist { ...</pre>
							<p></td>
							</tr>
							<tr><td>Java</td>
							<td></p>
							<pre class="prettyprint lang-java linenums">
public class Artist implements IMongoBean { 
  private DBObject _dbObject;
  
  public DBObject getDbObject() {
    return this._dbObject;
  }

  public Artist(final DBObject dbObject) {
    this._dbObject = dbObject;
  }
  
  public Artist() {
    _dbObject = new BasicDBObject();
    _dbObject.put(JAVA_CLASS_KEY, "org.musicdb.Artist");
  }
...</pre>
							<p></td>
							</tr>
							</table>
							<p>
						</p>
						<p>
							The inferrer code does this in two separate methods: One for the property <code class="prettyprint lang-xtend">_dbObject</code> and another
							for the constructors. Once again, we are using extension methods from the 
							<code class="prettyprint lang-xtend">JvmTypesBuilder</code> and the shortcut syntax to access setters. Also note the closures to
							initialize the bodies of the constructors. We could just have appended a multi-line string, but in order
							to get the imports in the generated code right we are using the helper method <code class="prettyprint lang-xtend">appendTypeRef()</code>.
						</p>
						<p>
							</p>
							<pre class="prettyprint lang-xtend linenums">
def protected addDbObjectProperty(JvmDeclaredType inferredType, MongoBean bean) {
  inferredType.members += bean.toField('_dbObject', newTypeRef(bean, 'com.mongodb.DBObject'))
  inferredType.members += bean.toGetter('dbObject', '_dbObject', newTypeRef(bean, 'com.mongodb.DBObject'))
}
										
def protected addConstructors(JvmDeclaredType inferredType, MongoBean bean) {
  inferredType.members += bean.toConstructor [
    documentation = '''Creates a new &laquo;bean.name&raquo; wrapping the given {@link DBObject}.'''
    parameters += toParameter("dbObject", newTypeRef(bean, 'com.mongodb.DBObject'))
    body = [
      append('this._dbObject = dbObject;')
    ]
  ]
  inferredType.members += bean.toConstructor [
    documentation = '''Creates a new &laquo;bean.name&raquo; wrapping a new {@link BasicDBObject}.'''
    body = [
      append('_dbObject = new ')
      appendTypeRef(bean, 'com.mongodb.BasicDBObject')
      append('();').newLine
      append('''
        _dbObject.put(JAVA_CLASS_KEY, "&laquo;inferredType.identifier&raquo;");
      ''')
    ]
  ]
}</pre>
							<p>
						</p>
						<p>
							Next on our list are the getters and setters delegating to the <code class="prettyprint lang-xtend">_dbObject</code>. Let us start with single
							valued <strong>MongoProperties</strong>:
						</p>
						<p>
							</p>
							<table class="table table-bordered table-condensed">
							<tr><td>DSL</td>
							<td></p>
							<pre class="prettyprint lang-mongobeans linenums">
...
    String name
    Artist friend
...</pre>
							<p></td>
							</tr>
							<tr><td>Java</td>
							<td></p>
							<pre class="prettyprint lang-java linenums">
...
  public String getName() {
    return (String) _dbObject.get("name");
  }
  
  public void setName(final String name) {
     _dbObject.put("name", name);
  }
  
  public Artist getFriend() {
    return WrappingUtil.wrapAndCast((DBObject) _dbObject.get("friend"));
  }
  
  public void setFriend(final Artist friend) {
     _dbObject.put("friend", WrappingUtil.unwrap(friend));
  }
...</pre>
							<p></td>
							</tr>
							</table>
							<p>
						</p>
						<p>
							As a Java client would expect the result of <code class="prettyprint lang-xtend">getFriend()</code> should be a <code class="prettyprint lang-xtend">Artist</code>, we have to handle
							<strong>MongoProperties</strong> whose type is a <strong>MongoBean</strong> differently. Note that the generated Java code uses 
							static helper methods to do the wrapping / unwrapping. They are defined in the second runtime class 
							<abbr title="org.xtext.mongobeans.lib.WrappingUtil">WrappingUtil</abbr> <a href="https://github.com/xtext-dev/seven-languages-xtext/blob/master/mongobeans/org.xtext.mongobeans.lib/src/org/xtext/mongobeans/lib/WrappingUtil.java">(src)</a>. To detect whether a type is actually a <strong>MongoBean</strong> or not, we 
							use the helper class <abbr title="org.xtext.mongobeans.jvmmodel.MongoTypes">MongoTypes</abbr> <a href="https://github.com/xtext-dev/seven-languages-xtext/blob/master/mongobeans/org.xtext.mongobeans.jvmmodel/src/org/xtext/mongobeans/jvmmodel/MongoTypes.java">(src)</a> that is also injected as an extension.
						</p>
						<p>
							</p>
							<pre class="prettyprint lang-xtend linenums">
def protected addDelegateAccessors(JvmDeclaredType inferredType, MongoProperty property) {
  inferredType.members += property.toMethod('get' + property.name.toFirstUpper, property.jvmType) [
    documentation = property.documentation
    body = [
      append('return ')
      if(property.jvmType.mongoBean) {
        ...
      } else {
        ...
      } 
    ]
  ]
  inferredType.members += property.toMethod('set' + property.name.toFirstUpper, null) [
    documentation = property.documentation
    parameters += toParameter(property.name, property.jvmType)
    body = [
      append(''' _dbObject.put("&laquo;property.name&raquo;", ''')
      if(property.jvmType.mongoBean) {
        ...
      } else {
        ...
      }
      append(');')
    ]
  ]
}</pre>
							<p>
						</p>
						<p>
							Multi-valued <strong>MongoProperties</strong> with a <strong>MongoBean</strong> type require a special implementation of 
							<a href="http://download.oracle.com/javase/1.5.0/docs/api/java/util/List.html"><abbr title="java.util.List">List</abbr></a> to automatically wrap/unwrap the elements. That's the third runtime library 
							class <abbr title="org.xtext.mongobeans.lib.MongoBeanList">MongoBeanList</abbr> <a href="https://github.com/xtext-dev/seven-languages-xtext/blob/master/mongobeans/org.xtext.mongobeans.lib/src/org/xtext/mongobeans/lib/MongoBeanList.java">(src)</a>. Note that we need a getter only. For multi-valued
							primitive properties, the Java driver already delivers a <a href="http://download.oracle.com/javase/1.5.0/docs/api/java/util/List.html"><abbr title="java.util.List">List</abbr></a>:
						</p>
						<p>
							</p>
							<table class="table table-bordered table-condensed">
							<tr><td>DSL</td>
							<td></p>
							<pre class="prettyprint lang-mongobeans linenums">
...
  String* aliases
    Album* albums
...</pre>
							<p></td>
							</tr>
							<tr><td>Java</td>
							<td></p>
							<pre class="prettyprint lang-java linenums">
...
  public List&lt;String&gt; getAliases() {
    return (List&lt;String&gt;) _dbObject.get("aliases");
  }
  
  private MongoBeanList&lt;Album&gt; _albums;
  
  public List&lt;Album&gt; getAlbums() {
    if(_albums==null)
      _albums = new MongoBeanList&lt;Album&gt;(_dbObject, "albums");
    return _albums;
  }
...</pre>
							<p></td>
							</tr>
							</table>
							<p>
						</p>
						<p>
							So this is what the inferrer snippet looks like:
							</p>
							<pre class="prettyprint lang-xtend linenums">
def protected addListAccessor(JvmDeclaredType inferredType, MongoProperty property) {
  if(isMongoPrimitiveType(property.jvmType)) {
    inferredType.members += property.toMethod('get' + property.name.toFirstUpper, 
      newTypeRef(property, 'java.util.List', property.jvmType.asWrapperTypeIfPrimitive)
    ) [
      documentation = property.documentation
      body = [
										...
      ]
    ]    
  } else {
    inferredType.members += property.toField('_' + property.name, newTypeRef(property,
       'org.xtext.mongobeans.MongoBeanList', property.jvmType))
    inferredType.members += property.toMethod('get' + property.name.toFirstUpper,
      newTypeRef(property, 'java.util.List', property.jvmType)
    ) [
										 ...
      ]
    ]
  }
}</pre>
							<p>
						</p>
						<p>
							Last but not least, we want to create methods for <strong>MongoOperations</strong>.
						</p>
						<p>
							</p>
							<table class="table table-bordered table-condensed">
							<tr><td>DSL</td>
							<td></p>
							<pre class="prettyprint lang-mongobeans linenums">
...
  Iterable&lt;Track&gt; getOevre() {
      albums.map[tracks].flatten
  }
...</pre>
							<p></td>
							</tr>
							<tr><td>Java</td>
							<td></p>
							<pre class="prettyprint lang-java linenums">
...
  public Iterable&lt;Track&gt; getOevre() {
    // some java code you really don't care about but it should just do the right thing
  }
...</pre>
							<p></td>
							</tr>
							</table>
							<p>
						</p>
						<p>
							The inferrer code for this particular task is surprisingly simple, as we can directly associate the
							body of the <strong>MongoOperation</strong>  to the generated Java method. The Xbase compiler will automatically 
							transform that to Java.
						</p>
						<p>
							</p>
							<pre class="prettyprint lang-xtend linenums">
def protected addMethod(JvmDeclaredType inferredType, MongoOperation operation) {
    inferredType.members += operation.toMethod(operation.name, operation.returnType) [
      documentation = operation.documentation
      for(parameter: operation.parameters)
        parameters += parameter.toParameter(parameter.name, parameter.parameterType)
      body = operation.body
    ]
  }</pre>
							<p>
						</p>
						<p>
							Puh, that was a lot of code, but because it is the essence of this language we hope it has been worthwhile.
						</p>
						</section>
						<!-- subsection -->
						<section id="mongo_additons" style="padding-top: 68px; margin-top: -68px;">
						<h3>Additional Aspects</h3>
						<p>
							We have tweaked the language's infrastructure a bit more.
						</p>
						<p>
							First, we have adapted the <a href="http://download.eclipse.org/modeling/tmf/xtext/javadoc/2.3/org/eclipse/xtext/naming/IQualifiedNameProvider.html"><abbr title="org.eclipse.xtext.naming.IQualifiedNameProvider">IQualifiedNameProvider</abbr></a> <a href="https://github.com/eclipse/xtext/blob/v2.3.0/plugins/org.eclipse.xtext/src/org/eclipse/xtext/naming/IQualifiedNameProvider.java">(src)</a>. By default, the
							qualified name of an element is calculated by concatening all the simple names of its containers with
							a dot. In our example, the <strong>MongoBean</strong> <code class="prettyprint lang-xtend">Track</code> would consequently be named 
							<code class="prettyprint lang-xtend">org.musicdb.Album.track.Track</code>. To ignore properties and beans on the path, we implemented our own
							<abbr title="org.xtext.mongobeans.scoping.MongoQualifiedNameProvider">MongoQualifiedNameProvider</abbr> <a href="https://github.com/xtext-dev/seven-languages-xtext/blob/master/mongobeans/org.xtext.mongobeans.scoping/src/org/xtext/mongobeans/scoping/MongoQualifiedNameProvider.java">(src)</a>. Note that we have to add a binding
							in the respective Guice module <a href="https://github.com/xtext-dev/seven-languages-xtext/blob/master/mongobeans/org.xtext.mongobeans.MongoBeansRuntimeModule/src/org/xtext/mongobeans/MongoBeansRuntimeModule.java">(src)</a> to make the framework 
							pick up our customization. See the <a href="http://www.xtext.org/documentation">Xtext documentation</a> for details 
							on dependency injection.
						</p>
						<p>
							Second, the Java driver for mongoDB cannot map all Java types to mongoDB types. To enforce that constraint, 
							we have added the <abbr title="org.xtext.mongobeans.validation.MongoBeansValidator">MongoBeansValidator</abbr> <a href="https://github.com/xtext-dev/seven-languages-xtext/blob/master/mongobeans/org.xtext.mongobeans.validation/src/org/xtext/mongobeans/validation/MongoBeansValidator.java">(src)</a>.
						</p>
						<p>
							To improve the language visually, we have tuned the 
							outline <a href="https://github.com/xtext-dev/seven-languages-xtext/blob/master/mongobeans/org.xtext.mongobeans.ui/src/org/xtext/mongobeans/ui/outline/MongoBeansOutlineTreeProvider.java">(src)</a> and the 
							label providers <a href="https://github.com/xtext-dev/seven-languages-xtext/blob/master/mongobeans/org.xtext.mongobeans.ui/src/org/xtext/mongobeans/ui/labeling/MongoBeansLabelProvider.java">(src)</a> as well.
						</p>
						</section>
						</section>
						<!--  section -->
						<section id="examples2.html#mongo_beyond" style="padding-top: 68px; margin-top: -68px;">
						<h2 style="padding-top: 15px;">Beyond This Example</h2>
						<p>
							Of course there could be further concepts in the DSL, e.g. transient properties, indices or refeerences. 
							Furthermore, the example <a href="https://github.com/xtext-dev/seven-languages-xtext/blob/master/mongobeans/org.xtext.mongobeans.example/src/org/xtext/mongobeans/example/MusicDBXtendTest.java">(src)</a> shows how to use Xtend to 
							build a very compact API to create trees of <strong>MongoBean</strong> instances. 
							Extension methods <a href="https://github.com/xtext-dev/seven-languages-xtext/blob/master/mongobeans/org.xtext.mongobeans.lib/src/org/xtext/mongobeans/lib/MongoExtensions.java">(src)</a> can also be used to wrap other
							classes of the mongoDB driver.
						</p>
						</section>
					</div>
				</div>
			</section>
		</div>
	</div>
</div>
	<div id="extra">
		<div class="inner">
			<div class="container">
				<div class="row">
					<div class="span6">
						<h3>Quick Links</h3>
						<ul class="footer-links clearfix">
							<li><a href="http://www.eclipse.org/legal/privacy.php">Privacy Policy</a></li>
							<li><a href="http://www.eclipse.org/legal/termsofuse.php">Terms of Use</a></li>
							<li><a href="http://www.eclipse.org/legal/copyright.php">Copyright Agent</a></li>
							<li><a href="http://www.eclipse.org/legal/">Legal</a></li>
						</ul>
						<ul class="footer-links clearfix">
	      			<li><a href="http://www.eclipse.org">Eclipse Home</a></li>
							<li><a href="http://marketplace.eclipse.org/">Market Place</a></li>
							<li><a href="http://live.eclipse.org/">Eclipse Live</a></li>
							<li><a href="http://www.planeteclipse.org/">Eclipse Planet</a></li>
						</ul>
					</div>
					<div class="span6">
						<h3><a href="https://twitter.com/#!/xtext" style="color: white;">Xtext</a> on Twitter</h3>
						<br />
						<div id="tweet">
							<p>Please wait while my tweets load</p>
							<p>
								<a href="http://twitter.com/rem">If you can't wait - check
									out what I've been twittering</a>
							</p>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- Le javascript
	    ================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->
	
	<script src="js/bootstrap-transition.js"></script>
	<script src="js/bootstrap-alert.js"></script>
	<script src="js/bootstrap-modal.js"></script>
	<script src="js/bootstrap-dropdown.js"></script>
	<script src="js/bootstrap-scrollspy.js"></script>
	<script src="js/bootstrap-tab.js"></script>
	<script src="js/bootstrap-tooltip.js"></script>
	<script src="js/bootstrap-popover.js"></script>
	<script src="js/bootstrap-button.js"></script>
	<script src="js/bootstrap-collapse.js"></script>
	<script src="js/bootstrap-carousel.js"></script>
	<script src="js/bootstrap-typeahead.js"></script>
	
	<!-- include pretty-print files -->
	<script type="text/javascript" src="google-code-prettify/prettify.js"></script>
	<script type="text/javascript" src="google-code-prettify/lang-xtend.js"></script>
	
	<!-- Include the plug-in -->
	<script src="js/jquery.easing.1.3.js" type="text/javascript"></script>
	<script src="js/custom.js" type="text/javascript"></script>
	<script type="text/javascript" src="google-code-prettify/lang-common.js"></script><script type="text/javascript">
		registerLanguage('grammar|import|generate|terminal|enum|returns|with|hidden|as|current|fragment|EOF', 'xtext');
		registerLanguage('extends|super|instanceof|as|new|null|false|true|val|var|if|else|switch|case|default|do|while|for|typeof|throw|try|catch|finally|this|it|int|boolean|short|char|double|float|long|byte|void|return', 'xbase');
		registerLanguage('module|var|auto-inject|auto|inject|import|true|false', 'mwe2');
		registerLanguage('package|import', 'mongobeans');
		registerLanguage('sub|begin|end', 'tortoise');
		registerLanguage('GET|POST|PUT|DELETE|HEAD|import|when', 'routing');
		registerLanguage('application', 'simple');
	</script>
</body>
</html>
