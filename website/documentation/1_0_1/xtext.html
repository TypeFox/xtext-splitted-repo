<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Xtext User Guide</title>
<link href="book.css" rel="stylesheet" type="text/css">
<meta content="DocBook XSL Stylesheets V1.75.1" name="generator">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="book" title="Xtext User Guide">
<div class="titlepage">
<div>
<div>
<h1 class="title">
<a name="N10001"></a>Xtext User Guide</h1>
</div>
</div>
<hr>
</div>
<div class="toc">
<p>
<b>Table of Contents</b>
</p>
<dl>
<dt>
<span class="chapter"><a href="#Overview">1. Overview</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="section"><a href="#WhatisXtext">What is Xtext?</a></span>
</dt>
<dt>
<span class="section"><a href="#HowDoesItWork">How Does It Work?</a></span>
</dt>
<dt>
<span class="section"><a href="#XtextisHighlyConfigurable">Xtext is Highly Configurable</a></span>
</dt>
<dt>
<span class="section"><a href="#WhoUsesXtext">Who Uses Xtext?</a></span>
</dt>
<dt>
<span class="section"><a href="#WhoisBehindXtext">Who is Behind Xtext?</a></span>
</dt>
<dt>
<span class="section"><a href="#DSL">What is a Domain-Specific Language</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="chapter"><a href="#getting-started">2. Getting Started</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="section"><a href="#getting-started-xtext">Creating a DSL  </a></span>
</dt>
<dt>
<span class="section"><a href="#processing_Xtext_models">Processing Xtext Models</a></span>
</dt>
<dt>
<span class="section"><a href="#getting-started-xpand">Writing a Code Generator</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="chapter"><a href="#grammarLanguage">3. The Grammar Language</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="section"><a href="#AFirstExample">A First Example</a></span>
</dt>
<dt>
<span class="section"><a href="#syntax">The Syntax</a></span>
</dt>
<dt>
<span class="section"><a href="#metamodelInference">Ecore Model Inference</a></span>
</dt>
<dt>
<span class="section"><a href="#grammarMixins">Grammar Mixins</a></span>
</dt>
<dt>
<span class="section"><a href="#CommonTerminals">Common Terminals</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="chapter"><a href="#configuration">4. Configuration</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="section"><a href="#generator">The Generator</a></span>
</dt>
<dt>
<span class="section"><a href="#dependencyInjection">Dependency Injection in Xtext with Google Guice</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="chapter"><a href="#runtime_concepts">5. Runtime Concepts</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="section"><a href="#RuntimeSetupISetup">Runtime Setup (ISetup)</a></span>
</dt>
<dt>
<span class="section"><a href="#SetupwithinEclipseEquinoxOSGi">Setup within Eclipse-Equinox (OSGi)</a></span>
</dt>
<dt>
<span class="section"><a href="#Logging">Logging</a></span>
</dt>
<dt>
<span class="section"><a href="#validation">Validation</a></span>
</dt>
<dt>
<span class="section"><a href="#linking">Linking</a></span>
</dt>
<dt>
<span class="section"><a href="#scoping">Scoping</a></span>
</dt>
<dt>
<span class="section"><a href="#valueconverter">Value Converter</a></span>
</dt>
<dt>
<span class="section"><a href="#serialization">Serialization</a></span>
</dt>
<dt>
<span class="section"><a href="#formatting">Formatting (Pretty Printing)</a></span>
</dt>
<dt>
<span class="section"><a href="#encoding">Encoding in Xtext</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="chapter"><a href="#MWE2">6. MWE2</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="section"><a href="#MWE2Exampe">Examples</a></span>
</dt>
<dt>
<span class="section"><a href="#MWE2LanguageReference">Language Reference</a></span>
</dt>
<dt>
<span class="section"><a href="#MWE2SyntaxReference">Syntax Reference</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="chapter"><a href="#ide_concepts">7. IDE Concepts</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="section"><a href="#labelProvider">Label Provider</a></span>
</dt>
<dt>
<span class="section"><a href="#contentAssist">Content Assist</a></span>
</dt>
<dt>
<span class="section"><a href="#quickfixes">Quick Fixes</a></span>
</dt>
<dt>
<span class="section"><a href="#templates">Template Proposals</a></span>
</dt>
<dt>
<span class="section"><a href="#outline">Outline View</a></span>
</dt>
<dt>
<span class="section"><a href="#hyperlinking">Hyperlinking</a></span>
</dt>
<dt>
<span class="section"><a href="#highlighting">Syntax Coloring</a></span>
</dt>
<dt>
<span class="section"><a href="#projectwizard">Project Wizard</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="chapter"><a href="#jvmtypes">8. Referring to Java Types</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="section"><a href="#HowtoUseJavaTypes">How to Use Java Types </a></span>
</dt>
<dt>
<span class="section"><a href="#CustomizationPoints">Customization Points</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="chapter"><a href="#special_languages">9. Typical Language Configurations</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="section"><a href="#case_insensitive_languages">Case Insensitive Languages</a></span>
</dt>
<dt>
<span class="section"><a href="#java_independent_languages">Languages Independent of JDT</a></span>
</dt>
<dt>
<span class="section"><a href="#expressions">Parsing Expressions with Xtext</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="chapter"><a href="#emf_integration">10. Integration with EMF and Other EMF Editors</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="section"><a href="#model_metamodel">Model, Ecore Model, and Ecore </a></span>
</dt>
<dt>
<span class="section"><a href="#emf_codegen">EMF Code Generation</a></span>
</dt>
<dt>
<span class="section"><a href="#xtext_resource">XtextResource Implementation</a></span>
</dt>
<dt>
<span class="section"><a href="#gmf_integration">Integration with GMF Editors</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="chapter"><a href="#migrating_from_0_7">11. Migrating from Xtext 0.7.x to 1.0</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="section"><a href="#TaketheShortcut">Take the Shortcut</a></span>
</dt>
<dt>
<span class="section"><a href="#MigratingStepByStep">Migrating Step By Step</a></span>
</dt>
<dt>
<span class="section"><a href="#NowGoForTheNewFeatures">Now Go For The New Features</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="chapter"><a href="#antlr_ip_issue">12. The ANTLR IP Issue (Or Which Parser To Use?)</a></span>
</dt>
</dl>
</div>
<div class="chapter" title="Chapter&nbsp;1.&nbsp;Overview">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="Overview"></a>Chapter&nbsp;1.&nbsp;Overview</h2>
</div>
</div>
</div>
<div class="section" title="What is Xtext?">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="WhatisXtext"></a>What is Xtext?</h2>
</div>
</div>
</div>
<p>No matter if you want to create a small textual domain-specific language (DSL) or you want to implement 
				a full-blown general purpose programming language. 
				With Xtext you can create your very own languages in a snap. Also if you already have an existing 
				language but it lacks decent tool support, you can use Xtext to create 
				a sophisticated Eclipse-based development environment providing editing experience known from modern 
				Java IDEs in a surprisingly short amount of time. We call Xtext a language development framework.  </p>
</div>
<div class="section" title="How Does It Work?">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="HowDoesItWork"></a>How Does It Work?</h2>
</div>
</div>
</div>
<p>Xtext provides you with a set of domain-specific languages and modern APIs to describe the different 
				aspects of your programming language. 
				Based on that information it gives you a full implementation of that language running on the JVM. 
				The compiler components of your language are independent of Eclipse or OSGi and can be used in any Java environment.
				They include such things as the parser, the type-safe abstract syntax tree (AST), the serializer and 
				code formatter, the scoping framework and the linking, compiler checks and static analysis aka validation 
				and last but not least a code generator or interpreter. These runtime components integrate with and 
				are based on the Eclipse Modeling Framework (EMF), which effectively allows you to 
				use Xtext together with other EMF frameworks like for instance the Graphical Modeling Project GMF.</p>
<p>In addition to this nice runtime architecture, you will get a full blown Eclipse-IDE specifically tailored 
				for your language. It already provides great default functionality for 
				all aspects and again comes with DSLs and APIs that allow to configure or change the most common things 
				very easily. And if that&rsquo;s not flexible enough there is Guice to replace the default behaviour with
				your own implementations.</p>
</div>
<div class="section" title="Xtext is Highly Configurable">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="XtextisHighlyConfigurable"></a>Xtext is Highly Configurable</h2>
</div>
</div>
</div>
<p>Xtext uses the lightweight dependency injection (DI) framework Google Guice to wire up the whole language 
				as well as the IDE infrastructure. A central, external module is used to configure the DI container. 
				As already mentioned, Xtext comes with decent default implementations and DSLs and APIs for the aspect that 
				are common sweet spots for customization. But if you need something completely different, 
				Google Guice gives you the power to exchange every little class in a non-invasive way.</p>
</div>
<div class="section" title="Who Uses Xtext?">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="WhoUsesXtext"></a>Who Uses Xtext?</h2>
</div>
</div>
</div>
<p>Xtext is used in many different industries. It is used in the field of mobile devices, automotive development, 
				embedded systems or Java enterprise software projects and game development. 
				People use Xtext-based languages to drive code generators that target Java, C, C++, C#, Objective C, Python, or Ruby code. 
				Although the language infrastructure itself runs on the JVM, you can compile Xtext languages to any 
				existing platform.
				Xtext-based languages are developed for well known Open-Source projects such as Maven, Eclipse B3, 
				the Eclipse Webtools platform or Google&rsquo;s Protocol Buffers and the framework is also widely used in research projects.  </p>
</div>
<div class="section" title="Who is Behind Xtext?">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="WhoisBehindXtext"></a>Who is Behind Xtext?</h2>
</div>
</div>
</div>
<p>Xtext is a professional Open-Source project. We, the main developers and the project lead, work for 
				itemis, 
				which is a well known consulting company specialized on model-based development.
				Therefore we are able to work almost full-time on the project. Xtext is an Eclipse.org project. 
				Besides many other advantages this means that you don&rsquo;t have to fear any IP issues, because the Eclipse Foundation 
				has their own lawyers who take care that no intellectual property is violated. </p>
<p>You may ask: Where does the money for Open-Source development come from? Well, we provide professional 
				services around Xtext. Be it training or on-site consulting, be it development of prototypes or 
				implementation of full-blown IDEs for programming languages. We do not only know the framework very well 
				but we are also experts in programming and domain-specific language design. Don&rsquo;t hesitate to get in 
				contact with us (
				<a class="ulink" href="http://xtext.itemis.com" target="_new">www.itemis.com</a>).
			</p>
</div>
<div class="section" title="What is a Domain-Specific Language">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="DSL"></a>What is a Domain-Specific Language</h2>
</div>
</div>
</div>
<p>A 
				<span class="emphasis"><em>Domain-Specific Language (DSL)</em></span> is a small programming language, which focuses on a particular domain.
				Such a domain can be more or less anything. The idea is that its concepts and notation is as close as possible to
				what you have in mind when you think about a solution in that domain. Of course we are talking about problems which can
				be solved or processed by computers somehow.
			</p>
<p>The opposite of a DSL is a so called 
				<span class="emphasis"><em>GPL</em></span>, a 
				<span class="emphasis"><em>General Purpose Language</em></span> such as Java or any other common programming language.
				With a GPL you can solve every computer problem, but it might not always be the best way to solve it.
			</p>
<p>Imagine you want to remove the core from an apple. You could of course use a Swiss army knife to cut it out, 
				and this is reasonable if you have to do it just once or twice. But if you need to do that on a regular 
				basis it might be more efficient to use an apple corer.</p>
<p>There are a couple of well-known examples of DSLs. For instance SQL is actually a DSL which focuses on 
				querying relational databases. Other DSLs are regular expressions or even languages provided by tools 
				like MathLab. Also most XML languages are actually domain-specific languages. The whole purpose of XML is 
				to allow for easy creation of new languages. Unfortunately, XML uses a fixed concrete syntax, which is 
				very verbose and yet not adapted to be read by humans. Into the bargain, a generic syntax for everything is a compromise.</p>
<p>Xtext is a sophisticated framework that helps to implement your very own DSL with appropriate IDE support. 
				There is no such limitation as with XML, you are free to define your concrete syntax as you like. It may 
				be as concise and suggestive as possible being a best match for your particular domain. The hard task of 
				reading your model, working with it and writing it back to your syntax is greatly simplified by Xtext.</p>
</div>
</div>
<div class="chapter" title="Chapter&nbsp;2.&nbsp;Getting Started">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="getting-started"></a>Chapter&nbsp;2.&nbsp;Getting Started</h2>
</div>
</div>
</div>
<p>In this mini-tutorial we will implement a small domain-specific language and a 
			corresponding Eclipse IDE integration with Xtext. Later, we will create a code generator 
			that is capable of reading the models you create with the DSL editor and process them, i.e. 
			generate some Java code from it.</p>
<div class="section" title="Creating a DSL">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="getting-started-xtext"></a>Creating a DSL  </h2>
</div>
</div>
</div>
<p>
				
<a class="ulink" href="http://www.eclipse.org/Xtext/download/" target="_new">Download and install the latest version of Xtext</a> and 
				set up a fresh workspace. We want to develop a small language used to define domain models.
				It is a stripped-down version of our 
				<span class="emphasis"><em>Domain-Model Example</em></span> which is shipped with Xtext 
				and can be materialized into your workspace using the example wizard. The following sample 
				of a domain model should give you an idea about the language.
			</p>
<div class="literallayout">
<p>
<code class="code">datatype&nbsp;String<br>
datatype&nbsp;Bool<br>

<br>
entity&nbsp;Session&nbsp;{<br>
&nbsp;&nbsp;title:&nbsp;String<br>
&nbsp;&nbsp;isTutorial&nbsp;:&nbsp;Bool<br>
}<br>

<br>
entity&nbsp;Conference&nbsp;{<br>
&nbsp;&nbsp;name&nbsp;:&nbsp;String<br>
&nbsp;&nbsp;attendees&nbsp;:&nbsp;Person*<br>
&nbsp;&nbsp;speakers&nbsp;:&nbsp;Speaker*<br>
}<br>

<br>
entity&nbsp;Person&nbsp;{<br>
&nbsp;&nbsp;name&nbsp;:&nbsp;String<br>
}<br>

<br>
entity&nbsp;Speaker&nbsp;extends&nbsp;Person&nbsp;{<br>
&nbsp;&nbsp;sessions&nbsp;:&nbsp;Session*<br>
}<br>

<br>

</code>
</p>
</div>
<div class="section" title="Create an Xtext Project">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="CreateanXtextProject"></a>Create an Xtext Project</h3>
</div>
</div>
</div>
<p>In order to get started we first need to create some Eclipse projects. Use the Xtext wizard to do so:</p>
<span class="emphasis"><em>File -&gt; New -&gt; Project...  -&gt; Xtext -&gt; Xtext project</em></span>
<p>Choose a meaningful project name, language name and file extension, e.g.</p>
<table id="N10068">
<tr>
						
<td>
							<span class="bold"><strong>Main project name:</strong></span>   
						</td>
						<td> org.eclipse.xtext.example.domainmodel  </td>
					
</tr>
<tr>
						
<td>
							<span class="bold"><strong>Language name:</strong></span>     
						</td>
						<td> org.eclipse.xtext.example.Domainmodel  </td>
					
</tr>
<tr>
						
<td>
							<span class="bold"><strong>DSL-File extension:</strong></span> 
						</td>
						<td> dmodel  </td>
					
</tr>
</table>
<p>Keep &bdquo;Create generator project&rdquo; checked, as we will also create a code generator in a second step.
					If you want to materialize the full blown Domainmodel example that ships with Xtext, it is
					strongly recommend to use another language name and file extension for this tutorial.</p>
<p>Click on 
					<span class="emphasis"><em>Finish</em></span> to create the projects. 
				</p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/getting-started-wizard.png"></div>
<p>
				
</p>
</div>
<div class="section" title="Project Layout">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="ProjectLayout"></a>Project Layout</h3>
</div>
</div>
</div>
<p>In the Package Explorer you can see three new projects. In 

					<span class="emphasis"><em>org.eclipse.xtext.example.domainmodel</em></span> the grammar is defined and all runtime 
					aspects, such as linking, scoping and validation are developed. The IDE-aspects 
					such as the editor, any views, and incremental project builder go into 

					<span class="emphasis"><em>org.eclipse.xtext.example.domainmodel.ui</em></span>. Both projects consist of generated 
					classes derived from the grammar and manual code such as the grammar itself and 
					further classes to differentiate and adapt from the default behavior. Although
					Xtext makes use of code generation, most of the code is actually written as 
					libraries, which are referenced by the means of OSGi using the Manifest.MF. 
				</p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/getting-started-project-layout.png"></div>
<p>
				
</p>
<p>It is good to be clear and unambiguous whether the code is generated or is to 
					be manipulated by the developer. Thus, the generated code should be held 
					separately from the manually written code. We follow this pattern by having a 
					folder 
					<span class="emphasis"><em>src/</em></span> and a folder 
					<span class="emphasis"><em>src-gen/</em></span> in each project. Keep in mind not to 
					make changes in the 
					<span class="emphasis"><em>src-gen/</em></span> folder. They will be overwritten by the generator 
					without any further warning.
				</p>
<p>A third project, 
					<span class="emphasis"><em>org.eclipse.xtext.example.domainmodel.generator</em></span> will later 
					contain an Xpand code generator that leverages the model created with the DSL 
					editor. This is fully optional and it is also optional to use Xpand. In fact 
					you can use any programming language running on the JVM to implement a code 
					generator for your Xtext models. Also it is of course perfectly ok, to have no 
					code generator at all but use the models dynamically at runtime. We call these 
					kind of model processors 
					<span class="emphasis"><em>interpreters</em></span>.
				</p>
</div>
<div class="section" title="Build Your Own Grammar">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="BuildYourOwnGrammar"></a>Build Your Own Grammar</h3>
</div>
</div>
</div>
<p>
					
<span class="bold"><strong>
						<span class="emphasis"><em>Please note</em></span>
					</strong></span>: If you encounter strange errors while copying and pasting
					a snippet from this document to your Eclipse editor, your documentation
					viewer most likely has inserted characters different from {space} into your 
					clipboard. Reenter the &bdquo;whitespace&rdquo; or type the text by hand to be sure everything
					works fine. 
				</p>
<p>The wizard will automatically open the example grammar file 

					<span class="emphasis"><em>Domainmodel.xtext</em></span> from the first project in the editor. A grammar has two 
					purposes: First, it is used to describe the concrete syntax of your language. 
					Second, it contains information about how the parser shall create a model during 
					parsing.
				</p>
<p>The first line of the grammar is the grammar declaration:</p>
<div class="literallayout">
<p>
<code class="code">grammar&nbsp;org.eclipse.xtext.example.Domainmodel&nbsp;<br>
&nbsp;&nbsp;with&nbsp;org.eclipse.xtext.common.Terminals<br>

<br>

</code>
</p>
</div>
<p>In Xtext each grammar has a unique name, which like public Java classes 
					needs to reflect the location of the file within the Java classpath. In our 
					case the grammar file is located in 

					<span class="emphasis"><em>/org/eclipse/xtext/example/Domainmodel.xtext</em></span> therefore the name of the 
					grammar is 
					<span class="emphasis"><em>org.eclipse.xtext.example.Domainmodel</em></span>. The second part of that 
					statement (
					<span class="emphasis"><em>with org.eclipse.xtext.common.Terminals</em></span>) states, that this grammar 
					reuses and overrides rules from the specified grammar. The 

					<span class="emphasis"><em>org.eclipse.xtext.common.Terminals</em></span> is a library grammar shipped with Xtext 
					and predefines the most common terminal rules, such as 
					<span class="emphasis"><em>ID</em></span>, 
					<span class="emphasis"><em>STRING</em></span> and 
					<span class="emphasis"><em>INT</em></span>. 
					It also introduces single-line and multi-line comments as well as rules for 
					whitespace, which may occur everywhere by default. You can open that grammar in the 
					editor to have a look at these rules. It turns out that these set of rules are often 
					the same and often used, so that most Xtext languages extend this grammar. 
					However, it is just a library, so you won&rsquo;t use it if it doesn&rsquo;t fit your needs. 
					Also you can use the grammar inheritance mechanism for your own grammar libraries, 
					of course.
				</p>
<p>The next statement declares an EMF Ecore package, aka 
					<span class="emphasis"><em>EPackage</em></span>, to be derived from the grammar:
				</p>
<div class="literallayout">
<p>
<code class="code">generate&nbsp;domainmodel&nbsp;"http://www.eclipse.org/xtext/example/Domainmodel"<br>

<br>

</code>
</p>
</div>
<p>Ecore 
					<span class="emphasis"><em>EPackages</em></span> are effectively a set of classes (in EMF they are called 

					<span class="emphasis"><em>EClass</em></span>) which are used to represent the in-memory-model of a text file. Instead
					of 
					<span class="emphasis"><em>model</em></span> we also sometimes refer to it as 
					<span class="emphasis"><em>semantic model</em></span> or _Abstract Syntax 
					Tree (AST)_. Note, that in the case of Xtext it&rsquo;s actually a graph rather than a 
					tree, since it also contains crosslinks. But as the term AST is so commonly 
					used and well known we are ignoring this minor detail. 
				</p>
<p>In order to tell the parser which 
					<span class="emphasis"><em>EClasses</em></span> to use when creating the AST, we 
					need to make them available by either importing existing Ecore packages or like 
					in our example let Xtext derive a package from the grammar. An 
					<span class="emphasis"><em>EPackage</em></span> has a 
					mandatory name and namespace URI (short: 
					<span class="emphasis"><em>nsURI</em></span>), so we have to declare these two values 
					in that statement. 
				</p>
<p>That&rsquo;s all for the prelude, now we have to define the parser rules which 
					effectively define a bi-directional mapping from text to a constructed AST. 
					It is bi-directional because Xtext not only derives a parser from the grammar but also 
					a serializer. Anyway, we will mostly talk about parsing in this chapter.</p>
<p>Ignore and delete the parser rules generated by the wizard and start by 
					declaring an entry rule for our language. The entry rule for the parser will be 
					called 
					<span class="emphasis"><em>DomainModel</em></span>. Xtext is fine with any name, it just picks the first rule 
					in a grammar and interprets it as the entry rule.
				</p>
<p>As a 
					<span class="emphasis"><em>DomainModel</em></span> consists of one or more 
					<span class="emphasis"><em>Entity</em></span> entries, this rule delegates 
					to another rule named 
					<span class="emphasis"><em>Entity</em></span>, which will be defined later on. As we can have an 
					arbitrary number of entities within a model, the cardinality is '
					<span class="emphasis"><em>*</em></span>'. There are 
					four different cardinalities available.
				</p>
<table id="N10135">
<tr>
						
<td>(no operator) </td>
						<td> exactly one  </td>
					
</tr>
<tr>
						
<td>
							<span class="emphasis"><em>?</em></span>     
						</td>
						<td> zero or one  </td>
					
</tr>
<tr>
						
<td>
							<span class="emphasis"><em>*</em></span>     
						</td>
						<td> zero or more</td>
					
</tr>
<tr>
						
<td>
							<span class="emphasis"><em>+</em></span>     
						</td>
						<td> one or more  </td>
					
</tr>
</table>
<p>Each rule ends with a semicolon. So our first rule reads for now as</p>
<div class="literallayout">
<p>
<code class="code">DomainModel&nbsp;:<br>
&nbsp;&nbsp;Entity*;&nbsp;<br>

<br>

</code>
</p>
</div>
<p>An Xtext grammar does not only describe rules for the parser but also the 
					structure of the resulting AST. Usually, each parser rule will create a new object 
					in that tree. The type of that element can be specified after the rule name using 
					the keyword 
					<span class="emphasis"><em>returns</em></span>. If the type&rsquo;s name is the same as the rule&rsquo;s name, it can 
					be omitted as in our case. Which effectively means that
				</p>
<div class="literallayout">
<p>
<code class="code">DomainModel&nbsp;returns&nbsp;DomainModel:&nbsp;...<br>

<br>

</code>
</p>
</div>
<p>is the same as</p>
<div class="literallayout">
<p>
<code class="code">DomainModel&nbsp;:&nbsp;...<br>

<br>

</code>
</p>
</div>
<p>In order to connect the different objects together, we have to assign the 
					elements returned by called rules to some feature of the current rule&rsquo;s object. 
					This is done by using so called assignments. </p>
<div class="literallayout">
<p>
<code class="code">DomainModel&nbsp;:<br>
&nbsp;&nbsp;(elements+=Entity)*;<br>

<br>

</code>
</p>
</div>
<p>The assignment with the '
					<span class="emphasis"><em>+=</em></span>' operator adds every object returned by the 

					<span class="emphasis"><em>Entity</em></span> rule to the 
					<span class="emphasis"><em>elements</em></span> referenced of the AST type 
					<span class="emphasis"><em>Model</em></span>. If you use '
					<span class="emphasis"><em>+=</em></span>' 
					as opposed to '
					<span class="emphasis"><em>=</em></span>' the feature needs to be a list &ndash; the upperBound has to be -1. In addition to the 
					two mentioned assignment operators there is a third one '
					<span class="emphasis"><em>?=</em></span>' which is called boolean 
					assignment and which sets a certain feature to true, if the part on the right hand 
					side was parsed successfully. Here&rsquo;s the list of available assignment operators:
				</p>
<table id="N101A5">
<tr>
						
<th>
							<span class="emphasis"><em>feature=...</em></span>   
						</th>
						<td>corresponds to 
							<span class="emphasis"><em>setFeature(...)</em></span>  
						</td>
					
</tr>
<tr>
						
<th>
							<span class="emphasis"><em>list+=...</em></span>  
						</th>
						<td>corresponds to 
							<span class="emphasis"><em>getList().add(...)</em></span>
						</td>
					
</tr>
<tr>
						
<th>
							<span class="emphasis"><em>condition?=...</em></span>  
						</th>
						<td>corresponds to 
							<span class="emphasis"><em>setCondition(true)</em></span>
						</td>
					
</tr>
</table>
<p>The next rule on our list is the rule 
					<span class="emphasis"><em>Entity</em></span>. Looking at our target syntax, 
					each entity begins with the keyword 
					<span class="emphasis"><em>'entity'</em></span> followed by the entity&rsquo;s name and an 
					opening curly brace (we will handle the 
					<span class="emphasis"><em>extends</em></span> clause in a second step). Then, 
					an entity defines a number of features and ends with a closing curly brace. The 
					rule looks like this:
				</p>
<div class="literallayout">
<p>
<code class="code">Entity&nbsp;:<br>
&nbsp;&nbsp;'entity'&nbsp;name=ID&nbsp;'{'<br>
&nbsp;&nbsp;&nbsp;&nbsp;(features+=Feature)*<br>
&nbsp;&nbsp;'}';<br>
&nbsp;&nbsp;<br>

</code>
</p>
</div>
<p>Keywords are simply declared as string literals within the rules. The name 
					uses the 
					<span class="emphasis"><em>ID</em></span> rule from the mixed-in grammar 
					<span class="emphasis"><em>org.eclipse.xtext.common.Terminals</em></span>. 
					The 
					<span class="emphasis"><em>ID</em></span> rule is a so called terminal rule which always returns simple data types, 
					such as 
					<span class="emphasis"><em>String</em></span>, 
					<span class="emphasis"><em>Date</em></span>, or 
					<span class="emphasis"><em>Integer</em></span>. Actually any Java class can be a simple 
					EMF 
					<span class="emphasis"><em>EDataType</em></span>. The 
					<span class="emphasis"><em>ID</em></span> rule recognizes alphanumeric words similar to identifiers 
					in Java and returns the value as a 
					<span class="emphasis"><em>String</em></span>. You can navigate to its declaration 
					using 
					<span class="emphasis"><em>F3</em></span>. As mentioned before the assignment operator '
					<span class="emphasis"><em>=</em></span>' denotes a single
					valued feature.
				</p>
<p>We want to allow inheritance for entities and therefore now add an optional 
					'
					<span class="emphasis"><em>extends</em></span>' part.
				</p>
<div class="literallayout">
<p>
<code class="code">Entity&nbsp;:<br>
&nbsp;&nbsp;'entity'&nbsp;name=ID&nbsp;('extends'&nbsp;superType=[Entity])?&nbsp;'{'<br>
&nbsp;&nbsp;&nbsp;&nbsp;(features+=Feature)*<br>
&nbsp;&nbsp;'}';<br>

<br>

</code>
</p>
</div>
<p>The question mark marks an element or as in this case an entire group of elements as optional.
					The other new thing is the right hand side of of the assignment 
					<span class="emphasis"><em>superType=[Entity]</em></span>.
					This is a cross-reference literal and states, that a cross-reference to an elsewhere 
					declared 
					<span class="emphasis"><em>Entity</em></span> should be established. So in this case 
					<span class="emphasis"><em>Entity</em></span> does not point to 
					the corresponding rule but to the 
					<span class="emphasis"><em>EClass</em></span>. As both are named equally this might 
					cause a little confusion at first. The full syntax for a cross-reference is 

					<span class="emphasis"><em>[TypeName|RuleCall]</em></span> where 
					<span class="emphasis"><em>RuleCall</em></span> defaults to 
					<span class="emphasis"><em>ID</em></span>. This means that 

					<span class="emphasis"><em>?</em></span> would work equally well. The parser only parses 
					the name of the cross-referenced element using the 
					<span class="emphasis"><em>ID</em></span> rule and stores it 
					internally. Later on the linker establishes the cross-reference using the name, the 
					defined cross-reference&rsquo;s type (
					<span class="emphasis"><em>Entity</em></span> in this case) and the defined scoping rules. 
					Scoping is not covered in this tutorial since the domain model DSL works with 
					the default scoping semantics. By default a namespace-based scoping is applied, which 
					means that all entities living in the same namespace are possible candidates for a 
					cross-reference. We talk a bit about this later on in this chapter when we introduce 
					namespaces.
				</p>
<p>In our introductory example model we had not only defined entities but also two 
					data types. So the 
					<span class="emphasis"><em>DomainModel</em></span> rule needs to be able to parse data types as well. 
					As both entities and data types will be referenced from the yet to be defined 
					<span class="emphasis"><em>Feature</em></span> 
					rule, we should introduce a common super type for them.
				</p>
<div class="literallayout">
<p>
<code class="code">DomainModel&nbsp;:<br>
&nbsp;&nbsp;(elements+=Type)*;<br>

<br>
Type:<br>
&nbsp;&nbsp;DataType&nbsp;|&nbsp;Entity;<br>
&nbsp;&nbsp;<br>
DataType:<br>
&nbsp;&nbsp;'datatype'&nbsp;name=ID;<br>
&nbsp;<br>

</code>
</p>
</div>
<p>A 
					<span class="emphasis"><em>DomainModel</em></span> now consists of types where a 
					<span class="emphasis"><em>Type</em></span> can either be a 
					<span class="emphasis"><em>DataType</em></span> or 
					an 
					<span class="emphasis"><em>Entity</em></span>. Our rule 
					<span class="emphasis"><em>Type</em></span> will just delegate to either of them, using the '
					<span class="emphasis"><em>|</em></span>' 
					alternatives operator. Now that we have a common super type for 
					<span class="emphasis"><em>Entity</em></span> and 
					<span class="emphasis"><em>DataType</em></span> 
					we are able to refer to both types of elements with a single cross-reference.
				</p>
<p>Next up we need to define the syntax of 
					<span class="emphasis"><em>Feature</em></span>, which shouldn&rsquo;t be surprising to 
					you, as we do not use any new concepts here.
				</p>
<div class="literallayout">
<p>
<code class="code">Feature:<br>
&nbsp;&nbsp;name=ID&nbsp;':'&nbsp;type=TypeRef;<br>

<br>

</code>
</p>
</div>
<p>In many target platforms there is a difference between the notion of a simple 
					attribute and a reference. In relational databases, for instance, a table contains 
					the values of attributes directly, but references are &bdquo;modeled&rdquo; by the means of 
					foreign keys. In object-relational persistence technologies such as JPA or Hibernate 
					references can have additional life-cycle semantics, which define what to do with 
					referenced objects in certain circumstances. Therefore you typically make a distinction 
					between the two concepts, as we do in the 
					<span class="emphasis"><em>Domain Model Example</em></span> you can create using 
					the wizard. However, in this small scenario we do not need a separation therefore we 
					stick with one single concept for features.
				</p>
<p>As the type reference has an additional property for the multiplicity (many or one), 
					we make it a separate model element and parser rule 
					<span class="emphasis"><em>TypeRef</em></span>. The presence of the 
					postfix &sbquo;*&rsquo; in an input file should set the boolean flag to &sbquo;true&rsquo; that indicates a multi-value
					type reference in the AST model. 
					This is the purpose of the assignment operator '
					<span class="emphasis"><em>?=</em></span>'. The parser rule looks like this:
				</p>
<div class="literallayout">
<p>
<code class="code">TypeRef&nbsp;:<br>
&nbsp;&nbsp;referenced=[Type]&nbsp;(multi?='*')?;<br>

<br>

</code>
</p>
</div>
<p>Again we have specified a cross-reference, which this time not only allows to 
					reference entities but all instances of type. So far this only includes data type and entities, but 
					you may want to introduce additional concepts in a future version, like for instance a 
					Value Object as proposed in Eric Evan&rsquo;s great book 
					<span class="emphasis"><em>Domain Driven Design</em></span>.
				</p>
<p>In the end your grammar editor should look like this:</p>
<div class="literallayout">
<p>
<code class="code">grammar&nbsp;org.eclipse.xtext.example.Domainmodel&nbsp;<br>
&nbsp;&nbsp;with&nbsp;org.eclipse.xtext.common.Terminals<br>
&nbsp;&nbsp;<br>
generate&nbsp;domainmodel&nbsp;"http://www.eclipse.org/xtext/example/Domainmodel"&nbsp;&nbsp;<br>

<br>
DomainModel&nbsp;:<br>
&nbsp;&nbsp;(elements+=Type)*;<br>
&nbsp;&nbsp;<br>
Type:<br>
&nbsp;&nbsp;DataType&nbsp;|&nbsp;Entity;<br>
&nbsp;&nbsp;<br>
DataType:<br>
&nbsp;&nbsp;'datatype'&nbsp;name=ID;<br>
&nbsp;<br>
Entity:<br>
&nbsp;&nbsp;'entity'&nbsp;name=ID&nbsp;('extends'&nbsp;superType=[Entity])?&nbsp;'{'<br>
&nbsp;&nbsp;&nbsp;&nbsp;(features+=Feature)*<br>
&nbsp;&nbsp;'}';<br>
&nbsp;<br>
Feature:<br>
&nbsp;&nbsp;name=ID&nbsp;':'&nbsp;type=TypeRef;<br>
&nbsp;&nbsp;<br>
TypeRef:<br>
&nbsp;&nbsp;referenced=[Type]&nbsp;(multi?='*')?;<br>
&nbsp;&nbsp;<br>

</code>
</p>
</div>
</div>
<div class="section" title="Generate Language Artifacts">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="GenerateLanguageArtifacts"></a>Generate Language Artifacts</h3>
</div>
</div>
</div>
<p>Now that we have the grammar in place and defined we need to run the generator that will derive the
					various language components. 
					To do so locate the file 
					<span class="emphasis"><em>GenerateDomainmodel.mwe2</em></span> file next to the grammar 
					file in the package explorer view. From its context menu, choose
				</p>
<span class="emphasis"><em>Run As -&gt; MWE2 Workflow</em></span>.
				<p>That will trigger the Xtext language generator. It generates the parser and 
					serializer and some additional infrastructure code. You will see its logging 
					messages in the Console View. </p>
</div>
<div class="section" title="Run the Generated IDE Plug-in">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="RuntheGeneratedIDEPlugin"></a>Run the Generated IDE Plug-in</h3>
</div>
</div>
</div>
<p>If the code generation succeeded, we are now able to test the IDE integration. 
					Right-click on the Xtext project and choose</p>
<span class="emphasis"><em>Run As -&gt; Eclipse Application</em></span>.
				<p>This will spawn a new Eclipse workbench with your projects as plug-ins installed. 
					In the new workbench, create a new project 
					(
					<span class="emphasis"><em>File -&gt; New -&gt; Project...  -&gt; General -&gt; Project</em></span>) and therein a new file 
					with the file extension you chose in the beginning (
					<span class="emphasis"><em>*.dmodel</em></span>). This will open
					the generated entity editor. Try it a bit and discover the default 
					functionality for code completion (
					<span class="emphasis"><em>CTRL SPACE</em></span> even for cross-references), 
					syntax highlighting, syntactic validation, linking errors, outline, find
					references etc.
				</p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/getting-started-editor.png"></div>
<p>
				
</p>
</div>
<div class="section" title="Adding a Namespace Concept">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="AddingaNamespaceConcept"></a>Adding a Namespace Concept</h3>
</div>
</div>
</div>
<p>At the current stage, our language puts all types into the same scope. As 
					cross-references are specified by means of names, this can easily yield collisions 
					as the model size increases. Avoiding such name clashes is why most programming 
					languages invent concepts like namespaces or modules. We will now introduce the 
					concept of a 
					<span class="emphasis"><em>Package</em></span>, which effectively is a namespace. 
				</p>
<p>Our languages&rsquo;s definition of a 
					<span class="emphasis"><em>Package</em></span> is as follows: A package has a name and 
					contains other named elements and namespace-imports. A named element is either another 

					<span class="emphasis"><em>Package</em></span> or a 
					<span class="emphasis"><em>Type</em></span>. Within a package, elements must have unique names. The 

					<span class="emphasis"><em>fully qualified name</em></span> (FQN) of a named element consists of the FQN of its package, 
					a separator '
					<span class="emphasis"><em>.</em></span>' and its own simple name. Elements refer to each other using their 

					<span class="emphasis"><em>qualified names</em></span> which may be relative to their common namespaces or absolute. By means 
					of import statements, these names can be further abbreviated. 
				</p>
<p>That might sound a bit complicated at first but the good thing is that Xtext 
					comes with exactly such a default semantic for namespaces, which feels very 
					natural in practice. Although all aspects of this semantic are adaptable, we 
					will stick to the defaults within this tutorial.</p>
<p>Before we extend the grammar, let&rsquo;s have a look how an example model would
					look like when using the newly introduced concepts:</p>
<div class="literallayout">
<p>
<code class="code">package&nbsp;my.types&nbsp;{<br>
&nbsp;&nbsp;datatype&nbsp;String<br>
&nbsp;&nbsp;datatype&nbsp;Boolean<br>
}<br>

<br>
package&nbsp;my.entities&nbsp;{<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;import&nbsp;my.types.*<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;entity&nbsp;Session&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;title:&nbsp;String<br>
&nbsp;&nbsp;&nbsp;&nbsp;isTutorial&nbsp;:&nbsp;Boolean<br>
&nbsp;&nbsp;}<br>

<br>
&nbsp;&nbsp;entity&nbsp;Conference&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;:&nbsp;String<br>
&nbsp;&nbsp;&nbsp;&nbsp;attendees&nbsp;:&nbsp;Person*<br>
&nbsp;&nbsp;&nbsp;&nbsp;speakers&nbsp;:&nbsp;Speaker*<br>
&nbsp;&nbsp;}<br>

<br>
&nbsp;&nbsp;entity&nbsp;Person&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;:&nbsp;String<br>
&nbsp;&nbsp;}<br>

<br>
&nbsp;&nbsp;entity&nbsp;Speaker&nbsp;extends&nbsp;Person&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;sessions&nbsp;:&nbsp;Session*<br>
&nbsp;&nbsp;}<br>
}<br>

<br>

</code>
</p>
</div>
<p>Let&rsquo;s start to modify our grammar now. First we introduce the rule 
					<span class="emphasis"><em>AbstractElement</em></span>:
				</p>
<div class="literallayout">
<p>
<code class="code">AbstractElement:<br>
&nbsp;&nbsp;PackageDeclaration&nbsp;|&nbsp;Type;<br>

<br>

</code>
</p>
</div>
<p>
					
<span class="emphasis"><em>DomainModel</em></span> should now call 
					<span class="emphasis"><em>AbstractElement</em></span> instead of 
					<span class="emphasis"><em>Type</em></span>:  
				</p>
<div class="literallayout">
<p>
<code class="code">DomainModel:<br>
&nbsp;&nbsp;(elements+=AbstractElement)*;<br>

<br>

</code>
</p>
</div>
<p>To allow qualified names, we need a new rule 
					<span class="emphasis"><em>QualifiedName</em></span>. This rule 
					returns a string. But we do not want this to be a 
					<span class="emphasis"><em>terminal rule</em></span>, as terminal 
					rules have special semantics (they are used context-less in the lexer, which 
					often causes problems). Instead we want it to be a parser rule, but one which
					doesn&rsquo;t return an instance of an 
					<span class="emphasis"><em>EClass</em></span> from the referenced 
					<span class="emphasis"><em>EPackage</em></span> but 
					just a plain String. Such rules are called 
					<span class="emphasis"><em>data type rules</em></span>, because they return 
					instances of 
					<span class="emphasis"><em>EDataType</em></span> as opposed to instances of 
					<span class="emphasis"><em>EClass</em></span>. String is the most 
					often used 
					<span class="emphasis"><em>EDataType</em></span> in this context and is therefore the default return 
					type for data type rules. The rule looks like this:
				</p>
<div class="literallayout">
<p>
<code class="code">QualifiedName:<br>
&nbsp;&nbsp;ID&nbsp;('.'&nbsp;ID)*;<br>

<br>

</code>
</p>
</div>
<p>Note, that Xtext automatically figures out that the rule is a 
					<span class="emphasis"><em>data type rule</em></span> 
					rather then a normal parser rule, because it doesn&rsquo;t contain any assignments 
					and all rule calls go to either other 
					<span class="emphasis"><em>data type rules</em></span> or 
					<span class="emphasis"><em>terminal rules</em></span>. 
					For a 
					<span class="emphasis"><em>data type rule</em></span> the parser simply concatenates the consumed text and returns 
					it as a string. The transformation to a user defined data type is done by so 
					called 
					<a class="link" href="#valueconverter" title="Value Converter">ValueConverters</a>. But as we use strings we don&rsquo;t need to care about 

					<span class="emphasis"><em>ValueConverters</em></span> here.
				</p>
<p>Next up we need to define the syntax of 
					<span class="emphasis"><em>PackageDeclarations</em></span>, which makes use of 
					the 
					<span class="emphasis"><em>QualifiedName</em></span> rule but doesn&rsquo;t make use of anything we haven&rsquo;t yet talked about.
				</p>
<div class="literallayout">
<p>
<code class="code">PackageDeclaration:<br>
&nbsp;&nbsp;'package'&nbsp;name=QualifiedName&nbsp;'{'<br>
&nbsp;&nbsp;&nbsp;&nbsp;(elements+=AbstractElement)*<br>
&nbsp;&nbsp;'}';<br>
&nbsp;&nbsp;<br>

</code>
</p>
</div>
<p>Having qualified names at hand, we want to specify cross-references that 
					way, too. As mentioned by default, Xtext assumes the rule 
					<span class="emphasis"><em>ID</em></span> as the syntax 
					for cross-references, which has been fully sufficient so far. But now we want 
					to allow fully qualified names as well, so we explicitly specify the syntax rule 
					after a delimiter '
					<span class="emphasis"><em>|</em></span>':
				</p>
<p>fn.. Note, that the '
					<span class="emphasis"><em>|</em></span>' has nothing to do with the previously introduced 
					alternative operator. In the context of a cross-reference it is simply a delimiter.  
				</p>
<div class="literallayout">
<p>
<code class="code">Entity:<br>
&nbsp;&nbsp;'entity'&nbsp;name=ID&nbsp;('extends'&nbsp;superType=[Entity|QualifiedName])?&nbsp;'{'<br>
&nbsp;&nbsp;&nbsp;&nbsp;(features+=Feature)*<br>
&nbsp;&nbsp;'}';<br>

<br>

</code>
</p>
</div>
<p>and</p>
<div class="literallayout">
<p>
<code class="code">TypeRef:<br>
&nbsp;&nbsp;referenced=[Type|QualifiedName]&nbsp;(multi?='*')?;<br>

<br>

</code>
</p>
</div>
<p>As the last step, we introduce imports. An 
					<span class="emphasis"><em>Import</em></span> is an instance of 

					<span class="emphasis"><em>AbstractElement</em></span>, too, so that it can occur as a child of 
					<span class="emphasis"><em>DomainModel</em></span> as 
					well as of 
					<span class="emphasis"><em>PackageDeclaration</em></span>.
				</p>
<div class="literallayout">
<p>
<code class="code">AbstractElement:<br>
&nbsp;&nbsp;PackageDeclaration&nbsp;|&nbsp;Type&nbsp;|&nbsp;Import;<br>

<br>

</code>
</p>
</div>
<p>An imported namespace is not just a qualified name but it also allows an 
					optional wildcard character '
					<span class="emphasis"><em>*</em></span>' at the end, so that multiple names can be 
					imported with one statement. That requires a new data type rule which we 
					name 
					<span class="emphasis"><em>QualifiedNameWithWildCard</em></span>:
				</p>
<div class="literallayout">
<p>
<code class="code">QualifiedNameWithWildCard:<br>
&nbsp;&nbsp;QualifiedName&nbsp;'.*'?;<br>

<br>

</code>
</p>
</div>
<p>The declaration of the 
					<span class="emphasis"><em>Import</em></span> rule should look familiar by now:
				</p>
<div class="literallayout">
<p>
<code class="code">Import:<br>
&nbsp;&nbsp;'import'&nbsp;importedNamespace=QualifiedNameWithWildCard;<br>

<br>

</code>
</p>
</div>
<p>The default scoping implementation is based on naming conventions. First 
					everything which has a name is referenceable. By default something has a name 
					if it has a property 
					<span class="emphasis"><em>'name'</em></span>. If such an 
					<span class="emphasis"><em>EAttribute</em></span> is available, the default 
					implementation computes a qualified name by asking the container for its name 
					and concatenates the two names separated by a dot. The computation of qualified
					names can be arbitrarily changed by implementing an 
					<span class="emphasis"><em>IQualifedNameProvider</em></span>. 
					The other naming convention is that if some element has an EAttribute 
&sbquo;					importedNamespace&rsquo; that value is used as a namespace import and is automatically 
					prefixed to any simple names used within that namespace. Also the asterisk '
					<span class="emphasis"><em>*</em></span>' 
					is used as a wildcard by default.
				</p>
<p>That&rsquo;s all for the grammar. It should now read as </p>
<div class="literallayout">
<p>
<code class="code">grammar&nbsp;org.eclipse.xtext.example.Domainmodel&nbsp;<br>
&nbsp;&nbsp;&nbsp;with&nbsp;org.eclipse.xtext.common.Terminals<br>

<br>
generate&nbsp;domainmodel&nbsp;"http://www.eclipse.org/xtext/example/Domainmodel"<br>

<br>
DomainModel:<br>
&nbsp;&nbsp;(elements+=AbstractElement)*;<br>

<br>
AbstractElement:<br>
&nbsp;&nbsp;PackageDeclaration&nbsp;|&nbsp;Type&nbsp;|&nbsp;Import;<br>
&nbsp;&nbsp;<br>
Import:<br>
&nbsp;&nbsp;'import'&nbsp;importedNamespace=QualifiedNameWithWildCard;<br>

<br>
PackageDeclaration:<br>
&nbsp;&nbsp;'package'&nbsp;name=QualifiedName&nbsp;'{'<br>
&nbsp;&nbsp;&nbsp;&nbsp;(elements+=AbstractElement)*<br>
&nbsp;&nbsp;'}';<br>

<br>
Type:<br>
&nbsp;&nbsp;Entity&nbsp;|&nbsp;DataType;<br>

<br>
DataType:<br>
&nbsp;&nbsp;'datatype'&nbsp;name=ID;<br>

<br>
Entity:<br>
&nbsp;&nbsp;'entity'&nbsp;name=ID&nbsp;('extends'&nbsp;superType=[Entity|QualifiedName])?&nbsp;'{'<br>
&nbsp;&nbsp;&nbsp;&nbsp;(features+=Feature)*<br>
&nbsp;&nbsp;'}';<br>

<br>
Feature:<br>
&nbsp;&nbsp;name=ID&nbsp;':'&nbsp;type=TypeRef;<br>

<br>
TypeRef:<br>
&nbsp;&nbsp;referenced=[Type|QualifiedName]&nbsp;(multi?='*')?;<br>

<br>
QualifiedName:<br>
&nbsp;&nbsp;ID&nbsp;('.'&nbsp;ID)*;<br>
&nbsp;&nbsp;<br>
QualifiedNameWithWildCard:<br>
&nbsp;&nbsp;QualifiedName&nbsp;'.*'?;<br>

<br>

</code>
</p>
</div>
<p>Now you should regenerate the language infrastructure as described in the 
					previous section, and give the editor a try. You can even split up your model 
					into smaller parts and have cross-references across file boundaries, as long 
					as the referenced models are on the classpath.</p>
</div>
</div>
<div class="section" title="Processing Xtext Models">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="processing_Xtext_models"></a>Processing Xtext Models</h2>
</div>
</div>
</div>
<p>Now that we know how to create a language we should talk about processing the parsed models somehow. 
				There are typically two useful things one can do with
				Xtext models: One is translating them to another programming language, i.e. writing a code generator, 
				the other is loading them at runtime and use them
				dynamically. We&rsquo;ll talk about code generation later. In this chapter we want to see how to interact with 
				Xtext models programmatically. </p>
<p>Text files parsed by Xtext are represented as object graphs in memory. We call these object graphs 
				<span class="emphasis"><em>Abstract Syntax Tree (AST)</em></span>, 
				<span class="emphasis"><em>semantic model</em></span> or 
				simply 
				<span class="emphasis"><em>model</em></span> interchangeably. In Xtext models are implemented using the 
				<span class="emphasis"><em>Eclipse Modeling Framework (EMF)</em></span>, which can be seen as a very powerful version 
				of JavaBeans. It not only provides the typical getter and setter methods for the different features of a model element but also comes with an long list of 
				advanced concepts and semantics, which are extremely useful in the context of Xtext.
			</p>
<div class="section" title="Loading a Resource">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="resource"></a>Loading a 
					<span class="emphasis"><em>Resource</em></span> 
				
</h3>
</div>
</div>
</div>
<p>EMF models can be persisted by the means of a so called 
					<span class="emphasis"><em>Resource</em></span>. Xtext languages implement the 
					<span class="emphasis"><em>Resource</em></span> interface which is why you can use the EMF API to
					load a model into memory (and also save them):
				</p>
<div class="literallayout">
<p>
<code class="code">new&nbsp;DomainmodelStandaloneSetup().createInjectorAndDoEMFRegistration();<br>

<br>
ResourceSet&nbsp;rs&nbsp;=&nbsp;new&nbsp;ResourceSetImpl();<br>
Resource&nbsp;resource&nbsp;=&nbsp;rs.getResource(URI.createURI("./mymodel.dmodel"),&nbsp;true);<br>
EObject&nbsp;eobject&nbsp;=&nbsp;resource.getContents().get(0);<br>
&nbsp;<br>

</code>
</p>
</div>
<p>The first line initializes the language infrastructure to run in 
					<span class="emphasis"><em>standalone</em></span> mode. That is EMF is designed to work in Eclipse and therefore makes use of 
					Equinox extension points in order to register factories and the like. In a vanilla Java project there is no Equinox, hence we do the registration programmaticly.
					The generated 
					<span class="emphasis"><em>MyLanguageStandaloneSetup</em></span> class does just that. You don&rsquo;t have to do this kind of initialization when you run your plug-ins within Eclipse, since in that case 
					the extension point declarations are used.
				</p>
<p>The other thing the 
					<span class="emphasis"><em>StandaloneSetup</em></span> takes care of is creating a Guice 
					<span class="emphasis"><em>injector</em></span>. The use of Guice and Dependency Injection is explained 
					<a class="link" href="#dependencyInjection" title="Dependency Injection in Xtext with Google Guice">here</a>. 
				</p>
<p>Now that the language infrastructure is initialized and the different contributions to EMF are registered, we want to load a 
					<span class="emphasis"><em>Resource</em></span>. To do so we first create a 

					<span class="emphasis"><em>ResourceSet</em></span>, which as the name suggests represents a set of Resources. If one 
					<span class="emphasis"><em>Resource</em></span> references another 
					<span class="emphasis"><em>Resource</em></span>, EMF will automatically load that other 
					<span class="emphasis"><em>Resource</em></span>
					into the same 
					<span class="emphasis"><em>ResourceSet</em></span> as soon as the cross-reference is resolved. Resolution of cross-references is done lazy, i.e. on first access.
				</p>
<p>The 4th line loads the 
					<span class="emphasis"><em>Resource</em></span> using the resource set. We pass in a URI which points to the file in the file system. 
					EMF&rsquo;s URI is a powerful concept. It supports a lot of different schemes to load resources from file system, web sites, jars, OSGi bundles or even 
					from Java&rsquo;s classpath. And if that is not enough you can come up with your own schemes. Also a URI can not only point to a resource but also to any 
					<span class="emphasis"><em>EObject</em></span> in a resource.
					This is done by appending a so called 
					<span class="emphasis"><em>URI fragment</em></span> to the URI. 
				</p>
<p>The second parameter denotes whether the resource should automatically be loaded if it wasn&rsquo;t already before. Alternatively we could have written</p>
<div class="literallayout">
<p>
<code class="code">Resource&nbsp;resource&nbsp;=&nbsp;rs.getResource(URI.createURI("./mymodel.dmodel"),&nbsp;false);<br>
resource.load(null);<br>

<br>

</code>
</p>
</div>
<p>The load method optionally takes a map of properties, which allows to define a contract between a client and the specific implementation. In Xtext, for instance, we use 
					the map to state whether cross-references should be eagerly resolved. In order to find out what properties are supported, it&rsquo;s usually best to look into 
					the concrete implementations. That said, in most cases you don&rsquo;t need to pass any properties at all.</p>
<p>The last line </p>
<div class="literallayout">
<p>
<code class="code">EObject&nbsp;eobject&nbsp;=&nbsp;resource.getContents().get(0);<br>

<br>

</code>
</p>
</div>
<p>assigns the root element to a local variable.
					Actually it is the first element from the contents list of a 
					<span class="emphasis"><em>Resource</em></span>, but in Xtext a 
					<span class="emphasis"><em>Resource</em></span> always has just one root element.
				</p>
</div>
<div class="section" title="Working with EMF Models">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="programmatic_EMF"></a>Working with EMF Models</h3>
</div>
</div>
</div>
<p>We have previously talked about Ecore models, which effectively is an 
					<span class="emphasis"><em>EPackage</em></span> containing a any number of 
					<span class="emphasis"><em>EClasses</em></span> with 
					<span class="emphasis"><em>EAttributes</em></span> and 
					<span class="emphasis"><em>EReferences</em></span>. 
					Ecore defines additional concepts but they are not so important here. An 
					<span class="emphasis"><em>EObject</em></span> is an instance of an 
					<span class="emphasis"><em>EClass</em></span>. For instance, the root element
					of a domain model would be an instance of the EClass 
					<span class="emphasis"><em>DomainModel</em></span>, as defined in the grammar in the last chapter. EMF provides a reflection layer to work
					with EObjects in a generic way. 
				</p>
<div class="literallayout">
<p>
<code class="code">assertEquals("DomainModel",&nbsp;eobject.eClass().getName());<br>
&nbsp;<br>

</code>
</p>
</div>
<p>It is also possible to create new instances or get and set values using the reflection layer. That reflection layer is very helpful when creating generic 
					libraries for EMF models, however if you know what kind of model you are working with it&rsquo;s much nicer to program against the generated Java classes. 
					As we know that the root element is an instance of DomainModel we can just cast it to the Java interface generated by EMF:</p>
<div class="literallayout">
<p>
<code class="code">DomainModel&nbsp;domainModel&nbsp;=&nbsp;(DomainModel)&nbsp;eobject;<br>

<br>

</code>
</p>
</div>
<p>The generated Java types provide getter and setter methods for each 
					<span class="emphasis"><em>EAttribute</em></span> and 
					<span class="emphasis"><em>EReference</em></span>, so that you can easily navigate the model using Java:
				</p>
<div class="literallayout">
<p>
<code class="code">EList&lt;AbstractElement&gt;&nbsp;elements&nbsp;=&nbsp;domainModel.getElements();<br>
for&nbsp;(AbstractElement&nbsp;abstractElement&nbsp;:&nbsp;elements)&nbsp;{<br>
&nbsp;&nbsp;if&nbsp;(abstractElement&nbsp;instanceof&nbsp;Entity)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;Entity&nbsp;entity&nbsp;=&nbsp;((Entity)abstractElement);<br>
&nbsp;&nbsp;&nbsp;&nbsp;System.out.println("entity&nbsp;"<br>
&nbsp;&nbsp;&nbsp;&nbsp;	+&nbsp;entity.getName()<br>
&nbsp;&nbsp;&nbsp;&nbsp;	+&nbsp;"&nbsp;extends&nbsp;"<br>
&nbsp;&nbsp;&nbsp;&nbsp;	+&nbsp;entity.getSuperType().getName());<br>
&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(abstractElement&nbsp;instanceof&nbsp;PackageDeclaration)&nbsp;{<br>
&nbsp;&nbsp;	PackageDeclaration&nbsp;pkgDecl&nbsp;=&nbsp;(PackageDeclaration)&nbsp;abstractElement;<br>
&nbsp;&nbsp;	System.out.println("package&nbsp;"<br>
&nbsp;&nbsp;&nbsp;&nbsp;	+&nbsp;pkgDecl.getName());<br>
&nbsp;&nbsp;}<br>
}<br>

<br>

</code>
</p>
</div>
<p>Note that you&rsquo;ll find a lot of convenience API in EMF&rsquo;s 
					<span class="emphasis"><em>EcoreUtil</em></span> and Xtext&rsquo;s 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/EcoreUtil2.java?root=Modeling_Project&view=co" target="_new">EcoreUtil2</a>. 
				</p>
</div>
<div class="section" title="Working with the Parse Tree (aka Node Model)">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="node_model"></a>Working with the Parse Tree (aka Node Model)</h3>
</div>
</div>
</div>
<p>In many situations the information from the 
					<span class="emphasis"><em>AST</em></span> is sufficient, but in some situations you need additional syntactical information. In Xtext not only
					an 
					<span class="emphasis"><em>AST</em></span> is constructed while parsing but also a so called 
					<span class="emphasis"><em>parse tree</em></span>, which contains all the textual information chunked in so called tokens. The 
					<span class="emphasis"><em>parse tree</em></span>, also 
					called 
					<span class="emphasis"><em>node model</em></span>, consists of two different kinds of nodes. 
				</p>
<p>
					
<span class="emphasis"><em>LeafNodes</em></span> as the name suggests represent the leafs of the parse tree. Each leaf node represents one 
					token. If you go through all leaf nodes of a parse tree and concatenate all the tokens to one string, you&rsquo;ll end up with the whole textual representation 
					of the model, including all hidden tokens such as whitespace and comments. The following code does exactly that:
				</p>
<div class="literallayout">
<p>
<code class="code">CompositeNode&nbsp;node&nbsp;=&nbsp;NodeUtil.getNode(domainModel);<br>
Iterable&lt;AbstractNode&gt;&nbsp;contents&nbsp;=&nbsp;NodeUtil.getAllContents(node);<br>
StringBuffer&nbsp;text&nbsp;=&nbsp;new&nbsp;StringBuffer();<br>
for&nbsp;(AbstractNode&nbsp;abstractNode&nbsp;:&nbsp;contents)&nbsp;{<br>
&nbsp;&nbsp;if&nbsp;(abstractNode&nbsp;instanceof&nbsp;LeafNode)<br>
&nbsp;&nbsp;&nbsp;&nbsp;text.append(((LeafNode)abstractNode).getText());<br>
}<br>
System.out.println(text);<br>

<br>

</code>
</p>
</div>
<p>In addition to the text 
					<span class="emphasis"><em>LeafNodes</em></span> also hold information about the line, the offset and the length of that token.
				</p>
<p>The other node type is called 
					<span class="emphasis"><em>CompositeNode</em></span> and is created for almost each grammar element. A composite node can contain other composite nodes and leaf nodes.
					The super type of both node types is 
					<span class="emphasis"><em>AbstractNode</em></span>. One can find a couple of convenience methods in 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/parsetree/NodeUtil.java?root=Modeling_Project&view=co" target="_new">NodeUtil</a> and 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/parsetree/ParseTreeUtil.java?root=Modeling_Project&view=co" target="_new">ParseTreeUtil</a>.
				</p>
</div>
<div class="section" title="Working with the Grammar">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="working_with_grammar_model"></a>Working with the Grammar</h3>
</div>
</div>
</div>
<p>Also the grammar is represented as an EMF model and can be used in Java. In fact each node of the 
					<span class="emphasis"><em>node model</em></span> references
					the element from the grammar which was responsible for parsing or lexing that node:
				</p>
<div class="literallayout">
<p>
<code class="code">DomainModel&nbsp;domainModel&nbsp;=&nbsp;(DomainModel)&nbsp;eObject;<br>
CompositeNode&nbsp;node&nbsp;=&nbsp;NodeUtil.getNode(domainModel);<br>
ParserRule&nbsp;parserRule&nbsp;=&nbsp;(ParserRule)&nbsp;node.getGrammarElement();<br>
assertEquals("DomainModel",&nbsp;parserRule.getName());<br>

<br>

</code>
</p>
</div>
</div>
<div class="section" title="Working with Live Models">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="WorkingwithLiveModels"></a>Working with Live Models</h3>
</div>
</div>
</div>
<p>In a running Xtext Workbench, there are a number of components which access the semantic model of an open editor, i.e. the parser, the linker, the validator, the outline, the index builder etc. While some of these components are executed by the display thread, others like the parser or the indexer use different concurrent threads to not deteriorate the editing experience. If you for example want to have a consistent outline of your model, it is essential to keep other threads from modifying the model while the outline component reads it.</p>
<p>Many of the prominent locations where users can hook in their own code in Xtext are already called from within a thread safe context, e.g. the API for 
					<a class="link" href="#quickfixes" title="Quick Fixes">quick fixes</a>. Consequently, the following usually applies only if you add additional functionality on top of Xtext, e.g. custom UI actions.
				</p>
<p>Each 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui/src/org/eclipse/xtext/ui/editor/XtextEditor.java?root=Modeling_Project&view=co" target="_new">XtextEditor</a> uses an 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui/src/org/eclipse/xtext/ui/editor/model/IXtextDocument.java?root=Modeling_Project&view=co" target="_new">IXtextDocument</a> to store its model. To avoid synchronization trouble, neither of them provides direct access to the 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/resource/XtextResource.java?root=Modeling_Project&view=co" target="_new">XtextResource</a> storing the semantic model. Instead, the 
					<span class="emphasis"><em>IXtextDocument</em></span> has two methods 
					<span class="emphasis"><em>readOnly()</em></span> and 
					<span class="emphasis"><em>modify()</em></span>. Both take an argument of type 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.util/src/org/eclipse/xtext/util/concurrent/IUnitOfWork.java?root=Modeling_Project&view=co" target="_new">IUnitOfWork</a>
					<span class="emphasis"><em>(&lt;T&gt;, IXtextResource)</em></span> which defines a method 
					<span class="emphasis"><em>&lt;T&gt; exec(IXtextResource)</em></span> that contains what you want to do with the model and allows to deliver a result of arbitrary type.
				</p>
<p>So here is an example of safely reading a model:</p>
<div class="literallayout">
<p>
<code class="code">IXtextDocument&nbsp;myDocument&nbsp;=&nbsp;...;<br>
String&nbsp;rootElementName&nbsp;=&nbsp;&nbsp;myDocument.readOnly(<br>
&nbsp;&nbsp;new&nbsp;IUnitOfWork(){<br>
&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;String&nbsp;exec(IXtextResource&nbsp;resource)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MyType&nbsp;type&nbsp;=&nbsp;(MyType)resource.getContents().get(0);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;myType.getName();<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;});<br>

<br>

</code>
</p>
</div>
<p>Direct write-access on the document is usually only performed inside the framework. If you want to change a document by means of its semantic model, you should rather use an 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui/src/org/eclipse/xtext/ui/editor/model/edit/IDocumentEditor.java?root=Modeling_Project&view=co" target="_new">IDocumentEditor</a> which uses the 
					<span class="emphasis"><em>modify()</em></span> method internally but takes care of synchronizing the 
					<a class="link" href="#node_model" title="Working with the Parse Tree (aka Node Model)">node model</a>, too:
				</p>
<div class="literallayout">
<p>
<code class="code">@Inject<br>
private&nbsp;IDocumentEditor&nbsp;documentEditor;<br>

<br>
public&nbsp;void&nbsp;setRootName(IXtextDocument&nbsp;myDocument,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;String&nbsp;newName)&nbsp;{<br>
&nbsp;documentEditor.process(<br>
&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;IUnitOfWork.Void()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;process(IXtextResource&nbsp;resource)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MyType&nbsp;type&nbsp;=&nbsp;(MyType)resource.getContents().get(0);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myType.setName(newName);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;},&nbsp;myDocument);<br>
}<br>

<br>

</code>
</p>
</div>
</div>
<div class="section" title="Summary">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Summary"></a>Summary</h3>
</div>
</div>
</div>
<p>Let&rsquo;s summarize what we have learned: An Xtext model is loaded by an EMF Resource. The main model is represented as an instance of so called 
					<span class="emphasis"><em>EClasses</em></span> which are themselves
					declared within Ecore models. A 
					<span class="emphasis"><em>parse tree</em></span> is created as well, which effectively acts as a tracing model between the text, the 
					<span class="emphasis"><em>AST</em></span> and the grammar. The following
					diagram illustrates the four different kinds of models.
				</p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/xtext_data_structures.png"></div>
<p>
				
</p>
</div>
</div>
<div class="section" title="Writing a Code Generator">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="getting-started-xpand"></a>Writing a Code Generator</h2>
</div>
</div>
</div>
<p>In the previous section we&rsquo;ve seen how to process Xtext files in general (e.g. with Java). 
				If you need late binding, loading models dynamically and interpreting them is a good idea. 
				If you do not need late binding, code generation is a viable option which is widely used to make models executable. </p>
<p>You could of course use Java to do the code generation, but unfortunately Java doesn&rsquo;t support this task very well.
				Therefore we use a language specialized on code generation: M2T Xpand.</p>
<div class="section" title="Xpand and MWE2">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="XpandandMWE2"></a>Xpand and MWE2</h3>
</div>
</div>
</div>
<p>Xpand is also part of Eclipse and ships with its own documentation, so we don&rsquo;t need to explain all the details here, but
					rather want to point you to the existing documentation. Instead this chapter is about providing some information about how to
					use Xtext and Xpand together. </p>
<p>The other technology we are going to use here is the 
					<a class="link" href="#MWE2" title="Chapter&nbsp;6.&nbsp;MWE2">Modeling Workflow Engine 2</a>. It is used to describe the generation workflow,
					that is how and which models should be loaded, how they should be validated post-processed and where and how code generation should take place.
				</p>
<p>This section is based on the 
					<a class="link" href="#getting-started-xtext" title="Creating a DSL">Getting Started</a> section and uses the code generator project which is created by Xtext&rsquo;s project wizard.
				</p>
</div>
<div class="section" title="The Empty Generator Project">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="TheEmptyGeneratorProject"></a>The Empty Generator Project</h3>
</div>
</div>
</div>
<p>Previously when we created the projects to develop the domain model language, we had checked the option 
					<span class="emphasis"><em>Create a generator project</em></span> in the wizard, which as 
					a result created a third project for us in the workspace. If you&rsquo;ve followed along you should have a project called 
&sbquo;					org.eclipse.xtext.example.domainmodel.generator&rsquo; in your workspace. It should look like shown in the following screenshot:
				</p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/generator-project.png"></div>
<p>
				
</p>
</div>
<div class="section" title="Replacing the Example Model File (1)">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="ReplacingtheExampleModelFile1"></a>Replacing the Example Model File (1)</h3>
</div>
</div>
</div>
<p>The four files shown in the image above are very simple stubs generated for the &sbquo;Hello World&rsquo;-language the wizard creates as a starting point. 
					We&rsquo;ll have to adapt them to match the domain model language we have developed in the 
					<a class="link" href="#getting-started-xtext" title="Creating a DSL">getting started section</a>. The first 
					thing we should do is open up the example model file (1) and replace its contents with an instance of the domain model language. To do so 
					copy and paste the following into the editor:
				</p>
<div class="literallayout">
<p>
<code class="code">package&nbsp;java.lang&nbsp;{<br>
&nbsp;&nbsp;datatype&nbsp;String<br>
&nbsp;&nbsp;datatype&nbsp;Boolean<br>
}<br>

<br>
package&nbsp;my.entities&nbsp;{<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;import&nbsp;java.lang.*<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;entity&nbsp;Session&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;title:&nbsp;String<br>
&nbsp;&nbsp;&nbsp;&nbsp;isTutorial&nbsp;:&nbsp;Boolean<br>
&nbsp;&nbsp;}<br>

<br>
&nbsp;&nbsp;entity&nbsp;Conference&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;:&nbsp;String<br>
&nbsp;&nbsp;&nbsp;&nbsp;attendees&nbsp;:&nbsp;Person*<br>
&nbsp;&nbsp;&nbsp;&nbsp;speakers&nbsp;:&nbsp;Speaker*<br>
&nbsp;&nbsp;}<br>

<br>
&nbsp;&nbsp;entity&nbsp;Person&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;:&nbsp;String<br>
&nbsp;&nbsp;}<br>

<br>
&nbsp;&nbsp;entity&nbsp;Speaker&nbsp;extends&nbsp;Person&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;sessions&nbsp;:&nbsp;Session*<br>
&nbsp;&nbsp;}<br>
}&nbsp;<br>

<br>

</code>
</p>
</div>
</div>
<div class="section" title="The Modeling Workflow Engine File (2)">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="TheModelingWorkflowEngineFile2"></a>The Modeling Workflow Engine File (2) </h3>
</div>
</div>
</div>
<p>As mentioned MWE2 is used to define and configure the generation process. Actually, it is much more general and can be useful for a lot of other things as well.
					Let&rsquo;s have a look at the MWE2 file as generated by the wizard:</p>
<div class="literallayout">
<p>
<code class="code">module&nbsp;workflow.DomainmodelGenerator<br>

<br>
import&nbsp;org.eclipse.emf.mwe.utils.*<br>

<br>
var&nbsp;targetDir&nbsp;=&nbsp;"src-gen"<br>
var&nbsp;fileEncoding&nbsp;=&nbsp;"ISO-8859-1"<br>
var&nbsp;modelPath&nbsp;=&nbsp;"src/model"<br>

<br>
Workflow&nbsp;{<br>

<br>
	component&nbsp;=&nbsp;org.eclipse.xtext.mwe.Reader&nbsp;{<br>
		//&nbsp;lookup&nbsp;all&nbsp;resources&nbsp;on&nbsp;the&nbsp;classpath<br>
		//&nbsp;useJavaClassPath&nbsp;=&nbsp;true<br>

<br>
		//&nbsp;or&nbsp;define&nbsp;search&nbsp;scope&nbsp;explicitly<br>
		path&nbsp;=&nbsp;modelPath<br>

<br>
		//&nbsp;this&nbsp;class&nbsp;will&nbsp;be&nbsp;generated&nbsp;by&nbsp;the&nbsp;xtext&nbsp;generator&nbsp;<br>
		register&nbsp;=&nbsp;org.eclipse.xtext.example.DomainmodelStandaloneSetup&nbsp;{}<br>
		load&nbsp;=&nbsp;{<br>
			slot&nbsp;=&nbsp;"greetings"<br>
			type&nbsp;=&nbsp;"Greeting"<br>
		}<br>
	}<br>

<br>
	component&nbsp;=&nbsp;org.eclipse.xpand2.Generator&nbsp;{<br>
		expand&nbsp;=&nbsp;"templates::Template::main&nbsp;FOREACH&nbsp;greetings"<br>
		outlet&nbsp;=&nbsp;{<br>
			path&nbsp;=&nbsp;targetDir<br>
		}<br>
		fileEncoding&nbsp;=&nbsp;fileEncoding<br>
	}<br>
}<br>

<br>

</code>
</p>
</div>
<p>The first line just declares a name for this workflow file. Any qualified Java identifier is allowed, but it should 
					match the file name of the MWE2 file (and in future versions we might make this mandatory). It is followed by an 
					<span class="emphasis"><em>import</em></span> statement.
					MWE2 references Java classes and to make that convenient, you can specify imports after the module declaration. Next up we 
					see a couple of 
					<span class="emphasis"><em>vars</em></span> are declared. Such 
					<span class="emphasis"><em>vars</em></span> can be overridden when invoking a workflow file. 
				</p>
<p>The important part is the 
					<span class="emphasis"><em>Workflow</em></span> part. There we declare an instance of 
					<span class="emphasis"><em>org.eclipse.emf.mwe.utils.Workflow</em></span> and add two instances to the 
					<span class="emphasis"><em>component</em></span>
					property. The first one is a 
					<span class="emphasis"><em>Reader</em></span> which is used to initialize Xtext languages, read in Xtext files, and fetch specific elements from those models in order to
					make them available to following workflow components (such as the declared 
					<span class="emphasis"><em>Generator</em></span>). 
				</p>
<p>Xtext language initialization is done by specifying any number of 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/ISetup.java?root=Modeling_Project&view=co" target="_new">ISetup</a> implementations. In our case the generated 
					<span class="emphasis"><em>DomainModelStandaloneSetup</em></span> is
					registered, which makes sure that the infrastructure of your domain model language is set up properly. If you have multiple languages just add additional assignments for each language.
				</p>
<p>You have to tell the 
					<span class="emphasis"><em>Reader</em></span> which paths to scan for model files. In this particular case we just specified one path. Another convenient option is to reuse the Java classpath, as suggested in the comments.
				</p>
<p>The 
					<span class="emphasis"><em>load</em></span> section specifies which elements to fetch from the loaded resources. In this case we state that we want all elements of type 
					<span class="emphasis"><em>Greeting</em></span>.
					Note that this is completely file agnostic, it will provide you with all elements from all files the 
					<span class="emphasis"><em>Reader</em></span> could find on the specified paths.
					The slot name is the name by which other workflow components can access the stored elements.
				</p>
<p>The second workflow component is an instance of 
					<span class="emphasis"><em>org.eclipse.xpand2.Generator</em></span>, which is the MWE2 facade to the Xpand template language. 
					The Xpand generator needs to know which template to invoke for which models. Qualified names in Xpand are separated by a double colon 
					<span class="emphasis"><em>'::'</em></span>. That
					is the name 
					<span class="emphasis"><em>'templates::Template::main'</em></span> points to the definition 
					<span class="emphasis"><em>main</em></span> in the file 
					<span class="emphasis"><em>templates/Template.xpt</em></span> on the Java classpath. The second part

					<span class="emphasis"><em>FOREACH greetings</em></span> references the 
					<span class="emphasis"><em>greetings</em></span> slot which has previously been populated by the reader component.
				</p>
<p>An 
					<span class="emphasis"><em>Outlet</em></span> describes where to put the generated sources. In Xpand there is a file-statement which refers to outlets. If you only have one outlet 
					you don&rsquo;t have to give it a name, but you need to declare where the root folder for that outlet can be found in the file system. I.e. you specifiy where the generated code should go.
					Oulets allow you to specify a couple of other things as well. As MWE2 just instantiates Java objects, you can go to the Java code of 
					<span class="emphasis"><em>org.eclipse.xpand2.output.Outlet</em></span>
					 in order to find out (see the adder and setter methods). 
					about the different options.
				</p>
<p>Now that we understood the most important things in the workflow we have to adapt it to match our domain model language. We only have to change the type
					which is used to fetch and filter the elements in the load section. We want to generate code for entities, therefore we change it to Entity. We should change the slot&rsquo;s 
					name, too:</p>
<div class="literallayout">
<p>
<code class="code">module&nbsp;workflow.DomainmodelGenerator<br>

<br>
import&nbsp;org.eclipse.emf.mwe.utils.*<br>

<br>
var&nbsp;targetDir&nbsp;=&nbsp;"src-gen"<br>
var&nbsp;fileEncoding&nbsp;=&nbsp;"ISO-8859-1"<br>
var&nbsp;modelPath&nbsp;=&nbsp;"src/model"<br>

<br>
Workflow&nbsp;{<br>

<br>
	component&nbsp;=&nbsp;org.eclipse.xtext.mwe.Reader&nbsp;{<br>
		//&nbsp;lookup&nbsp;all&nbsp;resources&nbsp;on&nbsp;the&nbsp;classpath<br>
		//&nbsp;useJavaClassPath&nbsp;=&nbsp;true<br>

<br>
		//&nbsp;or&nbsp;define&nbsp;search&nbsp;scope&nbsp;explicitly<br>
		path&nbsp;=&nbsp;modelPath<br>

<br>
		//&nbsp;this&nbsp;class&nbsp;will&nbsp;be&nbsp;generated&nbsp;by&nbsp;the&nbsp;xtext&nbsp;generator&nbsp;<br>
		register&nbsp;=&nbsp;org.eclipse.xtext.example.DomainmodelStandaloneSetup&nbsp;{}<br>
		load&nbsp;=&nbsp;{<br>
			slot&nbsp;=&nbsp;"entities"&nbsp;//changed&nbsp;to&nbsp;entities<br>
			type&nbsp;=&nbsp;"Entity"&nbsp;&nbsp;&nbsp;//changed&nbsp;to&nbsp;Entity<br>
		}<br>
	}<br>

<br>
	component&nbsp;=&nbsp;org.eclipse.xpand2.Generator&nbsp;{<br>
		expand&nbsp;=&nbsp;"templates::Template::main&nbsp;FOREACH&nbsp;entities"&nbsp;//changed&nbsp;to&nbsp;entities<br>
		outlet&nbsp;=&nbsp;{<br>
			path&nbsp;=&nbsp;targetDir<br>
		}<br>
		fileEncoding&nbsp;=&nbsp;fileEncoding<br>
	}<br>
}<br>

<br>

</code>
</p>
</div>
</div>
<div class="section" title="Using Xpand (3) and Xtend (4) for Code Generation">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="UsingXpand3andXtend4forCodeGeneration"></a>Using Xpand (3) and Xtend (4) for Code Generation</h3>
</div>
</div>
</div>
<p>The MWE2 file invokes an Xpand definition called 
					<span class="emphasis"><em>main</em></span> located in 
					<span class="emphasis"><em>templates/Template.xpt</em></span>. 
					Please open that file and replace its contents with the following Xpand code:
				</p>
<div class="literallayout">
<p>
<code class="code">&laquo;IMPORT&nbsp;org::eclipse::xtext::example::domainmodel&raquo;<br>
&laquo;EXTENSION&nbsp;templates::Extensions&raquo;<br>

<br>
&laquo;DEFINE&nbsp;main&nbsp;FOR&nbsp;Entity-&raquo;<br>
&laquo;FILE&nbsp;qualifiedName().replaceAll("\\.","/")+".java"-&raquo;<br>
package&nbsp;&laquo;packageName()&raquo;;<br>

<br>
public&nbsp;class&nbsp;&laquo;name&raquo;&nbsp;&laquo;IF&nbsp;superType&nbsp;!=&nbsp;null&raquo;&nbsp;extends&nbsp;&laquo;superType.name&raquo;&laquo;ENDIF&raquo;{<br>
{<br>
&nbsp;&nbsp;&laquo;EXPAND&nbsp;property&nbsp;FOREACH&nbsp;features&raquo;<br>
}<br>
&laquo;ENDFILE&raquo;<br>
&laquo;ENDDEFINE&raquo;<br>

<br>
&laquo;DEFINE&nbsp;property&nbsp;FOR&nbsp;Feature&raquo;<br>
&nbsp;&nbsp;private&nbsp;&laquo;type.referenced.qualifiedName()&raquo;&nbsp;&laquo;name&raquo;;<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;set&laquo;name.toFirstUpper()&raquo;(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&laquo;type.referenced.qualifiedName()&raquo;&nbsp;&laquo;name&raquo;)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;this.&laquo;name&raquo;&nbsp;=&nbsp;&laquo;name&raquo;;<br>
&nbsp;&nbsp;}&nbsp;<br>
&nbsp;&nbsp;public&nbsp;&laquo;type.referenced.qualifiedName()&raquo;&nbsp;get&laquo;name.toFirstUpper()&raquo;()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&laquo;name&raquo;;<br>
&nbsp;&nbsp;}&nbsp;<br>
&laquo;ENDDEFINE&raquo;<br>

<br>

</code>
</p>
</div>
<p>You might get a couple of error markers, because the Xpand file references another file (
					<span class="emphasis"><em>Extensions.ext</em></span> (4)) which has not yet been updated. 
					Let&rsquo;s ignore this for a moment and have a look at the general structure of an Xpand template file. In the first line we import the namespace (i.e. Java package)
					of the generated AST classes, that is Entity and Feature, we want to refer to in the generator. Next up the previously mentioned Xtend file is imported. An Xtend file defines 
					functions which can be used in Xpand. 
				</p>
<p>The rest of the file contains two so called definitions. A definition in Xpand is similar to a function in that it can be called, it has a name and it is defined
					for one or more arguments. The general syntax is as follows:</p>
<div class="literallayout">
<p>
<code class="code">&laquo;DEFINE&nbsp;name(ArgType1&nbsp;arg1,&nbsp;ArgType2&nbsp;arg2)&nbsp;FOR&nbsp;MainArgType&raquo;<br>

<br>

</code>
</p>
</div>
<p>Where 
					<span class="emphasis"><em>MainArgType</em></span> is bound to the variable name 
					<span class="emphasis"><em>this</em></span> which can like in Java be omitted when referring to.
				</p>
<p>The first definition 
					<span class="emphasis"><em>main</em></span> is defined for 
					<span class="emphasis"><em>Entity</em></span> and is the one invoked from the previously discussed MWE2 file (2). 
					The first thing the definition does is opening a file using the 
					<span class="emphasis"><em>qualifiedName()</em></span> of the given 
					<span class="emphasis"><em>Entity</em></span>. 
					The function 
					<span class="emphasis"><em>qualifiedName()</em></span> should be declared in the referenced Xtend file (4). To do so open that file and replace its
					current contents by the following snippet:
				</p>
<div class="literallayout">
<p>
<code class="code">import&nbsp;org::eclipse::xtext::example::domainmodel;<br>

<br>
packageName(Type&nbsp;this)&nbsp;:<br>
	qualifiedName(eContainer());<br>
	
<br>
packageName(Void&nbsp;this)&nbsp;:&nbsp;null;<br>
	
<br>
String&nbsp;qualifiedName(Object&nbsp;this)&nbsp;:&nbsp;null;<br>
	
<br>
String&nbsp;qualifiedName(Type&nbsp;this)&nbsp;:&nbsp;<br>
	packageName()==null?&nbsp;name&nbsp;:&nbsp;packageName()+"."+name;<br>
	
<br>
String&nbsp;qualifiedName(PackageDeclaration&nbsp;this)&nbsp;:<br>
	if&nbsp;qualifiedName(eContainer())==null&nbsp;<br>
		then&nbsp;name<br>
		else&nbsp;qualifiedName(eContainer())+'.'+name;<br>
	
<br>

</code>
</p>
</div>
<p>It defines the 
					<span class="emphasis"><em>qualifiedName()</em></span> function not only for 
					<span class="emphasis"><em>Entity</em></span> but also generally for types. Note how it computes the qualified name by calling

					<span class="emphasis"><em>qualifiedName()</em></span> recursively on its 
					<span class="emphasis"><em>eContainer()</em></span>. Both Xpand and Xtend are based on the same expression language, which is statically typed and 
					allows for very convenient navigation over object graphs and collections.
				</p>
<p>Back to the Xpand file (3) we see some static text which goes directly into the opened file. The 
					<span class="emphasis"><em>EXPAND</em></span> statement calls the other definition defined in this file.
					It will effectively generate a Java field and two accessor-methods for each 
					<span class="emphasis"><em>Feature</em></span>. 
				</p>
<p>You&rsquo;ll now able able to run the generator by opening the context menu on the 
					<span class="emphasis"><em>*.mwe2</em></span> file (2) and choose 
					<span class="emphasis"><em>Run As-&gt;MWE2 Workflow</em></span>.
					For more information on Xpand and Xtend see the corresponding language documentation (available through Eclipse Help). MWE2 is explained in detail 
					in 
					<a class="link" href="#MWE2" title="Chapter&nbsp;6.&nbsp;MWE2">a later section</a>. 
				</p>
</div>
</div>
</div>
<div class="chapter" title="Chapter&nbsp;3.&nbsp;The Grammar Language">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="grammarLanguage"></a>Chapter&nbsp;3.&nbsp;The Grammar Language</h2>
</div>
</div>
</div>
<p>The 
			<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/Xtext.xtext?root=Modeling_Project&view=markup" target="_new">grammar language</a> 
			is the corner stone of Xtext. It is a domain-specific language, carefully designed for the description of textual languages.
			The main idea is to describe the concrete syntax and how it is mapped to an in-memory model created during parsing. 
		</p>
<div class="section" title="A First Example">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="AFirstExample"></a>A First Example</h2>
</div>
</div>
</div>
<p>To get an idea of how it works we&rsquo;ll start by implementing a 
				<a class="ulink" href="http://martinfowler.com/dslwip/Intro.html" target="_new">simple example</a> 
				introduced by Martin Fowler. It&rsquo;s mainly about describing state machines used as the (un)lock mechanism of secret compartments.
				People who have secret compartments control their access in a very old-school way, e.g. by opening the door first and 
				turning on the light afterwards. Then the secret compartment, for instance a panel, opens up. One of those state machines 
				could look like this:
			</p>
<div class="literallayout">
<p>
<code class="code">events<br>
&nbsp;&nbsp;doorClosed&nbsp;&nbsp;D1CL<br>
&nbsp;&nbsp;drawOpened&nbsp;&nbsp;D2OP<br>
&nbsp;&nbsp;lightOn&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L1ON<br>
&nbsp;&nbsp;doorOpened&nbsp;&nbsp;D1OP<br>
&nbsp;&nbsp;panelClosed&nbsp;PNCL<br>
end<br>
&nbsp;<br>
resetEvents<br>
&nbsp;&nbsp;doorOpened<br>
end<br>
&nbsp;<br>
commands<br>
&nbsp;&nbsp;unlockPanel&nbsp;PNUL<br>
&nbsp;&nbsp;lockPanel&nbsp;&nbsp;&nbsp;PNLK<br>
&nbsp;&nbsp;lockDoor&nbsp;&nbsp;&nbsp;&nbsp;D1LK<br>
&nbsp;&nbsp;unlockDoor&nbsp;&nbsp;D1UL<br>
end<br>
&nbsp;<br>
state&nbsp;idle<br>
&nbsp;&nbsp;actions&nbsp;{unlockDoor&nbsp;lockPanel}<br>
&nbsp;&nbsp;doorClosed&nbsp;=&gt;&nbsp;active<br>
end<br>
&nbsp;<br>
state&nbsp;active<br>
&nbsp;&nbsp;drawOpened&nbsp;=&gt;&nbsp;waitingForLight<br>
&nbsp;&nbsp;lightOn&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;waitingForDraw<br>
end<br>
&nbsp;<br>
state&nbsp;waitingForLight<br>
&nbsp;&nbsp;lightOn&nbsp;=&gt;&nbsp;unlockedPanel<br>
end<br>
&nbsp;<br>
state&nbsp;waitingForDraw<br>
&nbsp;&nbsp;drawOpened&nbsp;=&gt;&nbsp;unlockedPanel<br>
end<br>
&nbsp;<br>
state&nbsp;unlockedPanel<br>
&nbsp;&nbsp;actions&nbsp;{unlockPanel&nbsp;lockDoor}<br>
&nbsp;&nbsp;panelClosed&nbsp;=&gt;&nbsp;idle<br>
end<br>

<br>

</code>
</p>
</div>
<p>So, we have a bunch of declared events, commands, and states. Within states there are references to declared actions,
				which should be executed when entering such a state. Also there are transitions consisting of a reference to an event and 
				a state. Please read 
				<a class="ulink" href="http://martinfowler.com/dslwip/Intro.html" target="_new">Martin&rsquo;s description</a> if you want to read the whole story.
			</p>
<p>In order to implment this little language with Xtext, you need to write the following grammar:</p>
<div class="literallayout">
<p>
<code class="code">grammar&nbsp;my.pack.SecretCompartments&nbsp;<br>
&nbsp;&nbsp;&nbsp;with&nbsp;org.eclipse.xtext.common.Terminals<br>

<br>
generate&nbsp;secretcompartment&nbsp;"http://www.eclipse.org/secretcompartment"<br>
&nbsp;<br>
Statemachine&nbsp;:<br>
&nbsp;&nbsp;'events'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(events+=Event)+<br>
&nbsp;&nbsp;'end'<br>
&nbsp;&nbsp;('resetEvents'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(resetEvents+=[Event])+<br>
&nbsp;&nbsp;'end')?<br>
&nbsp;&nbsp;'commands'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(commands+=Command)+<br>
&nbsp;&nbsp;'end'<br>
&nbsp;&nbsp;(states+=State)+;<br>
&nbsp;<br>
Event&nbsp;:<br>
&nbsp;&nbsp;name=ID&nbsp;code=ID;<br>
&nbsp;<br>
Command&nbsp;:<br>
&nbsp;&nbsp;name=ID&nbsp;code=ID;<br>
&nbsp;<br>
State&nbsp;:<br>
&nbsp;&nbsp;'state'&nbsp;name=ID<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;('actions'&nbsp;'{'&nbsp;(actions+=[Command])+&nbsp;'}')?<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(transitions+=Transition)*<br>
&nbsp;&nbsp;'end';<br>
&nbsp;<br>
Transition&nbsp;:<br>
&nbsp;&nbsp;event=[Event]&nbsp;'=&gt;'&nbsp;state=[State];<br>
&nbsp;&nbsp;<br>

</code>
</p>
</div>
<p>Martin uses this example throughout his book &bdquo;Domain-Specific Languages&rdquo; to implement external and internal DSLs using
				different technologies. Note, that none of his implmentations is nearly as readable and concise as the description in
				Xtext&rsquo;s grammar language above. That is of course because the grammar language is designed to do just that, i.e. it is 
				specific to the domain of language descriptions.</p>
</div>
<div class="section" title="The Syntax">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="syntax"></a>The Syntax</h2>
</div>
</div>
</div>
<p>In the following the different concepts and syntactical constructs of the grammar language are explained. </p>
<div class="section" title="Language Declaration">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="LanguageDeclaration"></a>Language Declaration</h3>
</div>
</div>
</div>
<p>The first line in every grammar ... </p>
<div class="literallayout">
<p>
<code class="code">grammar&nbsp;my.pack.SecretCompartments&nbsp;with&nbsp;org.eclipse.xtext.common.Terminals<br>

</code>
</p>
</div>
<p>declares the name of the grammar. Xtext leverages Java&rsquo;s classpath mechanism. This means that the name 
					can be any valid Java qualifier. The file name needs to correspond to the grammar name and have the file 
					extension '
					<span class="emphasis"><em>.xtext</em></span>'. This means that the name has to be 
					<span class="emphasis"><em>SecretCompartments.xtext</em></span> and must be placed 
					in a package 
					<span class="emphasis"><em>my.pack</em></span> somewhere on your project&rsquo;s classpath.
				</p>
<p>The first line is also used to declare any used language (for mechanism details see 
					<a class="link" href="#grammarMixins" title="Grammar Mixins">Grammar Mixins</a>).
				</p>
</div>
<div class="section" title="EPackage Declarations">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="package_declarations"></a>EPackage Declarations</h3>
</div>
</div>
</div>
<p>Xtext parsers create in-memory object graphs while parsing text. Such object-graphs are 
					instances of EMF Ecore models. An Ecore model basically consists of an 
					<span class="emphasis"><em>EPackage</em></span> containing 
					<span class="emphasis"><em>EClasses</em></span>, 

					<span class="emphasis"><em>EDataTypes</em></span> and 
					<span class="emphasis"><em>EEnums</em></span> (See the 
					<a class="link" href="#model_metamodel" title="Model, Ecore Model, and Ecore">section on EMF</a> for more details).
					Xtext can infer Ecore models from a grammar (see 
					<a class="link" href="#metamodelInference" title="Ecore Model Inference">Ecore model inference</a>) but it is also 
					possible to reuse existing Ecore models. You can even mix this and use multiple existing Ecore models and 
					infer some others from one grammar. 
				</p>
<div class="section" title="EPackage Generation">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="EPackageGeneration"></a>EPackage Generation</h4>
</div>
</div>
</div>
<p>The easiest way to get started is to let Xtext infer the Ecore model from your grammar. This is what is done in the 
						secret compartment example. To do so just state:</p>
<div class="literallayout">
<p>
<code class="code">generate&nbsp;secretcompartment&nbsp;'http://www.eclipse.org/secretcompartment'<br>

</code>
</p>
</div>
<p>That statement means: generate an 
						<span class="emphasis"><em>EPackage</em></span> with the 
						<span class="emphasis"><em>name</em></span> &bdquo;secretcompartment&rdquo; and the 
						<span class="emphasis"><em>nsURI</em></span> &bdquo;http://www.eclipse.org/secretcompartment&rdquo;. 
						Actually these are the properties that are required to create an 
						<span class="emphasis"><em>EPackage</em></span>.
						Xtext will then add 
						<span class="emphasis"><em>EClasses</em></span> with properties (
						<span class="emphasis"><em>EAttributes</em></span> and 
						<span class="emphasis"><em>EReferences</em></span>) for the different rules, as described in

						<a class="link" href="#metamodelInference" title="Ecore Model Inference">Ecore model inference</a>. 
					</p>
</div>
<div class="section" title="EPackage Import">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="EPackageImport"></a>EPackage Import</h4>
</div>
</div>
</div>
<p>If you already have an existing 
						<span class="emphasis"><em>EPackage</em></span>, you can import it using either a namespace URI or a resource URI. 
						An 
						<a class="ulink" href="http://www.ietf.org/rfc/rfc2396.txt" target="_new">URI</a> (Uniform Resource Identifier) provides a simple and extensible 
						means for identifying an abstract or physical resource. For all the niftx details about EMF URIs 
						please see its 
						<a class="ulink" href="http://help.eclipse.org/help32/topic/org.eclipse.emf.doc/references/javadoc/org/eclipse/emf/common/util/URI.html" target="_new">documentation</a>.
					</p>
<div class="section" title="Using Resource URIs to Import Existing EPackages">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="UsingResourceURIstoImportExistingEPackages"></a>Using Resource URIs to Import Existing EPackages</h5>
</div>
</div>
</div>
<p>In order to import an existing Ecore model, you&rsquo;ll have to have the *.ecore file describing the 
							<span class="emphasis"><em>EPackage</em></span> you want to 
							use somewhere in your workspace. In order to refer to that file you make use of the platform:/resource scheme.
							Platform URIs are a special EMF concept, which allow to reference elements in the workspace 
							independent of the location of the workspace. 
						</p>
<p>An import statement referring to an Ecore file by a 
							<span class="emphasis"><em>platform:/resource/</em></span>-URI looks like this: 
						</p>
<div class="literallayout">
<p>
<code class="code">import&nbsp;'platform:/resource/my.project/src/my/pack/SecretCompartments.ecore'<br>

</code>
</p>
</div>
<p>If you want to mix generated and imported Ecore models you&rsquo;ll have to configure the generator fragment 
							in your MWE file responsible for generating the Ecore classes 
							(
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/ecore/EcoreGeneratorFragment.java?root=Modeling_Project&view=co" target="_new">EcoreGeneratorFragment</a>) 
							with resource URIs that point to the 
							<a class="link" href="#emf_codegen" title="EMF Code Generation">generator models</a> of the referenced Ecore models.
						</p>
<p>The *.genmodel provides all kind of generator configuration used by EMF&rsquo;s code generator. Xtext will automatically create
							a *.genmodel for generated ecore models, but if such a model references an existing imported Ecore model, the code generator 
							needs to know how that code was generated in order to generate valid references in Java for the new Ecore model. </p>
<p>Example:</p>
<div class="literallayout">
<p>
<code class="code">fragment&nbsp;=&nbsp;org.eclipse.xtext.generator.ecore.EcoreGeneratorFragment&nbsp;{<br>
&nbsp;&nbsp;genModels&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;"platform:/resource/my.project/src/my/pack/SecretCompartments.genmodel"<br>
}<br>

<br>

</code>
</p>
</div>
</div>
<div class="section" title="Using Classpath URIs to Import Existing EPackages">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="UsingClasspathURIstoImportExistingEPackages"></a>Using Classpath URIs to Import Existing EPackages</h5>
</div>
</div>
</div>
<p>We like to leverage Java&rsquo;s classpath mechanism, because besides that it is well understood and designed it allows us to
							package libraries as jars. If you want to reference an *.ecore file which is contained in a jar, you can make use of the 
							classpath scheme we&rsquo;ve introduced. For instance if you want to reference Java elements, you can use the JvmType Ecore model 
							which is shipped as part of Xtext. </p>
<p>Example:</p>
<div class="literallayout">
<p>
<code class="code">import&nbsp;'classpath:/model/JvmTypes.ecore'&nbsp;as&nbsp;types<br>

</code>
</p>
</div>
<p>As with platform resource URIs you&rsquo;ll also have to tell the generator where the corresponding *.genmodel can be found:</p>
<div class="literallayout">
<p>
<code class="code">fragment&nbsp;=&nbsp;org.eclipse.xtext.generator.ecore.EcoreGeneratorFragment&nbsp;{<br>
&nbsp;&nbsp;genModels&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;"classpath:/model/JvmTypes.genmodel"<br>
}<br>

<br>

</code>
</p>
</div>
<p>See the section on 
							<a class="link" href="#jvmtypes" title="Chapter&nbsp;8.&nbsp;Referring to Java Types">Referring Java Types</a> for a full explanation of this useful feature.
						</p>
</div>
<div class="section" title="Using Namespace URIs to Import Existing EPackages">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="UsingNamespaceURIstoImportExistingEPackages"></a>Using Namespace URIs to Import Existing EPackages</h5>
</div>
</div>
</div>
<p>You can also use nsURI in order to import existing 
							<span class="emphasis"><em>EPackage</em></span>. Note that this is generally not
							preferrable, because you&rsquo;ll have to have the corresponding EPackage installed in the workbench.
							There&rsquo;s mainly just one exception, that is Ecore itself. So if you refer to Ecore it is best
							to use its nsURI :
						</p>
<div class="literallayout">
<p>
<code class="code">import&nbsp;"http://www.eclipse.org/emf/2002/Ecore"&nbsp;as&nbsp;ecore<br>

</code>
</p>
</div>
</div>
</div>
<div class="section" title="Ecore Model Aliases for EPackages">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="EcoreModelAliasesforEPackages"></a>Ecore Model Aliases for EPackages</h4>
</div>
</div>
</div>
<p>If you want to use multiple 
						<span class="emphasis"><em>EPackages</em></span> you need to specify aliases in the following way:
					</p>
<div class="literallayout">
<p>
<code class="code">generate&nbsp;secretcompartment&nbsp;'http://www.eclipse.org/secretcompartment'<br>
import&nbsp;'http://www.eclipse.org/anotherPackage'&nbsp;as&nbsp;another<br>

<br>

</code>
</p>
</div>
<p>When referring to a type somewhere in the grammar you need to qualify the reference using that 
						alias (example 
						<span class="emphasis"><em>another::CoolType</em></span>). We&rsquo;ll see later where such type references occur.
					</p>
<p>It is also supported to put multiple 
						<span class="emphasis"><em>EPackage</em></span> imports into one alias. This is no problem as 
						long as there are not any two 
						<span class="emphasis"><em>EClassifiers</em></span> with the same name. In such cases none of them can be referenced. 
						It is even possible to 
						<span class="emphasis"><em>import</em></span> multiple and 
						<span class="emphasis"><em>generate</em></span> one Ecore model and all of them are declared for 
						the same alias. If you do so, for a reference to an 
						<span class="emphasis"><em>EClassifier</em></span> first the imported 
						<span class="emphasis"><em>EPackages</em></span> are 
						scanned before it is assumed that a type needs to by generated into the to-be-generated package. 
					</p>
<p>Note, that using this feature is not recommended, because it might cause problems, which are hard to track down.
						For instance, a reference to 
						<span class="emphasis"><em>classA</em></span> would as well be linked to a newly created 
						<span class="emphasis"><em>EClass</em></span>, because the 
						corresponding type in 
						<span class="emphasis"><em>http://www.eclipse.org/packContainingClassA</em></span> is spelled with a capital letter.
					</p>
</div>
</div>
<div class="section" title="Rules">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Rules"></a>Rules</h3>
</div>
</div>
</div>
<p>Basically parsing can be separated in the following phases. </p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>lexing</p>
</li>
<li class="listitem">
<p>parsing</p>
</li>
<li class="listitem">
<p>linking</p>
</li>
<li class="listitem">
<p>validation</p>
</li>
</ol>
</div>
<div class="section" title="Terminal Rules">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="TerminalRules"></a>Terminal Rules</h4>
</div>
</div>
</div>
<p>In the first stage called 
						<span class="emphasis"><em>lexing</em></span>, a sequence of characters (the text input) is transformed into a sequence of so 
						called tokens. In this context, a token is sort of a strongly typed part of the input sequence. It consists of one 
						or more characters and was matched by a particular terminal rule or keyword and therefore represents an atomic symbol.
						Terminal rules are also referred to as 
						<span class="emphasis"><em>token rules</em></span> or 
						<span class="emphasis"><em>lexer rules</em></span>. There is an informal naming convention that 
						names of terminal rules are all upper-case.
					</p>
<p>In the secret compartments example there are no explicitly defined terminal rules, since it only uses the 
						<span class="emphasis"><em>ID</em></span> rule 
						which is inherited from the grammar 
						<span class="emphasis"><em>org.eclipse.xtext.common.Terminals</em></span> (cf. 
						<a class="link" href="#grammarMixins" title="Grammar Mixins">Grammar Mixins</a>).
						Therein the 
						<span class="emphasis"><em>ID</em></span> rule is defined as follows:
					</p>
<div class="literallayout">
<p>
<code class="code">terminal&nbsp;ID&nbsp;:&nbsp;<br>
&nbsp;&nbsp;('^')?('a'..'z'|'A'..'Z'|'_')&nbsp;('a'..'z'|'A'..'Z'|'_'|'0'..'9')*;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>

</code>
</p>
</div>
<p>It says that a token 
						<span class="emphasis"><em>ID</em></span> starts with an optional 
						<span class="emphasis"><em>'^'</em></span> character (caret), followed by a letter 
						<span class="emphasis"><em>(&sbquo;a&rsquo;..&sbquo;z&rsquo;|&sbquo;A&rsquo;..&sbquo;Z&rsquo;)</em></span> 
						or underscore (&sbquo;_&rsquo;) followed by any number of letters, underscores and numbers 
						<span class="emphasis"><em>(&sbquo;0&rsquo;..&sbquo;9&rsquo;)</em></span>. 
					</p>
<p>The caret is used to escape an identifier for cases where there are conflicts with keywords. It is removed 
						by the 
						<span class="emphasis"><em>ID</em></span> rule&rsquo;s 
						<a class="link" href="#valueconverter" title="Value Converter">ValueConverter</a>. 
					</p>
<p>This is the formal definition of terminal rules:</p>
<div class="literallayout">
<p>
<code class="code">TerminalRule&nbsp;:<br>
&nbsp;&nbsp;'terminal'&nbsp;name=ID&nbsp;('returns'&nbsp;type=TypeRef)?&nbsp;':'&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;alternatives=TerminalAlternatives&nbsp;';'<br>
;<br>

<br>

</code>
</p>
</div>
<p>Note, that 
						<span class="emphasis"><em>the order of terminal rules is crucial for your grammar</em></span>, as they may hide each other. 
						This is especially important for newly introduced rules in connection with mixed rules from used grammars. 
					</p>
<p>If you for instance want to add a rule to allow fully qualified names in addition to simple IDs, you should 
						implement it as a 
						<a class="link" href="#datatypeRules" title="Data Type Rules">data type rule</a>, instead of adding another terminal rule.
					</p>
<div class="section" title="Return Types">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="ReturnTypes"></a>Return Types</h5>
</div>
</div>
</div>
<p>A terminal rule returns a value, which is a string (type 
							<span class="emphasis"><em>ecore::EString</em></span>) by default.
							However, if you want to have a different type you can specify it. For instance, the rule 
							<span class="emphasis"><em>INT</em></span> is defined as:
						</p>
<div class="literallayout">
<p>
<code class="code">terminal&nbsp;INT&nbsp;returns&nbsp;ecore::EInt&nbsp;:&nbsp;<br>
&nbsp;&nbsp;('0'..'9')+;<br>

<br>

</code>
</p>
</div>
<p>This means that the terminal rule 
							<span class="emphasis"><em>INT</em></span> returns instances of 
							<span class="emphasis"><em>ecore::EInt</em></span>. It is possible to define any 
							kind of data type here, which just needs to be an instance of 
							<span class="emphasis"><em>ecore::EDataType</em></span>. In order to tell the parser 
							how to convert the parsed string to a value of the declared data type, you need to provide your own 
							implementation of 
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/conversion/IValueConverterService.java?root=Modeling_Project&view=co" target="_new">IValueConverterService</a> (cf. 

							<a class="link" href="#valueconverter" title="Value Converter">value converters</a>). The value converter is also the point where you can remove things 
							like quotes from string literals or the caret (&sbquo;^&rsquo;) from identifiers. Its implementation needs to be registered 
							as a service (cf. 
							<a class="link" href="#dependencyInjection" title="Dependency Injection in Xtext with Google Guice">Service Framework</a>).
						</p>
</div>
</div>
<div class="section" title="Extended Backus-Naur Form Expressions">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="ExtendedBackusNaurFormExpressions"></a>Extended Backus-Naur Form Expressions</h4>
</div>
</div>
</div>
<p>Token rules are described using &bdquo;Extended Backus-Naur Form&rdquo;-like (EBNF) expressions. The different expressions 
						are described in the following. The one thing all of these expressions have in common is the cardinality operator.
						There are four different possible cardinalities</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>exactly one (the default, no operator)</p>
</li>
<li class="listitem">
<p>one or none (operator 
								<span class="emphasis"><em>?</em></span>)
							</p>
</li>
<li class="listitem">
<p>any (zero or more, operator 
								<span class="emphasis"><em>*</em></span>)
							</p>
</li>
<li class="listitem">
<p>one or more (operator 
								<span class="emphasis"><em>+</em></span>)
							</p>
</li>
</ol>
</div>
<div class="section" title="Keywords / Characters">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="Keywords"></a>Keywords / Characters</h5>
</div>
</div>
</div>
<p>Keywords are a kind of token rule literals. 
							The 
							<span class="emphasis"><em>ID</em></span> rule in 
							<span class="emphasis"><em>org.eclipse.xtext.common.Terminals</em></span> for instance starts with a keyword:
						</p>
<div class="literallayout">
<p>
<code class="code">terminal&nbsp;ID&nbsp;:&nbsp;'^'?&nbsp;....&nbsp;;<br>

</code>
</p>
</div>
<p>The question mark sets the cardinality to &bdquo;none or one&rdquo; (i.e. optional) like explained above.</p>
<p>Note that a keyword can have any length and contain arbitrary characters. </p>
<p>The following standard Java notations for special characters are allowed: 
							<span class="emphasis"><em>\n</em></span>, 
							<span class="emphasis"><em>\r</em></span>,
							 
							<span class="emphasis"><em>\t</em></span>, 
							<span class="emphasis"><em>\b</em></span>, and 
							<span class="emphasis"><em>\f</em></span>. We currently don&rsquo;t support quoted unicode character notation, as 
							<span class="emphasis"><em>\u123</em></span>.
						</p>
</div>
<div class="section" title="Character Ranges">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="CharacterRanges"></a>Character Ranges</h5>
</div>
</div>
</div>
<p>A character range can be declared using the &sbquo;..&rsquo; operator.</p>
<p>Example:</p>
<div class="literallayout">
<p>
<code class="code">terminal&nbsp;INT&nbsp;returns&nbsp;ecore::EInt:&nbsp;('0'..'9')+;<br>

</code>
</p>
</div>
<p>In this case an 
							<span class="emphasis"><em>INT</em></span> is comprised of one or more (note the 
							<span class="emphasis"><em>+</em></span> operator) characters 
							between (and including) 
							<span class="emphasis"><em>'0'</em></span> and 
							<span class="emphasis"><em>'9'</em></span>.
						</p>
</div>
<div class="section" title="Wildcard">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="Wildcard"></a>Wildcard</h5>
</div>
</div>
</div>
<p>If you want to allow any character you can simple write the wildcard operator '
							<span class="emphasis"><em>.</em></span>' (dot):
							Example:
						</p>
<div class="literallayout">
<p>
<code class="code">FOO&nbsp;:&nbsp;'f'&nbsp;.&nbsp;'o';<br>

</code>
</p>
</div>
<p>The rule above would allow expressions like &sbquo;foo&rsquo;, &sbquo;f0o&rsquo; or even &sbquo;f\no&rsquo;.</p>
</div>
<div class="section" title="Until Token">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="UntilToken"></a>Until Token</h5>
</div>
</div>
</div>
<p>With the until token it is possible to state that everything should be consumed until a certain token occurs.
							The multi-line comment is implemented this way:</p>
<div class="literallayout">
<p>
<code class="code">terminal&nbsp;ML_COMMENT	:&nbsp;'/*'&nbsp;-&gt;&nbsp;'*/';<br>

</code>
</p>
</div>
<p>This is the rule for Java-style comments that begin with '
							<span class="emphasis"><em>/*</em></span>' and end with '
							<span class="emphasis"><em>*/</em></span>'.
						</p>
</div>
<div class="section" title="Negated Token">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="NegatedToken"></a>Negated Token</h5>
</div>
</div>
</div>
<p>All the tokens explained above can be inverted using a preceding exclamation mark:</p>
<div class="literallayout">
<p>
<code class="code">terminal&nbsp;BETWEEN_HASHES	:&nbsp;'#'&nbsp;(!'#')*&nbsp;'#';<br>

</code>
</p>
</div>
</div>
<div class="section" title="Rule Calls">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="RuleCalls"></a>Rule Calls</h5>
</div>
</div>
</div>
<p>Rules can refer to other rules. This is done by writing the name of the rule to be called.
							We refer to this as rule calls. Rule calls in terminal rules can only point to terminal rules.</p>
<p>Example:</p>
<div class="literallayout">
<p>
<code class="code">terminal&nbsp;DOUBLE&nbsp;:&nbsp;INT&nbsp;'.'&nbsp;INT;<br>

</code>
</p>
</div>
</div>
<div class="section" title="Alternatives">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="Alternatives"></a>Alternatives </h5>
</div>
</div>
</div>
<p>Using alternatives one can state multiple different alternatives.
							For instance, the whitespace rule uses alternatives like this:</p>
<div class="literallayout">
<p>
<code class="code">terminal&nbsp;WS&nbsp;:&nbsp;('&nbsp;'|'\t'|'\r'|'\n')+;<br>

</code>
</p>
</div>
<p>That is a WS can be made of one or more whitespace characters (including &sbquo; &rsquo;, '
							<span class="emphasis"><em>\t</em></span>', '
							<span class="emphasis"><em>\r</em></span>', '
							<span class="emphasis"><em>\n</em></span>').
						</p>
</div>
<div class="section" title="Groups">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="Groups"></a>Groups</h5>
</div>
</div>
</div>
<p>Finally, if you put tokens one after another, the whole sequence is referred to as a group.
							Example:</p>
<div class="literallayout">
<p>
<code class="code">terminal&nbsp;ASCII&nbsp;:&nbsp;'0x'&nbsp;('0'..'7')&nbsp;('0'..'9'|'A'..'F');<br>

</code>
</p>
</div>
<p>That is the 2-digit hexadecimal code of ASCII characters.</p>
</div>
</div>
</div>
<div class="section" title="Parser Rules">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="parser_rules"></a>Parser Rules</h3>
</div>
</div>
</div>
<p>The parser reads a sequence of terminals and walks through the parser rules. Hence a parser rule - 
					contrary to a terminal rule &ndash; does not produce a single terminal token but a tree of non-terminal 
					and terminal tokens. They lead to a so called 
					<a class="link" href="#node_model" title="Working with the Parse Tree (aka Node Model)">parse tree</a> (in Xtext it is also referred 
					as node model). Furthermore, parser rules are handled as kind of a building plan for the creation of 
					the 
					<span class="emphasis"><em>EObjects</em></span> that form the semantic model (the linked abstract syntax graph or AST). Due to this 
					fact, parser rules are even called production rules. The different constructs like actions and 
					assignments are used to derive types and initialize the semantic objects accordingly. 
				</p>
<div class="section" title="Extended Backus-Naur Form Expressions">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="ExtendedBackusNaurFormExpressions2"></a>Extended Backus-Naur Form Expressions</h4>
</div>
</div>
</div>
<p>Not all the expressions that are available in terminal rules can be used in parser rules. Character 
						ranges, wildcards, the until token and the negation are only available for terminal rules. </p>
<p>The elements that are available in parser rules as well as in terminal rules are</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>groups, </p>
</li>
<li class="listitem">
<p>
								
<a class="link" href="#Alternatives" title="Alternatives">alternatives</a>, 
							</p>
</li>
<li class="listitem">
<p>
								
<a class="link" href="#Keywords" title="Keywords / Characters">keywords</a> and 
							</p>
</li>
<li class="listitem">
<p>rule calls.</p>
</li>
</ol>
</div>
<p>In addition to these elements, there are some expressions used to direct how the AST 
						is constructed, which are listed and explained in the following.</p>
<div class="section" title="Assignments">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="assignments"></a>Assignments </h5>
</div>
</div>
</div>
<p>Assignments are used to assign the parsed information to a feature of the current object. 
							The type of the current object, its 
							<span class="emphasis"><em>EClass</em></span>, is specified by the return type of the parser 
							rule. If it is not explicitly stated it is implied that the type&rsquo;s name equals the rule&rsquo;s name. 
							The type of the feature is inferred from the right hand side of the assignment.
						</p>
<p>Example:</p>
<div class="literallayout">
<p>
<code class="code">State&nbsp;:<br>
&nbsp;&nbsp;'state'&nbsp;name=ID<br>
&nbsp;&nbsp;&nbsp;&nbsp;('actions'&nbsp;'{'&nbsp;(actions+=[Command])+&nbsp;'}')?<br>
&nbsp;&nbsp;&nbsp;&nbsp;(transitions+=Transition)*<br>
&nbsp;&nbsp;'end'<br>
;<br>

<br>

</code>
</p>
</div>
<p>The syntactic declaration for states in the state machine example starts with a keyword 
							<span class="emphasis"><em>state</em></span> followed by an assignment:
						</p>
<div class="literallayout">
<p>
<code class="code">name=ID<br>

</code>
</p>
</div>
<p>The left hand side refers to a feature '
							<span class="emphasis"><em>name</em></span>' of the current object (which has the 
							<span class="emphasis"><em>EClass</em></span> '
							<span class="emphasis"><em>State</em></span>' in this case). 
							The right hand side can be a rule call, a keyword, a cross-reference (explained later) or even an 
							alternative comprised by the former. The type of the feature needs to be compatible with the type of the
							 expression on the right. As 
							<span class="emphasis"><em>ID</em></span> returns an 
							<span class="emphasis"><em>EString</em></span> in this case, the feature '
							<span class="emphasis"><em>name</em></span>' needs to be 
							 of type 
							<span class="emphasis"><em>EString</em></span> as well.
						</p>
<p>
							
<span class="bold"><strong>Assignment Operators</strong></span>
						
</p>
<p>There are three different assignment operators, each with different semantics.</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>The simple equal sign '
									<span class="emphasis"><em>=</em></span>' is the straight forward assignment, and used for features which take only one element.
								</p>
</li>
<li class="listitem">
<p>The '
									<span class="emphasis"><em>+=</em></span>' sign (the add operator) expects a multi-valued feature and adds the value on the right hand to that feature, which is a list feature.
								</p>
</li>
<li class="listitem">
<p>The '
									<span class="emphasis"><em>?=</em></span>' sign (boolean assignment operator) expects a feature of type 
									<span class="emphasis"><em>EBoolean</em></span> and sets it to true if the right hand side was consumed independently from the concrete value of the right hand side.
								</p>
</li>
</ol>
</div>
<p>The used assignment operator does not effect the cardinality of the expected symbols on the right hand side. </p>
</div>
<div class="section" title="Cross-References">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="CrossReferences"></a>Cross-References </h5>
</div>
</div>
</div>
<p>A unique feature of Xtext is the ability to declare crosslinks in the grammar. In traditional compiler 
							construction the crosslinks are not established during parsing but in a later linking phase. This is the 
							same in Xtext, but we allow to specify crosslink information in the grammar. This information is used by the linker.
							The syntax for crosslinks is:</p>
<div class="literallayout">
<p>
<code class="code">CrossReference&nbsp;:<br>
&nbsp;&nbsp;'['&nbsp;type=TypeRef&nbsp;('|'&nbsp;^terminal=CrossReferenceableTerminal&nbsp;)?&nbsp;']'<br>
;<br>

<br>

</code>
</p>
</div>
<p>For example, the transition is made up of two cross-references, pointing to an event and a state:</p>
<div class="literallayout">
<p>
<code class="code">Transition&nbsp;:<br>
&nbsp;&nbsp;event=[Event]&nbsp;'=&gt;'&nbsp;state=[State]<br>
;<br>

<br>

</code>
</p>
</div>
<p>It is important to understand that the text between the square brackets does not refer to another rule, but to a type!
							This is sometimes confusing, because one usually uses the same name for the rules and the returned types.
							That is if we had named the type for events differently like in the following the cross-reference needs 
							to be adapted as well:</p>
<div class="literallayout">
<p>
<code class="code">Transition&nbsp;:<br>
&nbsp;&nbsp;event=[MyEvent]&nbsp;'=&gt;'&nbsp;state=[State]<br>
;<br>
&nbsp;<br>
Event&nbsp;returns&nbsp;MyEvent&nbsp;:&nbsp;....;<br>

<br>

</code>
</p>
</div>
<p>Looking at the syntax definition of cross-references, there is an optional part starting with a vertical 
							bar (pipe) followed by 
							<span class="emphasis"><em>CrossReferenceableTerminal</em></span>. This is the part describing the concrete text, from 
							which the crosslink later should be established. If the terminal is omitted, it is expected to be 
							<span class="emphasis"><em>ID</em></span>.
						</p>
<p>You may even use alternatives as the referencable terminal. This way, either an 
							<span class="emphasis"><em>ID</em></span> or a 
							<span class="emphasis"><em>STRING</em></span> may be 
							used as the referencable terminal, as it is possible in many SQL dialects.
						</p>
<div class="literallayout">
<p>
<code class="code">TableRef:&nbsp;table=[Table|(ID|STRING)];<br>

</code>
</p>
</div>
<p>Have a look at the 
							<a class="link" href="#linking" title="Linking">linking section</a> in order to understand how linking is done.
						</p>
</div>
<div class="section" title="Unordered Groups">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="unordered_groups"></a>Unordered Groups</h5>
</div>
</div>
</div>
<p>The elements of an unordered group can occur in any order but each element must appear once. Unordered 
							groups are separated with '
							<span class="emphasis"><em>&amp;</em></span>', e.g.
						</p>
<div class="literallayout">
<p>
<code class="code">Modifier:&nbsp;<br>
	static?='static'?&nbsp;&amp;&nbsp;final?='final'?&nbsp;&amp;&nbsp;visibility=Visibility;<br>

<br>
enum&nbsp;Visibility:<br>
	PUBLIC='public'&nbsp;|&nbsp;PRIVATE='private'&nbsp;|&nbsp;PROTECTED='protected';<br>
	
<br>

</code>
</p>
</div>
<p>allows</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;static&nbsp;final<br>
static&nbsp;protected&nbsp;<br>
final&nbsp;private&nbsp;static<br>
public<br>

<br>

</code>
</p>
</div>
<p>but not</p>
<div class="literallayout">
<p>
<code class="code">static&nbsp;final&nbsp;static&nbsp;//&nbsp;ERROR:&nbsp;static&nbsp;appears&nbsp;twice<br>
public&nbsp;static&nbsp;final&nbsp;private&nbsp;//&nbsp;ERROR:&nbsp;visibility&nbsp;appears&nbsp;twice<br>
final&nbsp;//&nbsp;ERROR:&nbsp;visibility&nbsp;is&nbsp;missing<br>

<br>

</code>
</p>
</div>
<p>Note that if you want an element of an unordered group to appear once or not at all, 
							you have to choose a cardinality of '
							<span class="emphasis"><em>?</em></span>'. In the example, the visibility is mandatory, 
							while '
							<span class="emphasis"><em>static</em></span>' or '
							<span class="emphasis"><em>final</em></span>' are optional. Elements with a cardinality of '
							<span class="emphasis"><em>*</em></span>' or '
							<span class="emphasis"><em>+</em></span>'
							have to appear continuously without interruption, i.e.
						</p>
<div class="literallayout">
<p>
<code class="code">Rule:<br>
	values+=INT*&nbsp;&amp;&nbsp;name=ID;<br>

<br>

</code>
</p>
</div>
<p>will parse</p>
<div class="literallayout">
<p>
<code class="code">0&nbsp;8&nbsp;15&nbsp;x<br>
x&nbsp;0&nbsp;8&nbsp;15&nbsp;<br>

<br>

</code>
</p>
</div>
<p>but not </p>
<div class="literallayout">
<p>
<code class="code">0&nbsp;x&nbsp;8&nbsp;15&nbsp;//&nbsp;wrong,&nbsp;as&nbsp;values&nbsp;cannot&nbsp;be&nbsp;interrupted.<br>

<br>

</code>
</p>
</div>
</div>
<div class="section" title="Simple Actions">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="SimpleActions"></a>Simple Actions </h5>
</div>
</div>
</div>
<p>By default the object to be returned by a parser rule is created lazily on the first assignment. Then the type of the 
							<span class="emphasis"><em>EObject</em></span> to be created is determined from the specified return type or the rule name if no explicit return type is specified.
							With Actions however, the creation of returned 
							<span class="emphasis"><em>EObject</em></span> can be made explicit. Xtext supports two kinds of Actions:
						</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>simple actions, and</p>
</li>
<li class="listitem">
<p>assigned actions.</p>
</li>
</ol>
</div>
<p>If at some point you want to enforce the creation of a specific type you can use alternatives or simple actions.
							In the following example 
							<span class="emphasis"><em>TypeB</em></span> must be a subtype of 
							<span class="emphasis"><em>TypeA</em></span>. An expression 
							<span class="emphasis"><em>A ident</em></span> should create an instance of 

							<span class="emphasis"><em>TypeA</em></span>, whereas 
							<span class="emphasis"><em>B ident</em></span> should instantiate 
							<span class="emphasis"><em>TypeB</em></span>.
						</p>
<p>Example with alternatives:</p>
<div class="literallayout">
<p>
<code class="code">MyRule&nbsp;returns&nbsp;TypeA&nbsp;:<br>
&nbsp;&nbsp;"A"&nbsp;name=ID&nbsp;|<br>
&nbsp;&nbsp;MyOtherRule<br>
;&nbsp;<br>
&nbsp;<br>
MyOtherRule&nbsp;returns&nbsp;TypeB&nbsp;:<br>
&nbsp;&nbsp;"B"&nbsp;name&nbsp;=&nbsp;ID<br>
;<br>

<br>

</code>
</p>
</div>
<p>Example with simple actions:  </p>
<div class="literallayout">
<p>
<code class="code">MyRule&nbsp;returns&nbsp;TypeA&nbsp;:<br>
&nbsp;&nbsp;"A"&nbsp;name=ID&nbsp;|<br>
&nbsp;&nbsp;"B"&nbsp;{TypeB}&nbsp;name=ID<br>
;&nbsp;<br>

<br>

</code>
</p>
</div>
<p>Generally speaking, the instance is created as soon as the parser hits the first assignment. However, actions 
							allow to explicitly instantiate any 
							<span class="emphasis"><em>EObject</em></span>. The notation 
							<span class="emphasis"><em>{TypeB}</em></span> will create an instance of TypeB and assign 
							it to the result of the parser rule. This allows parser rules without any assignment and object creation without 
							the need to introduce unnecessary rules.
						</p>
</div>
<div class="section" title="Unassigned Rule Calls">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="UnassignedRuleCalls"></a>Unassigned Rule Calls </h5>
</div>
</div>
</div>
<p>We previously explained, that the 
							<span class="emphasis"><em>EObject</em></span> to be returned is created lazily when the first assignment occurs or 
							when a simple action is evaluated. There is another way one can set the 
							<span class="emphasis"><em>EObject</em></span> to be returned, which we call 
							an &bdquo;unassigned rule call&rdquo;.
						</p>
<p>Unassigned rule calls (the name suggests it) are rule calls to other parser rules, which are not used within an 
							assignment. If there is no feature the returned value shall be assigned to, the value is assigned to the 
&bdquo;							to-be-returned&rdquo; result of the calling rule.</p>
<p>With unassigned rule calls one can, for instance, create rules which just dispatch between several other rules:</p>
<div class="literallayout">
<p>
<code class="code">AbstractToken&nbsp;:<br>
&nbsp;&nbsp;TokenA&nbsp;|<br>
&nbsp;&nbsp;TokenB&nbsp;|<br>
&nbsp;&nbsp;TokenC<br>
;<br>

<br>

</code>
</p>
</div>
<p>As 
							<span class="emphasis"><em>AbstractToken</em></span> could possibly return an instance of 
							<span class="emphasis"><em>TokenA</em></span>, 
							<span class="emphasis"><em>TokenB</em></span> or 
							<span class="emphasis"><em>TokenC</em></span> its type must by a 
							super type of these types. It is now for instance as well possible to further change the state of the AST 
							element by assigning additional things.
						</p>
<p>Example:</p>
<div class="literallayout">
<p>
<code class="code">AbstractToken&nbsp;:<br>
&nbsp;&nbsp;(&nbsp;TokenA&nbsp;|<br>
&nbsp;&nbsp;&nbsp;&nbsp;TokenB&nbsp;|<br>
&nbsp;&nbsp;&nbsp;&nbsp;TokenC&nbsp;)&nbsp;(cardinality=('?'|'+'|'*'))?<br>
;<br>

<br>

</code>
</p>
</div>
<p>This way the 
							<span class="emphasis"><em>cardinality</em></span> is optional (last question mark) and can be represented 
							by a question mark, a plus, or an asterisk. It will be assigned to either an 

							<span class="emphasis"><em>EObject</em></span> of type 
							<span class="emphasis"><em>TokenA</em></span>,  
							<span class="emphasis"><em>TokenB</em></span>, or 
							<span class="emphasis"><em>TokenC</em></span> which are all subtypes of 

							<span class="emphasis"><em>AbstractToken</em></span>. The rule in this example will never create an instance of 
							<span class="emphasis"><em>AbstractToken</em></span> directly 
							as long as the preceeding 
							<span class="emphasis"><em>TokenX</em></span> rule call returns an element. 
						</p>
</div>
<div class="section" title="Assigned Actions">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="grammarActions"></a>Assigned Actions </h5>
</div>
</div>
</div>
<p>LL-parsing has some significant advantages over LR algorithms. The most important ones for Xtext are, that the generated code is much simpler to understand and debug and that it is easier to recover from errors. Especially ANTLR has a very nice generic error recovery mechanism. This allows to construct an AST even if there are syntactic errors in the text. You wouldn&rsquo;t get any of the nice IDE features as soon as there is one little error, if we hadn&rsquo;t error recovery.</p>
<p>However, LL also has some drawbacks. The most important one is that it does not allow left recursive grammars.
							For instance, the following is not allowed in LL-based grammars, because 
							<span class="emphasis"><em>Expression &sbquo;+&rsquo; Expression</em></span> is left recursive:
						</p>
<div class="literallayout">
<p>
<code class="code">Expression&nbsp;:<br>
&nbsp;&nbsp;Expression&nbsp;'+'&nbsp;Expression&nbsp;|<br>
&nbsp;&nbsp;'('&nbsp;Expression&nbsp;')'&nbsp;|<br>
&nbsp;&nbsp;INT<br>
;<br>

<br>

</code>
</p>
</div>
<p>Instead one has to rewrite such things by &bdquo;left-factoring&rdquo; it:</p>
<div class="literallayout">
<p>
<code class="code">Expression&nbsp;:<br>
&nbsp;&nbsp;TerminalExpression&nbsp;('+'&nbsp;TerminalExpression)?<br>
;<br>
&nbsp;<br>
TerminalExpression&nbsp;:<br>
&nbsp;&nbsp;'('&nbsp;Expression&nbsp;')'&nbsp;|<br>
&nbsp;&nbsp;INT<br>
;<br>

<br>

</code>
</p>
</div>
<p>In practice this is always the same pattern and therefore not that problematic. 
							However, by simply applying the Xtext AST construction features we&rsquo;ve covered so far, a grammar ...</p>
<div class="literallayout">
<p>
<code class="code">Expression&nbsp;:<br>
&nbsp;&nbsp;{Operation}&nbsp;left=TerminalExpression&nbsp;(op='+'&nbsp;right=TerminalExpression)?<br>
;<br>
&nbsp;<br>
TerminalExpression&nbsp;returns&nbsp;Expression:<br>
&nbsp;&nbsp;'('&nbsp;Expression&nbsp;')'&nbsp;|<br>
&nbsp;&nbsp;{IntLiteral}&nbsp;value=INT<br>
;<br>

<br>

</code>
</p>
</div>
<p>... would result in unwanted elements in the AST.
							For instance the expression 
							<span class="emphasis"><em>(42)</em></span> would result in a tree like this:
						</p>
<div class="literallayout">
<p>
<code class="code">Operation&nbsp;{<br>
&nbsp;&nbsp;left=Operation&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;left=IntLiteral&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value=42<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;}<br>
}<br>

<br>

</code>
</p>
</div>
<p>Typically one would only want to have one instance of 
							<span class="emphasis"><em>IntLiteral</em></span> instead.
						</p>
<p>One can solve this problem using a combination of unassigned rule calls and assigned actions:</p>
<div class="literallayout">
<p>
<code class="code">Expression&nbsp;:<br>
&nbsp;&nbsp;TerminalExpression&nbsp;({Operation.left=current}&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;op='+'&nbsp;right=Expression)?<br>
;<br>
&nbsp;<br>
TerminalExpression&nbsp;returns&nbsp;Expression:<br>
&nbsp;&nbsp;'('&nbsp;Expression&nbsp;')'&nbsp;|<br>
&nbsp;&nbsp;{IntLiteral}&nbsp;value=INT<br>
;<br>

<br>

</code>
</p>
</div>
<p>In the example above 
							<span class="emphasis"><em>{Operation.left=current}</em></span> is a so called tree rewrite action, which creates a new instance of the stated 
							<span class="emphasis"><em>EClass</em></span> (
							<span class="emphasis"><em>Operation</em></span> in this case) and assigns the element currently to-be-returned (
							<span class="emphasis"><em>current</em></span> variable) to a feature of the newly created object (in this case feature 
							<span class="emphasis"><em>left</em></span> of the 
							<span class="emphasis"><em>Operation</em></span> instance).
							In Java these semantics could be expressed as:
						</p>
<div class="literallayout">
<p>
<code class="code">Operation&nbsp;temp&nbsp;=&nbsp;new&nbsp;Operation();<br>
temp.setLeft(current);<br>
current&nbsp;=&nbsp;temp;<br>

<br>

</code>
</p>
</div>
</div>
</div>
</div>
<div class="section" title="Hidden Terminal Symbols">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="hidden_terminals"></a>Hidden Terminal Symbols</h3>
</div>
</div>
</div>
<p>Because parser rules describe not a single token, but a sequence of patterns in the input, it is necessary to define the interesting parts of the input. Xtext introduces the concept of hidden tokens to handle semantically unimportant things like whitespaces, comments, etc. in the input sequence gracefully. It is possible to define a set of terminal symbols, that are hidden from the parser rules and automatically skipped when they are recognized. Nevertheless, they are transparently woven into the node model, but not relevant for the semantic model. </p>
<p>Hidden terminals may (or may not) appear between any other terminals in any cardinality. They can be described per rule or for the whole grammar. When 
					<a class="link" href="#grammarMixins" title="Grammar Mixins">reusing a single grammar</a> its definition of hidden tokens is reused as well. The grammar 
					<span class="emphasis"><em>org.eclipse.xtext.common.Terminals</em></span> comes with a reasonable default and hides all comments and whitespace from the parser rules.
				</p>
<p>If a rule defines hidden symbols, you can think of a kind of scope that is automatically introduced. Any rule that is called from the declaring rule uses the same hidden terminals as the calling rule, unless it defines other hidden tokens itself.</p>
<div class="literallayout">
<p>
<code class="code">Person&nbsp;hidden(WS,&nbsp;ML_COMMENT,&nbsp;SL_COMMENT):&nbsp;<br>
&nbsp;&nbsp;name=Fullname&nbsp;age=INT&nbsp;';'<br>
;<br>

<br>
Fullname:&nbsp;<br>
&nbsp;&nbsp;(firstname=ID)?&nbsp;lastname=ID<br>
;<br>

<br>

</code>
</p>
</div>
<p>The sample rule &bdquo;Person&rdquo; defines multiline comments (_ML_COMMENT_), single-line comments (_SL_COMMENT_), and whitespace (
					<span class="emphasis"><em>WS</em></span>) to be allowed between the 
					<span class="emphasis"><em>Fullname</em></span> and the 
					<span class="emphasis"><em>age</em></span>. Because the rule 
					<span class="emphasis"><em>Fullname</em></span> does not introduce another set of hidden terminals, it allows the same symbols to appear between 
					<span class="emphasis"><em>firstname</em></span> and 
					<span class="emphasis"><em>lastname</em></span> as the calling rule 
					<span class="emphasis"><em>Person</em></span>. Thus, the following input is perfectly valid for the given grammar snippet:
				</p>
<div class="literallayout">
<p>
<code class="code">John&nbsp;/*&nbsp;comment&nbsp;*/&nbsp;Smith&nbsp;//&nbsp;line&nbsp;comment<br>
/*&nbsp;comment&nbsp;*/<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;42&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;//&nbsp;line&nbsp;comment<br>

<br>

</code>
</p>
</div>
<p>A list of all default terminals like 
					<span class="emphasis"><em>WS</em></span> can be found in section 
					<a class="link" href="#grammarMixins" title="Grammar Mixins">Grammar Mixins</a>.
				</p>
</div>
<div class="section" title="Data Type Rules">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="datatypeRules"></a>Data Type Rules</h3>
</div>
</div>
</div>
<p>Data type rules are parsing-phase rules, which create instances of 
					<span class="emphasis"><em>EDataType</em></span> instead of 
					<span class="emphasis"><em>EClass</em></span>. Thinking about it, one may discover that they are quite similar to terminal rules.
					However, the nice thing about data type rules is that they are actually parser rules and are therefore 
				</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>context sensitive and </p>
</li>
<li class="listitem">
<p>allow for use of hidden tokens.</p>
</li>
</ol>
</div>
<p>If you, for instance, want to define a rule to consume Java-like qualified names (e.g. &bdquo;foo.bar.Baz&rdquo;)
					you could write:</p>
<div class="literallayout">
<p>
<code class="code">QualifiedName&nbsp;:<br>
&nbsp;&nbsp;ID&nbsp;('.'&nbsp;ID)*<br>
;<br>

<br>

</code>
</p>
</div>
<p>In contrast to a terminal rule this is only valid in certain contexts, i.e. it won&rsquo;t conflict with the rule 
					<span class="emphasis"><em>ID</em></span>.
					If you had defined it as a terminal rule, it would possibly hide the 
					<span class="emphasis"><em>ID</em></span> rule.
				</p>
<p>In addition when this has been defined as a data type rule, it is allowed to use hidden tokens (e.g. &bdquo;/* comment **/&rdquo;) between the IDs and dots (e.g. 
					<span class="emphasis"><em>foo/* comment */. bar . Baz</em></span>).
				</p>
<p>Return types can be specified in the same way as in terminal rules:</p>
<div class="literallayout">
<p>
<code class="code">QualifiedName&nbsp;returns&nbsp;ecore::EString&nbsp;:&nbsp;<br>
&nbsp;&nbsp;ID&nbsp;('.'&nbsp;ID)*<br>
;<br>

<br>

</code>
</p>
</div>
<p>Note that if a rule does not call another parser rule and does neither contain any actions nor 
					<a class="link" href="#assignments" title="Assignments">assignments</a>, it is considered to be a data type rule and the data type 
					<span class="emphasis"><em>EString</em></span> is implied if none has been explicitly declared. You have to import Ecore with the alias 
					<span class="emphasis"><em>ecore</em></span> in this case.
				</p>
<p>For conversion again value converters are responsible (cf. 
					<a class="link" href="#valueconverter" title="Value Converter">value converters</a>).
				</p>
</div>
<div class="section" title="Enum Rules">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="EnumRules"></a>Enum Rules</h3>
</div>
</div>
</div>
<p>Enum rules return enumeration literals from strings. They can be seen as a shortcut for data type rules with specific value converters.
					The main advantage of enum rules is their simplicity, type safety and therefore nice validation. Furthermore it is possible to infer enums and their respective literals during the Ecore model transformation.</p>
<p>If you want to define a 
					<span class="emphasis"><em>ChangeKind</em></span> 
					<a class="ulink" href="http://help.eclipse.org/stable/index.jsp?topic=/org.eclipse.emf.doc/references/javadoc/org/eclipse/emf/ecore/change/impl/package-summary.html" target="_new">org.eclipse.emf.ecore.change/model/Change.ecore</a> with 
					<span class="emphasis"><em>ADD</em></span>, 
					<span class="emphasis"><em>MOVE</em></span> and 
					<span class="emphasis"><em>REMOVE</em></span> you could write:
				</p>
<div class="literallayout">
<p>
<code class="code">enum&nbsp;ChangeKind&nbsp;:<br>
&nbsp;&nbsp;ADD&nbsp;|&nbsp;MOVE&nbsp;|&nbsp;REMOVE<br>
;<br>

<br>

</code>
</p>
</div>
<p>It is even possible to use alternative literals for your enums or reference an enum value twice:</p>
<div class="literallayout">
<p>
<code class="code">enum&nbsp;ChangeKind&nbsp;:<br>
&nbsp;&nbsp;ADD&nbsp;=&nbsp;'add'&nbsp;|&nbsp;ADD&nbsp;=&nbsp;'+'&nbsp;|&nbsp;<br>
&nbsp;&nbsp;MOVE&nbsp;=&nbsp;'move'&nbsp;|&nbsp;MOVE&nbsp;=&nbsp;'-&gt;'&nbsp;|&nbsp;<br>
&nbsp;&nbsp;REMOVE&nbsp;=&nbsp;'remove'&nbsp;|&nbsp;REMOVE&nbsp;=&nbsp;'-'<br>
;<br>

<br>

</code>
</p>
</div>
<p>Please note, that Ecore does not support unset values for enums. If you formulate a grammar like</p>
<div class="literallayout">
<p>
<code class="code">Element:&nbsp;"element"&nbsp;name=ID&nbsp;(value=SomeEnum)?;<br>

</code>
</p>
</div>
<p>with the input of</p>
<div class="literallayout">
<p>
<code class="code">element&nbsp;Foo<br>

</code>
</p>
</div>
<p>the resulting value of the element 
					<span class="emphasis"><em>Foo</em></span> will hold the enum value with the internal representation of &sbquo;0&rsquo; (zero). When generating the 
					<span class="emphasis"><em>EPackage</em></span> from your grammar this will be the first literal you define. As a workaround you could introduce a dedicated none-value or order the enums accordingly. Note that it is not possible to define an enum literal with an empty textual representation.
				</p>
<div class="literallayout">
<p>
<code class="code">enum&nbsp;Visibility:&nbsp;<br>
&nbsp;&nbsp;package&nbsp;|&nbsp;private&nbsp;|&nbsp;protected&nbsp;|&nbsp;public<br>
;<br>
&nbsp;<br>

</code>
</p>
</div>
<p>You can overcome this by modifying the infered Ecore model through a 
					<a class="link" href="#customPostProcessing" title="Customized Post Processing">model to model transformation</a>.
				</p>
</div>
</div>
<div class="section" title="Ecore Model Inference">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="metamodelInference"></a>Ecore Model Inference</h2>
</div>
</div>
</div>
<p>The Ecore model (or meta model) of a textual language describes the structure of its abstract syntax trees (AST). </p>
<p>Xtext uses Ecore&rsquo;s 
				<span class="emphasis"><em>EPackages</em></span> to define Ecore models. Ecore models are declared to be either inferred (generated) from the grammar or imported. 
				By using the 
				<span class="emphasis"><em>generate</em></span> directive, one tells Xtext to derive an 
				<span class="emphasis"><em>EPackage</em></span> from the grammar. 
			</p>
<div class="section" title="Type and Package Generation">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="TypeandPackageGeneration"></a>Type and Package Generation</h3>
</div>
</div>
</div>
<p>Xtext creates</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>an 
							<span class="emphasis"><em>EPackage</em></span>
						
</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="circle">
<li class="listitem">
<p>for each generate-package declaration. After the directive 
									<span class="emphasis"><em>generate</em></span> a list of parameters follows. The 
									<span class="emphasis"><em>name</em></span> of the 
									<span class="emphasis"><em>EPackage</em></span> will be set to the first parameter, its 
									<span class="emphasis"><em>nsURI</em></span> to the second parameter. An optional alias as the third parameter allows to distinguish generated 
									<span class="emphasis"><em>EPackages</em></span> later. Only one generated package declaration per alias is allowed.
								</p>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>an 
							<span class="emphasis"><em>EClass</em></span>
						
</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="circle">
<li class="listitem">
<p>for each return type of a parser rule. If a parser rule does not define a return type, an implicit one with the same name as the rule itself is assumed. You can specify more than one rule that return the same type but only one 
									<span class="emphasis"><em>EClass</em></span> will be generated.
								</p>
</li>
<li class="listitem">
<p>for each type defined in an action or a cross-reference.</p>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>an 
							<span class="emphasis"><em>EEnum</em></span>
						
</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="circle">
<li class="listitem">
<p>for each return type of an enum rule.</p>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>an 
							<span class="emphasis"><em>EDataType</em></span>
						
</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="circle">
<li class="listitem">
<p>for each return type of a terminal rule or a data type rule.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p>All 
					<span class="emphasis"><em>EClasses</em></span>, 
					<span class="emphasis"><em>EEnums</em></span>, and 
					<span class="emphasis"><em>EDataTypes</em></span> are added to the 
					<span class="emphasis"><em>EPackage</em></span> referred to by the alias provided in the type reference they were created from.
				</p>
</div>
<div class="section" title="Feature and Type Hierarchy Generation">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="FeatureandTypeHierarchyGeneration"></a>Feature and Type Hierarchy Generation</h3>
</div>
</div>
</div>
<p>While walking through the grammar, the algorithm keeps track of a set of the currently possible return types to add features to. </p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>Entering a parser rule the set contains only the return type of the rule. </p>
</li>
<li class="listitem">
<p>Entering a group in an alternative the set is reset to the same state it was in when entering the first group of this alternative. </p>
</li>
<li class="listitem">
<p>Leaving an alternative the set contains the union of all types at the end of each of its groups.</p>
</li>
<li class="listitem">
<p>After an optional element, the set is reset to the same state it was before entering it. </p>
</li>
<li class="listitem">
<p>After a mandatory (non-optional) rule call or mandatory action the set contains only the return type of the called rule or action. </p>
</li>
<li class="listitem">
<p>An optional rule call does not modify the set.</p>
</li>
<li class="listitem">
<p>A rule call is optional, if its cardinality is '
							<span class="emphasis"><em>?</em></span>' or '
							<span class="emphasis"><em>*</em></span>'.
						</p>
</li>
</ul>
</div>
<p>While iterating the parser rules Xtext creates</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>an 
							<span class="emphasis"><em>EAttribute</em></span> in each current return type
						</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="circle">
<li class="listitem">
<p>of type 
									<span class="emphasis"><em>EBoolean</em></span> for each feature assignment using the '
									<span class="emphasis"><em>?=</em></span>' operator. No further 
									<span class="emphasis"><em>EReferences</em></span> or 
									<span class="emphasis"><em>EAttributes</em></span> will be generated from this assignment.
								</p>
</li>
<li class="listitem">
<p>for each assignment with the '
									<span class="emphasis"><em>=</em></span>' or '
									<span class="emphasis"><em>+=</em></span>' operator calling a terminal rule. Its type will be the return type of the called rule.
								</p>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>an 
							<span class="emphasis"><em>EReference</em></span> in each current return type
						</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="circle">
<li class="listitem">
<p>for each assignment with the '
									<span class="emphasis"><em>=</em></span>' or '
									<span class="emphasis"><em>+=</em></span>' operator in a parser rule calling a parser rule. The 
									<span class="emphasis"><em>EReference</em></span>'s type will be the return type of the called parser rule.
								</p>
</li>
<li class="listitem">
<p>for each assigned action. The reference&rsquo;s type will be set to the return type of the current calling rule. </p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p>Each 
					<span class="emphasis"><em>EAttribute</em></span> or 
					<span class="emphasis"><em>EReference</em></span> takes its name from the assignment or action that caused it. Multiplicities will be 0...1 for assignments with the '
					<span class="emphasis"><em>=</em></span>' operator and 0...* for assignments with the '
					<span class="emphasis"><em>+=</em></span>' operator. 
				</p>
<p>Furthermore, each type that is added to the currently possible return types automatically extends the current return type of the parser rule. You can specify additional common super types by means of &bdquo;artificial&rdquo; parser rules, that are never called, e.g.</p>
<div class="literallayout">
<p>
<code class="code">CommonSuperType:<br>
&nbsp;&nbsp;SubTypeA&nbsp;|&nbsp;SubTypeB&nbsp;|&nbsp;SubTypeC;<br>

<br>

</code>
</p>
</div>
</div>
<div class="section" title="Enum Literal Generation">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="EnumLiteralGeneration"></a>Enum Literal Generation</h3>
</div>
</div>
</div>
<p>For each alternative defined in an enum rule, the transformer creates an enum literal, when another literal with the same name cannot be found. The 
					<span class="emphasis"><em>literal</em></span> property of the generated enum literal is set to the right hand side of the declaration. If it is omitted, you will get an enum literal with equal 
					<span class="emphasis"><em>name</em></span> and 
					<span class="emphasis"><em>literal</em></span> attributes.
				</p>
<div class="literallayout">
<p>
<code class="code">enum&nbsp;MyGeneratedEnum:<br>
&nbsp;&nbsp;NAME&nbsp;=&nbsp;'literal'&nbsp;|&nbsp;EQUAL_NAME_AND_LITERAL;<br>

<br>

</code>
</p>
</div>
</div>
<div class="section" title="Feature Normalization">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="FeatureNormalization"></a>Feature Normalization</h3>
</div>
</div>
</div>
<p>In the next step the generator examines all generated 
					<span class="emphasis"><em>EClasses</em></span> and lifts up similar features to super types if there is more than one subtype and the feature is defined in every subtypes. This does even work for multiple super types.
				</p>
</div>
<div class="section" title="Customized Post Processing">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="customPostProcessing"></a>Customized Post Processing</h3>
</div>
</div>
</div>
<p>As a last step, the generator invokes the post processor for every generated Ecore model. The post processor expects an Xtend file with name 
					<span class="emphasis"><em>MyDslPostProcessor.ext</em></span> (if the name of the grammar file is 
					<span class="emphasis"><em>MyDsl.xtext</em></span>) in the same folder as the grammar file. Further, for a successful invocation, the Xtend file must declare an extension with signature 
					<span class="emphasis"><em>process(xtext::GeneratedMetamodel)</em></span>. E.g.
				</p>
<div class="literallayout">
<p>
<code class="code">process(xtext::GeneratedMetamodel&nbsp;this)&nbsp;:<br>
&nbsp;&nbsp;process(ePackage)<br>
;<br>
&nbsp;<br>
process(ecore::EPackage&nbsp;this)&nbsp;:<br>
&nbsp;&nbsp;...&nbsp;do&nbsp;something<br>
;<br>

<br>

</code>
</p>
</div>
<p>The invoked extension can then augment the generated Ecore model in place. Some typical use cases are to:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>set default values for attributes,</p>
</li>
<li class="listitem">
<p>add container references as opposites of existing containment references, or</p>
</li>
<li class="listitem">
<p>add operations with implementation using a body annotation.</p>
</li>
</ul>
</div>
<p>Great care must be taken to not modify the Ecore model in a way preventing the Xtext parser from working correctly (e.g. removing or renaming model elements).</p>
</div>
<div class="section" title="Error Conditions">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="ErrorConditions"></a>Error Conditions</h3>
</div>
</div>
</div>
<p>The following conditions cause an error</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>An 
							<span class="emphasis"><em>EAttribute</em></span> or 
							<span class="emphasis"><em>EReference</em></span> has two different types or different cardinality.
						</p>
</li>
<li class="listitem">
<p>There is an 
							<span class="emphasis"><em>EAttribute</em></span> and an 
							<span class="emphasis"><em>EReference</em></span> with the same name in the same 
							<span class="emphasis"><em>EClass</em></span>.
						</p>
</li>
<li class="listitem">
<p>There is a cycle in the type hierarchy.</p>
</li>
<li class="listitem">
<p>An new 
							<span class="emphasis"><em>EAttribute</em></span>, 
							<span class="emphasis"><em>EReference</em></span> or super type is added to an imported type.
						</p>
</li>
<li class="listitem">
<p>An 
							<span class="emphasis"><em>EClass</em></span> is added to an imported 
							<span class="emphasis"><em>EPackage</em></span>.
						</p>
</li>
<li class="listitem">
<p>An undeclared alias is used. </p>
</li>
<li class="listitem">
<p>An imported Ecore model cannot be loaded.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="section" title="Grammar Mixins">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="grammarMixins"></a>Grammar Mixins</h2>
</div>
</div>
</div>
<p>Xtext supports the reuse of existing grammars. Grammars that are created via the Xtext wizard use 
				<span class="emphasis"><em>org.eclipse.xtext.common.Terminals</em></span> by default which introduces a common set of terminal rules and defines reasonable defaults for hidden terminals.
			</p>
<div class="literallayout">
<p>
<code class="code">grammar&nbsp;org.xtext.example.MyDsl&nbsp;with&nbsp;org.eclipse.xtext.common.Terminals<br>
&nbsp;<br>
generate&nbsp;myDsl&nbsp;'http://www.xtext.org/example/MyDsl'<br>
&nbsp;<br>
...&nbsp;some&nbsp;rules<br>

<br>

</code>
</p>
</div>
<p>Mixing in another grammar makes the rules defined in that grammar referable. It is also possible to overwrite rules from the used grammar. </p>
<p>Example :</p>
<div class="literallayout">
<p>
<code class="code">grammar&nbsp;my.SuperGrammar<br>
...<br>
RuleA&nbsp;:&nbsp;"a"&nbsp;stuff=RuleB;<br>
RuleB&nbsp;:&nbsp;"{"&nbsp;name=ID&nbsp;"}";<br>

<br>
grammar&nbsp;my.SubGrammar&nbsp;with&nbsp;my.SuperGrammar<br>

<br>
Model&nbsp;:&nbsp;(ruleAs+=RuleA)*;<br>

<br>
//&nbsp;overrides&nbsp;my.SuperGrammar.RuleB<br>
RuleB&nbsp;:&nbsp;'['&nbsp;name=ID&nbsp;']';<br>

<br>

</code>
</p>
</div>
<p>Note that declared terminal rules always get a higher priority then imported terminal rules.</p>
</div>
<div class="section" title="Common Terminals">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="CommonTerminals"></a>Common Terminals</h2>
</div>
</div>
</div>
<p>Xtext ships with a default set of predefined, reasonable and often required terminal rules. This grammar is defined as follows:</p>
<div class="literallayout">
<p>
<code class="code">grammar&nbsp;org.eclipse.xtext.common.Terminals&nbsp;<br>
&nbsp;&nbsp;hidden(WS,&nbsp;ML_COMMENT,&nbsp;SL_COMMENT)<br>

<br>
import&nbsp;"http://www.eclipse.org/emf/2002/Ecore"&nbsp;as&nbsp;ecore<br>

<br>
terminal&nbsp;ID&nbsp;:&nbsp;<br>
&nbsp;&nbsp;'^'?('a'..'z'|'A'..'Z'|'_')&nbsp;('a'..'z'|'A'..'Z'|'_'|'0'..'9')*&nbsp;;<br>
terminal&nbsp;INT&nbsp;returns&nbsp;ecore::EInt:&nbsp;('0'..'9')+&nbsp;;<br>
terminal&nbsp;STRING	:&nbsp;<br>
&nbsp;&nbsp;'"'&nbsp;(&nbsp;'\\'&nbsp;('b'|'t'|'n'|'f'|'r'|'"'|"'"|'\\')&nbsp;|&nbsp;!('\\'|'"')&nbsp;)*&nbsp;'"'&nbsp;|<br>
&nbsp;&nbsp;"'"&nbsp;(&nbsp;'\\'&nbsp;('b'|'t'|'n'|'f'|'r'|'"'|"'"|'\\')&nbsp;|&nbsp;!('\\'|"'")&nbsp;)*&nbsp;"'";&nbsp;<br>
terminal&nbsp;ML_COMMENT	:&nbsp;'/*'&nbsp;-&gt;&nbsp;'*/'&nbsp;;<br>
terminal&nbsp;SL_COMMENT&nbsp;	:&nbsp;'//'&nbsp;!('\n'|'\r')*&nbsp;('\r'?&nbsp;'\n')?&nbsp;;<br>
terminal&nbsp;WS		:&nbsp;('&nbsp;'|'\t'|'\r'|'\n')+&nbsp;;<br>
terminal&nbsp;ANY_OTHER:	.&nbsp;;<br>

<br>

</code>
</p>
</div>
</div>
</div>
<div class="chapter" title="Chapter&nbsp;4.&nbsp;Configuration">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="configuration"></a>Chapter&nbsp;4.&nbsp;Configuration</h2>
</div>
</div>
</div>
<div class="section" title="The Generator">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="generator"></a>The Generator</h2>
</div>
</div>
</div>
<p>Xtext provides lots of generic implementations for your language&rsquo;s
				infrastructure but also uses code generation to generate some of the 
				components. Those generated components are for instance the parser, the 
				serializer, the inferred Ecore model (if any) and a couple of convenient base classes for 
				content assist, etc.</p>
<p>The generator also contributes to shared project resources such as the 

				<span class="emphasis"><em>plugin.xml</em></span>, 
				<span class="emphasis"><em>MANIFEST.MF</em></span> and the 
				<a class="link" href="#guicemodules" title="The Module API">Guice modules</a>.
			</p>
<p>Xtext&rsquo;s generator leverages 
				<a class="link" href="#MWE2" title="Chapter&nbsp;6.&nbsp;MWE2">MWE2 &ndash; the modeling workflow engine</a> 
				from EMFT to configure the generator.
			</p>
<div class="section" title="A Short Introduction to MWE2">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="short_intro_to_mwe"></a>A Short Introduction to MWE2</h3>
</div>
</div>
</div>
<p>MWE2 allows to compose object graphs declaratively in a very compact manner. The nice thing about it is that it just 
					instantiates Java classes and the configuration is done through public setter and adder methods as one is used to 
					from Java Beans encapsulation principles. An in-depth documentation can be found in the chapter 
					<a class="link" href="#MWE2" title="Chapter&nbsp;6.&nbsp;MWE2">MWE2</a>.
				</p>
<p>Given the following simple Java class (POJO):</p>
<div class="literallayout">
<p>
<code class="code">package&nbsp;com.mycompany;<br>
&nbsp;&nbsp;<br>
public&nbsp;class&nbsp;Person&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;private&nbsp;String&nbsp;name;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;setName(String&nbsp;name)&nbsp;{&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;this.name&nbsp;=&nbsp;name;<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;private&nbsp;final&nbsp;List&lt;Person&gt;&nbsp;children&nbsp;=&nbsp;new&nbsp;ArrayList&lt;Person&gt;();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;addChild(Person&nbsp;child)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;this.children.add(child);<br>
&nbsp;&nbsp;}<br>
}<br>
&nbsp;&nbsp;<br>

</code>
</p>
</div>
<p>One can create a family tree with MWE2 easily by describing it in a declarative manner 
					without writing a single line of Java code and without the need to compile classes:</p>
<div class="literallayout">
<p>
<code class="code">module&nbsp;com.mycompany.CreatePersons<br>

<br>
Person&nbsp;{<br>
	name&nbsp;=&nbsp;"Grandpa"<br>
	child&nbsp;=&nbsp;{<br>
		name&nbsp;=&nbsp;"Father"<br>
		child&nbsp;=&nbsp;{<br>
			name&nbsp;=&nbsp;"Son"<br>
		}<br>
	}<br>
}<br>

<br>

</code>
</p>
</div>
<p>These couple of lines will, when interpreted by MWE2, result in an 
					object tree consisting of three instances of 
					<span class="emphasis"><em>com.mycompany.Person</em></span>.
					The interpreter will basically do the same as the following 
					<span class="emphasis"><em>main</em></span> method: 
				</p>
<div class="literallayout">
<p>
<code class="code">package&nbsp;com.mycompany;<br>

<br>
public&nbsp;class&nbsp;CreatePersons&nbsp;{<br>
	public&nbsp;static&nbsp;void&nbsp;main(String[]&nbsp;args)&nbsp;{<br>
		Person&nbsp;grandpa&nbsp;=&nbsp;new&nbsp;Person();<br>
		grandpa.setName("Grandpa");<br>
		Person&nbsp;father&nbsp;=&nbsp;new&nbsp;Person();<br>
		father.setName("Father");<br>
		grandpa.addChild(father);<br>
		Person&nbsp;son&nbsp;=&nbsp;new&nbsp;Person();<br>
		son.setName("Son");<br>
		father.addChild(son);<br>
	}<br>
}<br>

<br>

</code>
</p>
</div>
<p>
					
</p>
<div class="mediaobject">
<img src="images/family_tree.png"></div>
<p> 
				
</p>
<p>The root element is a class-name following the Java classpath visibility rules. As the module is a sibling to the class

					<span class="emphasis"><em>com.mycompany.Person</em></span> it is not necessary to use use fully qualified name. There are other packages implicitly imported
					into this workflow as well to make it convenient to instantiate actual workflows and components, but these ones are covered 
					in depth in the appropriate 
					<a class="link" href="#MWE2" title="Chapter&nbsp;6.&nbsp;MWE2">chapter</a>. The constructed objects are furthermore configured according to the declaration 
					in the module, e.g. a second instance of Person will be created and added to the list of children of &bdquo;Grandpa&rdquo; while the third 
					person &ndash; the class is inferred from the assigned feature &ndash; becomes a child of &bdquo;Father&rdquo;. All three instances will have 
					their respective 
					<span class="emphasis"><em>name</em></span> assigned via a reflective invocation 
					<span class="emphasis"><em>setName</em></span>. If one wants to add another child to &bdquo;Father&rdquo;, she
					can simply repeat the child assignment:
				</p>
<div class="literallayout">
<p>
<code class="code">child&nbsp;=&nbsp;com.mycompany.Person&nbsp;{<br>
	name&nbsp;=&nbsp;"Father"<br>
	child&nbsp;=&nbsp;{<br>
		name&nbsp;=&nbsp;"Son"<br>
	}<br>
	child&nbsp;=&nbsp;{<br>
		name&nbsp;=&nbsp;"Daughter"<br>
	}<br>
}<br>

<br>

</code>
</p>
</div>
<p>As you can see in the example above MWE2 can be used to instantiate arbitrary Java object models without any dependency or
					limitation to MWE2 specific implementations. This is conceptually very close to the dependency injection mechanism and 
					the XML language in the 
					<a class="ulink" href="http://www.springframework.org" target="_new">Spring Framework</a>. 
				</p>
<p>
					
<span class="bold"><strong>Tip</strong></span>

					<span class="italic">Whenever you are in an *.mwe2 file and wonder what kind of configuration the underlying component may accept:</span>

					<span class="italic">Just use the Content Assist in the MWE2 Editor or navigate directly to the declaration of the underlying Java</span> 

					<span class="italic">implementation by means of F3 (Go To Declaration).</span>
				
</p>
<p>This is the basic idea of the MWE2 language. There are of course a couple of additional concepts and features in the 
					language and we also have not yet talked about the runtime workflow model. Please refer to the dedicated MWE2 

					<a class="link" href="#MWE2" title="Chapter&nbsp;6.&nbsp;MWE2">reference documentation</a> for additional information.
				</p>
</div>
<div class="section" title="General Architecture">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="GeneralArchitecture"></a>General Architecture </h3>
</div>
</div>
</div>
<p>Of course a generator in Xtext is not composed of fathers and sons, but of so called language configurations. 
					For each language configuration a URI pointing to 
					its grammar file and the file extensions for the DSL must be provided. 
					In addition, a language is configured with a list of 

					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/IGeneratorFragment.java?root=Modeling_Project&view=co" target="_new">IGeneratorFragment</a>s.
					The whole generator is composed of theses fragments. We have fragments for generating parsers, the serializer, the EMF code, 
					the outline view, etc. 
				</p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/generator-structure.png"></div>
<p>
				
</p>
<div class="section" title="Generator Fragments">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="generator_fragment"></a>Generator Fragments</h4>
</div>
</div>
</div>
<p>Each fragment gets the grammar of the language as an EMF model passed in. A fragment is able to generate code in one 
						of the configured locations and contribute to several shared artifacts. The main interface 

						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/IGeneratorFragment.java?root=Modeling_Project&view=co" target="_new">IGeneratorFragment</a> is supported by a convenient 
						abstract base class 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/AbstractGeneratorFragment.java?root=Modeling_Project&view=co" target="_new">AbstractGeneratorFragment</a>, which 
						by default delegates to an Xpand template with the same qualified name as the class and delegates some of the 
						calls to Xpand template definitions.
					</p>
<p>We suggest to have a look at the fragment we have written for label providers (
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/ui/generator/labeling/LabelProviderFragment.java?root=Modeling_Project&view=co" target="_new">LabelProviderFragment</a>). It is pretty trivial and at the same time uses the most important call backs. In addition, the structure is not cluttered with too much extra noise so that the whole package can serve as a template to write your own fragment.
					</p>
</div>
<div class="section" title="Configuration">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="Configuration"></a>Configuration</h4>
</div>
</div>
</div>
<p>As already explained we use MWE2 from EMFT in order to instantiate, configure and execute this structure of components. 
						In the following we see an exemplary Xtext generator configuration written in MWE2 configuration code:  </p>
<div class="literallayout">
<p>
<code class="code">module&nbsp;org.xtext.example.MyDsl<br>

<br>
import&nbsp;org.eclipse.emf.mwe.utils.*<br>
import&nbsp;org.eclipse.xtext.generator.*<br>
import&nbsp;org.eclipse.xtext.ui.generator.*<br>

<br>
var&nbsp;grammarURI&nbsp;=&nbsp;"classpath:/org/xtext/example/MyDsl.xtext"<br>
var&nbsp;file.extensions&nbsp;=&nbsp;"mydsl"<br>
var&nbsp;projectName&nbsp;=&nbsp;"org.xtext.example.mydsl"<br>
var&nbsp;runtimeProject&nbsp;=&nbsp;"../${projectName}"<br>

<br>
Workflow&nbsp;{<br>
	bean&nbsp;=&nbsp;StandaloneSetup&nbsp;{<br>
		platformUri&nbsp;=&nbsp;"${runtimeProject}/.."<br>
	}<br>

<br>
	component&nbsp;=&nbsp;DirectoryCleaner&nbsp;{<br>
		directory&nbsp;=&nbsp;"${runtimeProject}/src-gen"<br>
	}<br>

<br>
	component&nbsp;=&nbsp;DirectoryCleaner&nbsp;{<br>
		directory&nbsp;=&nbsp;"${runtimeProject}.ui/src-gen"<br>
	}<br>

<br>
	component&nbsp;=&nbsp;Generator&nbsp;{<br>
		pathRtProject&nbsp;=&nbsp;runtimeProject<br>
		pathUiProject&nbsp;=&nbsp;"${runtimeProject}.ui"<br>
		projectNameRt&nbsp;=&nbsp;projectName<br>
		projectNameUi&nbsp;=&nbsp;"${projectName}.ui"<br>

<br>
		language&nbsp;=&nbsp;{<br>
			uri&nbsp;=&nbsp;grammarURI<br>
			fileExtensions&nbsp;=&nbsp;file.extensions<br>

<br>
			//&nbsp;Java&nbsp;API&nbsp;to&nbsp;access&nbsp;grammar&nbsp;elements<br>
			fragment&nbsp;=&nbsp;grammarAccess.GrammarAccessFragment&nbsp;{}<br>

<br>
			/*&nbsp;more&nbsp;fragments&nbsp;to&nbsp;configure&nbsp;the&nbsp;language&nbsp;*/<br>
			...<br>
		}<br>
	}<br>
}<br>

<br>

</code>
</p>
</div>
<p>Here the root element is 
						<span class="emphasis"><em>Workflow</em></span> and is part of the very slim runtime model shipped with MWE2. It accepts 

						<span class="italic">bean</span> s and 
						<span class="italic">component</span> s. The 
						<span class="emphasis"><em>var</em></span> declaration is a first class concept of MWE2&rsquo;s configuration language 
						and defines the interface of the module. They allow to externalize some common configuration parameters. This 
						comes especially handy in String variables where one can easily use 
						<span class="emphasis"><em>${variable}</em></span> to concatenate values. 
					</p>
<p>The method 
						<span class="emphasis"><em>Workflow.addBean(Object)</em></span> does nothing but provides a means to apply global side-effects, which 
						unfortunately is required sometimes. In this example we do a so called 
						<span class="italic">EMF stand-alone setup</span>. This class 
						initializes a bunch of things for a non-OSGi environment that are otherwise configured by means of extension points, 
						e.g. it allows to populate EMF&rsquo;s singletons like the 
						<span class="emphasis"><em>EPackage.Registry</em></span>.
					</p>
<p>Following the 
						<span class="emphasis"><em>bean</em></span> assignment there are three 
						<span class="emphasis"><em>component</em></span> elements. The 
						<span class="emphasis"><em>Workflow.addComponent()</em></span> method 
						accepts instances of 
						<span class="emphasis"><em>IWorkflowComponent</em></span>, which is the primary concept of MWE2&rsquo;s workflow model. Xtext&rsquo;s generator 
						itself is an instance of 
						<span class="emphasis"><em>IWorkflowComponent</em></span> and can therefore be used within MWE2 workflows. 
					</p>
<p>There are two fragments 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/ImplicitRuntimeFragment.java?root=Modeling_Project&view=co" target="_new">ImplicitRuntimeFragment</a> and 

						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/ui/generator/ImplicitUiFragment.java?root=Modeling_Project&view=co" target="_new">ImplicitUiFragment</a> will be called implicitly if 
						the required paths and project names are set. They take care of common defaults.  
					</p>
</div>
</div>
<div class="section" title="Standard Generator Fragments">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="StandardGeneratorFragments"></a>Standard Generator Fragments</h3>
</div>
</div>
</div>
<p>In the following table the most important standard generator fragments are listed. Please refer to the Javadocs for more detailed documentation.</p>
<table id="N10D1C">
<tr>
						
<th>Class</th>
						<th>Generated Artifacts</th>
						<th>Related Documentation</th>
					
</tr>
<tr>
						
<td>
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/ecore/EcoreGeneratorFragment.java?root=Modeling_Project&view=co" target="_new">EcoreGeneratorFragment</a>
						</td>
						<td>EMF code for generated models</td>
						<td>
							<a class="link" href="#metamodelInference" title="Ecore Model Inference">Model inference</a>
						</td>
					
</tr>
<tr>
						
<td>
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/parser/antlr/XtextAntlrGeneratorFragment.java?root=Modeling_Project&view=co" target="_new">XtextAntlrGeneratorFragment</a>
						</td>
						<td>ANTLR grammar, parser, lexer and related services</td>
						<td></td>
					
</tr>
<tr>
						
<td>
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/grammarAccess/GrammarAccessFragment.java?root=Modeling_Project&view=co" target="_new">GrammarAccessFragment</a>
						</td>
						<td>Access to the grammar</td>
						<td></td>
					
</tr>
<tr>
						
<td>
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/resourceFactory/ResourceFactoryFragment.java?root=Modeling_Project&view=co" target="_new">ResourceFactoryFragment</a>
						</td>
						<td>EMF resource factory</td>
						<td>
							<a class="link" href="#xtext_resource" title="XtextResource Implementation">Xtext Resource</a>
						</td>
					
</tr>
<tr>
						
<td>
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/parseTreeConstructor/ParseTreeConstructorFragment.java?root=Modeling_Project&view=co" target="_new">ParseTreeConstructorFragment</a>
						</td>
						<td>Model-to-text serialization</td>
						<td>
							<a class="link" href="#serialization" title="Serialization">Serialization</a>
						</td>
					
</tr>
<tr>
						
<td>
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/scoping/ImportNamespacesScopingFragment.java?root=Modeling_Project&view=co" target="_new">ImportNamespacesScopingFragment</a>
						</td>
						<td>Index-based scoping</td>
						<td>
							<a class="link" href="#index_based" title="Global Scopes Based On External Configuration (e.g. Classpath-Based)">Index-based namespace scoping</a>
						</td>
					
</tr>
<tr>
						
<td>
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/validation/JavaValidatorFragment.java?root=Modeling_Project&view=co" target="_new">JavaValidatorFragment</a>
						</td>
						<td>Model validation</td>
						<td>
							<a class="link" href="#custom_validation" title="Custom Validation">Model validation</a>
						</td>
					
</tr>
<tr>
						
<td>
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/formatting/FormatterFragment.java?root=Modeling_Project&view=co" target="_new">FormatterFragment</a>
						</td>
						<td>Code formatter</td>
						<td>
							<a class="link" href="#declarativeformatter" title="Declarative Formatter">Declarative formatter</a>
						</td>
					
</tr>
<tr>
						
<td>
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/ui/generator/labeling/LabelProviderFragment.java?root=Modeling_Project&view=co" target="_new">LabelProviderFragment</a>
						</td>
						<td>Label provider</td>
						<td>
							<a class="link" href="#labelProvider" title="Label Provider">Label provider</a>
						</td>
					
</tr>
<tr>
						
<td>
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/ui/generator/outline/OutlineNodeAdapterFactoryFragment.java?root=Modeling_Project&view=co" target="_new">OutlineNodeAdapterFactoryFragment</a>
						</td>
						<td>Outline view configuration</td>
						<td>
							<a class="link" href="#outline" title="Outline View">Outline</a>
						</td>
					
</tr>
<tr>
						
<td>
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/ui/generator/outline/TransformerFragment.java?root=Modeling_Project&view=co" target="_new">TransformerFragment</a>
						</td>
						<td>Outline view configuration</td>
						<td>
							<a class="link" href="#outline" title="Outline View">Outline</a>
						</td>
					
</tr>
<tr>
						
<td>
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/ui/generator/contentAssist/JavaBasedContentAssistFragment.java?root=Modeling_Project&view=co" target="_new">JavaBasedContentAssistFragment</a>
						</td>
						<td>Java-based content assist</td>
						<td>
							<a class="link" href="#contentAssist" title="Content Assist">Content assist</a>
						</td>
					
</tr>
<tr>
						
<td>
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/parser/antlr/XtextAntlrUiGeneratorFragment.java?root=Modeling_Project&view=co" target="_new">XtextAntlrUiGeneratorFragment</a>
						</td>
						<td>Content assist helper based on ANTLR</td>
						<td>
							<a class="link" href="#contentAssist" title="Content Assist">Content assist</a>
						</td>
					
</tr>
<tr>
						
<td>
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/ui/generator/projectWizard/SimpleProjectWizardFragment.java?root=Modeling_Project&view=co" target="_new">SimpleProjectWizardFragment</a>
						</td>
						<td>New project wizard</td>
						<td>
							<a class="link" href="#projectwizard" title="Project Wizard">Project wizard</a>
						</td>
					
</tr>
</table>
</div>
</div>
<div class="section" title="Dependency Injection in Xtext with Google Guice">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="dependencyInjection"></a>Dependency Injection in Xtext with Google Guice</h2>
</div>
</div>
</div>
<p>All Xtext components are assembled by means of Dependency Injection (DI). This means basically that whenever some code is in need for functionality (or state) 
				from another component, one just declares the dependency rather then stating how to resolve it, i.e. obtaining that component.</p>
<p>For instance when some code wants to use a scope provider, it just declares a field (or method or constructor) and 
				adds the @Inject annotation: </p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;MyLanguageLinker&nbsp;extends&nbsp;Linker&nbsp;{<br>

<br>
&nbsp;&nbsp;@Inject<br>
&nbsp;&nbsp;private&nbsp;IScopeProvider&nbsp;scopeProvider;<br>

<br>
}<br>
&nbsp;<br>

</code>
</p>
</div>
<p>It is not the duty of the code to care about where the 
				<span class="emphasis"><em>IScopeProvider</em></span> comes from or how it is created. When above&rsquo;s
				class is instantiated, Guice sees that it requires an instance of IScopeProvider and assigns it to the specified field or method parameter.
				This of course only works, if the object itself is created by Guice. In Xtext almost every instance is created that way 
				and therefore the whole dependency net is controlled and configured by the means of Google Guice.
			</p>
<p>Guice of course needs to know how to instantiate real objects for declared dependencies. This is done in so called 
				<span class="emphasis"><em>Modules</em></span>.
				A 
				<span class="emphasis"><em>Module</em></span> defines a set of mappings from types to either existing instances, instance providers or concrete
				classes. Modules are implemented in Java. Here&rsquo;s an example:
			</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;MyDslRuntimeModule&nbsp;extends&nbsp;AbstractMyDslRuntimeModule&nbsp;{<br>
	@Override<br>
	public&nbsp;void&nbsp;configure(Binder&nbsp;binder)&nbsp;{<br>
		super.configure(binder);<br>
		binder.bind(IScopeProvider.class).to(MyConcreteScopeProvider.class);<br>
	}<br>
}<br>

<br>

</code>
</p>
</div>
<p>With plain Guice modules one implements a method called configure and gets a so called 
				<span class="emphasis"><em>Binder</em></span> passed in.
				That binder provides a fluent API to define the mentioned mappings. This was just a very brief and simplified description.
				We highly recommend to have a look at 
				<a class="ulink" href="http://code.google.com/p/google-guice/" target="_new">the website Google Guice</a> to learn more.  
			</p>
<div class="section" title="The Module API">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="guicemodules"></a>The Module API</h3>
</div>
</div>
</div>
<p>Xtext comes with a slightly enhanced module API. For your language you get two different modules: One for the runtime bundle
					which is used when executing your language infrastructure outside of Eclipse such as on the build server. The other is
					located in the UI bundle and adds or overrides bindings when Xtext is used within an Eclipse environment. </p>
<p>The enhancement we added to Guice&rsquo;s Module API is that we provide an abstract base class, which reflectively looks for certain 
					methods in order to find declared bindings. The most common kind of method is :</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;Class&lt;?&nbsp;extends&nbsp;IScopeProvider&gt;&nbsp;bindIScopeProvider()&nbsp;{<br>
	return&nbsp;MyConcreteScopeProvider.class;<br>
}<br>

<br>

</code>
</p>
</div>
<p>which would do the same as the code snippet above. It simply declares a binding from 
					<span class="emphasis"><em>IScopeProvider</em></span> to 
					<span class="emphasis"><em>MyConcreteScopeProvider</em></span>.
					That binding will make Guice instantiate and inject a new instance of 
					<span class="emphasis"><em>MyConcreteScopeProvider</em></span> whenever a dependency 
					to 
					<span class="emphasis"><em>IScopeProvider</em></span> is declared.
				</p>
<p>Having a method per binding allows to deactivate individual bindings by overriding the corresponding methods and either change 
					the binding by returning a different target type or removing that binding completely by returning null.</p>
<p>There are two additional kinds of binding-methods supported. The first one allows to configure a provider. A 
					<span class="emphasis"><em>Provider</em></span> is
					an interface with just one method : 
				</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;interface&nbsp;Provider&lt;T&gt;&nbsp;{<br>

<br>
&nbsp;&nbsp;/**<br>
&nbsp;&nbsp;&nbsp;*&nbsp;Provides&nbsp;an&nbsp;instance&nbsp;of&nbsp;{@code&nbsp;T}.&nbsp;Must&nbsp;never&nbsp;return&nbsp;{@code&nbsp;null}.<br>
&nbsp;&nbsp;&nbsp;*/<br>
&nbsp;&nbsp;T&nbsp;get();<br>
}<br>

<br>

</code>
</p>
</div>
<p>This one can be used if you need a hook whenever an instance of a certain type is created. For instance if you want to 
					provide lazy access to a singleton or you need to do some computation each time an instance is created (i.e. factory). If you want 
					to point to a provider rather than to a concrete class you can use the following binding method.</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;Class&lt;?&nbsp;extends&nbsp;Provider&lt;IScopeProvider&gt;&gt;&nbsp;provideIScopeProvider()&nbsp;{<br>
	return&nbsp;MyConcreteScopeProviderFactory.class;<br>
}<br>

<br>

</code>
</p>
</div>
<p>
					
<span class="italic">(Please forgive us the overuse of the term</span> provider. 
					<span class="italic">The IScopeProvider is not a Guice</span> provider 
					<span class="italic">.)</span>
				
</p>
<p>That binding tells Guice to instantiate 
					<span class="emphasis"><em>MyConcreteScopeProviderFactory</em></span> and invoke get() in order to obtain an instance of 

					<span class="emphasis"><em>IScopeProvider</em></span> 
					for clients having declared a dependency to that type. Both mentioned methods are allowed to return an instance instead of a type. This
					may be useful if some global state should be shared in the application:
				</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;Provider&lt;IScopeProvider&gt;&nbsp;provideIScopeProvider()&nbsp;{<br>
	return&nbsp;new&nbsp;MyConcreteScopeProviderFactory();<br>
}<br>

<br>

</code>
</p>
</div>
<p>or</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;IScopeProvider&nbsp;bindIScopeProvider()&nbsp;{<br>
	return&nbsp;new&nbsp;MyConcreteScopeProvider();<br>
}<br>

<br>

</code>
</p>
</div>
<p>respectively.</p>
<p>The last binding method provided by Xtext allows to do anything you can do with Guice&rsquo;s binding API, since it allows you to 
					use it directly. If your method&rsquo;s name starts with the name &sbquo;configure&rsquo;, has a return type 
					<span class="emphasis"><em>void</em></span> and accepts one argument of 
					type 
					<span class="emphasis"><em>Binder</em></span>
				
</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;void&nbsp;configureIScopeProvider(Binder&nbsp;binder)&nbsp;{<br>
	binder.bind(IScopeProvider.class).to(MyConcreteScopeProvider.class);<br>
}&nbsp;<br>

<br>

</code>
</p>
</div>
</div>
<div class="section" title="Obtaining an Injector">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="ObtaininganInjector"></a>Obtaining an 
					<span class="emphasis"><em>Injector</em></span>
				
</h3>
</div>
</div>
</div>
<p>In every application wired up with Guice there is usually one point where you initialize a so called 
					<span class="emphasis"><em>Injector</em></span> using the 
					modules declared and after that using that injector to create the root instance of the whole application. In plain Java environments
					this is something that&rsquo;s done in the main method. It could look like this:
				</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;static&nbsp;void&nbsp;main(String[]&nbsp;args)&nbsp;{<br>
	Injector&nbsp;injector&nbsp;=&nbsp;Guice.createInjector(new&nbsp;MyDslRuntimeModule());<br>
	MyApplication&nbsp;application&nbsp;=&nbsp;injector.getInstance(MyApplication.class);<br>
	application.run();<br>
}<br>

<br>

</code>
</p>
</div>
<p>Xtext uses EMF which makes use of a couple of global registries, which have to be configured on startup. Because we
					of course want to leverage Guice also for all factories, etc. that we put into those registries, we have introduced a so called

					<span class="emphasis"><em>ISetup</em></span> which provides a method called 
					<span class="emphasis"><em>Injector createInjectorAndDoEMFRegistration()</em></span>. So instead of using the plain Guice
					code shown above you rather use the 
					<span class="emphasis"><em>ISetup</em></span> class generated for your language, which, as the method name suggests, creates
					an 
					<span class="emphasis"><em>Injector</em></span> and uses it to initialize a couple of EMF objects and register them in the corresponding registries.
				</p>
<div class="literallayout">
<p>
<code class="code">Injector&nbsp;injector&nbsp;=&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;MyStandaloneSetup().createInjectorAndDoEMFRegistration();&nbsp;<br>

<br>

</code>
</p>
</div>
<p>These are the basic ideas around Guice and the small extension Xtext provides on top. For more information we 
					strongly encourage you to read through the documentation on 
					<a class="ulink" href="http://code.google.com/p/google-guice/" target="_new">the website of Google Guice</a>.
				</p>
</div>
</div>
</div>
<div class="chapter" title="Chapter&nbsp;5.&nbsp;Runtime Concepts">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="runtime_concepts"></a>Chapter&nbsp;5.&nbsp;Runtime Concepts</h2>
</div>
</div>
</div>
<p>Xtext itself and every language infrastructure developed with Xtext is configured and wired-up using 

			<a class="link" href="#dependencyInjection" title="Dependency Injection in Xtext with Google Guice">dependency injection</a>. Xtext may be used in different environments which introduce 
			different constraints. Especially important is the difference between OSGi managed containers and plain 
			vanilla Java programs. To honor these differences Xtext uses the concept of 

			<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/ISetup.java?root=Modeling_Project&view=co" target="_new">ISetup</a>-implementations in normal mode and uses Eclipse&rsquo;s 
			extension mechanism when it should be configured in an OSGi environment.   
		</p>
<div class="section" title="Runtime Setup (ISetup)">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="RuntimeSetupISetup"></a>Runtime Setup (ISetup)</h2>
</div>
</div>
</div>
<p>For each language there is an implementation of 
				<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/ISetup.java?root=Modeling_Project&view=co" target="_new">ISetup</a> 
				generated. It implements a method called 
				<span class="emphasis"><em>createInjectorAndDoEMFRegistration()</em></span>, which can be called 
				to do the initialization of the language infrastructure. This class is intended to be used for 
				runtime and for unit testing, only.
			</p>
<p>The setup method returns an 
				<span class="emphasis"><em>Injector</em></span>, which can further be used to obtain a parser, etc. It also 
				registers the ResourceFactory and generated 
				<span class="emphasis"><em>EPackages</em></span> at the respective global registries provided 
				by EMF. So basically you can just run the setup and start using EMF API to load and store models of 
				your language.
			</p>
</div>
<div class="section" title="Setup within Eclipse-Equinox (OSGi)">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="SetupwithinEclipseEquinoxOSGi"></a>Setup within Eclipse-Equinox (OSGi)</h2>
</div>
</div>
</div>
<p>Within Eclipse we have a generated 
				<span class="emphasis"><em>Activator</em></span>, which creates a Guice injector using the 
				<a class="link" href="#guicemodules" title="The Module API">modules</a>.
				In addition an 
				<span class="emphasis"><em>IExecutableExtensionFactory</em></span> is generated for each language, which is used to create 
				<span class="emphasis"><em>ExecutableExtensions</em></span>.
				This means that everything which is created via extension points is managed by Guice as well, i.e. you can declare dependencies and get them injected upon creation. 
			</p>
<p>The only thing you have to do in order to use this factory is to prefix the class with the factory 
				<span class="emphasis"><em>ExecutableExtensionFactory</em></span> name followed by a colon.
			</p>
<div class="literallayout">
<p>
<code class="code">&lt;extension<br>
&nbsp;&nbsp;point="org.eclipse.ui.editors"&gt;<br>
&nbsp;&nbsp;&lt;editor<br>
&nbsp;&nbsp;&nbsp;&nbsp;class="&lt;MyLanguageName&gt;ExecutableExtensionFactory:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;org.eclipse.xtext.ui.editor.XtextEditor"<br>
&nbsp;&nbsp;&nbsp;&nbsp;contributorClass=<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"org.eclipse.ui.editors.text.TextEditorActionContributor"<br>
&nbsp;&nbsp;&nbsp;&nbsp;default="true"<br>
&nbsp;&nbsp;&nbsp;&nbsp;extensions="ecoredsl"<br>
&nbsp;&nbsp;&nbsp;&nbsp;id="org.eclipse.xtext.example.EcoreDsl"<br>
&nbsp;&nbsp;&nbsp;&nbsp;name="EcoreDsl&nbsp;Editor"&gt;<br>
&nbsp;&nbsp;&lt;/editor&gt;<br>
&lt;/extension&gt;<br>

<br>

</code>
</p>
</div>
</div>
<div class="section" title="Logging">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Logging"></a>Logging</h2>
</div>
</div>
</div>
<p>Xtext uses Apache&rsquo;s log4j for logging. It is configured using the so called 
				<span class="emphasis"><em>log4j.properties</em></span>, which is looked up in the root of the Java classpath. If you want to change or provide configuration at runtime (i.e. non-OSGI), all you have to do is putting such a 
				<span class="emphasis"><em>log4j.properties</em></span> in place and make sure that it is not overridden by other 
				<span class="emphasis"><em>log4j.properties</em></span> in previous classpath entries.
			</p>
<p>In OSGi you provide configuration by creating a fragment for 
				<span class="emphasis"><em>org.apache.log4j</em></span>. In this case you need to make sure that there&rsquo;s no second fragment contributing a 
				<span class="emphasis"><em>log4j.properties</em></span> file.
			</p>
</div>
<div class="section" title="Validation">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="validation"></a>Validation</h2>
</div>
</div>
</div>
<p>Static analysis or validation is one of the most interesting aspects when developing a programming language. The users of your languages will be grateful
				if they get informative feedback as they type. 
				In Xtext there are basically three different kinds of validation.</p>
<div class="section" title="Automatic Validation">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="AutomaticValidation"></a>Automatic Validation</h3>
</div>
</div>
</div>
<p>Some implementation aspects (e.g. the grammar, scoping) of a language have an impact on what is required for a document or semantic model to be valid. Xtext automatically takes care of this. </p>
<div class="section" title="Lexer/Parser: Syntactical Validation">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="syntactical_validation"></a>Lexer/Parser: Syntactical Validation</h4>
</div>
</div>
</div>
<p>The syntactical correctness of any textual input is validated automatically by the parser. The error messages are generated by the underlying parser technology.
						One can use the 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/parser/antlr/ISyntaxErrorMessageProvider.java?root=Modeling_Project&view=co" target="_new">ISyntaxErrorMessageProvider</a>-API to customize this messages.
						Any syntax errors can be retrieved from the Resource using the common EMF API:
					</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>
								
<span class="emphasis"><em>org.eclipse.emf.ecore.resource.Resource.getErrors()</em></span>
							
</p>
</li>
<li class="listitem">
<p>
								
<span class="emphasis"><em>org.eclipse.emf.ecore.resource.Resource.getWarnings()</em></span>
							
</p>
</li>
</ul>
</div>
</div>
<div class="section" title="Linker: Crosslink Validation">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="linking_validation"></a>Linker: Crosslink Validation</h4>
</div>
</div>
</div>
<p>Any broken crosslinks can be checked generically. As crosslink resolution is done lazily (see 
						<a class="link" href="#linking" title="Linking">linking</a>), any broken links are resolved lazily as well.
						If you want to validate whether all links are valid, you will have to navigate through the model so that all installed EMF proxies get resolved. This is done automatically in the editor.
					</p>
<p>Similar to syntax errors, any unresolvable crosslinks will be reported and can be obtained through:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>
								
<span class="emphasis"><em>org.eclipse.emf.ecore.resource.Resource.getErrors()</em></span>
							
</p>
</li>
<li class="listitem">
<p>
								
<span class="emphasis"><em>org.eclipse.emf.ecore.resource.Resource.getWarnings()</em></span>
							
</p>
</li>
</ul>
</div>
</div>
<div class="section" title="Serializer: Concrete Syntax Validation">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="concrete_syntax_validation"></a>Serializer: Concrete Syntax Validation</h4>
</div>
</div>
</div>
<p>The 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/validation/IConcreteSyntaxValidator.java?root=Modeling_Project&view=co" target="_new">IConcreteSyntaxValidator</a> validates all constraints that are implied by a grammar. Meeting these constraints for a model is mandatory to be serialized.
					</p>
<p>Example:</p>
<div class="literallayout">
<p>
<code class="code">MyRule:<br>
&nbsp;&nbsp;({MySubRule}&nbsp;"sub")?&nbsp;(strVal+=ID&nbsp;intVal+=INT)*;<br>
	
<br>

</code>
</p>
</div>
<p>This implies several constraints:</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>Types: only instances of 
								<span class="emphasis"><em>MyRule</em></span> and 
								<span class="emphasis"><em>MySubRule</em></span> are allowed for this rule. Sub-types are prohibited, since the parser never instantiates unknown sub-types.
							</p>
</li>
<li class="listitem">
<p>Features: In case the 
								<span class="emphasis"><em>MyRule</em></span> and 
								<span class="emphasis"><em>MySubRule</em></span> have 
								<span class="emphasis"><em>EStructuralFeatures</em></span> besides 
								<span class="emphasis"><em>strVal</em></span> and 
								<span class="emphasis"><em>intVal</em></span>, only 
								<span class="emphasis"><em>strVal</em></span> and 
								<span class="emphasis"><em>intVal</em></span> may have 
								<a class="link" href="#transientvalues" title="Transient Values">non-transient values</a>.
							</p>
</li>
<li class="listitem">
<p>Quantities: The following condition must be true: 
								<span class="emphasis"><em>strVal.size() == intVal.size()</em></span>.
							</p>
</li>
<li class="listitem">
<p>Values: It must be possible to 
								<a class="link" href="#valueconverter" title="Value Converter">convert all values</a> to valid tokens for terminal rule 
								<span class="emphasis"><em>STRING</em></span>.  The same is true for 
								<span class="emphasis"><em>intVal</em></span> and 
								<span class="emphasis"><em>INT</em></span>.
							</p>
</li>
</ol>
</div>
<p>The typical use cases for the concrete syntax validator are validation in non-Xtext-editors that, however, use an 
						<span class="emphasis"><em>XtextResource</em></span>. This is, for example, the case when combining GMF and Xtext. Another use case is when the semantic model is modified &bdquo;manually&rdquo; (not by the parser) and then serialized again. Since it is very difficult for the serializer to provide 
						<a class="link" href="#parsetreeconstructor" title="Parse Tree Constructor">meaningful error messages</a>, the concrete syntax validator is executed by default before serialization. A textual Xtext editor itself, however, is 
						<span class="emphasis"><em>not</em></span> a valid use case. Here, the parser ensures that all syntactical constraints are met. Therefore, there is no value in additionally running the concrete syntax validator.  
					</p>
<p>There are some limitations to the concrete syntax validator which result from the fact that it treats the grammar as declarative, which is something the parser doesn&rsquo;t always do.</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>Grammar rules containing assigned actions (e.g. 
								<span class="emphasis"><em>{MyType.myFeature=current}</em></span> are ignored. Unassigned actions (e.g. 
								<span class="emphasis"><em>{MyType}</em></span>), however, are supported. 
							</p>
</li>
<li class="listitem">
<p>Grammar rules that delegate to one or more rules containing assigned actions via unassigned rule calls are ignored.</p>
</li>
<li class="listitem">
<p>Orders within list-features can not be validated. e.g. 
								<span class="emphasis"><em>Rule: (foo+=R1 foo+=R2)*</em></span> implies that 
								<span class="emphasis"><em>foo</em></span> is expected to contain instances of 
								<span class="emphasis"><em>R1</em></span> and 
								<span class="emphasis"><em>R2</em></span> in an alternating order. 
							</p>
</li>
</ul>
</div>
<p>To use concrete syntax validation you can let Guice inject an instance of 

						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/validation/IConcreteSyntaxValidator.java?root=Modeling_Project&view=co" target="_new">IConcreteSyntaxValidator</a> and use it directly. 
						Furthermore, there is an adapter (
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/validation/impl/ConcreteSyntaxEValidator.java?root=Modeling_Project&view=co" target="_new">ConcreteSyntaxEValidator</a>) 
						allows integrating of the concrete syntax validator as an 
						<span class="emphasis"><em>EValidator</em></span>. You can, for example, enable it in 
						your runtime module, by adding:
					</p>
<div class="literallayout">
<p>
<code class="code">@SingletonBinding(eager&nbsp;=&nbsp;true)<br>
public&nbsp;Class&lt;?&nbsp;extends&nbsp;ConcreteSyntaxEValidator&gt;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bindConcreteSyntaxEValidator()&nbsp;{<br>
&nbsp;&nbsp;return&nbsp;ConcreteSyntaxEValidator.class;<br>
}<br>

</code>
</p>
</div>
<p>To customize error messages please see 

						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/validation/IConcreteSyntaxDiagnosticProvider.java?root=Modeling_Project&view=co" target="_new">IConcreteSyntaxDiagnosticProvider</a> and subclass 

						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/validation/impl/ConcreteSyntaxDiagnosticProvider.java?root=Modeling_Project&view=co" target="_new">ConcreteSyntaxDiagnosticProvider</a>.
					</p>
</div>
</div>
<div class="section" title="Custom Validation">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="custom_validation"></a>Custom Validation</h3>
</div>
</div>
</div>
<p>In addition to the afore mentioned kinds of validation, which are more or less done automatically, you can specify additional constraints specific for your Ecore model.
					We leverage existing EMF API (mainly 
					<span class="emphasis"><em>EValidator</em></span>) and have put some convenience stuff on top. 
					Basically all you need to do is to make sure that an 
					<span class="emphasis"><em>EValidator</em></span> is registered for your 
					<span class="emphasis"><em>EPackage</em></span>. The registry for 
					<span class="emphasis"><em>EValidators</em></span> (
					<span class="emphasis"><em>EValidator.Registry.INSTANCE</em></span>) can only be filled programmatically.
					That means contrary to the EPackage and 
					<span class="emphasis"><em>Resource.Factory</em></span> registries there is no Equinox extension point to populate the validator registry.
				</p>
<p>For Xtext we provide a 
					<a class="link" href="#generator_fragment" title="Generator Fragments">generator fragment</a> for the convenient Java-based 
					<span class="emphasis"><em>EValidator</em></span> API. Just add the following fragment to your generator configuration and you are good to go:
				</p>
<div class="literallayout">
<p>
<code class="code">fragment&nbsp;=&nbsp;org.eclipse.xtext.generator.validation.JavaValidatorFragment&nbsp;{}<br>

<br>

</code>
</p>
</div>
<p>The generator will provide you with two Java classes. An abstract class generated to 
					<span class="emphasis"><em>src-gen/</em></span> which extends the library class 
					<span class="emphasis"><em>AbstractDeclarativeValidator</em></span>. This one just registers the EPackages for which this validator introduces constraints.
					The other class is a subclass of that abstract class and is generated to the 
					<span class="emphasis"><em>src/</em></span> folder in order to be edited by you. That&rsquo;s where you put the constraints in.
				</p>
<p>The purpose of the 
					<span class="emphasis"><em>AbstractDeclarativeValidator</em></span> is to allow you to write constraints in a declarative way &ndash; as the class name already suggests. That is instead of writing exhaustive if-else constructs or extending the generated EMF switch you just have to add the 
					<span class="emphasis"><em>@Check</em></span> annotation to any method and it will be invoked automatically when validation takes place.
					Moreover you can state for what type the respective constraint method is, just by declaring a typed parameter. This also lets you avoid any type casts.  
					In addition to the reflective invocation of validation methods the 
					<span class="emphasis"><em>AbstractDeclarativeValidator</em></span> provides a couple of convenient assertions.
				</p>
<p>All in all this is very similar to how JUnit works. Here is an example:</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;DomainmodelJavaValidator&nbsp;<br>
&nbsp;&nbsp;extends&nbsp;AbstractDomainmodelJavaValidator&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;@Check<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;checkTypeNameStartsWithCapital(Type&nbsp;type)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!Character.isUpperCase(type.getName().charAt(0)))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;warning("Name&nbsp;should&nbsp;start&nbsp;with&nbsp;a&nbsp;capital",&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DomainmodelPackage.TYPE__NAME);<br>
&nbsp;&nbsp;}<br>
}<br>

<br>

</code>
</p>
</div>
<p>You can also implement quick fixes for individual validation errors and warnings. See the 
					<a class="link" href="#quickfixes" title="Quick Fixes">chapter on quick fixes</a> for details.
				</p>
</div>
<div class="section" title="Validation with the Check Language">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="check_based_validation"></a>Validation with the Check Language</h3>
</div>
</div>
</div>
<p>In addition to the Java-based validation code you can use the language Check (from M2T/Xpand) to implement constraint checks against your model. To do so, you have to configure the 
					<a class="link" href="#generator" title="The Generator">generator</a> with the

					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/validation/CheckFragment.java?root=Modeling_Project&view=co" target="_new">CheckFragment</a>.
					Please note, that you can combine both types of validation in your project. 
				</p>
<div class="literallayout">
<p>
<code class="code">fragment&nbsp;=&nbsp;org.eclipse.xtext.generator.validation.CheckFragment&nbsp;{}<br>
&nbsp;&nbsp;<br>

</code>
</p>
</div>
<p>After regenerating your language artifacts you will find three new files &bdquo;YourLanguageChecks.chk&rdquo;, &bdquo;YourLanguageFastChecks.chk&rdquo; and &bdquo;YourLanguageExpensiveChecks.chk&rdquo; in the 
					<span class="emphasis"><em>src/</em></span> folder in the sub-package 
					<span class="emphasis"><em>validation</em></span>.  The checks in these files will be executed when saving a file, while typing (FastChecks) or when triggering the validation explicitly (ExpensiveChecks). When using Check the example of the previous chapter could be written like this.
				</p>
<div class="literallayout">
<p>
<code class="code">context&nbsp;Type#name&nbsp;WARNING&nbsp;"Name&nbsp;should&nbsp;start&nbsp;with&nbsp;a&nbsp;capital":<br>
&nbsp;&nbsp;name.toFirstUpper()&nbsp;==&nbsp;name;&nbsp;&nbsp;<br>

<br>

</code>
</p>
</div>
<p>Each check works in a specific context (here: 
					<span class="emphasis"><em>Type</em></span>) and can further denote a feature to which a warning or error should be attached to (here: 
					<span class="emphasis"><em>name</em></span>). Each check could either be a 
					<span class="emphasis"><em>WARNING</em></span> or an 
					<span class="emphasis"><em>ERROR</em></span> with a given string to explain the situation. The essential part of each check is an invariant that must hold true for the given context. If it fails the check will produce an issue with the provided explanation.
				</p>Please read more about the Check language as well as the underlying expression language in Xpand&rsquo;s reference documentation which is shipped as Eclipse help. 
			</div>
<div class="section" title="Validating Manually">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="ValidatingManually"></a>Validating Manually</h3>
</div>
</div>
</div>
<p>As noted above, Xtext uses EMF&rsquo;s 
					<span class="emphasis"><em>EValidator</em></span> API to register Java or Check validators. You can run the validators on your model programmatically using EMF&rsquo;s 
					<span class="emphasis"><em>Diagnostician</em></span>, e.g.
				</p>
<div class="literallayout">
<p>
<code class="code">EObject&nbsp;myModel&nbsp;=&nbsp;myResource.getContents().get(0);<br>
Diagnostic&nbsp;diagnostic&nbsp;=&nbsp;Diagnostician.INSTANCE.validate(myModel);<br>
switch&nbsp;(diagnostic.getSeverity())&nbsp;{<br>
&nbsp;&nbsp;case&nbsp;Diagnostic.ERROR:<br>
&nbsp;&nbsp;&nbsp;&nbsp;System.err.println("Model&nbsp;has&nbsp;errors:&nbsp;",diagnostic);<br>
&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
&nbsp;&nbsp;case&nbsp;Diagnostic.WARNING:<br>
&nbsp;&nbsp;&nbsp;&nbsp;System.err.println("Model&nbsp;has&nbsp;warnings:&nbsp;",diagnostic);<br>
}<br>

<br>

</code>
</p>
</div>
</div>
<div class="section" title="Test Validators">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="test_validators"></a>Test Validators</h3>
</div>
</div>
</div>
<p>If you have implemented your validators by extending 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/validation/AbstractDeclarativeValidator.java?root=Modeling_Project&view=co" target="_new">AbstractDeclarativeValidator</a>, there are helper classes which may assist you when testing your validators.
				</p>
<p>Testing validators typically works as follows: </p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>The test creates some models which intentionally violate some constraints.</p>
</li>
<li class="listitem">
<p>The test runs some choosen @Check-methods from the validator.</p>
</li>
<li class="listitem">
<p>The test asserts whether the @Check-methods have raised the expected warnings and errors.</p>
</li>
</ol>
</div>
<p>To create models, you can either use EMF&rsquo;s 
					<span class="emphasis"><em>ResourceSet</em></span> to load models from your hard disk or you can utilize the 
					<span class="emphasis"><em>Factory</em></span> (which EMF generates for each 
					<span class="emphasis"><em>EPackage</em></span>) to construct the needed model elements manually. While the fist option has the advantages that you can edit your models in your textual concrete syntax, the second option has the advantage that you can create partial models.
				</p>
<p>To run the @Check-methods and ensure they raise the intended errors and warnings, you can utilize 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/junit/validation/ValidatorTester.java?root=Modeling_Project&view=co" target="_new">ValidatorTester</a> as shown by the following example:
				</p>
<p>Validator:</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;MyLanguageValidator&nbsp;extends&nbsp;AbstractDeclarativeValidator&nbsp;{<br>
&nbsp;&nbsp;@Check<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;checkFooElement(FooElement&nbsp;element)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;if(element.getBarAttribute().contains("foo"))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error("Only&nbsp;Foos&nbsp;allowed",&nbsp;element,&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MyLanguagePackage.FOO_ELEMENT__BAR_ATTRIBUTE,&nbsp;101);<br>
&nbsp;&nbsp;}<br>
}<br>

<br>

</code>
</p>
</div>
<p>JUnit-Test:</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;MyLanguageValidatorTest&nbsp;extends&nbsp;AbstractXtextTests&nbsp;{<br>

<br>
&nbsp;&nbsp;private&nbsp;ValidatorTester&lt;MyLanguageValidator&gt;&nbsp;tester;<br>

<br>
&nbsp;&nbsp;@Override<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;setUp()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;with(MyLanguageStandaloneSetup.class);<br>
&nbsp;&nbsp;&nbsp;&nbsp;MyLanguageValidator&nbsp;validator&nbsp;=&nbsp;get(MyLanguageValidator.class);<br>
&nbsp;&nbsp;&nbsp;&nbsp;tester&nbsp;=&nbsp;new&nbsp;ValidatorTester&lt;TestingValidator&gt;(validator);<br>
&nbsp;&nbsp;}<br>

<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;testError()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;FooElement&nbsp;model&nbsp;=&nbsp;MyLanguageFactory.eINSTANCE.createFooElement()<br>
&nbsp;&nbsp;&nbsp;&nbsp;model.setBarAttribute("barbarbarbarfoo");<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;tester.validator().checkFooElement(model);<br>
&nbsp;&nbsp;&nbsp;&nbsp;tester.diagnose().assertError(101);<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;testError2()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;FooElement&nbsp;model&nbsp;=&nbsp;MyLanguageFactory.eINSTANCE.createFooElement()<br>
&nbsp;&nbsp;&nbsp;&nbsp;model.setBarAttribute("barbarbarbarfoo");<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;tester.validate(model).assertError(101);<br>
&nbsp;&nbsp;}<br>
}<br>

<br>

</code>
</p>
</div>
<p>This example uses JUnit 3, but since the involved classes from Xtext have no dependency on JUnit 
					whatsoever, JUnit 4 and other testing frameworks will work as well.  JUnit runs the 
					<span class="emphasis"><em>setUp()</em></span>-method 
					before each testcase and thereby helps to create some common state. In this example, the validator 
					(
					<span class="emphasis"><em>MyLanguageValidator</em></span>) is instantiated by means of Google Guice. As we inherit from the 
					<span class="emphasis"><em>AbstractXtextTests</em></span>
					there are a plenty of useful methods available and the state of the global EMF singletons will be restored in the

					<span class="emphasis"><em>tearDown()</em></span>. 
					Afterwards, the 
					<span class="emphasis"><em>ValidatorTester</em></span> is created and parameterized with the actual validator. It acts as 
					a wrapper for the validator, ensures that the validator has a valid state and provides convenient 
					access to the validator itself (
					<span class="emphasis"><em>tester.validator()</em></span>) as well as to the utility classes which 
					assert diagnostics created by the validator (
					<span class="emphasis"><em>tester.diagnose()</em></span>). Please be aware that you have to 
					call 
					<span class="emphasis"><em>validator()</em></span> before you can call 
					<span class="emphasis"><em>diagnose()</em></span>. However, you can call 
					<span class="emphasis"><em>validator()</em></span> multiple 
					times in a row.
				</p>
<p>While 
					<span class="emphasis"><em>validator()</em></span> allows to call the validator&rsquo;s @Check-methods directly, 
					<span class="emphasis"><em>validate(model)</em></span> leaves it 
					to the framework to call the applicable @Check-methods. However, to avoid side-effects between tests, 
					it is recommended to call the @Check-methods directly.
				</p>
<p>
					
<span class="emphasis"><em>diagnose()</em></span> and 
					<span class="emphasis"><em>validate(model)</em></span> return an object of type 

					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.junit/src/org/eclipse/xtext/junit/validation/AssertableDiagnostics.java?root=Modeling_Project&view=co" target="_new">AssertableDiagnostics</a> which provides 
					several 
					<span class="emphasis"><em>assert</em></span>-methods to verify whether the expected diagnostics are present:
				</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>
							
<span class="emphasis"><em>assertError(int code)</em></span>: There must be one diagnostic with severity ERROR and the supplied error code.
						</p>
</li>
<li class="listitem">
<p>
							
<span class="emphasis"><em>assertErrorContains(String messageFragment)</em></span>:  There must be one diagnostic with severity ERROR and its message must contain 
							<span class="emphasis"><em>messageFragment</em></span>.
						</p>
</li>
<li class="listitem">
<p>
							
<span class="emphasis"><em>assertError(int code, String messageFragment)</em></span>: Verifies severity, error code and messageFragment.
						</p>
</li>
<li class="listitem">
<p>
							
<span class="emphasis"><em>assertWarning(...)</em></span>: This method is available for the same combination of parameters as 
							<span class="emphasis"><em>assertError()</em></span>.
						</p>
</li>
<li class="listitem">
<p>
							
<span class="emphasis"><em>assertOK()</em></span>: Expects that no diagnostics (errors, warnings etc.) have been raised.   
						</p>
</li>
<li class="listitem">
<p>
							
<span class="emphasis"><em>assertDiagnostics(int severity, int code, String messageFragment)</em></span>: Verifies severity, error code and messageFragment.
						</p>
</li>
<li class="listitem">
<p>
							
<span class="emphasis"><em>assertAll(DiagnosticPredicate... predicates)</em></span>: Allows to describe multiple diagnostics at the same time and verifies that all of them are present. Class 
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/junit/validation/AssertableDiagnostics.java?root=Modeling_Project&view=co" target="_new">AssertableDiagnostics</a> contains static 
							<span class="emphasis"><em>error()</em></span> and 
							<span class="emphasis"><em>warning()</em></span>-methods which help to create the needed 
							<span class="emphasis"><em>DiagnosticPredicate</em></span>. Example: 
							<span class="emphasis"><em>assertAll(error(123), warning(&bdquo;some part of the message&rdquo;))</em></span>. 
						</p>
</li>
<li class="listitem">
<p>
							
<span class="emphasis"><em>assertAny(DiagnosticPredicate predicate)</em></span>: Asserts that a diagnostic exists which matches the predicate. 
						</p>
</li>
</ul>
</div>
</div>
</div>
<div class="section" title="Linking">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="linking"></a>Linking</h2>
</div>
</div>
</div>
<p>The linking feature allows for specification of cross-references within an Xtext grammar.
				The following things are needed for the linking:</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>declaration of a crosslink in the grammar (at least in the Ecore model)</p>
</li>
<li class="listitem">
<p>specification of linking semantics (usually provided via the 
						<a class="link" href="#scoping" title="Scoping">scoping API</a>)
					</p>
</li>
</ol>
</div>
<div class="section" title="Declaration of Crosslinks">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="DeclarationofCrosslinks"></a>Declaration of Crosslinks</h3>
</div>
</div>
</div>
<p>In the grammar a cross-reference is specified using square brackets.</p>
<div class="literallayout">
<p>
<code class="code">CrossReference&nbsp;:<br>
&nbsp;&nbsp;'['&nbsp;type=ReferencedEClass&nbsp;('|'&nbsp;terminal=CrossReferenceableTerminal)?&nbsp;']'<br>
;<br>

<br>

</code>
</p>
</div>
<p>Example:</p>
<div class="literallayout">
<p>
<code class="code">ReferringType&nbsp;:<br>
&nbsp;&nbsp;'ref'&nbsp;referencedObject=[Entity|STRING]<br>
;<br>

<br>

</code>
</p>
</div>
<p>The 
					<a class="link" href="#metamodelInference" title="Ecore Model Inference">Ecore model inference</a> would create an 
					<span class="emphasis"><em>EClass</em></span> 
					<span class="emphasis"><em>ReferringType</em></span> with an 

					<span class="emphasis"><em>EReference</em></span> 
					<span class="emphasis"><em>referencedObject</em></span> of type 
					<span class="emphasis"><em>Entity</em></span> (
					<span class="emphasis"><em>containment=false</em></span>). The referenced object would 
					be identified either by a 
					<span class="emphasis"><em>STRING</em></span> and the surrounding information in the current context 
					(see 
					<a class="link" href="#scoping" title="Scoping">scoping</a>). If you do not use 
					<span class="emphasis"><em>generate</em></span> but 
					<span class="emphasis"><em>import</em></span> an existing Ecore model, 
					the class 
					<span class="emphasis"><em>ReferringType</em></span> (or one of its super types) would need to have an 
					<span class="emphasis"><em>EReference</em></span> of type 

					<span class="emphasis"><em>Entity</em></span> (or one of its super types) declared. Also the 
					<span class="emphasis"><em>EReference</em></span>'s containment and container 
					properties needs to be set to 
					<span class="emphasis"><em>false</em></span>. 
				</p>
</div>
<div class="section" title="Default Runtime Behavior (Lazy Linking)">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="DefaultRuntimeBehaviorLazyLinking"></a>Default Runtime Behavior (Lazy Linking)</h3>
</div>
</div>
</div>
<p>Xtext uses lazy linking by default and we encourage users to stick to this because it provides  
					many advantages. One of which is improved performance in all scenarios where you don&rsquo;t have to load 
					the whole closure of all transitively referenced resources. Furthermore it automatically solves 
					situations where one link relies on other links. Though cyclic linking dependencies are not 
					supported by Xtext at all. </p>
<p>When parsing a given input string, say</p>
<div class="literallayout">
<p>
<code class="code">ref&nbsp;Entity01<br>

</code>
</p>
</div>
<p>the 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/linking/lazy/LazyLinker.java?root=Modeling_Project&view=co" target="_new">LazyLinker</a> first creates an EMF proxy and 
					assigns it to the corresponding 
					<span class="emphasis"><em>EReference</em></span>. In EMF a proxy is described by a URI, which points to the 
					real 
					<span class="emphasis"><em>EObject</em></span>. In the case of lazy linking the stored URI comprises of the context information given 
					at parse time, which is the 
					<span class="emphasis"><em>EObject</em></span> containing the cross-reference, the actual 
					<span class="emphasis"><em>EReference</em></span>, the 
					index (in case it&rsquo;s a multi-valued cross-reference) and the string which represented the crosslink 
					in the concrete syntax. The latter usually corresponds to the name of the referenced 
					<span class="emphasis"><em>EObject</em></span>. 
					In EMF a URI consists of information about the resource the 
					<span class="emphasis"><em>EObject</em></span> is contained in as well as a so 
					called fragment part, which is used to find the 
					<span class="emphasis"><em>EObject</em></span> within that resource. When an  EMF proxy 
					is resolved, the current 
					<span class="emphasis"><em>ResourceSet</em></span> is asked. The resource set uses the first part to obtain 
					(i.e. load if it is not already loaded) the resource. Then the resource is asked to return the 

					<span class="emphasis"><em>EObject</em></span> based on the fragment in the URI. The actual cross-reference resolution is done by 

					<span class="emphasis"><em>LazyLinkingResource.getEObject(String)</em></span> which receives the fragment and delegates to the implementation 
					of the 
					<span class="emphasis"><em>ILinkingService</em></span>. The default implementation in turn delegates to the 
					<a class="link" href="#scoping" title="Scoping">scoping API</a>.
				</p>
<p>A simple implementation of the linking service (the 

					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/linking/impl/DefaultLinkingService.java?root=Modeling_Project&view=co" target="_new">DefaultLinkingService</a>) is shipped with Xtext 
					and used for any grammar per default. Usually any necessary customization of the linking behavior 
					can best be described using the 
					<a class="link" href="#scoping" title="Scoping">scoping API</a>.
				</p>
</div>
</div>
<div class="section" title="Scoping">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="scoping"></a>Scoping</h2>
</div>
</div>
</div>
<p>Using the scoping API one defines which elements are referable by a certain reference. For instance, 
				using the introductory example (fowler&rsquo;s state machine language)
				a transition contains two cross-references: One to a declared event and one to a declared state.</p>
<p>Example:</p>
<div class="literallayout">
<p>
<code class="code">events<br>
&nbsp;&nbsp;nothingImportant&nbsp;&nbsp;MYEV<br>
end<br>
&nbsp;<br>
state&nbsp;idle<br>
&nbsp;&nbsp;nothingImportant&nbsp;=&gt;&nbsp;idle<br>
end<br>
&nbsp;&nbsp;<br>

</code>
</p>
</div>
<p>The grammar rule for transitions looks like this:</p>
<div class="literallayout">
<p>
<code class="code">Transition&nbsp;:<br>
&nbsp;&nbsp;event=[Event]&nbsp;'=&gt;'&nbsp;state=[State];<br>

<br>

</code>
</p>
</div>
<p>The grammar states that for the reference 
				<span class="emphasis"><em>event</em></span> only instances of the type 
				<span class="emphasis"><em>Event</em></span> are allowed and 
				that for the EReference 
				<span class="emphasis"><em>state</em></span> only instances of type 
				<span class="emphasis"><em>State</em></span> can be referenced. However, this simple 
				declaration doesn&rsquo;t say anything about where to find the states or events. That is the duty of scopes.  
			</p>
<p>An 
				<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/scoping/IScopeProvider.java?root=Modeling_Project&view=co" target="_new">IScopeProvider</a> is responsible for providing 
				an 
				<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/scoping/IScope.java?root=Modeling_Project&view=co" target="_new">IScope</a> for a given context 
				<span class="emphasis"><em>EObject</em></span> and 

				<span class="emphasis"><em>EReference</em></span>. The returned 
				<span class="emphasis"><em>IScope</em></span> should contain all target candidates for the given object and cross-reference.
			</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;interface&nbsp;IScopeProvider&nbsp;{<br>

<br>
	/**<br>
	&nbsp;*&nbsp;Returns&nbsp;a&nbsp;scope&nbsp;for&nbsp;the&nbsp;given&nbsp;context.&nbsp;The&nbsp;scope&nbsp;<br>
	&nbsp;*&nbsp;provides&nbsp;access&nbsp;to&nbsp;the&nbsp;compatible&nbsp;visible&nbsp;EObjects&nbsp;<br>
	&nbsp;*&nbsp;for&nbsp;a&nbsp;given&nbsp;reference.<br>
	&nbsp;*<br>
	&nbsp;*&nbsp;@param&nbsp;context&nbsp;the&nbsp;element&nbsp;from&nbsp;which&nbsp;an&nbsp;element&nbsp;shall&nbsp;be&nbsp;referenced<br>
	&nbsp;*&nbsp;@param&nbsp;reference&nbsp;the&nbsp;reference&nbsp;to&nbsp;be&nbsp;used&nbsp;to&nbsp;filter&nbsp;the&nbsp;elements.<br>
	&nbsp;*&nbsp;@return&nbsp;{@link&nbsp;IScope}&nbsp;representing&nbsp;the&nbsp;inner&nbsp;most&nbsp;{@link&nbsp;IScope}&nbsp;for&nbsp;<br>
	&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;passed&nbsp;context&nbsp;and&nbsp;reference.&nbsp;Note&nbsp;for&nbsp;implementors:&nbsp;The&nbsp;<br>
	&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;may&nbsp;not&nbsp;be&nbsp;&lt;code&gt;null&lt;/code&gt;.&nbsp;Return&nbsp;<br>
	&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;code&gt;IScope.NULLSCOPE&lt;/code&gt;&nbsp;instead.<br>
	&nbsp;*/<br>
	IScope&nbsp;getScope(EObject&nbsp;context,&nbsp;EReference&nbsp;reference);<br>

<br>
}<br>

<br>

</code>
</p>
</div>
<p>A single 
				<span class="emphasis"><em>IScope</em></span> represents an element of a linked list of scopes. That means that a scope can be 
				nested within an outer scope. Each scope works like a symbol table or a map where the keys are strings 
				and the values are so called 
				<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/resource/IEObjectDescription.java?root=Modeling_Project&view=co" target="_new">IEObjectDescription</a>, 
				which is effectively an abstract description of a real 
				<span class="emphasis"><em>EObject</em></span>. 
			</p>
<div class="section" title="Global Scopes and IResourceDescriptions">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="global_scopes"></a>Global Scopes and 
					<span class="emphasis"><em>IResourceDescriptions</em></span>
				
</h3>
</div>
</div>
</div>
<p>In the state machine example we don&rsquo;t have references across model files. Also there is no concept like 
					a namespace which would make scoping a bit more complicated. Basically, every 
					<span class="emphasis"><em>State</em></span> and every 
					<span class="emphasis"><em>Event</em></span> 
					declared in the same resource is visible by their name. However in the real world things are most likely 
					not that simple: What if you want to reuse certain declared states and events across different 
					state machines and you want to share those as library between different users? You would want to introduce 
					some kind of cross resource reference. 
				</p>
<p>Defining what is visible from outside the current resource is the responsibility of global scopes. 
					As the name suggests, global scopes are provided by instances of the 

					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/scoping/IGlobalScopeProvider.java?root=Modeling_Project&view=co" target="_new">IGlobalScopeProvider</a>. The data structures used to 
					store its elements are described in the next section.
				</p>
<div class="section" title="Resource and EObject Descriptions ( IResourceDescription, IEObjectDescription)">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="resourcedescriptions"></a>
						<span class="emphasis"><em>Resource</em></span> and 
						<span class="emphasis"><em>EObject</em></span> Descriptions (
						<span class="emphasis"><em>IResourceDescription</em></span>, 
						<span class="emphasis"><em>IEObjectDescription</em></span>)
					</h4>
</div>
</div>
</div>
<p>In order to make states and events of one file referable from another file you need to export them as 
						part of a so called 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/resource/IResourceDescription.java?root=Modeling_Project&view=co" target="_new">IResourceDescription</a>. 
					</p>
<p>A 
						<span class="emphasis"><em>IResourceDescription</em></span> contains information about the resource itself (primarily its 
						<span class="emphasis"><em>URI</em></span>), a list 
						of exported 
						<span class="emphasis"><em>EObjects</em></span> (in the form of 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/resource/IEObjectDescription.java?root=Modeling_Project&view=co" target="_new">IEObjectDescription</a>) 
						as well as information about outgoing cross-references and qualified names it references. The cross 
						references contain only resolved references, while the list of imported qualified names also contain 
						those names, which couldn&rsquo;t be resolved. This information is important in order to compute the transitive 
						hull of dependent resources, which the shipped index infrastructure automatically does for you.
					</p>
<p>For users and especially in the context of scoping the most important information is the list of 
						exported 
						<span class="emphasis"><em>EObjects</em></span>. An 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/resource/IEObjectDescription.java?root=Modeling_Project&view=co" target="_new">IEObjectDescription</a> 
						contains information about the 
						<span class="emphasis"><em>URI</em></span> to the actual 
						<span class="emphasis"><em>EObject</em></span> and the qualified name of that element 
						as well as the corresponding 
						<span class="emphasis"><em>EClass</em></span>. In addition one can export arbitrary information using the 

						<span class="emphasis"><em>user data</em></span> map. The following diagram gives an overview on the description classes and their relationships.
					</p>
<p>
						
</p>
<div class="mediaobject">
<img src="images/index_datamodel.png"></div>
<p>
					
</p>
<p>A language is configured with a default implementation of 
						<span class="emphasis"><em>IResourceDescription.Manager</em></span> which computes 
						the list of exported 
						<span class="emphasis"><em>IEObjectDescriptions</em></span> by iterating the whole EMF model and applying the 

						<span class="emphasis"><em>getQualifiedName(EObject obj)</em></span> from 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/naming/IQualifiedNameProvider.java?root=Modeling_Project&view=co" target="_new">IQualifiedNameProvider</a> 
						on each 
						<span class="emphasis"><em>EObject</em></span>. If the object has a qualified name an 
						<span class="emphasis"><em>IEObjectDescription</em></span> is created and exported 
						(i.e. added to the list). If an 
						<span class="emphasis"><em>EObject</em></span> doesn&rsquo;t have a qualified name, the element is considered to 
						be not referable from outside the resource and consequently not indexed. If you don&rsquo;t like this behavior, 
						you can implement and bind your own implementation of 
						<span class="emphasis"><em>IResourceDescription.Manager</em></span>.  
					</p>
<p>There are also two different default implementations of 
						<span class="emphasis"><em>IQualifiedNameProvider</em></span>. Both work by looking 
						up an 
						<span class="emphasis"><em>EAttribute</em></span> &sbquo;name&rsquo;. The 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/naming/SimpleNameProvider.java?root=Modeling_Project&view=co" target="_new">SimpleNameProvider</a> 
						simply returns the plain value, while the 

						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/naming/DefaultDeclarativeQualifiedNameProvider.java?root=Modeling_Project&view=co" target="_new">DefaultDeclarativeQualifiedNameProvider</a> concatenates 
						the simple name with the qualified name of its parent exported 
						<span class="emphasis"><em>EObject</em></span>. This effectively simulates 
						the qualified name computation of most namespace-based languages (like e.g. Java). 
					</p>
<p>As mentioned above, in order to calculate an 
						<span class="emphasis"><em>IResourceDescription</em></span> for a resource the framework asks 
						the 
						<span class="emphasis"><em>IResourceDescription.Manager</em></span>. Here&rsquo;s some Java code showing how to do that:
					</p>
<div class="literallayout">
<p>
<code class="code">Manager&nbsp;manager&nbsp;=&nbsp;//&nbsp;obtain&nbsp;an&nbsp;instance&nbsp;of&nbsp;IResourceDescription.Manager<br>
IResourceDescription&nbsp;description&nbsp;=&nbsp;manager.getResourceDescription(resource);<br>
for&nbsp;(IEObjectDescription&nbsp;objDescription&nbsp;:&nbsp;description.getExportedObjects())&nbsp;{<br>
&nbsp;&nbsp;System.out.println(objDescription.getQualifiedName());<br>
}&nbsp;<br>
&nbsp;&nbsp;<br>

</code>
</p>
</div>
<p>In order to obtain an 
						<span class="emphasis"><em>IResourceDescription.Manager</em></span> it is best to ask the corresponding 

						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/resource/IResourceServiceProvider.java?root=Modeling_Project&view=co" target="_new">IResourceServiceProvider</a>. That is because each 
						language might have a totally different implementation and as you might refer from your language to a 
						different language you can&rsquo;t reuse your language&rsquo;s 
						<span class="emphasis"><em>IResourceDescription.Manager</em></span>. One basically asks 
						the 
						<span class="emphasis"><em>IResourceServiceProvider.Registry</em></span> (there is usually one global instance) for an 

						<span class="emphasis"><em>IResourceServiceProvider</em></span>, which in turn provides an 
						<span class="emphasis"><em>IResourceDescription.Manager</em></span> along other 
						useful services.
					</p>
<p>If you&rsquo;re running in a Guice enabled scenario, the code looks like this:</p>
<div class="literallayout">
<p>
<code class="code">@Inject&nbsp;<br>
private&nbsp;IResourceServiceProvider.Registry&nbsp;resourceServiceProviderRegistry;<br>
	
<br>
private&nbsp;IResourceDescription.Manager&nbsp;getManager(Resource&nbsp;res)&nbsp;{<br>
&nbsp;&nbsp;IResourceServiceProvider&nbsp;resourceServiceProvider&nbsp;=&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;resourceServiceProviderRegistry.getResourceServiceProvider(res.getURI());<br>
&nbsp;&nbsp;return&nbsp;resourceServiceProvider.getResourceDescriptionManager();<br>
}<br>

<br>

</code>
</p>
</div>
<p>If you don&rsquo;t run in a Guice enabled context you will likely have to directly access the singleton:</p>
<div class="literallayout">
<p>
<code class="code">private&nbsp;IResourceServiceProvider.Registry&nbsp;resourceServiceProviderRegistry&nbsp;=&nbsp;<br>
&nbsp;&nbsp;IResourceServiceProvider.Registry.INSTANCE;<br>

<br>

</code>
</p>
</div>
<p>However, we strongly encourage you to use dependency injection.
						Now, that we know how to export elements to be referenceable from other resources, we need to learn 
						how those exported 
						<span class="emphasis"><em>IEObjectDescriptions</em></span> can be made available to the referencing resources. That is 
						the responsibility of global scoping (i.e. 

						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/scoping/IGlobalScopeProvider.java?root=Modeling_Project&view=co" target="_new">IGlobalScopeProvider</a>) which is described in the 
						following chapter.
					</p>
</div>
<div class="section" title="Global Scopes Based On Explicit Imports (ImportURI Mechanism)">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="import_uri"></a>Global Scopes Based On Explicit Imports (ImportURI Mechanism)</h4>
</div>
</div>
</div>
<p>A simple and straight forward solution is to have explicit references to other resources in your 
						file by explicitly listing pathes (or 
						<span class="emphasis"><em>URIs</em></span>) to all referenced resources in your model file. That is 
						for instance what most include mechanisms use. In Xtext we provide a handy implementation of an 

						<span class="emphasis"><em>IGlobalScopeProvider</em></span> which is based on a naming convention and makes this semantics very easy to use. 
						Talking of the introductory example and given you would want to add support for referencing external 

						<span class="emphasis"><em>States</em></span> and 
						<span class="emphasis"><em>Events</em></span> from within your state machine, all you had to do is add something like the 
						following to the grammar definition:
					</p>
<div class="literallayout">
<p>
<code class="code">Statemachine&nbsp;:<br>
&nbsp;&nbsp;(imports+=Import)*&nbsp;//&nbsp;allow&nbsp;imports<br>
&nbsp;&nbsp;'events'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(events+=Event)+<br>
&nbsp;&nbsp;'end'<br>
&nbsp;&nbsp;('resetEvents'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(resetEvents+=[Event])+<br>
&nbsp;&nbsp;'end')?<br>
&nbsp;&nbsp;'commands'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(commands+=Command)+<br>
&nbsp;&nbsp;'end'<br>
&nbsp;&nbsp;(states+=State)+;<br>

<br>
Import&nbsp;:&nbsp;<br>
&nbsp;&nbsp;'import'&nbsp;importURI=STRING;&nbsp;//&nbsp;feature&nbsp;must&nbsp;be&nbsp;named&nbsp;importURI<br>

<br>

</code>
</p>
</div>
<p>This effectively allows import statements to be declared before the events section. In addition 
						you&rsquo;ll have to make sure that you have bound the 

						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/scoping/impl/ImportUriGlobalScopeProvider.java?root=Modeling_Project&view=co" target="_new">ImportUriGlobalScopeProvider</a> for the type 

						<span class="emphasis"><em>IGlobalScopeProvider</em></span> by the means of 
						<a class="link" href="#dependencyInjection" title="Dependency Injection in Xtext with Google Guice">Guice</a>. That implementation looks up any 

						<span class="emphasis"><em>EAttributes</em></span> named &sbquo;importURI&rsquo; in your model and interprets their values as URIs that point to imported
						resources. That is it adds the corresponding resources to the current resource&rsquo;s resource set. In 
						addition the scope provider uses the 
						<a class="link" href="#resourcedescriptions" title="Resource and EObject Descriptions ( IResourceDescription, IEObjectDescription)">
							<span class="emphasis"><em>IResourceDescription.Manager</em></span>
						</a> of that 
						imported resource to compute all the 
						<span class="emphasis"><em>IEObjectDescriptions</em></span> returned by the 
						<span class="emphasis"><em>IScope</em></span>.  
					</p>
<p>Global scopes based on import URIs are available if you use the 

						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/scoping/ImportURIScopingFragment.java?root=Modeling_Project&view=co" target="_new">ImportURIScopingFragment</a> in the 
						workflow of your language. It will bind an 

						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/scoping/impl/ImportUriGlobalScopeProvider.java?root=Modeling_Project&view=co" target="_new">ImportUriGlobalScopeProvider</a> 
						(
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/resource/ignorecase/IgnoreCaseImportUriGlobalScopeProvider.java?root=Modeling_Project&view=co" target="_new">IgnoreCaseImportUriGlobalScopeProvider</a> 
						if the 
						<span class="emphasis"><em>caseInsensitve</em></span> flag is set) that handles 
						<span class="emphasis"><em>importURI</em></span> features.
					</p>
</div>
<div class="section" title="Global Scopes Based On External Configuration (e.g. Classpath-Based)">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="index_based"></a>Global Scopes Based On External Configuration (e.g. Classpath-Based)</h4>
</div>
</div>
</div>
<p>Instead of explicitly referring to imported resources, the other possibility is to have some kind of 
						external configuration in order to define what is visible from outside a resource. Java for instances 
						uses the notion of classpaths to define containers (jars and class folders) which contain any 
						referenceable elements. In the case of Java also the order of such entries is important. </p>
<p>Since version 1.0.0 Xtext provides support for this kind of global scoping. To enable it, a 

						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/scoping/impl/DefaultGlobalScopeProvider.java?root=Modeling_Project&view=co" target="_new">DefaultGlobalScopeProvider</a> has to be bound to 
						the 
						<span class="emphasis"><em>IGlobalScopeProvider</em></span> interface. For case insensitive names use the 

						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/resource/ignorecase/IgnoreCaseDefaultGlobalScopeProvider.java?root=Modeling_Project&view=co" target="_new">IgnoreCaseDefaultGlobalScopeProvider</a>.
					</p>
<p>By default Xtext leverages the classpath mechanism since it is well designed and already understood 
						by most of our users. The available tooling provided by JDT and PDE to configure the classpath adds 
						even more value. However, it is just a default: You can reuse the infrastructure without using Java 
						and independent from the JDT.</p>
<p>In order to know what is available in the &bdquo;world&rdquo; a global scope provider which relies on external 
						configuration needs to read that configuration in and be able to find all candidates for a certain 

						<span class="emphasis"><em>EReference</em></span>. If you don&rsquo;t want to force users to have a folder and file name structure reflecting 
						the actual qualified names of the referenceable 
						<span class="emphasis"><em>EObjects</em></span>, you&rsquo;ll have to load all resources up front 
						and either keep holding them in memory or remembering all information which is needed for the 
						resolution of cross-references. In Xtext that information is provided by a so called 

						<a class="link" href="#resourcedescriptions" title="Resource and EObject Descriptions ( IResourceDescription, IEObjectDescription)">
							<span class="emphasis"><em>IEObjectDescription</em></span>
						</a>. 
					</p>
<div class="section" title="About the Index, Containers and Their Manager">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="containers"></a>About the Index, Containers and Their Manager </h5>
</div>
</div>
</div>
<p>Xtext ships with an index which remembers all 
							<span class="emphasis"><em>IResourceDescription</em></span> and their 
							<span class="emphasis"><em>IEObjectDescription</em></span> 
							objects. In the IDE-context (i.e. when running the editor, etc.) the index is updated by an incremental 
							project builder. As opposed to that, in a non-UI context you typically do not have to deal with changes 
							such that the infrastructure can be much simpler. In both situations the global index state is held 
							by an implementation of 
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/resource/IResourceDescriptions.java?root=Modeling_Project&view=co" target="_new">IResourceDescriptions</a> 
							(Note the plural form!). The bound singleton in the UI scenario is even aware of unsaved editor changes, 
							such that all linking happens to the latest maybe unsaved version of the resources. You will find the 
							Guice configuration of the global index in the UI scenario in 

							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui.shared/src/org/eclipse/xtext/ui/shared/internal/SharedModule.java?root=Modeling_Project&view=co" target="_new">SharedModule</a>.
						</p>
<p>The index is basically a flat list of instances of 
							<span class="emphasis"><em>IResourceDescription</em></span>. The index itself doesn&rsquo;t 
							know about visibility constraints due to classpath restriction. Rather than that, they are defined by 
							the referencing language by means of so called 
							<span class="emphasis"><em>IContainers</em></span>: While Java might load a resource 
							via 
							<span class="emphasis"><em>ClassLoader.loadResource()</em></span> (i.e. using the classpath mechanism), another language could load 
							the same resource using the file system paths. 
						</p>
<p>Consequently, the information which container a resource belongs to depends on the referencing 
							context. Therefore an 
							<span class="emphasis"><em>IResourceServiceProvider</em></span> provides another interesting service, which is called

							<span class="emphasis"><em>IContainer.Manager</em></span>. For a given 
							<span class="emphasis"><em>IResourceDescription</em></span>, the 
							<span class="emphasis"><em>IContainer.Manager</em></span> provides you with 
							the 
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/resource/IContainer.java?root=Modeling_Project&view=co" target="_new">IContainer</a> as well as with a list of all 

							<span class="emphasis"><em>IContainers</em></span> which are visible from there. Note that the index (
							<span class="emphasis"><em>IResourceDesciptions</em></span>) is globally 
							shared between all languages while the 
							<span class="emphasis"><em>IContainer.Manager</em></span> that adds the semantics of containers can 
							be very different depending on the language. The following method lists all resources visible from a 
							given 
							<span class="emphasis"><em>Resource</em></span>:  
						</p>
<div class="literallayout">
<p>
<code class="code">@Inject<br>
IContainer.Manager&nbsp;manager;<br>

<br>
public&nbsp;void&nbsp;listVisibleResources(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Resource&nbsp;myResource,&nbsp;IResourceDescriptions&nbsp;index)&nbsp;{<br>
&nbsp;&nbsp;IResourceDescription&nbsp;descr&nbsp;=&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;index.getResourceDescription(myResource.getURI());<br>
&nbsp;&nbsp;for(IContainer&nbsp;visibleContainer:&nbsp;<br>
&nbsp;&nbsp;	&nbsp;&nbsp;&nbsp;&nbsp;manager.getVisibleContainers(descr,&nbsp;index))&nbsp;{&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;for(IResourceDescription&nbsp;visibleResourceDesc:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;visibleContainer.getResourceDescription())&nbsp;{&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(visibleResourceDesc.getURI());<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;}<br>
}<br>

<br>

</code>
</p>
</div>
<p>Xtext ships two implementations of 
							<span class="emphasis"><em>IContainer.Manager</em></span> which are as usual bound with Guice: The 
							default binding is to 

							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/resource/impl/SimpleResourceDescriptionsBasedContainerManager.java?root=Modeling_Project&view=co" target="_new">SimpleResourceDescriptionsBasedContainerManager</a>, 
							which assumes all 
							<span class="emphasis"><em>IResourceDescription</em></span> to be in a single common container. If you don&rsquo;t care about 
							container support, you&rsquo;ll be fine with this one. Alternatively, you can bind 

							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/resource/containers/StateBasedContainerManager.java?root=Modeling_Project&view=co" target="_new">StateBasedContainerManager</a> and an 
							additional 
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/resource/containers/IAllContainersState.java?root=Modeling_Project&view=co" target="_new">IAllContainersState</a> which 
							keeps track of the set of available containers and their visibility relationships.  
						</p>
<p>Xtext offers a couple of strategies for managing containers: If you&rsquo;re running an Eclipse workbench, 
							you can define containers based on Java projects and their classpaths or based on plain Eclipse projects. 
							Outside Eclipse, you can provide a set of file system paths to be scanned for models. All of these only 
							differ in the bound instance of 
							<span class="emphasis"><em>IAllContainerState</em></span> of the referring language. These will be described 
							in detail in the following sections.
						</p>
<p>
							
</p>
<div class="mediaobject">
<img src="images/index_container.png"></div>
<p>
						
</p>
</div>
<div class="section" title="JDT-Based Container Manager">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="jdt_based_containers"></a>JDT-Based Container Manager </h5>
</div>
</div>
</div>
<p>As JDT is an Eclipse feature, this JDT-based container management is only available in the UI scenario. 
							It assumes so called 
							<span class="emphasis"><em>IPackageFragmentRoots</em></span> as containers. An 
							<span class="emphasis"><em>IPackageFragmentRoot</em></span> in JDT is the 
							root of a tree of Java model elements. It usually refers to 
						</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>a source folder of a Java project,</p>
</li>
<li class="listitem">
<p>a referenced jar, </p>
</li>
<li class="listitem">
<p>a classpath entry of a referenced Java project, or</p>
</li>
<li class="listitem">
<p>the exported packages of a required PDE plug-in.</p>
</li>
</ul>
</div>
<p>So for an element to be referable, its resource must be on the classpath of the caller&rsquo;s Java project 
							and it must be exported (as described above). </p>
<p>As this strategy allows to reuse a lot of nice Java things like jars, OSGi, maven, etc. it is part of 
							the default: You should not have to reconfigure anything to make it work. Nevertheless, if you messed 
							something up, make sure you bind</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;Class&lt;?&nbsp;extends&nbsp;IContainer.Manager&gt;&nbsp;bindIContainer$Manager()&nbsp;{<br>
&nbsp;&nbsp;return&nbsp;StateBasedContainerManager.class;<br>
}<br>

<br>

</code>
</p>
</div>
<p>in the runtime module and </p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;Provider&lt;IAllContainersState&gt;&nbsp;provideIAllContainersState()&nbsp;{<br>
&nbsp;&nbsp;return&nbsp;org.eclipse.xtext.ui.shared.Access.getJavaProjectsState();<br>
&nbsp;&nbsp;//&nbsp;return&nbsp;org.eclipse.xtext.ui.shared.Access.getStrictJavaProjectsState();<br>
}<br>

<br>

</code>
</p>
</div>
<p>in the UI module of the referencing language. The latter looks a bit more difficult than a common 
							binding, as we have to bind a global singleton to a Guice provider. The 
							<span class="emphasis"><em>StrictJavaProjectsState</em></span> 
							requires all elements to be on the classpath, while the default 
							<span class="emphasis"><em>JavaProjectsState</em></span> also allows models 
							in non-source folders. 
						</p>
</div>
<div class="section" title="Eclipse Project-Based Containers">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="project_based_containers"></a>Eclipse Project-Based Containers</h5>
</div>
</div>
</div>
<p>If the classpath-based mechanism doesn&rsquo;t work for your case, Xtext offers an alternative container 
							manager based on plain Eclipse projects: Each project acts as a container and the project references 

							<span class="emphasis"><em>Properties-&gt;Project References</em></span> are the visible containers. 
						</p>
<p>In this case, your runtime module should define</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;Class&lt;?&nbsp;extends&nbsp;IContainer.Manager&gt;&nbsp;bindIContainer$Manager()&nbsp;{<br>
&nbsp;&nbsp;return&nbsp;StateBasedContainerManager.class;<br>
}<br>

<br>

</code>
</p>
</div>
<p>and the UI module should bind </p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;Provider&lt;IAllContainersState&gt;&nbsp;provideIAllContainersState()&nbsp;{<br>
&nbsp;&nbsp;return&nbsp;org.eclipse.xtext.ui.shared.Access.getWorkspaceProjectsState();<br>
}<br>

<br>

</code>
</p>
</div>
</div>
<div class="section" title="ResourceSet-Based Containers">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="resource_set_containers"></a>
							<span class="emphasis"><em>ResourceSet</em></span>-Based Containers
						</h5>
</div>
</div>
</div>
<p>If you need an 
							<span class="emphasis"><em>IContainer.Manager</em></span> that is independent of Eclipse projects, you can use the 

							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/resource/containers/ResourceSetBasedAllContainersState.java?root=Modeling_Project&view=co" target="_new">ResourceSetBasedAllContainersState</a>. 
							This one can be configured with a mapping of container handles to resource URIs.
						</p>
<p>It is unlikely you want to use this strategy directly in your own code, but it is used in the back-end 
							of the MWE2 workflow component 
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/mwe/Reader.java?root=Modeling_Project&view=co" target="_new">Reader</a>. This is responsible 
							for reading in models in a workflow, e.g. for later code generation. The 
							<span class="emphasis"><em>Reader</em></span> allows to either scan 
							the whole classpath or a set of paths for all models therein. When paths are given, each path entry 
							becomes an 
							<span class="emphasis"><em>IContainer</em></span> of its own. In the following snippet,
						</p>
<div class="literallayout">
<p>
<code class="code">component&nbsp;=&nbsp;org.eclipse.xtext.mwe.Reader&nbsp;{<br>
&nbsp;&nbsp;//&nbsp;lookup&nbsp;all&nbsp;resources&nbsp;on&nbsp;the&nbsp;classpath<br>
&nbsp;&nbsp;//&nbsp;useJavaClassPath&nbsp;=&nbsp;true<br>
	
<br>
&nbsp;&nbsp;//&nbsp;or&nbsp;define&nbsp;search&nbsp;scope&nbsp;explicitly<br>
&nbsp;&nbsp;path&nbsp;=&nbsp;"src/models"<br>
&nbsp;&nbsp;path&nbsp;=&nbsp;"src/further-models"<br>

<br>
&nbsp;&nbsp;...<br>
}<br>
&nbsp;<br>

</code>
</p>
</div>
</div>
</div>
</div>
<div class="section" title="Local Scoping">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="local_scoping"></a>Local Scoping</h3>
</div>
</div>
</div>
<p>We now know how the outer world of referenceable elements can be defined in Xtext. Nevertheless, not 
					everything is available in any context and with a global name. Rather than that, each context can usually 
					have a different scope. As already stated, scopes can be nested, i.e. a scope can in addition to its 
					own elements contain elements of a parent scope. When parent and child scope contain different elements 
					with the same name, the parent scope&rsquo;s element will usually be 
					<span class="emphasis"><em>shadowed</em></span> by the element from the child scope.      
				</p>
<p>To illustrate that, let&rsquo;s have a look at Java: Java defines multiple kinds of scopes 
					(object scope, type scope, etc.). For Java one would create the scope hierarchy as commented in the 
					following example:</p>
<div class="literallayout">
<p>
<code class="code">//&nbsp;file&nbsp;contents&nbsp;scope<br>
import&nbsp;static&nbsp;my.Constants.STATIC;<br>

<br>
public&nbsp;class&nbsp;ScopeExample&nbsp;{&nbsp;//&nbsp;class&nbsp;body&nbsp;scope<br>
&nbsp;&nbsp;private&nbsp;Object&nbsp;field&nbsp;=&nbsp;STATIC;<br>

<br>
&nbsp;&nbsp;private&nbsp;void&nbsp;method(String&nbsp;param)&nbsp;{&nbsp;//&nbsp;method&nbsp;body&nbsp;scope<br>
&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;localVar&nbsp;=&nbsp;"bar";<br>
&nbsp;&nbsp;&nbsp;&nbsp;innerBlock:&nbsp;{&nbsp;//&nbsp;block&nbsp;scope<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;innerScopeVar&nbsp;=&nbsp;"foo";<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Object&nbsp;field&nbsp;=&nbsp;innerScopeVar;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;the&nbsp;scope&nbsp;hierarchy&nbsp;at&nbsp;this&nbsp;point&nbsp;would&nbsp;look&nbsp;like&nbsp;this:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;blockScope{field,innerScopeVar}-&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;methodScope{localVar,&nbsp;param}-&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;classScope{field}-&gt;&nbsp;('field'&nbsp;is&nbsp;shadowed)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;fileScope{STATIC}-&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;classpathScope{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'all&nbsp;qualified&nbsp;names&nbsp;of&nbsp;accessible&nbsp;static&nbsp;fields'}&nbsp;-&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;NULLSCOPE{}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;field.add(localVar);<br>
&nbsp;&nbsp;}<br>
}<br>

<br>

</code>
</p>
</div>
<p>In fact the classpath scope should also reflect the order of classpath entries.
					For instance:</p>
<div class="literallayout">
<p>
<code class="code">classpathScope{stuff&nbsp;from&nbsp;bin/}<br>
-&gt;&nbsp;classpathScope{stuff&nbsp;from&nbsp;foo.jar/}<br>
-&gt;&nbsp;...<br>
-&gt;&nbsp;classpathScope{stuff&nbsp;from&nbsp;JRE&nbsp;System&nbsp;Library}<br>
-&gt;&nbsp;NULLSCOPE{}<br>

<br>

</code>
</p>
</div>
<p>Please find the motivation behind this and some additional details in 

					<a class="ulink" href="http://blog.efftinge.de/2009/01/xtext-scopes-and-emf-index.html" target="_new">this blog post</a> .
				</p>
<div class="section" title="Declarative Scoping">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="DeclarativeScoping"></a>Declarative Scoping</h4>
</div>
</div>
</div>
<p>If you have to define scopes for certain contexts, the base class 

						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/scoping/impl/AbstractDeclarativeScopeProvider.java?root=Modeling_Project&view=co" target="_new">AbstractDeclarativeScopeProvider</a> allows to do 
						that in a declarative way. It looks up methods which have either of the following two signatures:
					</p>
<div class="literallayout">
<p>
<code class="code">IScope&nbsp;scope_&lt;RefDeclaringEClass&gt;_&lt;Reference&gt;(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;ContextType&gt;&nbsp;ctx,&nbsp;EReference&nbsp;ref)<br>

<br>
IScope&nbsp;scope_&lt;TypeToReturn&gt;(&lt;ContextType&gt;&nbsp;ctx,&nbsp;EReference&nbsp;ref)<br>

<br>

</code>
</p>
</div>
<p>The former is used when evaluating the scope for a specific cross-reference and here 
						<span class="emphasis"><em>ContextReference</em></span> 
						corresponds to the name of this reference (prefixed with the name of the reference&rsquo;s declaring type and 
						separated by an underscore). The 
						<span class="emphasis"><em>ref</em></span> parameter represents this cross-reference.
					</p>
<p>The latter method signature is used when computing the scope for a given element type and is applicable 
						to all cross-references of that type. Here 
						<span class="emphasis"><em>TypeToReturn</em></span> is the name of that type. 
					</p>
<p>So if you for example have a state machine with a  
						<span class="emphasis"><em>Transition</em></span> object owned by its source 
						<span class="emphasis"><em>State</em></span> and 
						you want to compute all reachable states (i.e. potential target states), the corresponding method could 
						be declared as follows (assuming the cross-reference is declared by the 
						<span class="emphasis"><em>Transition</em></span> type and is called 
						<span class="emphasis"><em>target</em></span>):
					</p>
<div class="literallayout">
<p>
<code class="code">IScope&nbsp;scope_Transition_target(Transition&nbsp;this,&nbsp;EReference&nbsp;ref)<br>

</code>
</p>
</div>
<p>If such a method does not exist, the implementation will try to find one for the context object&rsquo;s container. 
						Thus in the example this would match a method with the same name but 
						<span class="emphasis"><em>State</em></span> as the type of the first 
						parameter. It will keep on walking the containment hierarchy until a matching method is found. This 
						container delegation allows to reuse the same scope definition for elements in different places of the 
						containment hierarchy. Also it may make the method easier to implement as the elements comprising the 
						scope are quite often owned or referenced by a container of the context object. In the example the 

						<span class="emphasis"><em>State</em></span> objects could for instance be owned by a containing 
						<span class="emphasis"><em>StateMachine</em></span> object.
					</p>
<p>If no method specific to the cross-reference in question was found for any of the objects in the 
						containment hierarchy, the implementation will start looking for methods matching the other signature. Again it will first attempt to match the context object. Thus in the 
						example the signature first matched would be:</p>
<div class="literallayout">
<p>
<code class="code">IScope&nbsp;scope_State(Transition&nbsp;this,&nbsp;EReference&nbsp;ref)<br>

</code>
</p>
</div>
<p>If no such method exists, the implementation will again try to find a method matching the context object&rsquo;s 
						container objects. In the case of the state machine example you might want to declare the scope with 
						available states at the state machine level:</p>
<div class="literallayout">
<p>
<code class="code">IScope&nbsp;scope_State(StateMachine&nbsp;this,&nbsp;EReference&nbsp;ref)<br>

</code>
</p>
</div>
<p>This scope can now be used for any cross-references of type 
						<span class="emphasis"><em>State</em></span> for context objects owned by the 
						state machine.
					</p>
</div>
</div>
<div class="section" title="Imported Namespace-Aware Scoping">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="ImportedNamespaceAwareScoping"></a>Imported Namespace-Aware Scoping</h3>
</div>
</div>
</div>
<p>The imported namespace aware scoping is based on qualified names and namespaces. It adds namespace 
					support to your language, which is comparable and similar to the one in Scala and C#. Scala and C# both 
					allow to have multiple nested packages within one file and you can put imports per namespace, so that 
					imported names are only visible within that namespace. See the domain model example: its scope provider 
					extends 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/scoping/impl/ImportedNamespaceAwareLocalScopeProvider.java?root=Modeling_Project&view=co" target="_new">ImportedNamespaceAwareLocalScopeProvider</a>.
				</p>
<div class="section" title="IQualifiedNameProvider">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="org.eclipse.xtextsrcorg.eclipse.xtext.naming.IQualifiedNameProvider"></a>
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/naming/IQualifiedNameProvider.java?root=Modeling_Project&view=co" target="_new">IQualifiedNameProvider</a>
					
</h4>
</div>
</div>
</div>
<p>The 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/scoping/impl/ImportedNamespaceAwareLocalScopeProvider.java?root=Modeling_Project&view=co" target="_new">ImportedNamespaceAwareLocalScopeProvider</a> 
						makes use of the so called 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/naming/IQualifiedNameProvider.java?root=Modeling_Project&view=co" target="_new">IQualifiedNameProvider</a> 
						service. It computes qualified names for EObjects. The default implementation 
						(
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/naming/DefaultDeclarativeQualifiedNameProvider.java?root=Modeling_Project&view=co" target="_new">DefaultDeclarativeQualifiedNameProvider</a>) uses 
						a simple name look up and concatenates the result to the qualified name of its parent object using a dot 
						as separator. 
					</p>
<p>It also allows to override the name computation declaratively. The following snippet shows how you could 
						make 
						<span class="emphasis"><em>Transitions</em></span> in the state machine example referable by giving them a name. Don&rsquo;t forget to bind 
						your implementation in your runtime module. 
					</p>
<div class="literallayout">
<p>
<code class="code">FowlerDslQualifiedNameProvider&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;extends&nbsp;DefaultDeclarativeQualifiedNameProvider&nbsp;{<br>
&nbsp;&nbsp;public&nbsp;String&nbsp;qualifiedName(Transition&nbsp;t)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;if(t.getEvent()&nbsp;==&nbsp;null&nbsp;||&nbsp;!(t.eContainer()&nbsp;instanceof&nbsp;State))&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;null;<br>
&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;((State)t.eContainer()).getName()&nbsp;+&nbsp;"."&nbsp;t.getEvent().getName();<br>
&nbsp;&nbsp;}<br>
}<br>

<br>

</code>
</p>
</div>
</div>
<div class="section" title="Importing Namespaces">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="ImportingNamespaces"></a>Importing Namespaces</h4>
</div>
</div>
</div>
<p>The 
						<span class="emphasis"><em>ImportedNamespaceAwareLocalScopeProvider</em></span> looks up 
						<span class="emphasis"><em>EAttributes</em></span> with name &sbquo;importedNamespace&rsquo; and 
						interprets them as import statements. By default qualified names with or without a wildcard at the end 
						are supported. For an import of a qualified name the simple name is made available as we know from e.g. 
						Java, where
					</p>
<div class="literallayout">
<p>
<code class="code">import&nbsp;java.util.Set;<br>

</code>
</p>
</div>
<p>makes it possible to refer to &sbquo;java.util.Set&rsquo; by its simple name &sbquo;Set&rsquo;.
						Contrary to Java the import is not active for the whole file but only for the namespace it is declared 
						in and its child namespaces. That is why you can write the following in the example DSL:</p>
<div class="literallayout">
<p>
<code class="code">package&nbsp;foo&nbsp;{<br>
&nbsp;&nbsp;import&nbsp;bar.Foo<br>
&nbsp;&nbsp;entity&nbsp;Bar&nbsp;extends&nbsp;Foo&nbsp;{<br>
&nbsp;&nbsp;}<br>
}<br>

<br>
package&nbsp;bar&nbsp;{<br>
&nbsp;&nbsp;entity&nbsp;Foo&nbsp;{}<br>
}<br>

<br>

</code>
</p>
</div>
<p>Of course the declared elements within a package are as well referable by their simple name:</p>
<div class="literallayout">
<p>
<code class="code">package&nbsp;bar&nbsp;{<br>
&nbsp;&nbsp;entity&nbsp;Bar&nbsp;extends&nbsp;Foo&nbsp;{}<br>
&nbsp;&nbsp;entity&nbsp;Foo&nbsp;{}<br>
}<br>

<br>

</code>
</p>
</div>
<p>The following would as well be ok:</p>
<div class="literallayout">
<p>
<code class="code">package&nbsp;bar&nbsp;{<br>
&nbsp;&nbsp;entity&nbsp;Bar&nbsp;extends&nbsp;bar.Foo&nbsp;{}<br>
&nbsp;&nbsp;entity&nbsp;Foo&nbsp;{}<br>
}<br>

<br>

</code>
</p>
</div>
<p>See the JavaDocs and 
						<a class="ulink" href="http://blog.efftinge.de/2009/07/xtext-scopes-and-emf-index-in-action.html" target="_new">this blog post</a> 
						for details.
					</p>
</div>
</div>
</div>
<div class="section" title="Value Converter">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="valueconverter"></a>Value Converter</h2>
</div>
</div>
</div>
<p>Value converters are registered to convert the parsed text into a certain data type instance and vice versa.
				The primary hook is called 
				<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/conversion/IValueConverterService.java?root=Modeling_Project&view=co" target="_new">IValueConverterService</a> 
				and the concrete implementation can be registered via the runtime 
				<a class="link" href="#guicemodules" title="The Module API">Guice module</a>.
				To do so override the corresponding binding in your runtime module like shown in this example:
			</p>
<div class="literallayout">
<p>
<code class="code">@Override<br>
public&nbsp;Class&lt;?&nbsp;extends&nbsp;IValueConverterService&gt;&nbsp;bindIValueConverterService()&nbsp;{<br>
&nbsp;&nbsp;return&nbsp;MySpecialValueConverterService.class;<br>
}<br>

<br>

</code>
</p>
</div>
<div class="section" title="Annotation-Based Value Converters">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="AnnotationBasedValueConverters"></a>Annotation-Based Value Converters</h3>
</div>
</div>
</div>
<p>The most simple way to register additional value converters is to make use of 

					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/conversion/impl/AbstractDeclarativeValueConverterService.java?root=Modeling_Project&view=co" target="_new">AbstractDeclarativeValueConverterService</a>, 
					which allows to declaratively register an 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/conversion/IValueConverter.java?root=Modeling_Project&view=co" target="_new">IValueConverter</a>
					by means of an annotated method. 
				</p>
<p>If you use the common terminals grammar 
					<span class="emphasis"><em>org.eclipse.xtext.common.Terminals</em></span> you should subclass 

					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/common/services/DefaultTerminalConverters.java?root=Modeling_Project&view=co" target="_new">DefaultTerminalConverters</a> and override or 
					add additional value converters by adding the respective methods. In addition to the explicitly 
					defined converters in the default implementation, a delegating converter is registered for each 
					available 
					<span class="emphasis"><em>EDataType</em></span> that reuses the functionality of the corresponding EMF 
					<span class="emphasis"><em>EFactory</em></span>.
				</p>
<p>As qualified names &ndash; i.e. names composed of namespaces separated by a delimiter &ndash; are expected to occur often, we&rsquo;ve added a 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/conversion/impl/QualifiedNameValueConverter.java?root=Modeling_Project&view=co" target="_new">QualifiedNameValueConverter</a>. This one removes comments and whitespaces and delegates to another value converter for each segment, allowing individually quoted segments. The domainmodel example shows how to use it. 
				</p>
<p>The protocol of an 
					<span class="emphasis"><em>IValueConverter</em></span> allows to throw a 
					<span class="emphasis"><em>ValueConverterException</em></span> if something went wrong.
					The exception is propagated as a syntax error by the parser or as a validation problem by the 

					<span class="emphasis"><em>ConcreteSyntaxValidator</em></span> if the value cannot be converted to a valid string. The 

					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/conversion/impl/AbstractLexerBasedConverter.java?root=Modeling_Project&view=co" target="_new">AbstractLexerBasedConverter</a> is useful when 
					implementing a custom value converter. If the converter needs to know about the rule that it currently 
					works with, it may implement the interface 
					<span class="emphasis"><em>IValueConverter.RuleSpecific</em></span>. The framework will set the
					rule such as the implementation may use it afterwards.
				</p>
</div>
</div>
<div class="section" title="Serialization">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="serialization"></a>Serialization</h2>
</div>
</div>
</div>
<p>Serialization is the process of transforming an EMF model into its textual representation. Thereby, 
				serialization complements parsing and lexing.</p>
<p>In Xtext, the process of serialization is split into the following steps:</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>Validating the semantic model. This is optional, enabled by default, done by the 
						<a class="link" href="#concrete_syntax_validation" title="Serializer: Concrete Syntax Validation">concrete syntax validator</a> and can be turned off in the 
						<a class="link" href="#saveoptions" title="Options">save options</a>. 
					</p>
</li>
<li class="listitem">
<p>Matching the model elements with the grammar rules and creating a stream of tokens. This is done by the 
						<a class="link" href="#parsetreeconstructor" title="Parse Tree Constructor">parse tree constructor</a>.
					</p>
</li>
<li class="listitem">
<p>Associating comments with semantic objects. This is done by the 
						<a class="link" href="#commentassociater" title="Preserving Comments from the Node Model">comment associator</a>.
					</p>
</li>
<li class="listitem">
<p>Associating existing nodes from the node model with tokens from the token stream.</p>
</li>
<li class="listitem">
<p>
						
<a class="link" href="#hiddentokenmerger" title="Merge Whitespaces">Merging existing whitespace</a> and line-wraps into to token stream. 
					</p>
</li>
<li class="listitem">
<p>Adding further needed whitespace or replacing all whitespace using a 
						<a class="link" href="#formatting" title="Formatting (Pretty Printing)">formatter</a>.  
					</p>
</li>
</ol>
</div>
<p>Serialization is invoked when calling 

				<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/resource/XtextResource.java?root=Modeling_Project&view=co" target="_new">XtextResource</a>.save(...). Furthermore, 

				<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/parsetree/reconstr/Serializer.java?root=Modeling_Project&view=co" target="_new">Serializer</a> provides resource-independent 
				support for serialization. Serialization is 
				<span class="emphasis"><em>not</em></span> called when a textual editors contents is saved to disk. 
				Another situation that triggers serialization is applying 
				<a class="link" href="#quickfixes" title="Quick Fixes">Quick Fixes</a> with semantic modifications.
			</p>
<div class="section" title="The Contract">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="serializationcontract"></a>The Contract</h3>
</div>
</div>
</div>
<p>The contract of serialization says that a model that is serialized to its textual representation 
					and then loaded (parsed) again should yield a loaded model that equals the original model. Please be 
					aware that this does 
					<span class="emphasis"><em>not</em></span> imply, that loading a textual representation and serializing it back produces 
					identical textual representations. For example, this is the case when a default value is used in a 
					textual representation and the assignment is optional. Another example is:
				</p>
<div class="literallayout">
<p>
<code class="code">MyRule:<br>
&nbsp;&nbsp;(xval+=ID&nbsp;|&nbsp;yval+=INT)*;<br>
&nbsp;&nbsp;<br>

</code>
</p>
</div>
<p>
					
<span class="emphasis"><em>MyRule</em></span> in this example reads 
					<span class="emphasis"><em>ID</em></span>- and 
					<span class="emphasis"><em>INT</em></span>-elements which may occur in an arbitrary order in 
					the textual representation. However, when serializing the model all 
					<span class="emphasis"><em>ID</em></span>-elements will be written 
					first and then all 
					<span class="emphasis"><em>INT</em></span>-elements. If the order is important it can be preserved by storing all elements 
					in the same list &ndash; which may require wrapping the 
					<span class="emphasis"><em>ID</em></span>- and 
					<span class="emphasis"><em>INT</em></span>-elements into objects.
				</p>
</div>
<div class="section" title="Roles of the Semantic Model and the Node Model During Serialization">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="RolesoftheSemanticModelandtheNodeModelDuringSerialization"></a>Roles of the Semantic Model and the Node Model During Serialization</h3>
</div>
</div>
</div>
<p>A serialized document represents the state of the semantic model. However, if there is a node model available (i.e. the semantic model has been created by the parser), the serializer</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>preserves 
							<a class="link" href="#hiddentokenmerger" title="Merge Whitespaces">existing whitespaces</a> from the node model.
						</p>
</li>
<li class="listitem">
<p>preserves 
							<a class="link" href="#commentassociater" title="Preserving Comments from the Node Model">existing comments</a> from the node model.
						</p>
</li>
<li class="listitem">
<p>preserves the representation of cross-references: If a cross-referenced object can be identified by multiple names (i.e. scoping returns multiple EObjectDescriptions for the same object), the serializer tries to keep the previously used name. </p>
</li>
<li class="listitem">
<p>preserves the representation of values: For values handled by the 
							<a class="link" href="#valueconverter" title="Value Converter">value converter</a>, the serializer checks whether the textual representation converted to a value equals the value from the semantic model. If that is true, the textual representation is kept.  
						</p>
</li>
</ul>
</div>
</div>
<div class="section" title="Parse Tree Constructor">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="parsetreeconstructor"></a>Parse Tree Constructor</h3>
</div>
</div>
</div>
<p>The parse tree constructor usually does not need to be customized since it is automatically derived 
					from the 
					<a class="link" href="#grammarLanguage" title="Chapter&nbsp;3.&nbsp;The Grammar Language">Xtext Grammar</a>. However, it can be helpful to look into it to understand 
					its error messages and its runtime performance.
				</p>
<p>For serialization to succeed, the parse tree constructor must be able to 
					<span class="emphasis"><em>consume</em></span> every non-transient 
					element of the to-be-serialized EMF model. To 
					<span class="emphasis"><em>consume</em></span> means, in this context, to write the element to 
					the textual representation of the model. This can turn out to be a not-so-easy-to-fulfill requirement, 
					since a grammar usually introduces implicit constraints to the EMF model as explained for the 

					<a class="link" href="#concrete_syntax_validation" title="Serializer: Concrete Syntax Validation">concrete syntax validator</a>.
				</p>
<p>If a model can not be serialized, an 

					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/parsetree/reconstr/XtextSerializationException.java?root=Modeling_Project&view=co" target="_new">XtextSerializationException</a> is thrown. 
					Possible reasons are listed below:
				</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>A model element can not be consumed. This can have the following reasons/solutions:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="circle">
<li class="listitem">
<p>The model element should not be stored in the model.</p>
</li>
<li class="listitem">
<p>The grammar needs an assignment which would consume the model element.</p>
</li>
<li class="listitem">
<p>The 
									<a class="link" href="#transientvalues" title="Transient Values">transient value service</a> can be used to indicate that this model element should not be consumed. 
								</p>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>An assignment in the grammar has no corresponding model element. The default transient value service considers a model element to be transient if it is 
							<span class="emphasis"><em>unset</em></span> or equals its default value. However, the parse tree constructor may serialize default values if this is required by a grammar constraint to be able to serialize another model element. The following solution may help to solve such a scenario:
						</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="circle">
<li class="listitem">
<p>A model element should be added to the model.</p>
</li>
<li class="listitem">
<p>The assignment in the grammar should be made optional.</p>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>The type of the model element differs from the type in the grammar. The type of the model element must be identical to the return type of the grammar rule or the action&rsquo;s type. Sub-types are not allowed.</p>
</li>
<li class="listitem">
<p>
							
<a class="link" href="#valueconverter" title="Value Converter">Value conversion</a> fails. The value converter can indicate that a value is not serializeable by throwing a 
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/conversion/ValueConverterException.java?root=Modeling_Project&view=co" target="_new">ValueConverterException</a>.
						</p>
</li>
<li class="listitem">
<p>An enum literal is not allowed at this position. This can happen if the referenced enum rule only lists a subset of the literals of the actual enumeration.</p>
</li>
</ul>
</div>
<p>To understand error messages and performance issues of the parse tree constructor it is important to 
					know that it implements a backtracking algorithm. This basically means that the grammar is used to 
					specify the structure of a tree in which one path (from the root node to a leaf node) is a valid 
					serialization of a specific model. The parse tree constructor&rsquo;s task is to find this path &ndash; with the 
					condition, that all model elements are consumed while walking this path. The parse tree constructor&rsquo;s 
					strategy is to take the most promising branch first (the one that would consume the most model elements). 
					If the branch leads to a dead end (for example, if a model element needs to be consumed that is not 
					present in the model), the parse tree constructor goes back the path until a different branch can be 
					taken. This behavior has two consequences:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>In case of an error, the parse tree constructor has found only dead ends but no leaf. It cannot tell which dead end is actually erroneous. Therefore, the error message lists dead ends of the longest paths, a fragment of their serialization and the reason why the path could not be continued at this point. The developer has to judge on his own which reason is the actual error.</p>
</li>
<li class="listitem">
<p> For reasons of performance, it is critical that the parse tree constructor takes the most promising branch first and detects wrong branches early. One way to achieve this is to avoid having many rules which return the same type and which are called from within the same alternative in the grammar.</p>
</li>
</ul>
</div>
</div>
<div class="section" title="Options">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="saveoptions"></a>Options</h3>
</div>
</div>
</div>
<p>
					
<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/resource/SaveOptions.java?root=Modeling_Project&view=co" target="_new">SaveOptions</a> can be passed to 

					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/resource/XtextResource.java?root=Modeling_Project&view=co" target="_new">XtextResource</a>.save(options) and to 

					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/parsetree/reconstr/Serializer.java?root=Modeling_Project&view=co" target="_new">Serializer</a>.serialize(..). 
					Available options are:
				</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>
							
<span class="bold"><strong>Formatting</strong></span>. Default: 
							<span class="emphasis"><em>false</em></span>. If enabled, it is the 
							<a class="link" href="#formatting" title="Formatting (Pretty Printing)">formatters</a> job to determine all whitespace information during serialization. If disabled, the formatter only defines whitespace information for the places in which no whitespace information can be preserved from the node model. E.g. When new model elements are inserted or there is no node model.
						</p>
</li>
<li class="listitem">
<p>
							
<span class="bold"><strong>Validating</strong></span>. Default: 
							<span class="emphasis"><em>true</em></span>: Run the 
							<a class="link" href="#concrete_syntax_validation" title="Serializer: Concrete Syntax Validation">concrete syntax validator</a> before serializing the model.
						</p>
</li>
</ul>
</div>
</div>
<div class="section" title="Preserving Comments from the Node Model">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="commentassociater"></a>Preserving Comments from the Node Model</h3>
</div>
</div>
</div>
<p>The 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/parsetree/reconstr/ICommentAssociater.java?root=Modeling_Project&view=co" target="_new">ICommentAssociater</a> associates 
					comments with semantic objects. This is important in case an element in the semantic model is moved 
					to a different position and the model is serialized, one expects the comments to be moved to the 
					new position in the document as well.
				</p>
<p>Which comment belongs to which semantic object is surely a very subjective issue. The default 
					implementation (
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/parsetree/reconstr/impl/DefaultCommentAssociater.java?root=Modeling_Project&view=co" target="_new">DefaultCommentAssociater</a>) 
					behaves as follows, but can be customized:
				</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>If there is a semantic token before a comment and in the same line, the comment is associated with this token&rsquo;s semantic object.</p>
</li>
<li class="listitem">
<p>In all other cases, the comment is associated with the semantic object of the next following object.</p>
</li>
</ul>
</div>
</div>
<div class="section" title="Transient Values">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="transientvalues"></a>Transient Values</h3>
</div>
</div>
</div>
<p>Transient values are values or model elements which are not persisted (written to the textual 
					representation in the serialization phase). If a model contains model elements which can not be serialized 
					with the current grammar, it is critical to mark them transient using the 

					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/parsetree/reconstr/ITransientValueService.java?root=Modeling_Project&view=co" target="_new">ITransientValueService</a>, or serialization 
					will fail. The default implementation marks all model elements transient, which are 
					<span class="emphasis"><em>eStructuralFeature.isTransient()</em></span> 
					or not 
					<span class="emphasis"><em>eObject.eIsSet(eStructuralFeature)</em></span>. By default, EMF returns 
					<span class="emphasis"><em>false</em></span> for 
					<span class="emphasis"><em>eIsSet(...)</em></span> if the 
					value equals the default value.    
				</p>
</div>
<div class="section" title="Unassigned Text">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="unassignedtext"></a>Unassigned Text</h3>
</div>
</div>
</div>
<p>If there are calls of data type rules or terminal rules that do not reside in an assignment, 
					the serializer by default doesn&rsquo;t know which value to use for serialization.  </p>
<p>. Example:</p>
<div class="literallayout">
<p>
<code class="code">PluralRule:<br>
&nbsp;&nbsp;'contents:'&nbsp;count=INT&nbsp;Plural;<br>
&nbsp;&nbsp;<br>
terminal&nbsp;Plural:&nbsp;<br>
&nbsp;&nbsp;'item'&nbsp;|&nbsp;'items';<br>
&nbsp;&nbsp;<br>

</code>
</p>
</div>
<p>Valid models for this example are 
					<span class="emphasis"><em>contents 1 item</em></span> or 
					<span class="emphasis"><em>contents 5 items</em></span>. However, it is not stored 
					in the semantic model whether the keyword 
					<span class="emphasis"><em>item</em></span> or 
					<span class="emphasis"><em>items</em></span> has been parsed. This is due to the fact 
					that the rule call 
					<span class="emphasis"><em>Plural</em></span> is unassigned. However, the 
					<a class="link" href="#parsetreeconstructor" title="Parse Tree Constructor">parse tree constructor</a> 
					needs to decide which value to write during serialization. This decision can be be made by customizing 
					the 
					<span class="emphasis"><em>IValueSerializer.serializeUnassignedValue(EObject, RuleCall, AbstractNode)</em></span>.  
				</p>
</div>
<div class="section" title="Cross-Reference Serializer">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="crossreferenceserializer"></a>Cross-Reference Serializer</h3>
</div>
</div>
</div>
<p>The cross-reference serializer specifies which values are to be written to the textual representation 
					for cross-references. This behavior can be customized by implementing 

					<span class="emphasis"><em>ICrossReferenceSerializer</em></span>. 
					The default implementation delegates to various other services such as the 
					<span class="emphasis"><em>IScopeProvider</em></span> or the 

					<span class="emphasis"><em>LinkingHelper</em></span> each of which may be the better place for customization.
				</p>
</div>
<div class="section" title="Merge Whitespaces">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="hiddentokenmerger"></a>Merge Whitespaces</h3>
</div>
</div>
</div>
<p>After the 
					<a class="link" href="#parsetreeconstructor" title="Parse Tree Constructor">parse tree constructor</a> has done its job to create a stream of 
					tokens which are to be written to the textual representation, and the 
					<a class="link" href="#commentassociater" title="Preserving Comments from the Node Model">comment associator</a> 
					has done its work, existing whitespace form the node model is merged into the stream. 
				</p>
<p>The strategy is as follows: If two tokens follow each other in the stream and the corresponding 
					nodes in the node model follow each other as well, then the whitespace information in between is kept. 
					In all other cases it is up to the 
					<a class="link" href="#formatting" title="Formatting (Pretty Printing)">formatter</a> to calculate new whitespace information. 
				</p>
</div>
<div class="section" title="Token Stream">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="tokenstream"></a>Token Stream</h3>
</div>
</div>
</div>
<p>The 
					<a class="link" href="#parsetreeconstructor" title="Parse Tree Constructor">parse tree constructor</a> and the 
					<a class="link" href="#formatting" title="Formatting (Pretty Printing)">formatter</a> use an 

					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/parsetree/reconstr/ITokenStream.java?root=Modeling_Project&view=co" target="_new">ITokenStream</a> for their output, and the 
					latter for its input as well. This makes them chainable. Token streams can be converted to a 
					<span class="emphasis"><em>String</em></span> 
					using the 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/parsetree/reconstr/impl/TokenStringBuffer.java?root=Modeling_Project&view=co" target="_new">TokenStringBuffer</a> and to 
					a 
					<span class="emphasis"><em>Writer</em></span> using the 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/parsetree/reconstr/impl/WriterTokenStream.java?root=Modeling_Project&view=co" target="_new">WriterTokenStream</a>.
				</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;interface&nbsp;ITokenStream&nbsp;{<br>
&nbsp;&nbsp;void&nbsp;flush()&nbsp;throws&nbsp;IOException;<br>
&nbsp;&nbsp;void&nbsp;writeHidden(EObject&nbsp;grammarElement,&nbsp;String&nbsp;value)&nbsp;throws&nbsp;IOException;<br>
&nbsp;&nbsp;void&nbsp;writeSemantic(EObject&nbsp;grammarElement,&nbsp;String&nbsp;value)&nbsp;throws&nbsp;IOException;<br>
}<br>

<br>
&nbsp;<br>

<br>

</code>
</p>
</div>
</div>
</div>
<div class="section" title="Formatting (Pretty Printing)">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="formatting"></a>Formatting (Pretty Printing)</h2>
</div>
</div>
</div>
<p>A formatter can be implemented via the 
				<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/formatting/IFormatter.java?root=Modeling_Project&view=co" target="_new">IFormatter</a> 
				service. Technically speaking, a formatter is a 
				<a class="link" href="#tokenstream" title="Token Stream">Token Stream</a> which 
				inserts/removes/modifies hidden tokens (whitespace, line-breaks, comments).
			</p>
<p>The formatter is invoked during the 
				<a class="link" href="#serialization" title="Serialization">serialization phase</a> and when the user triggers 
				formatting in the editor (for example, using the CTRL+SHIFT+F shortcut).
			</p>
<p>Xtext ships with two formatters:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>The 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/formatting/impl/OneWhitespaceFormatter.java?root=Modeling_Project&view=co" target="_new">OneWhitespaceFormatter</a> simply writes one whitespace between all tokens.
					</p>
</li>
<li class="listitem">
<p>The 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/formatting/impl/AbstractDeclarativeFormatter.java?root=Modeling_Project&view=co" target="_new">AbstractDeclarativeFormatter</a> allows advanced configuration using a 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/formatting/impl/FormattingConfig.java?root=Modeling_Project&view=co" target="_new">FormattingConfig</a>. Both are explained in the 
						<a class="link" href="#declarativeformatter" title="Declarative Formatter">next chapter</a>.
					</p>
</li>
</ul>
</div>
<div class="section" title="Declarative Formatter">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="declarativeformatter"></a>Declarative Formatter</h3>
</div>
</div>
</div>
<p>A declarative formatter can be implemented by sub-classing 

					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/formatting/impl/AbstractDeclarativeFormatter.java?root=Modeling_Project&view=co" target="_new">AbstractDeclarativeFormatter</a>, as shown in 
					the following example:
				</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;ExampleFormatter&nbsp;extends&nbsp;AbstractDeclarativeFormatter&nbsp;{<br>

<br>
&nbsp;&nbsp;@Override<br>
&nbsp;&nbsp;protected&nbsp;void&nbsp;configureFormatting(FormattingConfig&nbsp;c)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;ExampleLanguageGrammarAccess&nbsp;f&nbsp;=&nbsp;getGrammarAccess();<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;c.setAutoLinewrap(120);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;find&nbsp;common&nbsp;keywords&nbsp;an&nbsp;specify&nbsp;formatting&nbsp;for&nbsp;them<br>
&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(Pair&lt;Keyword,&nbsp;Keyword&gt;&nbsp;pair&nbsp;:&nbsp;f.findKeywordPairs("(",&nbsp;")"))&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.setNoSpace().after(pair.getFirst());<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.setNoSpace().before(pair.getSecond());<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(Keyword&nbsp;comma&nbsp;:&nbsp;f.findKeywords(","))&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.setNoSpace().before(comma);<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>

<br>
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;formatting&nbsp;for&nbsp;grammar&nbsp;rule&nbsp;Line<br>
&nbsp;&nbsp;&nbsp;&nbsp;c.setLinewrap(2).after(f.getLineAccess().getSemicolonKeyword_1());<br>
&nbsp;&nbsp;&nbsp;&nbsp;c.setNoSpace().before(f.getLineAccess().getSemicolonKeyword_1());<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;formatting&nbsp;for&nbsp;grammar&nbsp;rule&nbsp;TestIndentation<br>
&nbsp;&nbsp;&nbsp;&nbsp;c.setIndentationIncrement().after(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f.getTestIndentationAccess().getLeftCurlyBracketKeyword_1());<br>
&nbsp;&nbsp;&nbsp;&nbsp;c.setIndentationDecrement().before(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f.getTestIndentationAccess().getRightCurlyBracketKeyword_3());<br>
&nbsp;&nbsp;&nbsp;&nbsp;c.setLinewrap().after(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f.getTestIndentationAccess().getLeftCurlyBracketKeyword_1());<br>
&nbsp;&nbsp;&nbsp;&nbsp;c.setLinewrap().after(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f.getTestIndentationAccess().getRightCurlyBracketKeyword_3());<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;formatting&nbsp;for&nbsp;grammar&nbsp;rule&nbsp;Param<br>
&nbsp;&nbsp;&nbsp;&nbsp;c.setNoLinewrap().around(f.getParamAccess().getColonKeyword_1());<br>
&nbsp;&nbsp;&nbsp;&nbsp;c.setNoSpace().around(f.getParamAccess().getColonKeyword_1());<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;formatting&nbsp;for&nbsp;Comments&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;cfg.setLinewrap(0,&nbsp;1,&nbsp;2).before(g.getSL_COMMENTRule());<br>
&nbsp;&nbsp;&nbsp;&nbsp;cfg.setLinewrap(0,&nbsp;1,&nbsp;2).before(g.getML_COMMENTRule());<br>
&nbsp;&nbsp;&nbsp;&nbsp;cfg.setLinewrap(0,&nbsp;1,&nbsp;1).after(g.getML_COMMENTRule());<br>
&nbsp;&nbsp;}<br>
}<br>

<br>

</code>
</p>
</div>
<p>The formatter has to implement the method 
					<span class="emphasis"><em>configureFormatting(...)</em></span> which declaratively sets up 
					a 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/formatting/impl/FormattingConfig.java?root=Modeling_Project&view=co" target="_new">FormattingConfig</a>.
				</p>
<p>The 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/formatting/impl/FormattingConfig.java?root=Modeling_Project&view=co" target="_new">FormattingConfig</a> consist of general 
					settings and a set of formatting instructions:
				</p>
<div class="section" title="General FormattingConfig Settings">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="GeneralFormattingConfigSettings"></a>General FormattingConfig Settings</h4>
</div>
</div>
</div>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>
								
<span class="emphasis"><em>setAutoLinewrap(int)</em></span> defines the amount of characters after which a line-break should be dynamically inserted between two tokens. The instructions 
								<span class="emphasis"><em>setNoLinewrap().???()</em></span>,  
								<span class="emphasis"><em>setNoSpace().???()</em></span> and 
								<span class="emphasis"><em>setSpace(space).???()</em></span> suppress this behavior locally. The default is 80.
							</p>
</li>
</ul>
</div>
</div>
<div class="section" title="FormattingConfig Instructions">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="FormattingConfigInstructions"></a>FormattingConfig Instructions</h4>
</div>
</div>
</div>
<p>Per default, the 
						<a class="link" href="#declarativeformatter" title="Declarative Formatter">declarative formatter</a> inserts one whitespace between two 
						tokens. Instructions can be used to specify a different behavior. They consist of two parts: 
						<span class="emphasis"><em>When</em></span> 
						to apply the instruction and 
						<span class="emphasis"><em>what</em></span> to do.
					</p>
<p>To understand 
						<span class="emphasis"><em>when</em></span> an instruction is applied think of a stream of tokens whereas each token is 
						associated with the corresponding grammar element. The instructions are matched against these grammar 
						elements. The following matching criteria exist:
					</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>
								
<span class="emphasis"><em>after(ele)</em></span>: The instruction is applied after the grammar element 
								<span class="emphasis"><em>ele</em></span> has been matched. For example, if your grammar uses the keyword &bdquo;;&rdquo; to end lines, this can instruct the formatter to insert a line break after the semicolon.  
							</p>
</li>
<li class="listitem">
<p>
								
<span class="emphasis"><em>before(ele)</em></span>: The instruction is executed before the matched element. For example, if your grammar contains lists which separate their values with the keyword &bdquo;,&rdquo;, you can instruct the formatter to suppress the whitespace before the comma.
							</p>
</li>
<li class="listitem">
<p>
								
<span class="emphasis"><em>around(ele)</em></span>: This is the same as 
								<span class="emphasis"><em>before(ele)</em></span> combined with  
								<span class="emphasis"><em>after(ele)</em></span>.  
							</p>
</li>
<li class="listitem">
<p>
								
<span class="emphasis"><em>between(ele1, ele2)</em></span>: This matches if 
								<span class="emphasis"><em>ele2</em></span> directly follows 
								<span class="emphasis"><em>ele1</em></span> in the document. There may be no other tokens in between 
								<span class="emphasis"><em>ele1</em></span> and 
								<span class="emphasis"><em>ele2</em></span>.
							</p>
</li>
<li class="listitem">
<p>
								
<span class="emphasis"><em>bounds(ele1, ele2)</em></span>: This is the same as 
								<span class="emphasis"><em>after(ele1)</em></span> combined with  
								<span class="emphasis"><em>before(ele2)</em></span>.
							</p>
</li>
<li class="listitem">
<p>
								
<span class="emphasis"><em>range(ele1, ele2)</em></span>: The rule is enabled when 
								<span class="emphasis"><em>ele1</em></span> is matched, and disabled when 
								<span class="emphasis"><em>ele2</em></span> is matched. Thereby, the rule is active for the complete region which is surrounded by 
								<span class="emphasis"><em>ele1</em></span> and 
								<span class="emphasis"><em>ele2</em></span>.
							</p>
</li>
</ul>
</div>
<p>The term 
						<span class="emphasis"><em>tokens</em></span> is used slightly different here compared to the parser/lexer. Here, a token is a 
						keyword or the string that is matched by a terminal rule, data type rule or cross-reference. In the 
						terminology of the lexer a data type rule can match a composition of multiple tokens.
					</p>
<p>The parameter 
						<span class="emphasis"><em>ele</em></span> can be a grammar&rsquo;s 
						<span class="emphasis"><em>AbstractElement</em></span> or a grammar&rsquo;s 
						<span class="emphasis"><em>AbstractRule</em></span>. All grammar 
						rules and almost all abstract elements can be matched. This includes rule calls, parser rules, groups 
						and alternatives. The semantic of 
						<span class="emphasis"><em>before(ele)</em></span>, 
						<span class="emphasis"><em>after(ele)</em></span>, etc. for rule calls and parser rules is 
						identical to when the parser would &bdquo;pass&rdquo; this part of the grammar. The stack of called rules is taken 
						into account. The following abstract elements can 
						<span class="bold"><strong>not</strong></span> have assigned formatting instructions:
					</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>Actions. E.g. 
								<span class="emphasis"><em>{MyAction}</em></span> or 
								<span class="emphasis"><em>{MyAction.myFeature=current}</em></span>.
							</p>
</li>
<li class="listitem">
<p>Grammar elements nested in data type rules. This is due to to the fact that tokens matched by a data type rule are treated as atomic by the serializer. To format these tokens, please implement a 
								<a class="link" href="#valueconverter" title="Value Converter">ValueConverter</a>. 
							</p>
</li>
<li class="listitem">
<p>Grammar elements nested in 
								<span class="emphasis"><em>CrossReferences</em></span>.
							</p>
</li>
</ul>
</div>
<p>After having explained how rules can be activated, this is what they can do:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>
								
<span class="emphasis"><em>setIndentationIncrement()</em></span> increments indentation by one unit at this position. Whether one unit consists of one tab-character or spaces is defined by 
								<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/formatting/IIndentationInformation.java?root=Modeling_Project&view=co" target="_new">IIndentationInformation</a>. The default implementation consults Eclipse&rsquo;s 
								<span class="emphasis"><em>PreferenceStore</em></span>.
							</p>
</li>
<li class="listitem">
<p>
								
<span class="emphasis"><em>setIndentationDecrement()</em></span> decrements indentation by one unit.
							</p>
</li>
<li class="listitem">
<p>
								
<span class="emphasis"><em>setLinewrap()</em></span>: Inserts a line-wrap at this position.
							</p>
</li>
<li class="listitem">
<p>
								
<span class="emphasis"><em>setLinewrap(int count)</em></span>: Inserts 
								<span class="emphasis"><em>count</em></span> numbers of line-wrap at this position.
							</p>
</li>
<li class="listitem">
<p>
								
<span class="emphasis"><em>setLinewrap(int min, int default, int max)</em></span>: If the amount of line-wraps that have been at this position before formatting can be determined (i.g. when a node model is present), then the amount of of line-wraps is adjusted to be within the interval [
								<span class="emphasis"><em>min</em></span>, 
								<span class="emphasis"><em>max</em></span>] and is then reused. In all other cases 
								<span class="emphasis"><em>default</em></span> line-wraps are inserted. Example: 
								<span class="emphasis"><em>setLinewrap(0, 0, 1)</em></span> will preserve existing line-wraps, but won&rsquo;t allow more than one line-wrap between two tokens.    
							</p>
</li>
<li class="listitem">
<p>
								
<span class="emphasis"><em>setNoLinewrap()</em></span>: Suppresses automatic line wrap, which may occur when the line&rsquo;s length exceeds the defined limit.
							</p>
</li>
<li class="listitem">
<p>
								
<span class="emphasis"><em>setSpace(String space)</em></span>: Inserts the string 
								<span class="emphasis"><em>space</em></span> at this position. If you use this to insert something else than whitespace, tabs or newlines, a small puppy will die somewhere in this world.
							</p>
</li>
<li class="listitem">
<p>
								
<span class="emphasis"><em>setNoSpace()</em></span>: Suppresses the whitespace between tokens at this position. Be aware that between some tokens a whitespace is required to maintain a valid concrete syntax. 
							</p>
</li>
</ul>
</div>
</div>
<div class="section" title="Grammar Element Finders">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="GrammarElementFinders"></a>Grammar Element Finders</h4>
</div>
</div>
</div>
<p>Sometimes, if a grammar contains many similar elements for which the same formatting instructions ought 
						to apply, it can be tedious to specify them for each grammar element individually. The 

						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/IGrammarAccess.java?root=Modeling_Project&view=co" target="_new">IGrammarAccess</a> provides convenience methods for this. The 
						find methods are available for the grammar and for each parser rule.
					</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>
								
<span class="emphasis"><em>findKeywords(String... keywords)</em></span> returns all keywords that equal one of the parameters.
							</p>
</li>
<li class="listitem">
<p>
								
<span class="emphasis"><em>findKeywordPairs(String leftKw, String rightKw)</em></span>: returns tuples of keywords from the same grammar rule. Pairs are matched nested and sequentially.  Example: for 
								<span class="emphasis"><em>Rule: &sbquo;(&rsquo; name=ID (&sbquo;(&rsquo; foo=ID &sbquo;)&rsquo;) &sbquo;)&rsquo; | &sbquo;(&rsquo; bar=ID ')'</em></span> 
								<span class="emphasis"><em>findKeywordPairs(&bdquo;(&rdquo;, &bdquo;)&rdquo;)</em></span> returns three pairs.
							</p>
</li>
</ul>
</div>
</div>
</div>
<div class="section" title="Fragment Provider (Referencing Xtext Models From Other EMF Artifacts)">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="fragmentProvider"></a>Fragment Provider (Referencing Xtext Models From Other EMF Artifacts)</h3>
</div>
</div>
</div>
<p>Although inter-Xtext linking is not done by URIs, you may want to be able to reference your 
					<span class="emphasis"><em>EObject</em></span> 
					from non-Xtext models. In those cases URIs are used, which are made up of a part identifying the resource 
					and a second part that points to an object. 
					Each 
					<span class="emphasis"><em>EObject</em></span> contained in a resource can be identified by a so called 
					<span class="emphasis"><em>fragment</em></span>.
				</p>
<p>A fragment is a part of an EMF URI and needs to be unique per resource.</p>
<p>The generic resource shipped with EMF provides a generic path-like computation of fragments. These 
					fragment paths are unique by default and do not have to be serialized. On the other hand, they can be 
					easily broken by reordering the elements in a resource. </p>
<p>With an XMI or other binary-like serialization it is also common and possible to use UUIDs. UUIDs 
					are usually binary and technical, so you don&rsquo;t want them in human readable representations.</p>
<p>However with a textual concrete syntax we want to be able to compute fragments out of the human readable 
					information. We don&rsquo;t want to force people to use UUIDs (i.e. synthetic identifiers) or fragile, relative, generic 
					paths in order to refer to 
					<span class="emphasis"><em>EObjects</em></span>.
				</p>
<p>Therefore one can contribute a so called 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/resource/IFragmentProvider.java?root=Modeling_Project&view=co" target="_new">IFragmentProvider</a> 
					per language. It has two methods: 
					<span class="emphasis"><em>getFragment(EObject, Fallback)</em></span> to calculate the fragment of an 

					<span class="emphasis"><em>EObject</em></span> and 
					<span class="emphasis"><em>getEObject(Resource, String, Fallback)</em></span> to go the opposite direction. The 
					<span class="emphasis"><em>Fallback</em></span> 
					interface allows to delegate to the default strategy &ndash; usually the fragment paths described above. 
				</p>
<p>The following snippet from the 
					<a class="link" href="#gmf_integration" title="Integration with GMF Editors">GMF Example</a> shows how to use qualified names as fragments:   
				</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;QualifiedNameFragmentProvider&nbsp;implements&nbsp;IFragmentProvider&nbsp;{<br>

<br>
&nbsp;&nbsp;@Inject<br>
&nbsp;&nbsp;private&nbsp;IQualifiedNameProvider&nbsp;qualifiedNameProvider;<br>

<br>
&nbsp;&nbsp;public&nbsp;String&nbsp;getFragment(EObject&nbsp;obj,&nbsp;Fallback&nbsp;fallback)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;qualifiedName&nbsp;=&nbsp;qualifiedNameProvider.getQualifiedName(obj);<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;qualifiedName&nbsp;!=&nbsp;null&nbsp;?&nbsp;qualifiedName&nbsp;:&nbsp;fallback.getFragment(obj);<br>
&nbsp;&nbsp;}<br>

<br>
&nbsp;&nbsp;public&nbsp;EObject&nbsp;getEObject(Resource&nbsp;resource,&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;fragment,&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Fallback&nbsp;fallback)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(fragment&nbsp;!=&nbsp;null)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Iterator&lt;EObject&gt;&nbsp;i&nbsp;=&nbsp;EcoreUtil.getAllContents(resource,&nbsp;false);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while(i.hasNext())&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EObject&nbsp;eObject&nbsp;=&nbsp;i.next();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;candidateFragment&nbsp;=&nbsp;(eObject.eIsProxy())&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;?&nbsp;((InternalEObject)&nbsp;eObject).eProxyURI().fragment()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;getFragment(eObject,&nbsp;fallback);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(fragment.equals(candidateFragment))&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;eObject;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;fallback.getEObject(fragment);<br>
&nbsp;&nbsp;}<br>
}<br>

<br>

</code>
</p>
</div>
<p>For performance reasons it is usually a good idea to navigate the resource based on the fragment 
					information instead of traversing it completely. If you know that your fragment is computed from 
					qualified names and your model contains something like 
					<span class="emphasis"><em>NamedElements</em></span>, you should split your fragment
					into those parts and query the root elements, the children of the best match and so on.
				</p>
<p>Furthermore it&rsquo;s a good idea to have some kind of conflict resolution strategy to be able to distinguish
					between equally named elements that actually are different, e.g. properties may have the very same qualified
					name as entities. </p>
</div>
</div>
<div class="section" title="Encoding in Xtext">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="encoding"></a>Encoding in Xtext</h2>
</div>
</div>
</div>
<p>
				
<span class="emphasis"><em>Encoding</em></span>, AKA 
				<span class="emphasis"><em>character set</em></span>, describes the way characters are encoded into bytes and vice versa. 
				Famous standard encodings are &bdquo;UTF-8&rdquo; or &bdquo;ISO-8859-1&rdquo;. The list of available encodings can be determined
				by calling 
				<span class="emphasis"><em>java.nio.Charset.availableCharsets()</em></span>. There is also a list of encodings and their 
				canonical Java names in the 
				<a class="ulink" href="http://java.sun.com/j2se/1.5.0/docs/guide/intl/encoding.doc.html" target="_new">API docs</a>.
			</p>
<p>Unfortunately, each platform and/or spoken language tends to define its own native encoding, 
				e.g. 
				<span class="emphasis"><em>Cp1258</em></span> on Windows in Vietnamese or 
				<span class="emphasis"><em>MacIceland</em></span> on Mac OS X in Icelandic. 
			</p>
<p>In an Eclipse workspace, files, folders, projects can have individual encodings, which are stored
				in the hidden file 
				<span class="emphasis"><em>.settings/org.eclipse.core.resources.prefs</em></span> in each project. If a resource does not have an 
				explicit encoding, it inherits the one from its parent recursively. Eclipse chooses the native
				platform encoding as the default for the workspace root. You can change the default workspace 
				encoding in the Eclipse preferences 
				<span class="emphasis"><em>Preferences-&gt;Workspace-&gt;Default text encoding</em></span>. If you develop on
				different platforms, you should consider choosing an explicit common encoding for your text or code
				files, especially if you use special characters. 
			</p>
<p>While Eclipse allows to define and inspect the encoding of a file, your file system usually doesn&rsquo;t. 
				Given an arbitrary text file there is no general strategy to tell how it was encoded. If you deploy 
				an Eclipse project as a jar (even a plug-in), any encoding information not stored in the file itself 
				is lost, too. Some languages define the encoding of a file explicitly, as in the first processing 
				instruction of an XML file. Most languages don&rsquo;t. Others imply a fixed encoding or offer enhanced 
				syntax for character literals, e.g. 
				<span class="emphasis"><em>\uXXXX</em></span> in Java. 
			</p>
<p>As Xtext is about textual modeling, it allows to tweak the encoding in various places.</p>
<div class="section" title="Encoding at Language Design Time">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="EncodingatLanguageDesignTime"></a>Encoding at Language Design Time</h3>
</div>
</div>
</div>
<p>The plug-ins created by the 
					<span class="emphasis"><em>New Xtext Project</em></span> wizard are by default encoded in the workspace&rsquo;s standard
					encoding. The same holds for all files that Xtext generates in there.
					If you want to change that, e.g. because your grammar uses/allows special characters, you should manually 
					set the encoding in the properties of these projects after their creation. Do this before 
					adding special characters to your grammar or at least make sure the grammar reads correctly after the 
					encoding change. To tell the Xtext generator to generate files in the same encoding, set the encoding 
					property in the workflow next to your grammar, e.g.
				</p>
<div class="literallayout">
<p>
<code class="code">Generator&nbsp;{<br>
	encoding&nbsp;="UTF-8"<br>
	...<br>

<br>

</code>
</p>
</div>
</div>
<div class="section" title="Encoding at Language Runtime">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="EncodingatLanguageRuntime"></a>Encoding at Language Runtime</h3>
</div>
</div>
</div>
<p>As each language could handle the encoding problem differently, Xtext offers a service here. 
					The 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/parser/IEncodingProvider.java?root=Modeling_Project&view=co" target="_new">IEncodingProvider</a> has a single method 

					<span class="emphasis"><em>getEncoding(URI)</em></span> to define the encoding of the resource with the given URI. Users can implement 
					their own strategy but keep in mind that this is not intended to be a long running method. If the 
					encoding is stored within the model file itself, it should be extractable in an easy way, like from 
					the first line in an XML file. The default implementation returns the default Java character set 
					in the runtime scenario. 
				</p>
<p>In the UI scenario, when there is a workspace, users will expect the encoding of the model files 
					to be settable the same way as for other files in the workspace. The default implementation 
					of the 
					<span class="emphasis"><em>IEncodingProvider</em></span> in the UI scenario therefore returns the file&rsquo;s workspace encoding 
					for files in the workspace and delegates to the runtime implementation for all other resources, 
					e.g. models in a jar or from a deployed plug-in. Keep in mind that you are going to loose the 
					workspace encoding information as soon as you leave this workspace, e.g. deploy your project.
				</p>
<p>Unless you want to enforce a uniform encoding for all models of your language, we advise to 
					override the runtime service only. It is bound in the runtime module using the binding annotation 

					<span class="emphasis"><em>@Runtime</em></span>:
				</p>
<div class="literallayout">
<p>
<code class="code">@Override<br>
public&nbsp;void&nbsp;configureRuntimeEncodingProvider(Binder&nbsp;binder)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;binder.bind(IEncodingProvider.class)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.annotatedWith(DispatchingProvider.Runtime.class)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.to(MyEncodingProvider.class);<br>
}<br>

<br>

</code>
</p>
</div>
<p>For the uniform encoding, bind the plain 
					<span class="emphasis"><em>IEncodingProvider</em></span> to the same implementation 
					in both modules:
				</p>
<div class="literallayout">
<p>
<code class="code">@Override<br>
public&nbsp;Class&lt;?&nbsp;extends&nbsp;IEncodingProvider&gt;&nbsp;bindIEncodingProvider()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;MyEncodingProvider.class;<br>
}<br>
	
<br>
	
<br>

</code>
</p>
</div>
</div>
<div class="section" title="Encoding of an XtextResource">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="EncodingofanXtextResource"></a>Encoding of an XtextResource</h3>
</div>
</div>
</div>
<p>An 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/resource/XtextResource.java?root=Modeling_Project&view=co" target="_new">XtextResource</a> uses the 
					<span class="emphasis"><em>IEncodingProvider</em></span> 
					of your language by default. You can override that by passing an option on load and save, e.g.
				</p>
<div class="literallayout">
<p>
<code class="code">Map&lt;?,?&gt;&nbsp;options&nbsp;=&nbsp;new&nbsp;HashMap();<br>
options.put(XtextResource.OPTION_ENCODING,&nbsp;"UTF-8");<br>
myXtextResource.load(options);<br>
options.put(XtextResource.OPTION_ENCODING,&nbsp;"ISO-8859-1");<br>
myXtextResource.save(options);<br>

<br>

</code>
</p>
</div>
</div>
<div class="section" title="Encoding in New Model Projects">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="EncodinginNewModelProjects"></a>Encoding in New Model Projects</h3>
</div>
</div>
</div>
<p>The 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/ui/generator/projectWizard/SimpleProjectWizardFragment.java?root=Modeling_Project&view=co" target="_new">SimpleProjectWizardFragment</a> 
					generates a wizard that clients of your language can use to create model 
					projects. This wizard expects its templates to be in the encoding of the Generator that created it 
					(see above). As for every new project wizard, its output will be encoded in the default encoding of the 
					target workspace. 
				</p>
</div>
<div class="section" title="Encoding of Xtext Source Code">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="EncodingofXtextSourceCode"></a>Encoding of Xtext Source Code</h3>
</div>
</div>
</div>
<p>The source code of the Xtext framework itself is completely encoded in &bdquo;ISO 8859-1&rdquo;, which is necessary 
					to make the Xpand templates work everywhere (they use french quotation markup). That encoding is hard 
					coded into the Xtext generator code. You are likely never going to change that. </p>
</div>
</div>
</div>
<div class="chapter" title="Chapter&nbsp;6.&nbsp;MWE2">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="MWE2"></a>Chapter&nbsp;6.&nbsp;MWE2</h2>
</div>
</div>
</div>
<p>The Modeling Workflow Engine 2 (MWE2) is a rewritten backwards 
			compatible implementation of the Modeling Workflow Engine (MWE). It 
			is a declarative, externally configurable generator engine. Users 
			can describe arbitrary object compositions by means of a simple, 
			concise syntax that allows to declare object instances, attribute 
			values and references. One use case &ndash; that&rsquo;s where the name had its 
			origins &ndash; is the definition of workflows. Such a workflow consists 
			usually of a number of components that interact with each other. 
			There are components to read EMF resources, to perform 
			operations (transformations) on them and to write them back or to generate 
			any number of other artifacts out of the information. Workflows are 
			typically executed in a single JVM. However there are no constraints 
			the prevent implementors to provide components that spawn multiple 
			threads or new processes.</p>
<div class="section" title="Examples">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="MWE2Exampe"></a>Examples</h2>
</div>
</div>
</div>
<p>Let&rsquo;s start with a couple of examples to demonstrate some usage 
				scenarios for MWE2. The first examples is a simple 
				<span class="emphasis"><em>HelloWorld</em></span> 
				module that does nothing but print a message to standard out. The 
				second module is assembled of three components that read an Ecore 
				file, transform the contained classifier-names to upper-case and 
				serialize the resource back to a new file. The last examples uses 
				the life-cycle methods to print the execution time of the workflow.
			</p>
<div class="section" title="The Simplest Workflow">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="MWE2HelloWorld"></a>The Simplest Workflow</h3>
</div>
</div>
</div>
<p>The arguably shortest MWE2 module may look like the following 
					snippet.</p>
<div class="literallayout">
<p>
<code class="code">module&nbsp;HelloWorld&nbsp;<br>

<br>
SayHello&nbsp;{<br>
&nbsp;&nbsp;message&nbsp;=&nbsp;"Hello&nbsp;World!"<br>
}<br>

</code>
</p>
</div>
<p>It configures a very simple workflow component with a message 
					that should be printed to 
					<span class="emphasis"><em>System.out</em></span> when the workflow is 
					executed. The module begins with a declaration of its name. It must 
					fulfill the Java conventions for fully qualified class-names. That&rsquo;s 
					why the module 
					<span class="emphasis"><em>HelloWorld</em></span> has to be placed into the default 
					package of a Java source folder. The second element in the module is 
					the class-name 
					<span class="emphasis"><em>SayHello</em></span> which introduces the root element of the 
					module. The interpreter will create an instance of the given 
					type and configure it as declared between the curly braces. E.g. the 
					assignment 
					<span class="emphasis"><em>message = "Hello World!"</em></span> in the module will be 
					interpreted as an invocation of the 
					<span class="emphasis"><em>setMessage(String)</em></span> on the 
					instantiated object. As one can easily imagine, the implementation 
					of the class 
					<span class="emphasis"><em>SayHello</em></span> looks straight forward:
				</p>
<div class="literallayout">
<p>
<code class="code">import&nbsp;org.eclipse.emf.mwe2.runtime.workflow.IWorkflowComponent;<br>
import&nbsp;org.eclipse.emf.mwe2.runtime.workflow.IWorkflowContext;<br>

<br>
public&nbsp;class&nbsp;SayHello&nbsp;implements&nbsp;IWorkflowComponent&nbsp;{<br>

<br>
&nbsp;&nbsp;private&nbsp;String&nbsp;message&nbsp;=&nbsp;"Hello&nbsp;World!";<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;setMessage(String&nbsp;message)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;this.message&nbsp;=&nbsp;message;<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;public&nbsp;String&nbsp;getMessage()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;message;<br>
&nbsp;&nbsp;}<br>

<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;invoke(IWorkflowContext&nbsp;ctx)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(getMessage());<br>
&nbsp;&nbsp;}<br>

<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;postInvoke()&nbsp;{}<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;preInvoke()&nbsp;{}<br>
}<br>

</code>
</p>
</div>
<p>It looks like a simple POJO and that&rsquo;s the philosophy behind MWE2. 
					It is easily possible to assemble completely independent objects in 
					a declarative manner. To make the workflow executable with the 

					<span class="emphasis"><em>WorkflowRunner</em></span>, the component 
					<span class="emphasis"><em>SayHello</em></span> must be nested in a root 
					workflow:
				</p>
<div class="literallayout">
<p>
<code class="code">module&nbsp;HelloWorld&nbsp;<br>

<br>
Workflow&nbsp;{<br>
	component&nbsp;=&nbsp;SayHello&nbsp;{<br>
		message&nbsp;=&nbsp;"Hello&nbsp;World!"<br>
	}<br>
}<br>

</code>
</p>
</div>
<p>The class 
					<span class="emphasis"><em>Workflow</em></span> is actually 

					<span class="emphasis"><em>org.eclipse.emf.mwe2.runtime.workflow.Workflow</em></span> but its package is 
					implicitly imported in MWE2 modules to make the the modules more 
					concise. The execution result of this workflow will be revealed 
					after a quick 
					<span class="emphasis"><em>Run As .. -&gt; MWE2 Workflow</em></span> in the console as 
				</p>
<div class="literallayout">
<p>
<code class="code">Hello&nbsp;World!<br>

</code>
</p>
</div>
</div>
<div class="section" title="A Simple Transformation">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="MWE2SimpleTransformation"></a>A Simple Transformation</h3>
</div>
</div>
</div>
<p>The following workflow solves the exemplary task to rename every 
					<span class="emphasis"><em>EClassifier</em></span> in an 
					<span class="emphasis"><em>*.ecore</em></span> file.
					It consists of three components that read, modify and write the model file:
				</p>
<div class="literallayout">
<p>
<code class="code">module&nbsp;Renamer<br>
Workflow&nbsp;{<br>
&nbsp;&nbsp;component&nbsp;=&nbsp;ResourceReader&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uri&nbsp;=&nbsp;"model.ecore"<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;component&nbsp;=&nbsp;RenamingTransformer&nbsp;{}<br>
&nbsp;&nbsp;component&nbsp;=&nbsp;ResourceWriter&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uri&nbsp;=&nbsp;"uppercaseModel.ecore"<br>
&nbsp;&nbsp;}<br>
}<br>

</code>
</p>
</div>
<p>The implementation of these components is surprisingly simple. It is easily possible to create
					own components even for minor operations to automate a process.</p>
<p>The 
					<span class="emphasis"><em>ResourceReader</em></span> simply reads the file with the given 
					<span class="emphasis"><em>URI</em></span> and stores it in a so called

					<span class="emphasis"><em>slot</em></span> of the workflow context. A slot can be understood as a dictionary or map-entry.
				</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;ResourceReader&nbsp;extends&nbsp;WorkflowComponentWithSlot&nbsp;{<br>
&nbsp;&nbsp;private&nbsp;String&nbsp;uri;<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;invoke(IWorkflowContext&nbsp;ctx)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;ResourceSet&nbsp;resourceSet&nbsp;=&nbsp;new&nbsp;ResourceSetImpl();<br>
&nbsp;&nbsp;&nbsp;&nbsp;URI&nbsp;fileURI&nbsp;=&nbsp;URI.createFileURI(uri);&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Resource&nbsp;resource&nbsp;=&nbsp;resourceSet.getResource(fileURI,&nbsp;true);<br>
&nbsp;&nbsp;&nbsp;&nbsp;ctx.put(getSlot(),&nbsp;resource);<br>
&nbsp;&nbsp;}<br>
	
<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;setUri(String&nbsp;uri)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;this.uri&nbsp;=&nbsp;uri;<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;public&nbsp;String&nbsp;getUri()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;uri;<br>
&nbsp;&nbsp;}<br>
}<br>

</code>
</p>
</div>
<p>The actual transformer takes the model from the slot and modifies it. It simply iterates the content
					of the resource, identifies each 
					<span class="emphasis"><em>EClassifier</em></span> and sets its name. 
				</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;RenamingTransformer&nbsp;extends&nbsp;WorkflowComponentWithSlot&nbsp;{<br>
&nbsp;&nbsp;private&nbsp;boolean&nbsp;toLowerCase&nbsp;=&nbsp;false;<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;invoke(IWorkflowContext&nbsp;ctx)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;Resource&nbsp;resource&nbsp;=&nbsp;(Resource)&nbsp;ctx.get(getSlot());<br>
&nbsp;&nbsp;&nbsp;&nbsp;EcoreUtil.resolveAll(resource);<br>
&nbsp;&nbsp;&nbsp;&nbsp;Iterator&lt;Object&gt;&nbsp;contents&nbsp;=&nbsp;EcoreUtil.getAllContents(resource,&nbsp;true);<br>
&nbsp;&nbsp;&nbsp;&nbsp;Iterator&lt;EClassifier&gt;&nbsp;iter&nbsp;=&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Iterators.filter(contents,&nbsp;EClassifier.class);<br>
&nbsp;&nbsp;&nbsp;&nbsp;while(iter.hasNext())&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EClassifier&nbsp;classifier&nbsp;=&nbsp;(EClassifier)&nbsp;iter.next();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;classifier.setName(isToLowerCase()&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;?&nbsp;classifier.getName().toLowerCase()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;classifier.getName().toUpperCase());<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;}<br>

<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;setToLowerCase(boolean&nbsp;toLowerCase)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;this.toLowerCase&nbsp;=&nbsp;toLowerCase;<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;public&nbsp;boolean&nbsp;isToLowerCase()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;toLowerCase;<br>
&nbsp;&nbsp;}<br>
}<br>

</code>
</p>
</div>
<p>After the model has been modified it should be written to a new file. That&rsquo;s what the 

					<span class="emphasis"><em>ResourceWriter</em></span> does. It actually takes the resource from the given 
					<span class="emphasis"><em>slot</em></span> and saves it with
					the configured 
					<span class="emphasis"><em>URI</em></span>:
				</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;ResourceWriter&nbsp;extends&nbsp;WorkflowComponentWithSlot&nbsp;{<br>
&nbsp;&nbsp;private&nbsp;String&nbsp;uri;<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;invoke(IWorkflowContext&nbsp;ctx)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;Resource&nbsp;resource&nbsp;=&nbsp;(Resource)&nbsp;ctx.get(getSlot());<br>
&nbsp;&nbsp;&nbsp;&nbsp;URI&nbsp;uri&nbsp;=&nbsp;URI.createFileURI(getUri());<br>
&nbsp;&nbsp;&nbsp;&nbsp;uri&nbsp;=&nbsp;resource.getResourceSet().getURIConverter().normalize(uri);<br>
&nbsp;&nbsp;&nbsp;&nbsp;resource.setURI(uri);<br>
&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resource.save(null);<br>
&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(IOException&nbsp;e)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;WrappedException(e);<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;}<br>

<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;setUri(String&nbsp;uri)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;this.uri&nbsp;=&nbsp;uri;<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;public&nbsp;String&nbsp;getUri()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;uri;<br>
&nbsp;&nbsp;}<br>
}<br>

</code>
</p>
</div>
<p>Last but not least, the common super-type for those components looks like this:</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;abstract&nbsp;class&nbsp;WorkflowComponentWithSlot&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;implements&nbsp;IWorkflowComponent&nbsp;{<br>
&nbsp;&nbsp;private&nbsp;String&nbsp;slot&nbsp;=&nbsp;"model";<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;setSlot(String&nbsp;slot)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;this.slot&nbsp;=&nbsp;slot;<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;public&nbsp;String&nbsp;getSlot()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;slot;<br>
&nbsp;&nbsp;}<br>
	
<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;postInvoke()&nbsp;{}<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;preInvoke()&nbsp;{}<br>
}<br>

</code>
</p>
</div>
<p>Each of the mentioned implementations is rather simple and can be done in a couple of minutes. 
					This is true for many tedious tasks that developers face in their daily work. MWE2 can be used to
					automize these tasks with minimum effort.</p>
</div>
<div class="section" title="A Stopwatch">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="MWE2Stopwatch"></a>A Stopwatch</h3>
</div>
</div>
</div>
<p>The last example demonstrates how to combine the MWE2 concepts to create a simple stopwatch that
					allows to measure the execution time of a set of components. The idea is to add the very same stopwatch
					twice as a component to a workflow. It will measure the time from the first pre-invoke to the last
					post-invoke event and print the elapsed milliseconds to the console.</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;StopWatch&nbsp;implements&nbsp;IWorkflowComponent&nbsp;{<br>
&nbsp;&nbsp;private&nbsp;long&nbsp;start;<br>
&nbsp;&nbsp;private&nbsp;boolean&nbsp;shouldStop&nbsp;=&nbsp;false;<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;invoke(IWorkflowContext&nbsp;ctx)&nbsp;{}<br>

<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;postInvoke()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(shouldStop)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;long&nbsp;elapsed&nbsp;=&nbsp;System.currentTimeMillis()&nbsp;-&nbsp;start;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println("Time&nbsp;elapsed:&nbsp;"&nbsp;+&nbsp;elapsed&nbsp;+&nbsp;"&nbsp;ms");<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;shouldStop&nbsp;=&nbsp;true;<br>
&nbsp;&nbsp;}<br>

<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;preInvoke()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;start&nbsp;=&nbsp;System.currentTimeMillis();<br>
&nbsp;&nbsp;}<br>
}<br>

</code>
</p>
</div>
<p>Clients who want to leverage this kind of stopwatch may use the following pattern. The stopwatch-instance 
					will be added as the first component and the last component to a workflow. Everything in between will
					be measured. In this case, it is another workflow that does not need know about this decoration. The idea
					is to use a local identifier for the instantiated 
					<span class="emphasis"><em>StopWatch</em></span> and reuse this one at the end to receive
					the post-invoke life-cycle event twice. 
				</p>
<div class="literallayout">
<p>
<code class="code">module&nbsp;MeasuredWorkflow<br>

<br>
Workflow&nbsp;{<br>
&nbsp;&nbsp;component&nbsp;=&nbsp;StopWatch:&nbsp;stopWatch&nbsp;{}<br>
&nbsp;&nbsp;component&nbsp;=&nbsp;@OtherWorkflow&nbsp;{}<br>
&nbsp;&nbsp;component&nbsp;=&nbsp;stopWatch<br>
}<br>

<br>

</code>
</p>
</div>
</div>
</div>
<div class="section" title="Language Reference">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="MWE2LanguageReference"></a>Language Reference</h2>
</div>
</div>
</div>
<p>MWE2 has a few well defined concepts which can be combined to 
				assemble arbitrary object graphs in a compact and declarative 
				manner.</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>A MWE2 file defines a 
						<span class="emphasis"><em>module</em></span> which exposes its root 
						<span class="emphasis"><em>component</em></span> as reusable artifact.
					</p>
</li>
<li class="listitem">
<p>
						
<span class="emphasis"><em>Properties</em></span> can be used to extract reusable, configurable parts of the workflow.
					</p>
</li>
<li class="listitem">
<p>Components are mapped to plain vanilla 
						<span class="emphasis"><em>Java objects</em></span>. Arbitrary 
						<span class="emphasis"><em>set- and add-methods</em></span> are used to configure them.
					</p>
</li>
</ul>
</div>
<p>Let&rsquo;s consider the follow short example module and 
				<span class="emphasis"><em>SampleClass</em></span> to 
				explain these concepts.
			</p>
<div class="literallayout">
<p>
<code class="code">module&nbsp;com.mycompany.Example<br>

<br>
import&nbsp;java.util.*<br>

<br>
SampleClass&nbsp;{<br>
&nbsp;&nbsp;singleValue&nbsp;=&nbsp;'a&nbsp;string'<br>
&nbsp;&nbsp;multiValue&nbsp;=&nbsp;ArrayList&nbsp;{}<br>
&nbsp;&nbsp;child&nbsp;=&nbsp;{}<br>
}&nbsp;<br>

<br>

</code>
</p>
</div>
<div class="literallayout">
<p>
<code class="code">package&nbsp;com.mycompany;<br>

<br>
import&nbsp;java.util.List;<br>

<br>
public&nbsp;class&nbsp;SampleClass&nbsp;{<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;setSingleValue(String&nbsp;value)&nbsp;{..}<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;addMultiValue(List&lt;?&gt;&nbsp;value)&nbsp;{..}<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;addChild(SampleClass&nbsp;value)&nbsp;{..}<br>
}<br>

<br>

</code>
</p>
</div>
<div class="section" title="Mapping to Java Classes">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="MWE2JavaReferences"></a>Mapping to Java Classes</h3>
</div>
</div>
</div>
<p>The module 
					<span class="emphasis"><em>com.mycompany.Example</em></span> defines a root component of 
					type 
					<span class="emphasis"><em>com.mycompany.SampleClass</em></span>. It is possible to use the simple 
					class-name because MWE2 uses the very same visibility rules as the 
					Java compiler. Classes that are in the same package as the module 
					can be referenced by their simple name. The same rule applies for 
					classes from the 
					<span class="emphasis"><em>java.lang</em></span> package. For convenience reasons is the 
					package 
					<span class="emphasis"><em>org.eclipse.emf.mwe2.runtime.workflow</em></span> implicitly imported 
					as well as it exposes some library workflow components. However, the
					imports are more flexible then in Java since MWE2-imports can be relative, e.g. 
					the 
					<span class="emphasis"><em>import java.*</em></span> resolves the reference 
					<span class="emphasis"><em>util.ArrayList</em></span> to 

					<span class="emphasis"><em>java.util.ArrayList</em></span>.  
				</p>
<p>The root instance of type 
					<span class="emphasis"><em>SampleClass</em></span> has to be configured 
					after it has been created. Therefore the method 
					<span class="emphasis"><em>setSingleValue</em></span> 
					will be called at first. The given parameter is 

					<span class="emphasis"><em>'a string'</em></span>. The method is identified by its name which starts with 

					<span class="emphasis"><em>set</em></span>. To allow to assign multi-value properties, MWE provides 
					access to methods called 
					<span class="emphasis"><em>add*</em></span> as well. 
				</p>
<p>If the right side of the assignment in the workflow file does not 
					define a class explicitly, its type is inferred from the method 
					parameter. The line 
					<span class="emphasis"><em>child = {}</em></span> is equivalent to 

					<span class="emphasis"><em>child = SampleClass {}</em></span> and creates a new instance of 
					<span class="emphasis"><em>SampleClass</em></span>.
				</p>
<p>MWE2 ships with nice tool support. The editor will provide 
					content assist for the allowed types and highlight incompatible 
					assignments. The available properties for Java classes will be 
					proposed as well.</p>
</div>
<div class="section" title="Module">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="MWE2Module"></a>Module </h3>
</div>
</div>
</div>
<p>As MWE2 modules have a fully qualified name, it is possible to refer
					to them from other modules. The type of the module is derived from
					the type of its root component. The 
					<span class="emphasis"><em>com.mycompany.Example</em></span> can be
					assigned at any place where a 
					<span class="emphasis"><em>com.mycompany.SampleClass</em></span> is expected.
				</p>
<p>Let&rsquo;s create a second module 
					<span class="emphasis"><em>com.mycompany.Second</em></span> like this:
				</p>
<div class="literallayout">
<p>
<code class="code">module&nbsp;com.mycompany.sub.Second<br>

<br>
import&nbsp;com.mycompany.*<br>

<br>
SampleClass&nbsp;{<br>
&nbsp;&nbsp;child&nbsp;=&nbsp;@Example&nbsp;{}<br>
}&nbsp;<br>

</code>
</p>
</div>
<p>The 
					<span class="emphasis"><em>child</em></span> value will be assigned to an instance of 
					<span class="emphasis"><em>SampleClass</em></span> 
					that is configured as in the first example workflow. This enables
					nice composition and a very focused, reusable component design. 
				</p>
<p>As the same rules apply in MWE2 like in Java, the module 

					<span class="emphasis"><em>com.mycompany.sub.Second</em></span> has to be defined in a file called 

					<span class="emphasis"><em>Second.mwe2</em></span> in the package 
					<span class="emphasis"><em>com.mycompany.sub</em></span>. The import semantic
					for other modules is the same as for classes. The import statement
					allows to refer to 
					<span class="emphasis"><em>com.mycompany.Example</em></span> with a shortened name.
				</p>
</div>
<div class="section" title="Properties">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="MWE2Properties"></a>Properties</h3>
</div>
</div>
</div>
<p>MWE2 allows to extract arbitrary information into properties to 
					ensure that these pieces are not cluttered around the workflow and 
					to allow for easier external customization. The exemplary component 
					definition was only changed slightly by introducing a property 

					<span class="emphasis"><em>value</em></span>.
				</p>
<div class="literallayout">
<p>
<code class="code">module&nbsp;com.mycompany.Example<br>

<br>
var&nbsp;value&nbsp;=&nbsp;'a&nbsp;string'<br>

<br>
SampleClass&nbsp;{<br>
&nbsp;&nbsp;singleValue&nbsp;=&nbsp;value<br>
}<br>

</code>
</p>
</div>
<p>The type of the property will be derived from the default value 
					similar to the mechanism that is already known from 
					<span class="emphasis"><em>set</em></span>- and 

					<span class="emphasis"><em>add</em></span>-methods. If no default value is given, 
					<span class="emphasis"><em>java.lang.String</em></span> will
					be assumed. However, properties are not limited to strings. The 
					second built in type is boolean via the familiar literals 
					<span class="emphasis"><em>true</em></span> and

					<span class="emphasis"><em>false</em></span>. More flexibility is available via actual component literals.
				</p>
<div class="literallayout">
<p>
<code class="code">module&nbsp;com.mycompany.Example<br>

<br>
var&nbsp;childInstance&nbsp;=&nbsp;SampleClass&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;singleValue&nbsp;=&nbsp;"child"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>

<br>
SampleClass&nbsp;{<br>
&nbsp;&nbsp;child&nbsp;=&nbsp;childInstance<br>
}<br>

</code>
</p>
</div>
<p>If one wants to define string properties that are actual reusable
					parts for other properties, she may use defined variables inside other
					literals like this: </p>
<div class="literallayout">
<p>
<code class="code">var&nbsp;aString&nbsp;=&nbsp;"part"<br>
var&nbsp;anotherString&nbsp;=&nbsp;"reuse&nbsp;the&nbsp;${part}&nbsp;here"<br>

</code>
</p>
</div>
<p>This is especially useful for file paths in workflows as one would
					usually want to define some common root directories only ones in the
					workflow and reuse this fragment across certain other file locations.</p>
</div>
<div class="section" title="Mandatory Properties">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="MWE2Mandatory"></a>Mandatory Properties</h3>
</div>
</div>
</div>
<p>It is not always feasible to define default values for properties. 
					That is where mandatory properties come into play. Modules define their
					interface not only via their fully qualified name and the type of the
					root component but also by means of the defined properties.    </p>
<div class="literallayout">
<p>
<code class="code">module&nbsp;com.mycompany.Example<br>

<br>
var&nbsp;optional&nbsp;=&nbsp;'a&nbsp;string'<br>
var&nbsp;mandatory<br>

<br>
SampleClass&nbsp;{<br>
&nbsp;&nbsp;singleValue&nbsp;=&nbsp;optional<br>
&nbsp;&nbsp;child&nbsp;=&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;singleValue&nbsp;=&nbsp;mandatory<br>
&nbsp;&nbsp;}<br>
}<br>

</code>
</p>
</div>
<p>This version of the example module exposes two externally assignable
					properties. The second one has no default value assigned and is 
					thereby considered to be mandatory. The mandatory value must be assigned
					if we reuse 
					<span class="emphasis"><em>org.mycompany.Example</em></span> in another module like this:
				</p>
<div class="literallayout">
<p>
<code class="code">module&nbsp;com.mycompany.Second<br>

<br>
var&nbsp;newMandatory<br>

<br>
@Example&nbsp;{<br>
&nbsp;&nbsp;mandatory&nbsp;=&nbsp;"mandatoryValue"<br>
&nbsp;&nbsp;optional&nbsp;=&nbsp;newMandatory<br>
}&nbsp;<br>

</code>
</p>
</div>
<p>Note that it is even possible to reuse another module as the root
					component of a new module. In this case we set the mandatory 
					property of 
					<span class="emphasis"><em>Example</em></span> to a specific constant value while the previously
					optional value is now redefined as mandatory by means of a new property
					without a default value.
				</p>
<p>It is not only possible to define mandatory properties for MWE2 
					modules but for classes as well. Therefore MWE2 ships with the 

					<span class="emphasis"><em>@Mandatory</em></span> annotation. If a 
					<span class="emphasis"><em>set</em></span>- or 
					<span class="emphasis"><em>add</em></span>-method is marked as

					<span class="emphasis"><em>mandatory</em></span>, the module validation will fail if no value was assigned
					to that feature.
				</p>
</div>
<div class="section" title="Named Components">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="MWE2NamedComponents"></a>Named Components</h3>
</div>
</div>
</div>
<p>Properties are not the only way to define something that can be reused.
					It is possible to assign a name to any instantiated component whether it&rsquo;s
					created from a class literal or from another component. This allows
					to refer to previously created and configured instances. Named instances
					can come handy for notification and call-back mechanisms or more general
					in terms of defined life-cycle events. </p>
<p>If we wanted to assign the created instance to a property of itself,
					we could use the following syntax:</p>
<div class="literallayout">
<p>
<code class="code">module&nbsp;com.mycompany.Example<br>

<br>
SampleClass&nbsp;:&nbsp;self&nbsp;{<br>
&nbsp;&nbsp;child&nbsp;=&nbsp;self<br>
}<br>

</code>
</p>
</div>
<p>A named component can be referenced immediately after its creation but
					it is not possible to define forward references in a MWE2 file.</p>
</div>
<div class="section" title="Auto Injection">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="MWE2AutoInject"></a>Auto Injection</h3>
</div>
</div>
</div>
<p>Existing modules or classes often expose a set of properties that 
					will be assigned to features of its root component or set- and add- 
					methods respectively. In many cases its quite hard to come up with 
					yet another name for the very same concept which leads to the situation
					where the properties itself have the very same name as the component&rsquo;s
					feature. To avoid the overall repetition of assignments, MWE2 offers
					the possibility to use the 
					<span class="emphasis"><em>auto-inject</em></span> modifier on the component 
					literal:
				</p>
<div class="literallayout">
<p>
<code class="code">module&nbsp;com.mycompany.Example<br>

<br>
var&nbsp;child&nbsp;=&nbsp;SampleClass&nbsp;{}<br>

<br>
SampleClass&nbsp;auto-inject&nbsp;{<br>
}<br>

</code>
</p>
</div>
<p>This example will implicitly assign the value of the property

					<span class="emphasis"><em>child</em></span> to the feature 
					<span class="emphasis"><em>child</em></span> of the root component. This is especially
					useful for highly configurable workflows that expose dozens of optional
					parameters each of which can be assigned to one or more components.
				</p>
<p>The 
					<span class="emphasis"><em>auto-inject</em></span> modifier can be used for a subset of the available
					features as well. It will suppressed for the explicitly set values
					of a component.        
				</p>
</div>
</div>
<div class="section" title="Syntax Reference">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="MWE2SyntaxReference"></a>Syntax Reference</h2>
</div>
</div>
</div>
<p>The following chapter serves as a reference for the concrete syntax of 
				MWE2. The building blocks of a module will be described in a few words.</p>
<p>MWE2 is not sensitive to white-space and allows to define line-comments
				and block comments everywhere. The syntax is the same as one is used 
				to from the Java language:</p>
<div class="literallayout">
<p>
<code class="code">//&nbsp;This&nbsp;is&nbsp;a&nbsp;comment<br>
/*&nbsp;<br>
&nbsp;&nbsp;This&nbsp;is&nbsp;another&nbsp;one.<br>
*/<br>

</code>
</p>
</div>
<p>Every name in MWE2 can be a fully qualified identifier and must follow 
				the Java conventions. However, in contrast to Java identifiers it is 
				not allowed to use German umlauts or Unicode escape sequences in 
				identifiers. A valid ID-segment in MWE2 starts with a letter or an 
				underscore and is followed by any number of letters, numbers or underscores.
				An identifier is composed from one or more segments which are delimited
				by a &sbquo;.&rsquo; dot.</p>
<div class="literallayout">
<p>
<code class="code">Name:&nbsp;ID&nbsp;('.'&nbsp;ID)*;<br>
ID:&nbsp;('a'..'z'|'A'..'Z'|'_')&nbsp;('a'..'z'|'A'..'Z'|'_'|'0'..'9')*;&nbsp;<br>

</code>
</p>
</div>
<p>MWE2 does not use a semicolon as statement delimiter at any place.</p>
<div class="section" title="Module">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="MWE2ModuleSyntax"></a>Module</h3>
</div>
</div>
</div>
<p>
					
</p>
<div class="mediaobject">
<img src="images/mwe2/module.png"></div>
<p>
				
</p>
<p>A 
					<span class="emphasis"><em>module</em></span> consists of four parts. The very first statement in a 

					<span class="emphasis"><em>*.mwe2</em></span> file is the module declaration. The name of the module must 
					follow the naming convention for Java classes. That MWE2 file&rsquo;s name 
					must therefore be the same as the last segment of the module-name 
					and it has to be placed in the appropriate package of a Java source 
					path.
				</p>
<p>It is allowed to define any number of import statements in a module.
					Imports are either suffixed by a wild-card or concrete for a class 
					or module. MWE2 can handle relative imports in case one uses the 
					wild-card notation:</p>
<div class="literallayout">
<p>
<code class="code">'import'&nbsp;name&nbsp;'.*'?&nbsp;&nbsp;&nbsp;<br>

<br>

</code>
</p>
</div>
</div>
<div class="section" title="Property">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="MWE2PropertySyntax"></a>Property</h3>
</div>
</div>
</div>
<p>The list of declared properties follows the optional import section.
					It is allowed to define modules without any properties. </p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/mwe2/property.png"></div>
<p>
				
</p>
<p>Each declared property is locally visible in the module. It 
					furthermore defines an assignable feature of the module in case one 
					refers to it from another module. Properties may either have a 
					default value or they are considered to be mandatory. If the type
					of property is omitted it will be inferred from the default value. The
					default type of a property is 
					<span class="emphasis"><em>java.lang.String</em></span> so if no default
					value is available, the property is mandatory and of type 
					<span class="emphasis"><em>String</em></span>.
				</p>
<p>There are four types of values available in MWE2. One may either
					define a string, boolean or component literal or a reference to a
					previously defined property. </p>
</div>
<div class="section" title="Component">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="MWE2ComponentSyntax"></a>Component</h3>
</div>
</div>
</div>
<p>The last part of a module is the root component. It defines the externally
					visible type of the module and may either be created from a Java 
					type or from another module.</p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/mwe2/component.png"></div>
<p>
				
</p>
<p>The type of the component can be derived in many cases except for 
					the root component. That&rsquo;s why it&rsquo;s optional in the component literal.
					If no type is given, it will be inferred from the left side of the
					assignment. The assigned feature can either be a declared property
					of the module or a 
					<span class="emphasis"><em>set</em></span>- or 
					<span class="emphasis"><em>add</em></span>-method of a Java class.
				</p>
<p>Components can be named to make them referable in subsequent assignments.
					Following the 
					<span class="emphasis"><em>':'</em></span> keyword, one can define an identifier for the 
					instantiated component. The identifier is locally visible in the module
					and any assignment that is defined after the named component can refer
					to this identifier and thereby point to exactly the instantiated object.
				</p>
<p>The next option for a component is 
					<span class="emphasis"><em>auto-inject</em></span>. If this modifier
					is set on a component, any available feature of the component that has
					the same name as a property or previously created named component will
					be automatically assigned.
				</p>
<p>The core of a component is the list of assignments between the curly 
					braces. An arbitrary number of values can be set on the component by
					means of feature-to-value pairs. </p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/mwe2/assignment.png"></div>
<p> 
				
</p>
<p>The available constructs on the right hand side of the assignment
					are the same as for default values for properties. </p>
</div>
<div class="section" title="String Literals">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="MWE2StringLiteralsSyntax"></a>String Literals</h3>
</div>
</div>
</div>
<p>String values are likely to be the most used literals in MWE2. There 
					is a convenient syntax for string concatenation available due to
					the high relevance in a description object composition and configuration 
					language. MWE2 strings are multi-line strings and can be composed of
					several parts.</p>
<div class="literallayout">
<p>
<code class="code">var&nbsp;aString&nbsp;=&nbsp;'a&nbsp;value'<br>
var&nbsp;anotherString&nbsp;=&nbsp;'It&nbsp;is&nbsp;possible&nbsp;to&nbsp;embed&nbsp;${aString}&nbsp;into<br>
&nbsp;a&nbsp;multi-line&nbsp;string'<br>

</code>
</p>
</div>
<p>This is especially convenient for path-substitution if one defines
					e.g. a common root directory and wants to specify other paths relative
					to the base. </p>
<p>There are two different delimiters available for strings. Users 
					are free to either use single- or double-quotes to start and end strings. 
					If a certain string contains a lot of single-quotes one would better
					choose double-quotes as delimiter and vice versa. There is no semantic 
					difference between both notations.</p>
<p>The escape character in MWE2 is the back-slash 
					<span class="emphasis"><em>"\"</em></span>. It can be used
					to write line-breaks or tabular characters explicitly and to escape
					the beginning of substitution variables 
					<span class="emphasis"><em>${</em></span> and the quotes itself. Allowed
					escape sequences are:
				</p>
<div class="literallayout">
<p>
<code class="code">\n&nbsp;&nbsp;..&nbsp;line&nbsp;break<br>
\r&nbsp;&nbsp;..&nbsp;carriage&nbsp;return<br>
\t&nbsp;&nbsp;..&nbsp;tabular&nbsp;character<br>
\'&nbsp;&nbsp;..&nbsp;single-quote&nbsp;(can&nbsp;be&nbsp;omitted&nbsp;in&nbsp;double-quoted&nbsp;strings)<br>
\"&nbsp;&nbsp;..&nbsp;double-quote&nbsp;(can&nbsp;be&nbsp;omitted&nbsp;in&nbsp;single-quoted&nbsp;strings)<br>
\${&nbsp;..&nbsp;escape&nbsp;the&nbsp;substitution&nbsp;variable&nbsp;start&nbsp;${<br>
\\&nbsp;&nbsp;..&nbsp;the&nbsp;back-slash&nbsp;itself<br>

</code>
</p>
</div>
<p>Other escape sequence are illegal in MWE2 strings.</p>
</div>
<div class="section" title="Boolean Literals">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="MWE2BooleanLiterals"></a>Boolean Literals</h3>
</div>
</div>
</div>
<p>MWE2 has native support for the boolean type. The literals are 
					<span class="emphasis"><em>true</em></span> and 
					<span class="emphasis"><em>false</em></span>.
				</p>
</div>
<div class="section" title="References">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="MWE2References"></a>References</h3>
</div>
</div>
</div>
<p>Each assigned value in MWE2 either as default for properties or in a
					component assignment can be a reference to a previously declared property
					or named component. The can be referenced intuitively by their name.</p>
</div>
</div>
</div>
<div class="chapter" title="Chapter&nbsp;7.&nbsp;IDE Concepts">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="ide_concepts"></a>Chapter&nbsp;7.&nbsp;IDE Concepts</h2>
</div>
</div>
</div>
<p>For the following part we will refer to a concrete example grammar in order to explain certain aspect 
			of the UI more clearly. The used example grammar is as follows:</p>
<div class="literallayout">
<p>
<code class="code">grammar&nbsp;org.eclipse.text.documentation.Sample&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;org.eclipse.xtext.common.Terminals<br>

<br>
generate&nbsp;gen&nbsp;'http://www.eclipse.org/xtext/documentation/Sample'<br>

<br>
Model&nbsp;:<br>
&nbsp;&nbsp;"model"&nbsp;intAttribute=INT&nbsp;(stringDescription=STRING)?&nbsp;"{"&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rules&nbsp;+=&nbsp;AbstractRule)*&nbsp;<br>
&nbsp;&nbsp;"}"&nbsp;<br>
;<br>

<br>
AbstractRule:<br>
&nbsp;&nbsp;RuleA&nbsp;|&nbsp;RuleB<br>
;<br>

<br>
RuleA&nbsp;:<br>
&nbsp;&nbsp;&nbsp;"RuleA"&nbsp;"("&nbsp;name&nbsp;=&nbsp;ID&nbsp;")"&nbsp;;<br>

<br>
RuleB&nbsp;return&nbsp;gen::CustomType:<br>
&nbsp;&nbsp;&nbsp;"RuleB"&nbsp;"("&nbsp;ruleA&nbsp;=&nbsp;[RuleA]&nbsp;")"&nbsp;;<br>

<br>

</code>
</p>
</div>
<p></p>
<div class="section" title="Label Provider">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="labelProvider"></a>Label Provider</h2>
</div>
</div>
</div>
<p>There are various places in the UI in which model elements have to be presented to the user: In the 

				<a class="link" href="#outline" title="Outline View">outline view</a>, in 
				<a class="link" href="#hyperlinking" title="Hyperlinking">hyper links</a>, in 
				<a class="link" href="#contentAssist" title="Content Assist">content proposals</a>, 
				find dialogs etc. Xtext allows to customize each of these appearances by individual 
				<span class="emphasis"><em>ILabelProviders</em></span>. 
			</p>
<p>An 
				<span class="emphasis"><em>ILabelProvider</em></span> has two methods: 
				<span class="emphasis"><em>getText(Object)</em></span> returns the text in an object&rsquo;s label, 
				while 
				<span class="emphasis"><em>getImage(Object)</em></span> returns the icon. In addition, the Eclipse UI framework offers the 

				<span class="emphasis"><em>IStyledLabelProvider</em></span>, which returns a styled string (i.e. with custom fonts, colors etc.) in the 

				<span class="emphasis"><em>getStyledText(Object)</em></span> method. 
			</p>
<p>Almost all label providers in the Xtext framework inherit from the base class 

				<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui/src/org/eclipse/xtext/ui/label/AbstractLabelProvider.java?root=Modeling_Project&view=co" target="_new">AbstractLabelProvider</a> which unifies both 
				approaches. Subclasses can either return a styled string or a string in the 
				<span class="emphasis"><em>doGetText(Object)</em></span> method. 
				The framework will automatically convert it to a styled text (with default styles) or to a plain text 
				in the respective methods. 
			</p>
<p>Dealing with images can be cumbersome, too, as image handles tend to be scarce system resources. 
				The 
				<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui/src/org/eclipse/xtext/ui/label/AbstractLabelProvider.java?root=Modeling_Project&view=co" target="_new">AbstractLabelProvider</a> helps you managing 
				the images: In your implementation of 
				<span class="emphasis"><em>doGetImage(Object)</em></span> you can as well return an 
				<span class="emphasis"><em>Image</em></span> or a string, 
				representing a path in the 
				<span class="emphasis"><em>icons/</em></span> folder of the containing plug-in. This path is actually 
				configurable by Google Guice. Have a look at the 

				<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui/src/org/eclipse/xtext/ui/PluginImageHelper.java?root=Modeling_Project&view=co" target="_new">PluginImageHelper</a> to learn about the 
				customizing possibilities.
			</p>
<p>If you have the 

				<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/ui/generator/labeling/LabelProviderFragment.java?root=Modeling_Project&view=co" target="_new">LabelProviderFragment</a> in the 
				list of generator fragments in the MWE2 workflow for your language, it will automatically create 
				stubs and bindings for an 
				<a class="link" href="#EObjectLabelProvider" title="Label Providers For EObjects">
					<span class="emphasis"><em>EObjectLabelProvider</em></span>
				</a> and an 

				<a class="link" href="#DescriptionLabelProvider" title="Label Providers For Index Entries">
					<span class="emphasis"><em>DescriptionLabelProvider</em></span>
				</a> which you can implement by manually. 
			</p>
<div class="section" title="Label Providers For EObjects">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="EObjectLabelProvider"></a>Label Providers For EObjects</h3>
</div>
</div>
</div>
<p>The first set of label providers refers to actually loaded and thereby available model elements. 
					By default, Xtext binds the 
					<span class="emphasis"><em>DefaultEObjectLabelProvider</em></span> to all use cases, but you can change the 
					binding individually for the Outline, Content Assist or other places. For that purpose, there is a 
					so called 
					<span class="emphasis"><em>binding annotation</em></span> for each use case. For example, to use a custom 

					<span class="emphasis"><em>MyContentAssistLabelProvider</em></span> to display elements in the content assist, you have to override
				</p>
<div class="literallayout">
<p>
<code class="code">@Override<br>
public&nbsp;void&nbsp;configureContentProposalLabelProvider(Binder&nbsp;binder)&nbsp;{<br>
&nbsp;&nbsp;binder.bind(ILabelProvider.class)<br>
&nbsp;&nbsp;&nbsp;&nbsp;.annotatedWith(ContentProposalLabelProvider.class)<br>
&nbsp;&nbsp;&nbsp;&nbsp;.to(MyContentAssistLabelProvider.class);<br>
}<br>

<br>
p.in&nbsp;your&nbsp;language's&nbsp;UI&nbsp;module.&nbsp;<br>

<br>

</code>
</p>
</div>
<p>If your grammar uses an imported 
					<span class="emphasis"><em>EPackage</em></span>, there may be an existing 
					<span class="emphasis"><em>.edit</em></span> plug-in generated 
					by EMF that also provides label providers for model elements. To use this as a fallback, your label 
					provider should call the constructor with the 
					delegate parameter and use DI for the initialization, e.g.
				</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;MyLabelProvider&nbsp;{<br>
	@Inject	<br>
	public&nbsp;MyLabelProvider(AdapterFactoryLabelProvider&nbsp;delegate)&nbsp;{<br>
		super(delegate);<br>
	}<br>
	...<br>
}&nbsp;&nbsp;<br>

<br>

</code>
</p>
</div>
<div class="section" title="DefaultEObjectLabelProvider">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="DefaultEObjectLabelProvider"></a>DefaultEObjectLabelProvider</h4>
</div>
</div>
</div>
<p>The default implementation of the 
						<span class="emphasis"><em>LabelProvider</em></span> interface utilizes the polymorphic dispatcher idiom 
						to implement an external visitor as the requirements of the LabelProvider are kind of a best match for 
						this pattern. It comes down to the fact that the only thing you need to do is to implement a method 
						that matches a specific signature. It either provides a image filename or the text to be used to 
						represent your model element. Have a look at following example to get a more detailed idea about 
						the 
						<span class="emphasis"><em>DefaultEObjectLabelProvider</em></span>.
					</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;SampleLabelProvider&nbsp;extends&nbsp;DefaultLabelProvider&nbsp;{<br>

<br>
&nbsp;&nbsp;String&nbsp;text(RuleA&nbsp;rule)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;"Rule:&nbsp;"&nbsp;+&nbsp;rule.getName();<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;String&nbsp;image(RuleA&nbsp;rule)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;"ruleA.gif";<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;String&nbsp;image(RuleB&nbsp;rule)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;"ruleB.gif";<br>
&nbsp;&nbsp;}<br>
}<br>
	
<br>

</code>
</p>
</div>
<p>What is especially nice about the default implementation is the actual reason for its class 
						name: It provides very reasonable defaults. To compute the label for a certain model element, it will 
						at first have a look for an EAttribute 
						<span class="emphasis"><em>name</em></span> and try to use this one. If it cannot find such a feature, 
						it will try to use the first feature, that can be used best as a label. At worst it will return the 
						class name of the model element, which is kind of unlikely to happen.
					</p>
<p>You can a also customize error handling by overriding the methods 
						<span class="emphasis"><em>handleTextError()</em></span> or 

						<span class="emphasis"><em>handleImageError()</em></span>.
					</p>
</div>
</div>
<div class="section" title="Label Providers For Index Entries">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="DescriptionLabelProvider"></a>Label Providers For Index Entries</h3>
</div>
</div>
</div>
<p>Xtext maintains an index of all model elements to allow quick searching and linking without loading 
					the referenced resource (See the chapter on 
					<a class="link" href="#index_based" title="Global Scopes Based On External Configuration (e.g. Classpath-Based)">index-based scopes</a> for details). The 
					elements from this index also appear in some UI contexts, e.g. in the 
					<span class="emphasis"><em>Find model elements</em></span> dialog or 
					in the 
					<span class="emphasis"><em>Find references</em></span> view. For reasons of scalability, the UI should not automatically load 
					resources, so we need another implementation of a label provider that works with the elements from the 
					index, i.e. 
					<span class="emphasis"><em>IResourceDescription</em></span>, 
					<span class="emphasis"><em>IEObjectDescription</em></span>, and 
					<span class="emphasis"><em>IReferenceDescription</em></span>.
				</p>
<p>The default implementation of this service is the 

					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui/src/org/eclipse/xtext/ui/label/DefaultDescriptionLabelProvider.java?root=Modeling_Project&view=co" target="_new">DefaultDescriptionLabelProvider</a>. It employs the 
					same polymorphic dispatch mechanism as the 
					<a class="link" href="#DefaultEObjectLabelProvider" title="DefaultEObjectLabelProvider">DefaultEObjectLabelProvider</a>. 
					The default text of an 
					<span class="emphasis"><em>EObjectDescription</em></span> is its indexed name. The image is resolved by dispatching 
					to 
					<span class="emphasis"><em>image(EClass)</em></span> with the 
					<span class="emphasis"><em>EClass</em></span> of the described object. This is likely the only method you want 
					to override. 
					<span class="emphasis"><em>IResourceDescriptions</em></span> will be represented with their path and the icon registered for 
					your language&rsquo;s editor. 
				</p>
<p>To have a custom description label provider, make sure it is bound in your UI module:</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;void&nbsp;configureResourceUIServiceLabelProvider(Binder&nbsp;binder)&nbsp;{<br>
&nbsp;&nbsp;binder.bind(ILabelProvider.class)<br>
&nbsp;&nbsp;&nbsp;&nbsp;.annotatedWith(ResourceServiceDescriptionLabelProvider.class)<br>
&nbsp;&nbsp;&nbsp;&nbsp;.to(MyCustomDefaultDescriptionLabelProvider.class);<br>
}<br>

</code>
</p>
</div>
</div>
</div>
<div class="section" title="Content Assist">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="contentAssist"></a>Content Assist</h2>
</div>
</div>
</div>
<p>The Xtext generator, amongst other things, generates the following two content assist (CA) related artifacts:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>an abstract proposal provider class named 
						<span class="emphasis"><em>Abstract[Language]ProposalProvider</em></span> generated into the 
						<span class="emphasis"><em>src-gen</em></span> folder within the 
						<span class="emphasis"><em>ui</em></span> project
					</p>
</li>
<li class="listitem">
<p>a concrete sub-class in the 
						<span class="emphasis"><em>src</em></span>-folder of the 
						<span class="emphasis"><em>ui</em></span> project called 
						<span class="emphasis"><em>ProposalProvider</em></span>
					
</p>
</li>
</ul>
</div>
<p>First we will investigate the generated 
				<span class="emphasis"><em>Abstract[Language]ProposalProvider</em></span> with methods that look like this:
			</p>
<div class="section" title="ProposalProvider">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="ProposalProvider"></a>ProposalProvider</h3>
</div>
</div>
</div>
<div class="literallayout">
<p>
<code class="code">public&nbsp;void&nbsp;complete[TypeName]_[FeatureName](<br>
&nbsp;&nbsp;EObject&nbsp;model,&nbsp;<br>
&nbsp;&nbsp;Assignment&nbsp;assignment,&nbsp;<br>
&nbsp;&nbsp;ContentAssistContext&nbsp;context,&nbsp;<br>
&nbsp;&nbsp;ICompletionProposalAcceptor&nbsp;acceptor)&nbsp;{<br>
&nbsp;&nbsp;//&nbsp;clients&nbsp;may&nbsp;override<br>
}<br>

<br>
public&nbsp;void&nbsp;complete_[RuleName](<br>
&nbsp;&nbsp;EObject&nbsp;model,&nbsp;<br>
&nbsp;&nbsp;RuleCall&nbsp;ruleCall,&nbsp;<br>
&nbsp;&nbsp;ContentAssistContext&nbsp;context,&nbsp;<br>
&nbsp;&nbsp;ICompletionProposalAcceptor&nbsp;acceptor)&nbsp;{<br>
&nbsp;&nbsp;//&nbsp;clients&nbsp;may&nbsp;override<br>
}<br>

<br>

</code>
</p>
</div>
<p>The snippet above indicates that the generated ProposalProvider class contains a 
					<span class="emphasis"><em>complete*</em></span>-method 
					for each assigned feature in the grammar and for each rule. The brackets are place-holders that should 
					give a clue about the naming scheme used to create the various entry points for clients. The generated 
					proposal provider falls back to some default behavior for cross-references and keywords. Furthermore 
					it inherits the logic that was introduced in reused grammars. 
				</p>
<p>Clients who want to customize the behavior may override the methods from the 

					<span class="emphasis"><em>AbstractProposalProvider</em></span> or introduce new methods with a specialized first parameter. The framework 
					dispatches method calls according to the current context to the most concrete implementation, that 
					can be found.
				</p>
<p>It is important to know, that for a given offset in a model file, many possible grammar elements exist. 
					The framework dispatches to the method declarations for any valid element. That means, that a bunch 
					of 
					<span class="emphasis"><em>complete*</em></span> methods may be called.
				</p>
</div>
<div class="section" title="Sample Implementation">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="SampleImplementation"></a>Sample Implementation</h3>
</div>
</div>
</div>
<p>To provide a dummy proposal for the description of a model object, you may introduce a specialization 
					of the generated method and implement it as follows. This will give &sbquo;Description for model #7&rsquo; for a 
					model with the intAttribute '7'</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;void&nbsp;completeModel_StringDescription&nbsp;(<br>
&nbsp;&nbsp;Model&nbsp;model,&nbsp;<br>
&nbsp;&nbsp;Assignment&nbsp;assignment,&nbsp;<br>
&nbsp;&nbsp;ContentAssistContext&nbsp;context,&nbsp;<br>
&nbsp;&nbsp;ICompletionProposalAcceptor&nbsp;acceptor)&nbsp;{<br>
&nbsp;&nbsp;//&nbsp;call&nbsp;implementation&nbsp;in&nbsp;superclass<br>
&nbsp;&nbsp;super.completeModel_StringDescription(<br>
&nbsp;&nbsp;&nbsp;&nbsp;model,&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;assignment,&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;context,&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;acceptor);<br>

<br>
&nbsp;&nbsp;//&nbsp;compute&nbsp;the&nbsp;plain&nbsp;proposal<br>
&nbsp;&nbsp;String&nbsp;proposal&nbsp;=&nbsp;"Description&nbsp;for&nbsp;model&nbsp;#"&nbsp;+&nbsp;model.getIntAttribute();<br>

<br>
&nbsp;&nbsp;//&nbsp;convert&nbsp;it&nbsp;to&nbsp;a&nbsp;valid&nbsp;STRING-terminal<br>
&nbsp;&nbsp;proposal&nbsp;=&nbsp;getValueConverter().toString(proposal,&nbsp;"STRING");<br>

<br>
&nbsp;&nbsp;//&nbsp;create&nbsp;the&nbsp;completion&nbsp;proposal<br>
&nbsp;&nbsp;//&nbsp;the&nbsp;result&nbsp;may&nbsp;be&nbsp;null&nbsp;as&nbsp;the&nbsp;createCompletionProposal(..)&nbsp;methods&nbsp;<br>
&nbsp;&nbsp;//&nbsp;check&nbsp;for&nbsp;valid&nbsp;prefixes<br>
&nbsp;&nbsp;//&nbsp;and&nbsp;terminal&nbsp;token&nbsp;conflicts<br>
&nbsp;&nbsp;ICompletionProposal&nbsp;completionProposal&nbsp;=&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;createCompletionProposal(proposal,&nbsp;context);<br>

<br>
&nbsp;&nbsp;//&nbsp;register&nbsp;the&nbsp;proposal,&nbsp;the&nbsp;acceptor&nbsp;handles&nbsp;null-values&nbsp;gracefully<br>
&nbsp;&nbsp;acceptor.accept(completionProposal);<br>
}<br>

<br>

</code>
</p>
</div>
</div>
</div>
<div class="section" title="Quick Fixes">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="quickfixes"></a>Quick Fixes</h2>
</div>
</div>
</div>
<p>For validations written using the 
				<a class="link" href="#custom_validation" title="Custom Validation">AbstractDeclarativeValidator</a> 
				it is possible to provide corresponding quick fixes in the editor. To be able to implement a quick fix 
				for a given diagnostic (a warning or error) the underlying 
				<span class="emphasis"><em>cause</em></span> of the diagnostic must be known 
				(i.e. what actual problem does the diagnostic represent?), otherwise the fix doesn&rsquo;t know what needs 
				to be done. As we don&rsquo;t want to deduce this from the diagnostic&rsquo;s error message we associate a problem 
				specific 
				<span class="emphasis"><em>code</em></span> with the diagnostic.
			</p>
<p>In the following example taken from the 
				<span class="emphasis"><em>DomainmodelJavaValidator</em></span> 
				the diagnostic&rsquo;s 
				<span class="emphasis"><em>code</em></span> is given by the third argument to the 
				<span class="emphasis"><em>warning()</em></span> method and it is a reference 
				to the static 
				<span class="emphasis"><em>String</em></span> field _==INVALID_TYPE_NAME==_ in the validator class.
			</p>
<div class="literallayout">
<p>
<code class="code">warning("Name&nbsp;should&nbsp;start&nbsp;with&nbsp;a&nbsp;capital",&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;DomainmodelPackage.TYPE__NAME,&nbsp;INVALID_TYPE_NAME,&nbsp;type.getName());<br>

<br>

</code>
</p>
</div>
<p>Now that the validation has a unique code identifying the problem we can register quick fixes for it. 
				We start by adding the 

				<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/ui/generator/quickfix/QuickfixProviderFragment.java?root=Modeling_Project&view=co" target="_new">QuickfixProviderFragment</a> 
				to our workflow and after regenerating the code we should find an empty class 
				<span class="emphasis"><em>MyDslQuickfixProvider</em></span> 
				in our DSL&rsquo;s UI project and new entries in the _==plugin.xml_gen==_ file.
			</p>
<p>Continuing with the _==INVALID_TYPE_NAME==_ problem from the Domainmodel example we add a method with which 
				the problem can be fixed (have a look at the 
				<span class="emphasis"><em>DomainmodelQuickfixProvider</em></span> for details):
			</p>
<div class="literallayout">
<p>
<code class="code">@Fix(DomainmodelJavaValidator.INVALID_TYPE_NAME)<br>
public&nbsp;void&nbsp;fixName(final&nbsp;Issue&nbsp;issue,&nbsp;IssueResolutionAcceptor&nbsp;acceptor)&nbsp;{<br>
&nbsp;&nbsp;acceptor.accept(issue,&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;"Capitalize&nbsp;name",&nbsp;//&nbsp;quick&nbsp;fix&nbsp;label<br>
&nbsp;&nbsp;&nbsp;&nbsp;"Capitalize&nbsp;name&nbsp;&nbsp;of&nbsp;'"&nbsp;+&nbsp;issue.getData()[0]&nbsp;+&nbsp;"'",&nbsp;&nbsp;//&nbsp;description&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;"upcase.png",&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;quick&nbsp;fix&nbsp;icon<br>
&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;IModification()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;apply(IModificationContext&nbsp;context)&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throws&nbsp;BadLocationException&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IXtextDocument&nbsp;xtextDocument&nbsp;=&nbsp;context.getXtextDocument();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;firstLetter&nbsp;=&nbsp;xtextDocument.get(issue.getOffset(),&nbsp;1);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xtextDocument.replace(issue.getOffset(),&nbsp;1,&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Strings.toFirstUpper(firstLetter));<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;);<br>
}<br>

<br>

</code>
</p>
</div>
<p>By using the correct signature (see below) and annotating the method with the 
				<span class="emphasis"><em>@Fix</em></span> annotation 
				referencing the previously specified issue code from the validator, Xtext knows that this method 
				implements a fix for the problem. This also allows us to annotate multiple methods as fixes for the 
				same problem.
			</p>
<p>The first three parameters given to the 

				<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui/src/org/eclipse/xtext/ui/editor/quickfix/IssueResolutionAcceptor.java?root=Modeling_Project&view=co" target="_new">IssueResolutionAcceptor</a> define the 
				UI representation of the quick fix. As the document is not necessarily loaded when the quick fix is 
				offered, we need to provide any additional data from the model that we want to refer to in the UI 
				when creating the issue in the validator above. In this case, we provided the existing type name. 
				The additional data is available as 
				<span class="emphasis"><em>Issue.getData()</em></span>. As it is persisted in markers, only strings 
				are allowed. 
			</p>
<p>The actual model modification is implemented in the 

				<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui/src/org/eclipse/xtext/ui/editor/model/edit/IModification.java?root=Modeling_Project&view=co" target="_new">IModification</a>. 
				The 
				<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui/src/org/eclipse/xtext/ui/editor/model/edit/IModificationContext.java?root=Modeling_Project&view=co" target="_new">IModificationContext</a> provides 
				access to the erroneous document. In this case, we&rsquo;re using Eclipse&rsquo;s 
				<span class="emphasis"><em>IDocument</em></span> API to replace a 
				text region.    
			</p>
<p>If you prefer to implement the quick fix in terms of the semantic model use a 

				<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui/src/org/eclipse/xtext/ui/editor/model/edit/ISemanticModification.java?root=Modeling_Project&view=co" target="_new">ISemanticModification</a> instead. 
				Its 
				<span class="emphasis"><em>apply(EObject, IModificationContext)</em></span> method will be invoked inside a modify-transaction and the 
				first argument will be the erroneous semantic element. This makes it very easy for the fix method to 
				modify the model as necessary. After the method returns the model as well as the Xtext editor&rsquo;s content 
				will be updated accordingly. If the method fails (throws an exception) the change will not be committed. 
				The following snippet shows a semantic quick fix for a similar problem.
			</p>
<div class="literallayout">
<p>
<code class="code">@Fix(DomainmodelJavaValidator.INVALID_FEATURE_NAME)<br>
public&nbsp;void&nbsp;fixFeatureName(final&nbsp;Issue&nbsp;issue,&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IssueResolutionAcceptor&nbsp;acceptor)&nbsp;{<br>
&nbsp;&nbsp;acceptor.accept(issue,&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;"Uncapitalize&nbsp;name",&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;label<br>
&nbsp;&nbsp;&nbsp;&nbsp;"Uncapitalize&nbsp;name&nbsp;of&nbsp;'"&nbsp;+&nbsp;issue.getData()[0]&nbsp;+&nbsp;"'",&nbsp;//&nbsp;description<br>
&nbsp;&nbsp;&nbsp;&nbsp;"upcase.png",&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;icon&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;ISemanticModification()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;apply(EObject&nbsp;element,&nbsp;IModificationContext&nbsp;context)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((Feature)&nbsp;element).setName(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Strings.toFirstLower(issue.getData()[0]));<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;);<br>
}<br>

<br>

</code>
</p>
</div>
<div class="section" title="Quickfixes for Linking Errors and Syntax Errors">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="QuickfixesforLinkingErrorsandSyntaxErrors"></a>Quickfixes for Linking Errors and Syntax Errors</h3>
</div>
</div>
</div>
<p>You can even define quick fixes for linking errors. The issue codes are assigned by the 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/linking/ILinkingDiagnosticMessageProvider.java?root=Modeling_Project&view=co" target="_new">ILinkingDiagnosticMessageProvider</a>. Have a look at the domain model example how to add quick fixes for these errors.
				</p>
<p>Analogously, there is the 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/parser/antlr/ISyntaxErrorMessageProvider.java?root=Modeling_Project&view=co" target="_new">ISyntaxErrorMessageProvider</a> to assign issue codes to syntactical errors.
				</p>
</div>
</div>
<div class="section" title="Template Proposals">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="templates"></a>Template Proposals</h2>
</div>
</div>
</div>
<p>Xtext-based editors automatically support code templates. That means that you get the corresponding 
				preference page where users can add and change template proposals. If you want to ship a couple of 
				default templates, you have to put a file named 
				<span class="emphasis"><em>templates.xml</em></span> inside the 
				<span class="emphasis"><em>templates</em></span> directory of 
				the generated UI-plug-in. This file contains templates in a format as described in the 

				<a class="ulink" href="http://help.eclipse.org/ganymede/topic/org.eclipse.cdt.doc.user/tasks/cdt_t_imp_code_temp.htm" target="_new">Eclipse online help</a> .
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/preferences_templates.png"></div>
<p>
			
</p>
<p>By default Xtext registers 
				<span class="emphasis"><em>ContextTypes</em></span> for each rule (
				<span class="emphasis"><em>.[RuleName]</em></span>) and for each 
				keyword (
				<span class="emphasis"><em>.kw</em></span>[keyword]_). If you don&rsquo;t 
				like these defaults you&rsquo;ll have to subclass 

				<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui/src/org/eclipse/xtext/ui/editor/templates/XtextTemplateContextTypeRegistry.java?root=Modeling_Project&view=co" target="_new">XtextTemplateContextTypeRegistry</a> 
				and configure it via 
				<a class="link" href="#guicemodules" title="The Module API">Guice</a>. 
			</p>
<p>In addition to the standard template proposal extension mechanism, Xtext ships with a predefined set 
				of 
				<span class="emphasis"><em>TemplateVariableResolvers</em></span> to resolve special variable types inside a given template 
				(i.e. 
				<span class="emphasis"><em>TemplateContext</em></span>). Besides the standard template variables available in 

				<span class="emphasis"><em>org.eclipse.jface.text.templates.GlobalTemplateVariables</em></span> like 
				<span class="emphasis"><em>${user}</em></span>, 
				<span class="emphasis"><em>${date}</em></span>, 
				<span class="emphasis"><em>${time}</em></span>, 

				<span class="emphasis"><em>${cursor}</em></span>, etc., these 
				<span class="emphasis"><em>TemplateVariableResolver</em></span> support the automatic resolving of 
				CrossReferences (type 
				<span class="emphasis"><em>CrossReferences</em></span>) and Enumerations (type 
				<span class="emphasis"><em>Enum</em></span>) like it is explained in the 
				following sections.
			</p>
<p>It is best practice to edit the templates in the preferences page, export them into the 

				<span class="emphasis"><em>templates.xml</em></span>-file and put this one into the 
				<span class="emphasis"><em>templates</em></span> folder of your UI-plug-in. However, these 
				templates will not be visible by default. To fix it, you have to manually edit the xml-file and insert 
				an ID attribute for each template element.
			</p>
<div class="section" title="CrossReference TemplateVariableResolver">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="CrossReferenceTemplateVariableResolver"></a>CrossReference TemplateVariableResolver</h3>
</div>
</div>
</div>
<p>Xtext comes with a specific template variable resolver 
					<span class="emphasis"><em>TemplateVariableResolver</em></span> called 

					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui/src/org/eclipse/xtext/ui/editor/templates/CrossReferenceTemplateVariableResolver.java?root=Modeling_Project&view=co" target="_new">CrossReferenceTemplateVariableResolver</a>, 
					which can be used to place cross-references within a template.
				</p>
<p>The syntax is as follows:</p>
<div class="literallayout">
<p>
<code class="code">${&lt;displayText&gt;:CrossReference([&lt;MyPackageName&gt;.]&lt;MyType&gt;.&lt;myRef&gt;)}<br>

</code>
</p>
</div>
<p>For example the following template:</p>
<div class="literallayout">
<p>
<code class="code">&lt;template&nbsp;name="transition"&nbsp;description="event&nbsp;transition"&nbsp;id="transition"<br>
&nbsp;&nbsp;context="org.eclipse.xtext.example.FowlerDsl.Transition"&nbsp;enabled="true"&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;${event:CrossReference('Transition.event')}&nbsp;=&gt;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;	${state:CrossReference('Transition.state')<br>
&lt;/template&gt;<br>

<br>

</code>
</p>
</div>
<p>yields the text 
					<span class="emphasis"><em>event =&gt; state</em></span> and allows selecting any events and states using a drop down.
				</p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/templates_crossref.png"></div>
<p>
				
</p>
</div>
<div class="section" title="Enumeration TemplateVariableResolver">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="EnumerationTemplateVariableResolver"></a>Enumeration TemplateVariableResolver</h3>
</div>
</div>
</div>
<p>The 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui/src/org/eclipse/xtext/ui/editor/templates/EnumTemplateVariableResolver.java?root=Modeling_Project&view=co" target="_new">EnumTemplateVariableResolver</a> 
					resolves a template variable to 
					<span class="emphasis"><em>EEnumLiteral</em></span> literals
					which are assignment-compatible to the enumeration type declared as the first parameter of the the 
					<span class="emphasis"><em>Enum</em></span> 
					<span class="emphasis"><em>TemplateVariable</em></span>. 
				</p>
<p>The syntax is as follows:   </p>
<div class="literallayout">
<p>
<code class="code">${&lt;displayText&gt;:Enum([&lt;MyPackage&gt;.]&lt;EnumType&gt;)<br>

</code>
</p>
</div>
<p>For example the following template (taken from the domainmodel example):</p>
<div class="literallayout">
<p>
<code class="code">&lt;template&nbsp;name="Operation"&nbsp;description="template&nbsp;for&nbsp;an&nbsp;Operation"<br>
&nbsp;&nbsp;id="org.eclipse.xtext.example.Domainmodel.Operation"<br>
&nbsp;&nbsp;context="org.eclipse.xtext.example.Domainmodel.Operation"<br>
&nbsp;&nbsp;enabled="true"&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;${visibility:Enum('Visibility')}&nbsp;op&nbsp;${name}(${cursor}):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${type:CrossReference('Operation.type')}<br>
&lt;/template&gt;<br>

<br>

</code>
</p>
</div>
<p>yields the text 
					<span class="emphasis"><em>public op name(): type</em></span> where the display text &sbquo;public&rsquo; is replaced with a drop 
					down filled with the literal values as defined in the 
					<span class="emphasis"><em>EEnum</em></span> 
					<span class="emphasis"><em>Visibility</em></span>. Also, 
					<span class="emphasis"><em>name</em></span> and 
					<span class="emphasis"><em>type</em></span> 
					are template variables.
				</p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/templates_enum.png"></div>
<p>
				
</p>
</div>
</div>
<div class="section" title="Outline View">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="outline"></a>Outline View</h2>
</div>
</div>
</div>
<p>Xtext provides an outline view to help you navigate your models. By default, it provides a hierarchical 
				view on your model and allows you to sort tree elements alphabetically. Selecting an element in the 
				outline will highlight the corresponding element in the text editor. Users can choose to synchronize 
				the outline with the editor selection by clicking the 
				<span class="emphasis"><em>Link with Editor</em></span> button.
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/sample_outline.png"></div>
<p>
			
</p>
<p>You can customize various aspects of the outline by providing implementation for its various interfaces. 
				The following sections show how to do this.</p>
<div class="section" title="Influencing the Outline Structure">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="InfluencingtheOutlineStructure"></a>Influencing the Outline Structure</h3>
</div>
</div>
</div>
<p>In its default implementation, the outline view shows the containment hierarchy of your model. 
					This should be sufficient in most cases. If you want to adjust the structure of the outline, i.e., 
					by omitting a certain kind of node or by introducing additional even virtual nodes, you customize 
					the outline by implementing 

					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui/src/org/eclipse/xtext/ui/editor/outline/transformer/ISemanticModelTransformer.java?root=Modeling_Project&view=co" target="_new">ISemanticModelTransformer</a>.
				</p>
<p>The Xtext wizard creates an empty transformer class (
					<span class="emphasis"><em>MyDslTransformer</em></span>) for your convenience. To 
					transform the semantic model delivered by the Xtext parser, you need to provide transformation methods 
					for each of the EClasses that are of interest:
				</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;MyDslTransformer&nbsp;extends&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;AbstractDeclarativeSemanticModelTransformer&nbsp;{&nbsp;<br>
&nbsp;&nbsp;/**<br>
&nbsp;&nbsp;&nbsp;*&nbsp;This&nbsp;method&nbsp;will&nbsp;be&nbsp;called&nbsp;by&nbsp;naming&nbsp;convention:<br>
&nbsp;&nbsp;&nbsp;*&nbsp;-&nbsp;method&nbsp;name&nbsp;must&nbsp;be&nbsp;createNode<br>
&nbsp;&nbsp;&nbsp;*&nbsp;-&nbsp;first&nbsp;param:&nbsp;subclass&nbsp;of&nbsp;EObject<br>
&nbsp;&nbsp;&nbsp;*&nbsp;-&nbsp;second&nbsp;param:&nbsp;ContentOutlineNode&nbsp;<br>
&nbsp;&nbsp;&nbsp;*/<br>
&nbsp;&nbsp;public&nbsp;ContentOutlineNode&nbsp;createNode(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Attribute&nbsp;semanticNode,&nbsp;ContentOutlineNode&nbsp;parentNode)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;ContentOutlineNode&nbsp;node&nbsp;=&nbsp;super.newOutlineNode(semanticNode,&nbsp;parentNode);<br>
&nbsp;&nbsp;&nbsp;&nbsp;node.setLabel("special&nbsp;"&nbsp;+&nbsp;node.getLabel());<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;node;<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;public&nbsp;ContentOutlineNode&nbsp;createNode(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Property&nbsp;semanticNode,&nbsp;ContentOutlineNode&nbsp;parentNode)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;ContentOutlineNode&nbsp;node&nbsp;=&nbsp;super.newOutlineNode(semanticNode,&nbsp;parentNode);<br>
&nbsp;&nbsp;&nbsp;&nbsp;node.setLabel("pimped&nbsp;"&nbsp;+&nbsp;node.getLabel());<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;node;<br>
&nbsp;&nbsp;}<br>

<br>
&nbsp;&nbsp;/**<br>
&nbsp;&nbsp;&nbsp;*&nbsp;This&nbsp;method&nbsp;will&nbsp;be&nbsp;called&nbsp;by&nbsp;naming&nbsp;convention:<br>
&nbsp;&nbsp;&nbsp;*&nbsp;-&nbsp;method&nbsp;name&nbsp;must&nbsp;be&nbsp;getChildren<br>
&nbsp;&nbsp;&nbsp;*&nbsp;-&nbsp;first&nbsp;param:&nbsp;subclass&nbsp;of&nbsp;EObject<br>
&nbsp;&nbsp;&nbsp;*/<br>
&nbsp;&nbsp;public&nbsp;List&lt;EObject&gt;&nbsp;getChildren(Attribute&nbsp;attribute)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;attribute.eContents();<br>
&nbsp;&nbsp;}<br>

<br>
&nbsp;&nbsp;public&nbsp;List&lt;EObject&gt;&nbsp;getChildren(Property&nbsp;property)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NO_CHILDREN;<br>
&nbsp;&nbsp;}<br>
}<br>

<br>

</code>
</p>
</div>
<p>To make sure Xtext picks up your new outline transformer, you have to register your implementation 
					with your UI module. This binding is usually added by the respective generator fragment.</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;MyDslUiModule&nbsp;extends&nbsp;AbstractMyDslUiModule&nbsp;{<br>

<br>
&nbsp;&nbsp;@Override<br>
&nbsp;&nbsp;public&nbsp;Class&lt;?&nbsp;extends&nbsp;ISemanticModelTransformer&gt;&nbsp;<br>
&nbsp;&nbsp;		bindISemanticModelTransformer()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;MyDslTransformer.class;<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;...<br>
}<br>

<br>

</code>
</p>
</div>
</div>
<div class="section" title="Filtering">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Filtering"></a>Filtering</h3>
</div>
</div>
</div>
<p>Often, you want to allow users to filter the contents of the outline to make it easier to concentrate 
					on the relevant aspects of the model. To add filtering capabilities to your outline, you need to add 

					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui/src/org/eclipse/xtext/ui/editor/outline/actions/AbstractFilterAction.java?root=Modeling_Project&view=co" target="_new">AbstractFilterAction</a>s to the 
					outline. Actions can be contributed by implementing and registering a 

					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui/src/org/eclipse/xtext/ui/editor/outline/actions/DeclarativeActionBarContributor.java?root=Modeling_Project&view=co" target="_new">DeclarativeActionBarContributor</a>.
				</p>
<p>To register a 
					<span class="emphasis"><em>DeclarativeActionBarContributor</em></span>, add the following lines to your 
					<span class="emphasis"><em>MyDslUiModule</em></span> class:
				</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;MyDslUiModule&nbsp;extends&nbsp;AbstractMyDslUiModule&nbsp;{<br>

<br>
&nbsp;&nbsp;@Override<br>
&nbsp;&nbsp;public&nbsp;Class&lt;?&nbsp;extends&nbsp;IActionBarContributor&gt;&nbsp;bindIActionBarContributor()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;MyDslActionBarContributor.class;<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;...<br>
}<br>

<br>

</code>
</p>
</div>
<p>The action bar contributor will look like this:</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;MyDslActionBarContributor&nbsp;extends<br>
&nbsp;&nbsp;&nbsp;&nbsp;DeclarativeActionBarContributor&nbsp;{<br>
&nbsp;&nbsp;public&nbsp;Action&nbsp;addFilterParserRulesToolbarAction(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;XtextContentOutlinePage&nbsp;page)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;FilterFooAction(page);<br>
&nbsp;&nbsp;}<br>
}<br>

<br>

</code>
</p>
</div>
<p>Filter actions must extend 
					<span class="emphasis"><em>AbstractFilterAction</em></span> (this ensures that the action toggle state is 
					handled correctly):
				</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;FilterFooAction&nbsp;extends&nbsp;AbstractFilterAction&nbsp;{<br>

<br>
&nbsp;&nbsp;public&nbsp;FilterFooAction(XtextContentOutlinePage&nbsp;outlinePage)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;super("Filter&nbsp;Foo",&nbsp;outlinePage);<br>
&nbsp;&nbsp;&nbsp;&nbsp;setToolTipText("Show&nbsp;/&nbsp;hide&nbsp;foo");<br>
&nbsp;&nbsp;&nbsp;&nbsp;setDescription("Show&nbsp;/&nbsp;hide&nbsp;foo");<br>
&nbsp;&nbsp;&nbsp;&nbsp;setImageDescriptor(Activator.getImageDescriptor("icons/foo.gif"));<br>
&nbsp;&nbsp;&nbsp;&nbsp;setDisabledImageDescriptor(<br>
&nbsp;&nbsp;&nbsp;&nbsp;	Activator.getImageDescriptor("icons/foo.gif"));<br>
&nbsp;&nbsp;}<br>

<br>
&nbsp;&nbsp;@Override<br>
&nbsp;&nbsp;protected&nbsp;String&nbsp;getToggleId()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;"FilterFooAction.isChecked";<br>
&nbsp;&nbsp;}<br>
	
<br>
&nbsp;&nbsp;@Override<br>
&nbsp;&nbsp;protected&nbsp;ViewerFilter&nbsp;createFilter()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;FooOutlineFilter();<br>
&nbsp;&nbsp;}<br>

<br>
}<br>

<br>

</code>
</p>
</div>
<p>The filtering itself will be performed by 
					<span class="emphasis"><em>FooOutlineFilter</em></span>:
				</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;FooOutlineFilter&nbsp;extends&nbsp;ViewerFilter&nbsp;{<br>

<br>
&nbsp;&nbsp;@Override<br>
&nbsp;&nbsp;public&nbsp;boolean&nbsp;select(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Viewer&nbsp;viewer,&nbsp;Object&nbsp;parentElement,&nbsp;Object&nbsp;element)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((parentElement&nbsp;!=&nbsp;null)&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp;&nbsp;(parentElement&nbsp;instanceof&nbsp;ContentOutlineNode))&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ContentOutlineNode&nbsp;parentNode&nbsp;=&nbsp;(ContentOutlineNode)&nbsp;parentElement;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EClass&nbsp;clazz&nbsp;=&nbsp;parentNode.getClazz();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(clazz.equals(MyDslPackage.Literals.ATTRIBUTE))&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;true;<br>
&nbsp;&nbsp;}<br>

<br>
}<br>

<br>

</code>
</p>
</div>
</div>
<div class="section" title="Context menus">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Contextmenus"></a>Context menus</h3>
</div>
</div>
</div>
<p>You might want to register context menu actions for specific elements in the outline, e.g. to allow 
					users of your DSL to invoke a generator or to validate the selected element. As all elements in the 
					outline are 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui/src/org/eclipse/xtext/ui/editor/outline/ContentOutlineNode.java?root=Modeling_Project&view=co" target="_new">ContentOutlineNode</a>s, you 
					cannot easily register an 
					<a class="ulink" href="http://help.eclipse.org/stable/index.jsp?topic=/org.eclipse.platform.doc.isv/guide/workbench_basicext_popupMenus.htm" target="_new">Object contribution</a>. 
					(Besides, using the extension point 
					<span class="emphasis"><em>org.eclipse.ui.popupMenus</em></span> is regarded somewhat old school - 
					you should rather use the new command and expression framework, as depicted below).
				</p>
<p>To register context menus for specific node types of your Ecore model, we need to:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>implement 
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui/src/org/eclipse/xtext/ui/editor/outline/actions/IContentOutlineNodeAdapterFactory.java?root=Modeling_Project&view=co" target="_new">IContentOutlineNodeAdapterFactory</a> which will translate 
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui/src/org/eclipse/xtext/ui/editor/outline/ContentOutlineNode.java?root=Modeling_Project&view=co" target="_new">ContentOutlineNode</a>s to their underlying node type
						</p>
</li>
<li class="listitem">
<p>register a menu contribution to add a command / handler pair to the context menu for the specific node types you&rsquo;re interested in.</p>
</li>
</ul>
</div>
<div class="section" title="Registering an IContentOutlineNodeAdapterFactory">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="RegisteringanIContentOutlineNodeAdapterFactory"></a>Registering an 
						<span class="emphasis"><em>IContentOutlineNodeAdapterFactory</em></span>
					
</h4>
</div>
</div>
</div>
<p>The Xtext code generator creates a subclass of 

						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui/src/org/eclipse/xtext/ui/editor/outline/actions/DefaultContentOutlineNodeAdapterFactory.java?root=Modeling_Project&view=co" target="_new">DefaultContentOutlineNodeAdapterFactory</a>. 
						All we need to do is specify a list of types that we later want to bind context menu contributions to. 
					</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;MyDslContentOutlineNodeAdapterFactory&nbsp;extends&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;DefaultContentOutlineNodeAdapterFactory&nbsp;{<br>
&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;Class&lt;?&gt;[]&nbsp;types&nbsp;=&nbsp;{&nbsp;Attribute.class&nbsp;};<br>

<br>
&nbsp;&nbsp;public&nbsp;Class&lt;?&gt;[]&nbsp;getAdapterList()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;types;<br>
&nbsp;&nbsp;}<br>
}<br>

<br>

</code>
</p>
</div>
<p>If you want to bind context menu actions to nodes representing 
						<span class="emphasis"><em>Attribute</em></span> and 
						<span class="emphasis"><em>Entity</em></span>, you need to 
						change the declaration of _types as follows:
					</p>
<div class="literallayout">
<p>
<code class="code">private&nbsp;static&nbsp;final&nbsp;Class&lt;?&gt;[]&nbsp;types&nbsp;=&nbsp;{&nbsp;Attribute.class,&nbsp;Entity.class&nbsp;};<br>

</code>
</p>
</div>
</div>
<div class="section" title="Registering a Menu Contribution">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="RegisteringaMenuContribution"></a>Registering a Menu Contribution</h4>
</div>
</div>
</div>
<p>You can now add command / handler pairs to the context menu.</p>
<p>First, you need to define a command &ndash; it will serve as a handle to glue together the handler 
						and the menu contribution:</p>
<div class="literallayout">
<p>
<code class="code">&lt;extension<br>
&nbsp;&nbsp;point="org.eclipse.ui.commands"&gt;<br>
&nbsp;&nbsp;&lt;command<br>
&nbsp;&nbsp;&nbsp;&nbsp;id="org.example.mydsl.ui.editor.outline.SampleOutlineCommand"<br>
&nbsp;&nbsp;&nbsp;&nbsp;name="Sample&nbsp;Command"<br>
&nbsp;&nbsp;&nbsp;&nbsp;description="Just&nbsp;a&nbsp;sample&nbsp;command"&gt;<br>
&nbsp;&nbsp;&lt;/command&gt;<br>
&lt;/extension&gt;<br>

<br>

</code>
</p>
</div>
<p>Next, you need to define a handler which will eventually execute the code to operate on the 
						selected node. Please pay special attention to the attribute 
						<span class="emphasis"><em>commandId</em></span> - it must match the 
						<span class="emphasis"><em>id</em></span> 
						attribute of your command. 
					</p>
<div class="literallayout">
<p>
<code class="code">&lt;extension<br>
&nbsp;&nbsp;point="org.eclipse.ui.handlers"&gt;<br>
&nbsp;&nbsp;&lt;handler<br>
&nbsp;&nbsp;&nbsp;&nbsp;class="org.example.mydsl.ui.editor.outline.SampleOutlineNodeHandler"<br>
&nbsp;&nbsp;&nbsp;&nbsp;commandId="org.example.mydsl.ui.editor.outline.SampleOutlineCommand"&gt;<br>
&nbsp;&nbsp;&lt;/handler&gt;<br>
&lt;/extension&gt;<br>

<br>

</code>
</p>
</div>
<p>Finally, define a 
						<span class="emphasis"><em>menuContribution</em></span> to add the command to the context menu:
					</p>
<div class="literallayout">
<p>
<code class="code">&lt;extension<br>
&nbsp;&nbsp;point="org.eclipse.ui.menus"&gt;<br>
&nbsp;&nbsp;&lt;menuContribution<br>
&nbsp;&nbsp;&nbsp;&nbsp;locationURI="popup:org.eclipse.xtext.ui.outline?after=additions"&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;command<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;commandId="org.example.mydsl.ui.editor.outline.SampleOutlineCommand"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;label="Sample&nbsp;action&nbsp;registered&nbsp;for&nbsp;Attributes"&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;visibleWhen&nbsp;checkEnabled="false"&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;iterate&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;adapt&nbsp;type="org.example.mydsl.Attribute"&nbsp;/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/iterate&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/visibleWhen&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/command&gt;<br>
&nbsp;&nbsp;&lt;/menuContribution&gt;<br>
&lt;/extension&gt;<br>

<br>

</code>
</p>
</div>
<p>Again, pay attention to the 
						<span class="emphasis"><em>commandId</em></span> attribute. The connection between your node type(s) and 
						the menu contribution is made by the part 
						<span class="emphasis"><em><span style="color: red">&lt;adapt&gt;&lt;/adapt&gt;</span></em></span>. 
					</p>
</div>
</div>
<div class="section" title="Quick Outline">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="quick_outline"></a>Quick Outline </h3>
</div>
</div>
</div>
<p>Xtext also provides a quick outline: If you press CTRL-O in an Xtext editor, the outline of the model is shown 
					in a popup window. The quick outline also supports drill-down search with wildcards. To enable the quick outline,
					you have to put the 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/ui/generator/outline/QuickOutlineFragment.java?root=Modeling_Project&view=co" target="_new">QuickOutlineFragment</a> 
					into your workflow.
				</p>
</div>
</div>
<div class="section" title="Hyperlinking">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="hyperlinking"></a>Hyperlinking</h2>
</div>
</div>
</div>
<p>The Xtext editor provides hyperlinking support for any tokens corresponding to cross-references in your 
				grammar definition. You can either CTRL-click on any of these tokens or hit F3 
				while the cursor position is at the token in question and this will take you to the referenced model 
				element. As you&rsquo;d expect this works for references to elements in the same resource as well as for 
				references to elements in other resources. In the latter case the referenced resource will first be 
				opened using the corresponding editor.</p>
<div class="section" title="Location Provider">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="locationProvider"></a>Location Provider</h3>
</div>
</div>
</div>
<p>When navigating a hyperlink, Xtext will also select the text region corresponding to the referenced model 
					element. Determining this text region is the responsibility of the 

					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/resource/ILocationInFileProvider.java?root=Modeling_Project&view=co" target="_new">ILocationInFileProvider</a>. The default implementation 
					(
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/resource/DefaultLocationInFileProvider.java?root=Modeling_Project&view=co" target="_new">DefaultLocationInFileProvider</a>) implements a best 
					effort strategy which can be summarized as:
				</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>If the model element&rsquo;s type (i.e. 
							<span class="emphasis"><em>EClass</em></span>) declares a feature 
							<span class="emphasis"><em>name</em></span> then return the region of the corresponding token(s). As a fallback also check for a feature 
							<span class="emphasis"><em>id</em></span>.
						</p>
</li>
<li class="listitem">
<p>If the model element&rsquo;s parse tree contains any top-level tokens corresponding to 
							<span class="emphasis"><em>ID</em></span> rule calls in the grammar then return a region spanning all those tokens.
						</p>
</li>
<li class="listitem">
<p>As a last resort return the region corresponding to the first keyword token of the referenced model element.</p>
</li>
</ol>
</div>
<div class="section" title="Customized Location Provider">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="CustomizedLocationProvider"></a>Customized Location Provider</h4>
</div>
</div>
</div>
<p>As the default strategy is a best effort it may not always result in the selection you want. If that&rsquo;s 
						the case you can 
						<a class="link" href="#guicemodules" title="The Module API">override</a> the 
						<span class="emphasis"><em>ILocationInFileProvider</em></span> binding in the UI module as 
						in the following example:
					</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;MyDslUiModule&nbsp;extends&nbsp;AbstractMyDslUiModule&nbsp;{<br>

<br>
&nbsp;&nbsp;@Override<br>
&nbsp;&nbsp;public&nbsp;Class&lt;?&nbsp;extends&nbsp;ILocationInFileProvider&gt;&nbsp;<br>
&nbsp;&nbsp;		bindILocationInFileProvider()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;MyDslLocationInFileProvider.class;<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;...<br>
}<br>

<br>

</code>
</p>
</div>
<p>Often the default strategy only needs some guidance (e.g. selecting the text corresponding to another 
						feature than 
						<span class="emphasis"><em>name</em></span>). In that case you can simply subclass 
						<span class="emphasis"><em>DefaultLocationInFileProvider</em></span> and override 
						the methods 
						<span class="emphasis"><em>getIdentifierFeature()</em></span> and / or 
						<span class="emphasis"><em>useKeyword()</em></span> to guide the first and last steps of the strategy 
						as described above (see 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.xtext.ui/src/org/eclipse/xtext/xtext/ui/XtextLocationInFileProvider.java?root=Modeling_Project&view=co" target="_new">XtextLocationInFileProvider</a> 
						for an example).
					</p>
</div>
</div>
<div class="section" title="Customizing Available Hyperlinks">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="CustomizingAvailableHyperlinks"></a>Customizing Available Hyperlinks</h3>
</div>
</div>
</div>
<p>The hyperlinks are provided by the 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui/src/org/eclipse/xtext/ui/editor/hyperlinking/HyperlinkHelper.java?root=Modeling_Project&view=co" target="_new">HyperlinkHelper</a>
					which will create links for cross-referenced objects by default. Clients may want to override 

					<span class="emphasis"><em>createHyperlinksByOffset(XtextResource, int, IHyperlinkAcceptor)</em></span> to provide additional links or 
					supersede the default implementation. 
				</p>
</div>
</div>
<div class="section" title="Syntax Coloring">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="highlighting"></a>Syntax Coloring</h2>
</div>
</div>
</div>
<p>Besides the already mentioned advanced features like content assist and code formatting the powerful 
				editor for your DSL is capable to mark up your model-code to improve the overall readability. It is 
				possible to use different colors and fonts according to the meaning of the different parts of your 
				input file. One may want to use some decent colors for large blocks of comments while identifiers, 
				keywords and strings should be colored differently to make it easier to distinguish between them. 
				This kind of text decorating markup does not influence the semantics of the various sections but 
				helps to understand the meaning and to find errors in the source code.</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/highlighting.png"></div>
<p>
			
</p>
<p>The highlighting is done in two stages. This allows for sophisticated algorithms that are executed 
				asynchronously to provide advanced coloring while simple pattern matching may be used to highlight 
				parts of the text instantaneously. The latter is called lexical highlighting while the first is based 
				on the meaning of your different model elements and therefore called semantic highlighting.</p>
<p>When you introduce new highlighting styles, the preference page for your DSL is automatically 
				configured and allows the customization of any registered highlighting setting. They are automatically 
				persisted and reloaded on startup.</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/preferences_syntax.png"></div>
<p>
			
</p>
<div class="section" title="Lexical Highlighting">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="LexicalHighlighting"></a>Lexical Highlighting</h3>
</div>
</div>
</div>
<p>The lexical highlighting can be customized by providing implementations of the interface 

					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui/src/org/eclipse/xtext/ui/editor/syntaxcoloring/IHighlightingConfiguration.java?root=Modeling_Project&view=co" target="_new">IHighlightingConfiguration</a> and 
					the abstract class 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui/src/org/eclipse/xtext/ui/editor/syntaxcoloring/AbstractTokenScanner.java?root=Modeling_Project&view=co" target="_new">AbstractTokenScanner</a>. 
					The latter fulfills the interface 
					<span class="emphasis"><em>ITokenScanner</em></span> from the underlying JFace Framework, which may be 
					implemented by clients directly.
				</p>
<p>The 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui/src/org/eclipse/xtext/ui/editor/syntaxcoloring/IHighlightingConfiguration.java?root=Modeling_Project&view=co" target="_new">IHighlightingConfiguration</a> is used
					to register any default style without a specific binding to 
					a pattern in the model file. It is used to populate the preferences page and to initialize the 

					<span class="emphasis"><em>ITextAttributeProvider</em></span>, which in turn is the component that is used to obtain the actual settings 
					for a style&rsquo;s id. An implementation will usually be very similar to the 

					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui/src/org/eclipse/xtext/ui/editor/syntaxcoloring/DefaultHighlightingConfiguration.java?root=Modeling_Project&view=co" target="_new">DefaultHighlightingConfiguration</a> and read like this: 
				</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;DefaultHighlightingConfiguration&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;implements&nbsp;IHighlightingConfiguration&nbsp;{<br>

<br>
&nbsp;&nbsp;public&nbsp;static&nbsp;final&nbsp;String&nbsp;KEYWORD_ID&nbsp;=&nbsp;"keyword";<br>
&nbsp;&nbsp;public&nbsp;static&nbsp;final&nbsp;String&nbsp;COMMENT_ID&nbsp;=&nbsp;"comment";<br>

<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;configure(IHighlightingConfigurationAcceptor&nbsp;acceptor)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;acceptor.acceptDefaultHighlighting(KEYWORD_ID,&nbsp;"Keyword",&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;keywordTextStyle());<br>
&nbsp;&nbsp;&nbsp;&nbsp;acceptor.acceptDefaultHighlighting(COMMENT_ID,&nbsp;"Comment",&nbsp;//&nbsp;...<br>
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;...<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;public&nbsp;TextStyle&nbsp;keywordTextStyle()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;TextStyle&nbsp;textStyle&nbsp;=&nbsp;new&nbsp;TextStyle();<br>
&nbsp;&nbsp;&nbsp;&nbsp;textStyle.setColor(new&nbsp;RGB(127,&nbsp;0,&nbsp;85));<br>
&nbsp;&nbsp;&nbsp;&nbsp;textStyle.setStyle(SWT.BOLD);<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;textStyle;<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;//&nbsp;...<br>
}<br>

<br>

</code>
</p>
</div>
<p>Implementations of the 
					<span class="emphasis"><em>ITokenScanner</em></span> are responsible for splitting the content of a document into 
					various parts, the so called tokens, and return the highlighting information for each identified range. 
					It is critical that this is done very fast because this component is used on each keystroke. Xtext 
					ships with a default implementation that is based on the lexer that is generated by ANTLR which is very 
					lightweight and fast. This default implementation can be customized by clients easily. They simply have 
					to bind another implementation of the 

					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui/src/org/eclipse/xtext/ui/editor/syntaxcoloring/AbstractAntlrTokenToAttributeIdMapper.java?root=Modeling_Project&view=co" target="_new">AbstractAntlrTokenToAttributeIdMapper</a>. 
					To get an idea about it, have a look at the 

					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui/src/org/eclipse/xtext/ui/editor/syntaxcoloring/DefaultAntlrTokenToAttributeIdMapper.java?root=Modeling_Project&view=co" target="_new">DefaultAntlrTokenToAttributeIdMapper</a>.
				</p>
</div>
<div class="section" title="Semantic Highlighting">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="SemanticHighlighting"></a>Semantic Highlighting</h3>
</div>
</div>
</div>
<p>The semantic highlighting stage is executed asynchronously in the background and can be used to calculated 
					highlighting states based on the meaning of the different model elements. Users of the editor will 
					notice a very short delay after they have edited the text until the styles are actually applied to the 
					document. This keeps the editor responsive while providing aid when reading and writing your model.</p>
<p>As for the lexical highlighting the interface to register the available styles is the 

					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui/src/org/eclipse/xtext/ui/editor/syntaxcoloring/IHighlightingConfiguration.java?root=Modeling_Project&view=co" target="_new">IHighlightingConfiguration</a>. 
					The 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui/src/org/eclipse/xtext/ui/editor/syntaxcoloring/ISemanticHighlightingCalculator.java?root=Modeling_Project&view=co" target="_new">ISemanticHighlightingCalculator</a> 
					is the primary hook to implement the logic that will compute to-be-highlighted ranges based on the model 
					elements. 
				</p>
<p>The framework will pass the current XtextResource and an 

					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui/src/org/eclipse/xtext/ui/editor/syntaxcoloring/IHighlightedPositionAcceptor.java?root=Modeling_Project&view=co" target="_new">IHighlightedPositionAcceptor</a> to 
					the calculator. It is ensured, that the resource will not be altered externally until the called method 

					<span class="emphasis"><em>provideHighlightingFor()</em></span> returns. However, the resource may be null. The implementor&rsquo;s task is to 
					navigate your semantic model and compute various ranges based on the attached node information and 
					associate styles with them. This may read similar to the following snippet:
				</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;void&nbsp;provideHighlightingFor(XtextResource&nbsp;resource,&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;IHighlightedPositionAcceptor&nbsp;acceptor)&nbsp;{<br>
&nbsp;&nbsp;if&nbsp;(resource&nbsp;==&nbsp;null)<br>
&nbsp;&nbsp;&nbsp;&nbsp;return;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;Iterable&lt;AbstractNode&gt;&nbsp;allNodes&nbsp;=&nbsp;NodeUtil.getAllContents(<br>
&nbsp;&nbsp;&nbsp;&nbsp;resource.getParseResult().getRootNode());<br>
&nbsp;&nbsp;for&nbsp;(AbstractNode&nbsp;node&nbsp;:&nbsp;allNodes)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(node.getGrammarElement()&nbsp;instanceof&nbsp;CrossReference)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;acceptor.addPosition(node.getOffset(),&nbsp;node.getLength(),&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MyHighlightingConfiguration.CROSS_REF);<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;}<br>
}<br>

<br>

</code>
</p>
</div>
<p>This example refers to an implementation of the 
					<span class="emphasis"><em>IHighlightingConfiguration</em></span> that registers a style 
					for a cross-reference. It is pretty much the same implementation as for the previously mentioned sample 
					of a lexical 
					<span class="emphasis"><em>IHighlightingConfiguration</em></span>.
				</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;HighlightingConfiguration&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;implements&nbsp;IHighlightingConfiguration&nbsp;{<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;//&nbsp;lexical&nbsp;stuff&nbsp;goes&nbsp;here&nbsp;<br>
&nbsp;&nbsp;//&nbsp;..<br>
&nbsp;&nbsp;public&nbsp;final&nbsp;static&nbsp;String&nbsp;CROSS_REF&nbsp;=&nbsp;"CrossReference";&nbsp;<br>

<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;configure(IHighlightingConfigurationAcceptor&nbsp;acceptor)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;lexical&nbsp;stuff&nbsp;goes&nbsp;here&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;..<br>
&nbsp;&nbsp;&nbsp;&nbsp;acceptor.acceptDefaultHighlighting(CROSS_REF,&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"Cross-References",&nbsp;crossReferenceTextStyle());<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;public&nbsp;TextStyle&nbsp;crossReferenceTextStyle()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;TextStyle&nbsp;textStyle&nbsp;=&nbsp;new&nbsp;TextStyle();<br>
&nbsp;&nbsp;&nbsp;&nbsp;textStyle.setStyle(SWT.ITALIC);<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;textStyle;<br>
&nbsp;&nbsp;}<br>
}<br>

<br>

</code>
</p>
</div>
<p>The implementor of an 
					<span class="emphasis"><em>IHighlightingCalculator</em></span> should be aware of performance to ensure a good user 
					experience. It is probably not a good idea to traverse everything of your model when you will only 
					register a few highlighted ranges that can be found easier with some typed method calls. It is strongly 
					advised to use purposeful ways to navigate your model. The parts of Xtext&rsquo;s core that are responsible 
					for the semantic highlighting are pretty optimized in this regard as well. The framework will only 
					update the ranges that actually have been altered, for example. This speeds up the redraw process. It 
					will even move, shrink or enlarge previously announced regions based on a best guess before the next 
					semantic highlighting pass has been triggered after the user has changed the document.
				</p>
</div>
</div>
<div class="section" title="Project Wizard">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="projectwizard"></a>Project Wizard</h2>
</div>
</div>
</div>
<p>Optionally, Xtext can generate a 
				<span class="emphasis"><em>New Project Wizard</em></span> for your DSL. Using this wizard a user can create a new 
				project with only a few clicks that is configured with the right dependencies and natures. By default 
				it contains a sample model file and workflow that serve as a scaffold for the user. Furthermore it 
				has the Xtext nature and thereby the builder assigned. You enable the generation of the project wizard by adding the 

				<span class="emphasis"><em>SimpleProjectWizardFragment</em></span> fragment to the 
				<a class="link" href="#generator_fragment" title="Generator Fragments">workflow</a>:
			</p>
<div class="literallayout">
<p>
<code class="code">import&nbsp;org.eclipse.xtext.ui.generator.*&nbsp;<br>

<br>
//&nbsp;project&nbsp;wizard&nbsp;fragment<br>
fragment&nbsp;=&nbsp;projectWizard.SimpleProjectWizardFragment&nbsp;{<br>
&nbsp;&nbsp;generatorProjectName&nbsp;=&nbsp;"${projectName}.generator"<br>
&nbsp;&nbsp;modelFileExtension&nbsp;=&nbsp;file.extensions<br>
}<br>

<br>

</code>
</p>
</div>
<p>Here</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>the 
						<span class="emphasis"><em>generatorProjectName</em></span> is used to specify the project that contains the workflows and templates used to generate artifacts from your DSL. The generated project wizard uses this to add a corresponding dependency to the created project.
					</p>
</li>
<li class="listitem">
<p>and the 
						<span class="emphasis"><em>modelFileExtension</em></span> specifies the default file extension associated with your DSL. When the user clicks the 
						<span class="emphasis"><em>Finish</em></span> button the project wizard will look for a file with the given extension in the created project and open a editor. 
					</p>
</li>
</ul>
</div>
<p>After running the Xtext generator, the DSL&rsquo;s UI project will contain a new Xpand template 

				<span class="emphasis"><em>MyDslNewProject.xpt</em></span> in the 
				<span class="emphasis"><em>src</em></span> folder in the package 
				<span class="emphasis"><em>.ui.wizard</em></span>. 
				Note: It may be necessary to manually merge the new entry in the _plugin.xml___gen_ into your 

				<span class="emphasis"><em>plugin.xml</em></span> of the UI project to enable the wizard contribution.
			</p>
<p>The generated Xpand template will be expanded by the project wizard when the user clicks the 
				<span class="emphasis"><em>Finish</em></span> button 
				and it is responsible for initializing the project with some sample content. When finishing the wizard 
				the template will be used to create a sample model file and a simple workflow to run the 
				model through the generator project&rsquo;s 
				<span class="emphasis"><em>MyDslGenerator.mwe</em></span> workflow. However, this is only a pragmatic default.
				As the Xpand template is in the 
				<span class="emphasis"><em>src</em></span> source folder you may of course modify it to generate whatever 
				initial content you want for a new project. Just make sure to leave the top-level 
				<span class="emphasis"><em>main</em></span> definition 
				in place, as that is the interface for the project wizard.
			</p>
<p>
				
<span class="bold"><strong>Note:</strong></span> To edit the generated Xpand template you should check that the 
				<span class="emphasis"><em>JavaBeans meta model contributor</em></span> 
				is enabled under 
				<span class="emphasis"><em>Preferences &gt; Xtend/Xpand</em></span>. Further you should also configure the UI project with the 
				Xpand/Xtend nature using 
				<span class="emphasis"><em>Configure &gt; Add Xpand/Xtend Nature</em></span> in the context menu.
			</p>
<div class="section" title="Customizing the Project Wizard">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="CustomizingtheProjectWizard"></a>Customizing the Project Wizard</h3>
</div>
</div>
</div>
<p>To further customize the creation of the project you can implement your own 
					<span class="emphasis"><em>project creator</em></span>. 
					The default project creator is represented by the generated class 
					<span class="emphasis"><em>MyDslProjectCreator</em></span> in the

					<span class="emphasis"><em>src-gen</em></span> folder. It is highly extensible. Without any changes it will simply create a new plug-in project 
					with the Xtext nature assigned. Afterwards it will execute the 
					<span class="emphasis"><em>main</em></span> definition of the Xpand template 
					as described above.
				</p>
<p>To add more pages or input fields to the project wizard you should subclass the class 

					<span class="emphasis"><em>MyDslNewProjectWizard</em></span> as appropriate. Don&rsquo;t forget to register the subclass in the UI project&rsquo;s 

					<span class="emphasis"><em>MyDslUiModule</em></span>. You may also want to make additionally entered user data available to the Xpand template. 
					In this case you should enhance the 
					<span class="emphasis"><em>MyDslProjectInfo</em></span> to allow that one to hold the information. This is the 
					context object which gets passed to the template when it&rsquo;s executed. Don&rsquo;t forget that your specialized 

					<span class="emphasis"><em>MyDslNewProjectWizard</em></span> has to populate the data fields of your 
					<span class="emphasis"><em>MyDslProjectInfo</em></span>.
				</p>
</div>
</div>
</div>
<div class="chapter" title="Chapter&nbsp;8.&nbsp;Referring to Java Types">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="jvmtypes"></a>Chapter&nbsp;8.&nbsp;Referring to Java Types</h2>
</div>
</div>
</div>
<p>A common use case when developing languages is the requirement to refer to existing concepts of other 
			languages. Xtext makes this very easy for other self defined languages. However, it is often very useful
			to have access to the available types of the Java Virtual Machine. The JVM types Ecore model enables
			clients to do exactly this. It is possible to create cross-references to classes, interfaces, and their 
			fields and methods. Basically every information about the structural concepts of the Java type system
			is available via the JVM types. This includes annotations and their specific values and enumeration 
			literals as well.</p>
<p>The implementation will be selected transparently to the client code depending on where the code is 
			executed. If the environment is a plain stand-alone Java or OSGi environment, the 
			<span class="emphasis"><em>java.lang.reflect</em></span> 
			API will be used to deduce the necessary data. On the contrary, the type-model will be created from the 
			live data of the JDT in an interactive Eclipse environment. All this happens behind the scenes via different
			implementations that are bound to specific interfaces with Google Guice. 
		</p>
<div class="section" title="How to Use Java Types">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="HowtoUseJavaTypes"></a>How to Use Java Types </h2>
</div>
</div>
</div>
<p>Using the JVM types model is very simple. First of all, the grammar has to import the 
				<span class="emphasis"><em>JavaVMTypes</em></span> Ecore model. 
				Thanks to content assist this is easy to spot in the list of proposals.  
			</p>
<div class="literallayout">
<p>
<code class="code">import&nbsp;"http://www.eclipse.org/xtext/common/JavaVMTypes"&nbsp;as&nbsp;types<br>

<br>

</code>
</p>
</div>
<p>The next step is to actually refer to an imported concept. Let&rsquo;s define a mapping to actually available
				Java types for the simple data types in the self defined language. By means of cross-references this works
				as one got already used to when dealing with references in Xtext.</p>
<div class="literallayout">
<p>
<code class="code">Type:<br>
&nbsp;&nbsp;'type'&nbsp;name=ID&nbsp;'mapped-to'&nbsp;javaType=[types::JvmType|FQN];<br>

<br>

</code>
</p>
</div>
<p>Last but not least, the 
				<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/types/TypesGeneratorFragment.java?root=Modeling_Project&view=co" target="_new">TypesGeneratorFragment</a> 
				has to be added to the workflow. The safest way is 
				to add it after the actually used scoping fragments as a specialized version of the 
				<span class="emphasis"><em>IGlobalScopeProvider</em></span> 
				will be configured. Don&rsquo;t forget to refer to the 
				<span class="emphasis"><em>genmodel</em></span> of the Java VM types. The shortest possible
				URI is a classpath-URI.    
			</p>
<div class="literallayout">
<p>
<code class="code">fragment&nbsp;=&nbsp;ecore.EcoreGeneratorFragment&nbsp;{<br>
&nbsp;&nbsp;referencedGenModels="classpath:/model/JavaVMTypes.genmodel"<br>
}<br>

<br>
...<br>
//&nbsp;scoping&nbsp;and&nbsp;exporting&nbsp;API&nbsp;<br>
...<br>

<br>
fragment&nbsp;=&nbsp;types.TypesGeneratorFragment&nbsp;{}<br>

<br>

</code>
</p>
</div>
<p>After regenerating your language, it will be allowed to define a type 
				<span class="emphasis"><em>Date</em></span> that maps to the 
				<span class="emphasis"><em>java.util.Date</em></span>
				like this:
			</p>
<div class="literallayout">
<p>
<code class="code">type&nbsp;Date&nbsp;mapped-to&nbsp;java.util.Date<br>

<br>

</code>
</p>
</div>
<p>These two steps will provide a nice integration into the Eclipse JDT. There is 
				<span class="emphasis"><em>Find References</em></span> on Java methods, 
				fields and types that will reveal results in your language files. 
				<span class="emphasis"><em>Go To Declaration</em></span> works as expected
				and content assist will propose the list of available types. 
			</p>
</div>
<div class="section" title="Customization Points">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="CustomizationPoints"></a>Customization Points</h2>
</div>
</div>
</div>
<p>There are several customization hooks in the runtime layer and on the editor side as well:</p>
<p>The 
				<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.common.types/src/org/eclipse/xtext/common/types/xtext/AbstractTypeScopeProvider.java?root=Modeling_Project&view=co" target="_new">AbstractTypeScopeProvider</a> 
				can be used to create scopes for members with respect to
				the override semantics of the Java language. Of course it is possible to use this implementation to
				create scopes for types as well.
			</p>
<p>As the Java VM types expose a lot of information about visibility, parameter- and return types, generic,
				available annotations or enumeration literals, it is very easy to define constraints for the referred types.</p>
<p>The 
				<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.common.types.ui/src/org/eclipse/xtext/common/types/xtext/ui/ITypesProposalProvider.java?root=Modeling_Project&view=co" target="_new">ITypesProposalProvider</a> can be
				used to provide optimized proposals based on various filter criteria. 
				The most common selector can be used directly via 
				<span class="emphasis"><em>createSubTypeProposals</em></span>. The implementation is optimized
				and uses the JDT Index directly to minimize the effort for object instantiation. The class 

				<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.common.types.ui/src/org/eclipse/xtext/common/types/xtext/ui/TypeMatchFilters.java?root=Modeling_Project&view=co" target="_new">TypeMatchFilters</a>
				provides a comprehensive set of reusable filters that can be easily combined to reduce the list of proposals
				to a smaller number of valid entries.
			</p>
<div class="literallayout">
<p>
<code class="code">import&nbsp;static&nbsp;org.eclipse.xtext.common.types.xtext.ui.TypeMatchFilters.*;&nbsp;<br>
..<br>
..<br>

<br>
&nbsp;&nbsp;proposalProvider.createSubTypeProposals(factory,&nbsp;context,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and(not(canInstantiate()),&nbsp;isPublic()),&nbsp;acceptor);<br>
&nbsp;<br>
&nbsp;<br>

</code>
</p>
</div>
<p>
				
<span class="emphasis"><em>Since Xtext 1.0.1:</em></span>
			
</p>
<p>Proposals can be created by means of a scoped proposal provider that is actually aware of existing import 
				statements and scoping rules while still leveraging the JDT index for faster proposal creation. Use the 

				<span class="emphasis"><em>ITypesProposalProvider.IScopableTypesProposalProvider</em></span> to create a scoped proposal provider and use this 
				one instead of the plain implementation.
			</p>
<div class="literallayout">
<p>
<code class="code">@Override<br>
public&nbsp;void&nbsp;complete&lt;TypeName&gt;_&lt;ReferenceName&gt;(<br>
&nbsp;&nbsp;&nbsp;&nbsp;EObject&nbsp;model,<br>
&nbsp;&nbsp;&nbsp;&nbsp;Assignment&nbsp;assignment,<br>
&nbsp;&nbsp;&nbsp;&nbsp;ContentAssistContext&nbsp;context,<br>
&nbsp;&nbsp;&nbsp;&nbsp;ICompletionProposalAcceptor&nbsp;acceptor)&nbsp;{<br>
&nbsp;&nbsp;IScope&nbsp;scope&nbsp;=&nbsp;getScopeProvider().getScope(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;model,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;MyDsl&gt;Package.Literals.&lt;POINTER_TO_REFERENCE&gt;);<br>
&nbsp;&nbsp;ITypesProposalProvider&nbsp;scopedProposalProvider&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;scopableProposalProvider.getScopedProposalProvider(model,&nbsp;scope);<br>
&nbsp;&nbsp;scopedProposalProvider.create...<br>
}<br>

<br>

<br>

</code>
</p>
</div>
</div>
</div>
<div class="chapter" title="Chapter&nbsp;9.&nbsp;Typical Language Configurations">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="special_languages"></a>Chapter&nbsp;9.&nbsp;Typical Language Configurations</h2>
</div>
</div>
</div>
<div class="section" title="Case Insensitive Languages">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="case_insensitive_languages"></a>Case Insensitive Languages</h2>
</div>
</div>
</div>
<p>In some cases, e.g. if your 
				<span class="emphasis"><em>SHIFT</em></span> key is broken, you might want to design a case insensitive language. Xtext offers separate 
				<a class="link" href="#generator_fragment" title="Generator Fragments">generator fragments</a> for this purpose. 
			</p>
<p>For case insensitive keywords, open your MWE workflow and replace the Antlr related fragments: </p>
<div class="literallayout">
<p>
<code class="code">//&nbsp;The&nbsp;antlr&nbsp;parser&nbsp;generator&nbsp;fragment.<br>
fragment&nbsp;=&nbsp;parser.antlr.XtextAntlrGeneratorFragment&nbsp;{<br>
//&nbsp;&nbsp;options&nbsp;=&nbsp;{<br>
//		backtrack&nbsp;=&nbsp;true<br>
//	}<br>
}<br>
...<br>

<br>
//&nbsp;generates&nbsp;a&nbsp;more&nbsp;lightweight&nbsp;Antlr&nbsp;parser&nbsp;and&nbsp;lexer&nbsp;tailored&nbsp;...<br>
fragment&nbsp;=&nbsp;parser.antlr.XtextAntlrUiGeneratorFragment&nbsp;{<br>
}<br>

<br>

</code>
</p>
</div>
<p>with</p>
<div class="literallayout">
<p>
<code class="code">//&nbsp;The&nbsp;antlr&nbsp;parser&nbsp;generator&nbsp;fragment.<br>
fragment&nbsp;=&nbsp;parser.antlr.ex.rt.AntlrGeneratorFragment&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;options&nbsp;=&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ignoreCase&nbsp;=&nbsp;true<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
}<br>
...<br>

<br>
//&nbsp;generates&nbsp;a&nbsp;more&nbsp;lightweight&nbsp;Antlr&nbsp;parser&nbsp;and&nbsp;lexer&nbsp;tailored&nbsp;...<br>
fragment&nbsp;=&nbsp;parser.antlr.ex.ca.ContentAssistParserGeneratorFragment&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;options&nbsp;=&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ignoreCase&nbsp;=&nbsp;true<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
}<br>

<br>

</code>
</p>
</div>
<p>For case insensitve element names, use the 
				<span class="emphasis"><em>ignoreCase</em></span> option in your scope fragment, i.e.
			</p>
<div class="literallayout">
<p>
<code class="code">fragment&nbsp;=&nbsp;scoping.ImportNamespacesScopingFragment&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;ignoreCase&nbsp;=&nbsp;true<br>
}<br>

<br>

</code>
</p>
</div>
<p>or if you are using 
				<a class="link" href="#import_uri" title="Global Scopes Based On Explicit Imports (ImportURI Mechanism)">importURI based global scopes</a>
			
</p>
<div class="literallayout">
<p>
<code class="code">fragment&nbsp;=&nbsp;scoping.ImportURIScopingFragment&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;ignoreCase&nbsp;=&nbsp;true<br>
}<br>

<br>

</code>
</p>
</div>
</div>
<div class="section" title="Languages Independent of JDT">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="java_independent_languages"></a>Languages Independent of JDT</h2>
</div>
</div>
</div>
<p>The following section describes how you make your language independent of Eclipse&rsquo;s Java Development Toolkit (JDT).</p>
<p>In the 
				<span class="emphasis"><em>UIModule</em></span> of your language you have to overwrite some bindings. First, remove the bindings to components with support for the '
				<span class="emphasis"><em>classpath:</em></span>' URI protocol, i.e. 
			</p>
<div class="literallayout">
<p>
<code class="code">@Override<br>
public&nbsp;Class&lt;?&nbsp;extends&nbsp;IResourceForEditorInputFactory&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;bindIResourceForEditorInputFactory()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;ResourceForIEditorInputFactory.class;<br>
}<br>

<br>
@Override<br>
public&nbsp;Class&lt;?&nbsp;extends&nbsp;IResourceSetProvider&gt;&nbsp;bindIResourceSetProvider()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;SimpleResourceSetProvider.class;<br>
}<br>

<br>

</code>
</p>
</div>
<p>Second, configure the global scope provider to scan project root folders instead of the classpath of Java projects.   </p>
<div class="literallayout">
<p>
<code class="code">@Override<br>
public&nbsp;com.google.inject.Provider<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;org.eclipse.xtext.resource.containers.IAllContainersState&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;provideIAllContainersState()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;org.eclipse.xtext.ui.shared.Access.getWorkspaceProjectsState();<br>
}<br>

<br>

</code>
</p>
</div>
<p>The remaining steps show you how to adapt the  

				<a class="link" href="#projectwizard" title="Project Wizard">project wizard</a> for your language, if you have generated one.
				The best way to do this is to create a new subclass of the generated 

				<span class="emphasis"><em>IProjectCreator</em></span> in the 
				<span class="emphasis"><em>src/</em></span> folder of the 
				<span class="emphasis"><em>ui</em></span> project and 
				apply the necessary changes there. First, remove the JDT project configuration 
				by overriding 
				<span class="emphasis"><em>configureProject</em></span> with an empty body. 
			</p>
<p>The next thing is to redefine the project natures and builders that should be
				applied to you language projects.</p>
<p>In in this case just remove the JDT stuff in this way:</p>
<div class="literallayout">
<p>
<code class="code">protected&nbsp;String[]&nbsp;getProjectNatures()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;String[]&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"org.eclipse.pde.PluginNature",<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"org.eclipse.xtext.ui.shared.xtextNature"<br>
&nbsp;&nbsp;&nbsp;&nbsp;};<br>
}<br>

<br>
protected&nbsp;String[]&nbsp;getBuilders()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;String[]&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"org.eclipse.pde.ManifestBuilder",&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"org.eclipse.pde.SchemaBuilder"<br>
&nbsp;&nbsp;&nbsp;&nbsp;};<br>
}<br>

<br>

</code>
</p>
</div>
<p>After that you have to bind the new 
				<span class="emphasis"><em>IProjectCreator</em></span>
			
</p>
<div class="literallayout">
<p>
<code class="code">@Override<br>
public&nbsp;Class&lt;?&nbsp;extends&nbsp;IProjectCreator&gt;&nbsp;bindIProjectCreator()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;JDTFreeMyDslProjectCreator.class;<br>
}<br>

<br>

</code>
</p>
</div>
<p>That&rsquo;s all. Your language and its IDE should now no longer depend on JDT.</p>
</div>
<div class="section" title="Parsing Expressions with Xtext">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="expressions"></a>Parsing Expressions with Xtext</h2>
</div>
</div>
</div>
<p>Parsing simple XML-like, structural languages with Xtext is a no-brainer. However, parsing nested expressions is often considered a bit more complicated. This is because they are more complicated due to their recursive nature and also because with Xtext you have to avoid left recursive parser rules. As the underlying parser (generated by Antlr) uses a top-down approach it would recurse endlessly if you had a left recursive grammar.</p>
<p>Let&rsquo;s have a look at parsing a simple arithmetic expression:</p>
<div class="literallayout">
<p>
<code class="code">2&nbsp;+&nbsp;20&nbsp;*&nbsp;2<br>

</code>
</p>
</div>
<p>If you know EBNF a bit and wouldn&rsquo;t think about avoiding left recursion, operator precedence or associativity, you&rsquo;ld probably write a grammar like this:</p>
<div class="literallayout">
<p>
<code class="code">Expression&nbsp;:<br>
&nbsp;&nbsp;Expression&nbsp;'+'&nbsp;Expression&nbsp;|<br>
&nbsp;&nbsp;Expression&nbsp;'*'&nbsp;Expression&nbsp;|<br>
&nbsp;&nbsp;INT;<br>

<br>

</code>
</p>
</div>
<p>This grammar would be left recursive because the parser reads the grammar top down and left to right and would endlessly call the Expression rule without consuming any characters, i.e. altering the underlying state of the parser. While this kind of grammar can be written for bottom-up parsers, you&rsquo;ld still have to deal with operator precedence in addition. That is define that a multiplication has higher precedence than an addition for example.</p>
<p>In Xtext you define the precedence implicitly when left-factoring such a grammar. Left-factoring means you get rid of left recursion by applying a certain technique, which we will show in the following.</p>
<p>So here is a left-factored grammar (not yet working with Xtext) for the expression language above :</p>
<div class="literallayout">
<p>
<code class="code">Addition&nbsp;:<br>
&nbsp;&nbsp;Multiplication&nbsp;('+'&nbsp;Multiplication)*;<br>

<br>
Multiplication:<br>
&nbsp;&nbsp;NumberLiteral&nbsp;('*'&nbsp;NumberLiteral)*;<br>

<br>
NumberLiteral:<br>
&nbsp;&nbsp;INT;<br>

<br>

</code>
</p>
</div>
<p>As you can see the main difference is that we have three rules instead of one and if you look a bit closer you see, that there&rsquo;s a certain delegation pattern involved. The rule Addition doesn&rsquo;t call itself but calls Multiplication instead. The operator precedence is defined by the order of delegation. The later the rule is called the higher is its precedence. This is at least the case for the first two rules which are of a left recursive nature (but we&rsquo;ve left-factored them now). The last rule is not left recursive which is why you can write them down without applying this pattern.</p>
<p>We should allow users to explicitly adjust precedence by adding parenthesis, e.g. write something like (2 + 20) * 2.
				So let&rsquo;s add support for that (note that the grammar is still not working with Xtext):</p>
<div class="literallayout">
<p>
<code class="code">Addition&nbsp;:<br>
&nbsp;&nbsp;Multiplication&nbsp;('+'&nbsp;Multiplication)*;<br>

<br>
Multiplication:<br>
&nbsp;&nbsp;Primary&nbsp;('*'&nbsp;Primary)*;<br>

<br>
Primary&nbsp;:<br>
&nbsp;&nbsp;NumberLiteral&nbsp;|<br>
&nbsp;&nbsp;'('&nbsp;Addition&nbsp;')';<br>

<br>
NumberLiteral:<br>
&nbsp;&nbsp;INT;<br>
&nbsp;&nbsp;<br>

</code>
</p>
</div>
<p>So once again: if you have some construct that recurses on the left hand side, you need to put it into the delegation chain according to their operator precedence. The pattern is always the same, the thing that recurses delegates to the rule with the next higher precedence.</p>
<div class="section" title="Construction of an AST">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="ConstructionofanAST"></a>Construction of an AST</h3>
</div>
</div>
</div>
<p>Now that we know how to avoid left recursion, let&rsquo;s have a look at what the parser produces. In Xtext each rule returns some value. Parser rules return AST nodes (i.e. EObject instances), enum rules return enum literals and datatype rules as well as terminal rules return simple values like strings and the like (EDatatype in EMF jargon).
					Xtext can automatically infer whether some rule is a parser rule, i.e. constructs and returns an AST node, or if it is a datatype rule that returns a value. The grammar above only consists of datatype rules all of them returning plain strings.
					In order to construct an AST we need to add Assignments and Actions. But before we do that we need to talk about return types.</p>
<p>The return type of a rule can be specified explicitly using the &sbquo;returns&rsquo; keyword but can be inferred if the type&rsquo;s name is the same as the rule&rsquo;s name.
					That is</p>
<div class="literallayout">
<p>
<code class="code">NumberLiteral&nbsp;:&nbsp;...&nbsp;;<br>

<br>

</code>
</p>
</div>
<p>is a short form of</p>
<div class="literallayout">
<p>
<code class="code">NumberLiteral&nbsp;returns&nbsp;NumberLiteral&nbsp;:&nbsp;...&nbsp;;<br>

<br>

</code>
</p>
</div>
<p>However in the case of the expressions grammar above, all rules need to return the same type since they are recursive. So in order to make the grammar functional we need to add a common return type explicitly (but the grammar is still missing some bits):</p>
<div class="literallayout">
<p>
<code class="code">Addition&nbsp;returns&nbsp;Expression:<br>
&nbsp;&nbsp;Multiplication&nbsp;('+'&nbsp;Multiplication)*;<br>
&nbsp;&nbsp;<br>
Multiplication&nbsp;returns&nbsp;Expression:<br>
&nbsp;&nbsp;Primary&nbsp;('*'&nbsp;Primary)*;<br>
&nbsp;&nbsp;<br>
Primary&nbsp;returns&nbsp;Expression:<br>
&nbsp;&nbsp;NumberLiteral&nbsp;|<br>
&nbsp;&nbsp;'('&nbsp;Addition&nbsp;')';<br>
&nbsp;&nbsp;<br>
NumberLiteral:<br>
&nbsp;&nbsp;INT;<br>

<br>

</code>
</p>
</div>
<p>The AST type inference mechanism of Xtext will infer two types: Expression and NumberLiteral. Now we need to add assignments and Actions in order to store all the important information in the AST and to create reasonable subtypes for the two operations.</p>
<p>In the following you see the final fully working Xtext grammar:</p>
<div class="literallayout">
<p>
<code class="code">Addition&nbsp;returns&nbsp;Expression:<br>
&nbsp;&nbsp;Multiplication&nbsp;({Addition.left=current}&nbsp;'+'&nbsp;right=Multiplication)*;<br>
&nbsp;&nbsp;<br>
Multiplication&nbsp;returns&nbsp;Expression:<br>
&nbsp;&nbsp;Primary&nbsp;({Multiplication.left=current}&nbsp;'*'&nbsp;right=Primary)*;<br>
&nbsp;&nbsp;<br>
Primary&nbsp;returns&nbsp;Expression:<br>
&nbsp;&nbsp;NumberLiteral&nbsp;|<br>
&nbsp;&nbsp;'('&nbsp;Addition&nbsp;')';<br>
&nbsp;&nbsp;<br>
NumberLiteral:<br>
&nbsp;&nbsp;value=INT;<br>

<br>

</code>
</p>
</div>
<p>Let&rsquo;s go through the grammar as the parser would do it for the expression</p>
<div class="literallayout">
<p>
<code class="code">(1&nbsp;+&nbsp;20)&nbsp;*&nbsp;2<br>

<br>

</code>
</p>
</div>
<p>The parser always starts with the first rule (Addition). Therein the first element is an unassigned rule call to Multiplication which in turn calls Primary. Primary now has two alternatives. The first one is calling NumberLiteral which consists only of one assignment to a feature called &sbquo;value&rsquo;. The type of &sbquo;value&rsquo; has to be compatible to the return type of the INT rule.</p>
<p>But as the first token in the sample expression is an opening parenthesis &sbquo;(&rsquo; the parser will take the second alternative in Primary, consume the &sbquo;(&rsquo; and call the rule Addition. Now the value &sbquo;1&rsquo; is the lookahead token and again Addition calls Multiplication and Multiplication calls Primary. This time the parser takes the first alternative because &sbquo;1&rsquo; was consumed by the INT rule (which btw. is a reused library terminal rule).</p>
<p>As soon as the parser hits an assignment it checks whether an AST node for the current rule was already created. If not it will create one based on the return type of the current rule, which is NumberLiteral. The Xtext generator created an EClass &sbquo;NumberLiteral&rsquo; before which can now be instantiated. That type will also have a property called value of type int (actually of type EInt), which will get the value &sbquo;1&rsquo; set. This is what the Java equivalent would look like:</p>
<div class="literallayout">
<p>
<code class="code">//&nbsp;value=INT<br>
if&nbsp;(current&nbsp;==&nbsp;null)<br>
&nbsp;current&nbsp;=&nbsp;new&nbsp;NumberLiteral();<br>
current.setValue(ruleINT());<br>
...<br>

<br>

</code>
</p>
</div>
<p>Now that the rule has been completed the created EObject is returned to the calling rule Primary, which in turn returns the object unchanged to its own caller. Within Multiplication the call to Primary has been successfully parsed and returned an instance of NumberLiteral. The second part of the rule (everything within the parenthesis) is a so called group. The asterisk behind the closing parenthesis states that this part can be consumed zero or more times. The first token to consume in this part is the multiplication operator &sbquo;*&rsquo;. Unfortunately in the current situation the next token to accept is the plus operator &sbquo;+&rsquo;, so the group is not consumed at all and the rule returns what they got from the unassigned rule call (the NumberLiteral).</p>
<p>In rule Addition there&rsquo;s a similar group but this time it expects the correct operator so the parser steps into the group.
					The first element in the group is a so called action. As Xtext grammars are highly declarative and bi-directional it is not a good idea to allow arbitrary expression within actions as it is usually the case with parser generators. Instead we only support two kinds of actions. This one will create a new instance of type Addition and assign what was the to-be-returned object to the feature left. In Java this would have been something like:</p>
<div class="literallayout">
<p>
<code class="code">//&nbsp;Multiplication&nbsp;rule&nbsp;call<br>
current&nbsp;=&nbsp;ruleMultiplication();<br>
//&nbsp;{Addition.left=current}<br>
Addition&nbsp;temp&nbsp;=&nbsp;new&nbsp;Addition();<br>
temp.setLeft(current);<br>
current&nbsp;=&nbsp;temp;<br>
...<br>

<br>

</code>
</p>
</div>
<p>As a result the rule would now return an instance of Addition which has a NumberLiteral set to its property left. Next up the parser consumes the &sbquo;+&rsquo; operator. We do not store the operator in the AST because we have an explicit Addition type, which implicitly contains this information.
					The assignment (&sbquo;right=Multiplication&rsquo;) calls the rule Multiplication another time and assigns the returned object (a NumberLiteral of value=20) to the property named right.</p>
<p>If we now had an additional plus operation &sbquo;+&rsquo; (e.g. 1 + 2 + 3) the group would match another time and create another instance of Addition. But we don&rsquo;t and therefore the rule is completed and returns the created instance of Addition to its caller which was the second alternative in Primary. Now the closing parenthesis is matched and consumed and the parser stack is reduced once more.</p>
<p>We are now in rule Multiplication and have the multiplication operator &sbquo;*&rsquo; on the lookahead. The parser goes into the group and applies the action. Finally it calls the Primary rule, gets another instance of NumberLiteral (value=2), assigns it as the &sbquo;right&rsquo; operand of the Multiplication and returns the Multiplication to the rule Addition which in turn returns the very same object as there&rsquo;s nothing left to parse.</p>
<p>The resulting AST looks like this:</p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/expression-ast.png"></div>
<p>
				
</p>
<p>(It&rsquo;s pretty hard to follow what&rsquo;s going on just by reading this text. Therefore we have prepared a small video which visualizes and explains the details. see http://vimeo.com/14358869)</p>
</div>
<div class="section" title="Associativity">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Associativity"></a>Associativity</h3>
</div>
</div>
</div>
<p>There is still one topic we should mention, which is associativity. There is left and right associativity as well as none associativity. In the example we have seen left associativity. Associativity tells the parser how to construct the AST when there are two infix operations with the same precedence. The following example is taken from the corresponding wikipedia entry:</p>
<p>Consider the expression a ~ b ~ c. If the operator ~ has left associativity, this expression would be interpreted as (a ~ b) ~ c and evaluated left-to-right. If the operator has right associativity, the expression would be interpreted as a ~ (b ~ c) and evaluated right-to-left. If the operator is non-associative, the expression might be a syntax error, or it might have some special meaning.
					We already know the most important form which is left associativity:</p>
<div class="literallayout">
<p>
<code class="code">Addition&nbsp;returns&nbsp;Expression:<br>
&nbsp;&nbsp;Multiplication&nbsp;({Addition.left=current}&nbsp;'+'&nbsp;right=Multiplication)*;<br>

<br>

</code>
</p>
</div>
<p>Right associativity is done using the following pattern (note the quantity operator and the call to the rule itself at the end):</p>
<div class="literallayout">
<p>
<code class="code">Addition&nbsp;returns&nbsp;Expression:<br>
&nbsp;&nbsp;Multiplication&nbsp;({Addition.left=current}&nbsp;'+'&nbsp;right=Addition)?;<br>

<br>

</code>
</p>
</div>
<p>And if you don&rsquo;t want to allow multiple usages of the same expression in a row (hence non-associativity) you write:</p>
<div class="literallayout">
<p>
<code class="code">Addition&nbsp;returns&nbsp;Expression:<br>
&nbsp;&nbsp;Multiplication&nbsp;({Addition.left=current}&nbsp;'+'&nbsp;right=Multiplication)?;<br>

<br>

</code>
</p>
</div>
<p>Note that sometimes it&rsquo;s better to allow associativity on parser level, but forbid it later using validation, because you can come up with a better error message. Also the whole parsing process won&rsquo;t be interrupted, so your tooling will generally be more forgiving.</p>
</div>
</div>
</div>
<div class="chapter" title="Chapter&nbsp;10.&nbsp;Integration with EMF and Other EMF Editors">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="emf_integration"></a>Chapter&nbsp;10.&nbsp;Integration with EMF and Other EMF Editors</h2>
</div>
</div>
</div>
<p>Xtext relies heavily on EMF internally, but it can also be used as the serialization back-end of other EMF-based tools.
			In this section we introduce the basic concepts of the 
			<a class="ulink" href="http://www.eclipse.org/emf" target="_new">Eclipse Modeling Framework (EMF)</a> in the context of Xtext.  
			If you want to learn more about EMF, we recommend reading the 
			<a class="ulink" href="http://www.eclipse.org/emf" target="_new">EMF book</a>.
		</p>
<div class="section" title="Model, Ecore Model, and Ecore">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="model_metamodel"></a>Model, Ecore Model, and Ecore </h2>
</div>
</div>
</div>
<p>When Xtext uses EMF models as the in-memory representation of any parsed text files. This in-memory object graph is called the 
				<span class="emphasis"><em>Abstract Syntax Tree</em></span> (AST). 
				Depending on the community this concepts is also called 
				<span class="emphasis"><em>document object graph (DOM)</em></span>, 
				<span class="emphasis"><em>semantic model</em></span>, or simply 
				<span class="emphasis"><em>model</em></span>. We use 
				<span class="emphasis"><em>model</em></span> and 
				<span class="emphasis"><em>AST</em></span> interchangeably. 
				Given the example model from the 
				<a class="link" href="#getting-started-xtext" title="Creating a DSL">introduction</a>, the AST looks similar to this
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/ast.png"></div>
<p>
			
</p>
<p>The 
				<span class="emphasis"><em>AST</em></span> should contain the essence of your textual models and abstract over syntactical information. It is used by later processing steps, 
				such as validation, compilation or interpretation. In EMF a model is made up of instances of 
				<span class="emphasis"><em>EObjects</em></span> which are connected 
				and an 
				<span class="emphasis"><em>EObject</em></span> is an instance of an 
				<span class="emphasis"><em>EClass</em></span>. 
				A set of 
				<span class="emphasis"><em>EClasses</em></span> if contained in a so called 
				<span class="emphasis"><em>EPackage</em></span>, which are both concepts of 
				<span class="emphasis"><em>Ecore</em></span> 
				In Xtext, meta models are either inferred from the grammar or predefined by the user (see the section on 
				<a class="link" href="#package_declarations" title="EPackage Declarations">package declarations</a> for details). The next diagram shows the meta model of our example:
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/metamodel.png"></div>
<p> 
			
</p>
<p>The language in which the meta model is defined is called 
				<span class="emphasis"><em>Ecore</em></span>. In other words, the meta model is the Ecore model of your language. Ecore an essential part of EMF. Your your models instantiate the meta model, and your meta model instantiates Ecore. To put an end to this recursion, Ecore is defined in itself (an instance of itself). 
			</p>
<p>The meta model defines the types of the semantic nodes as Ecore 
				<span class="emphasis"><em>EClasses</em></span>. EClasses are shown as boxes in the meta mode diagram, so in our example, 
				<span class="emphasis"><em>Model</em></span>, 
				<span class="emphasis"><em>Type</em></span>, 
				<span class="emphasis"><em>SimpleType</em></span>, 
				<span class="emphasis"><em>Entity</em></span>, and 
				<span class="emphasis"><em>Property</em></span> are EClasses. An EClass can inherit from other EClasses. Multiple inheritance is allowed in Ecore, but of course cycles are forbidden.  
			</p>
<p>EClasses can have 
				<span class="emphasis"><em>EAttributes</em></span> for their simple properties. These are shown inside the EClasses nodes. The example contains two EAttributes 
				<span class="emphasis"><em>name</em></span> and one EAttribute 
				<span class="emphasis"><em>isMulti</em></span>. The domain of values for an EAttribute is defined by its 
				<span class="emphasis"><em>EDataType</em></span>. Ecore ships with some predefined 
				<span class="emphasis"><em>EDataTypes</em></span>, which essentially refer to Java primitive types and other immutable classes like String. To make a distinction from the Java types, the EDataTypes are prefixed with an 
				<span class="emphasis"><em>E</em></span>. In our example, that&rsquo;s 
				<span class="emphasis"><em>EString</em></span> and 
				<span class="emphasis"><em>EBoolean</em></span>.  
			</p>
<p>In contrast to EAttributes, 
				<span class="emphasis"><em>EReferences</em></span> point to other EClasses. The 
				<span class="emphasis"><em>containment</em></span> flag indicates whether an EReference is a 
				<span class="emphasis"><em>containment reference</em></span> or a 
				<span class="emphasis"><em>cross-reference</em></span>. In the diagram, references are edges and containment references are marked with a diamond. At the model level, each element can have at most one container, i.e. another element referring to it with a containment reference. This infers a tree structure to the models, as can be seen in the sample model diagram. On the other hand, 
				<span class="emphasis"><em>cross-references</em></span> refer to elements that can be contained anywhere else. In the example, 
				<span class="emphasis"><em>elements</em></span> and 
				<span class="emphasis"><em>properties</em></span> are containment references, while 
				<span class="emphasis"><em>type</em></span> and 
				<span class="emphasis"><em>extends</em></span> are cross-references. For reasons of readability, we skipped the cross-references in the sample model diagram. Note that in contrast to other parser generators, Xtext creates ASTs with linked cross-references. 
			</p>
<p>Other than associations in UML, EReferences in Ecore are always owned by one EClass and only navigable in the direction form the owner to the type. Bi-directional associations must be modeled as two references, being 
				<span class="emphasis"><em>eOpposite</em></span> of each other and owned by either end of the associations.
			</p>
<p>The superclass of EAttibutes and EReferences is 
				<span class="emphasis"><em>EStructuralFeature</em></span> and allows to define a name and a cardinality by setting 
				<span class="emphasis"><em>lowerBound</em></span> and 
				<span class="emphasis"><em>upperBound</em></span>. Setting the latter to -1 means &sbquo;unbounded&rsquo;. 
			</p>
<p>The common supertype of EDataType and EClass is 
				<span class="emphasis"><em>EClassifier</em></span>. An 
				<span class="emphasis"><em>EPackage</em></span> acts as a namespace and container of EClassifiers. 
			</p>
<p>We have summarized these most relevant concepts of Ecore in the following diagram:  </p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/ecore.png"></div>
<p>
			
</p>
</div>
<div class="section" title="EMF Code Generation">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="emf_codegen"></a>EMF Code Generation</h2>
</div>
</div>
</div>
<p>EMF also ships with a code generator that generates Java classes from your Ecore model. The code generators input is the so called 
				<span class="emphasis"><em>EMF generator model</em></span>. It decorates (references) the Ecore model and adds additional information for the Ecore -&gt; Java transformation. Xtext will automatically generate a generator model with reasonable defaults for all generated metamodels, and run the EMF code generator on them. 
			</p>
<p>The generated classes are based on the EMF runtime library, which offers a lot of infrastructure and tools to work with your models, such as persistence, reflection, referential integrity, lazy loading etc.</p>
<p>Among other things, the code generator will generate</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>A Java interface and a Java class for each EClassifier in your Ecore model. By default, all classes will implement the interface 
						<span class="emphasis"><em>org.eclipse.emf.ecore.EObject</em></span>, linking a lot of runtime functionality. 
					</p>
</li>
<li class="listitem">
<p>A Java bean property for each EStructuralFeature (member variable, accessor methods)</p>
</li>
<li class="listitem">
<p>A package interface and class, holding singleton objects for all elements of your Ecore model, allowing reflection. EPackages are also registered to the 
						<span class="emphasis"><em>EPackage.Registry</em></span> to be usable at runtime.
					</p>
</li>
<li class="listitem">
<p>A factory interface and class for creating instances</p>
</li>
<li class="listitem">
<p>An abstract switch class implementing a visitor pattern to avoid if-instanceof cascades in your code.</p>
</li>
</ul>
</div>
</div>
<div class="section" title="XtextResource Implementation">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="xtext_resource"></a>XtextResource Implementation</h2>
</div>
</div>
</div>
<p>Xtext provides an implementation of EMF&rsquo;s resource, the 
				<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/resource/XtextResource.java?root=Modeling_Project&view=co" target="_new">XtextResource</a>. This does not only encapsulate the parser that converts text to an EMF model but also the serializer working the opposite direction. That way, an Xtext model just looks like any other Ecore-based model from the outside, making it amenable for the use by other EMF based tools. In fact, the Xpand templates in the generator plug-in created by the Xtext wizard do not make any assumption on the fact that the model is described in Xtext, and they would work fine with any model based on the same Ecore model of the language. So in the ideal case, you can switch the serialization format of your models to your self-defined DSL by just replacing the resource implementation used by your other modeling tools. 
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/emf-integration.png"></div>
<p>
			
</p>
<p>The generator fragment 
				<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/resourceFactory/ResourceFactoryFragment.java?root=Modeling_Project&view=co" target="_new">ResourceFactoryFragment</a> registers a factory for the 
				<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/resource/XtextResource.java?root=Modeling_Project&view=co" target="_new">XtextResource</a> to EMF&rsquo;s resource factory registry, such that all tools using the default mechanism to resolve a resource implementation will automatically get that resource implementation.   
			</p>
<p>Using a self-defined textual syntax as the primary storage format has a number of advantages over the default XMI serialization, e.g.</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>You can use well-known and easy-to-use tools and techniques for manipulation, such as text editors, regular expressions, or stream editors.</p>
</li>
<li class="listitem">
<p>You can use the same tools for version control as you use for source code. Merging and diffing is performed in a syntax the developer is familiar with. </p>
</li>
<li class="listitem">
<p>It is impossible to break the model such that it cannot be reopened in the editor again. </p>
</li>
<li class="listitem">
<p>Models can be fixed using the same tools, even if they have become incompatible with a new version of the Ecore model.</p>
</li>
</ul>
</div>
<p>Xtext targets easy to use and naturally feeling languages. It focuses on the lexical aspects of a language a bit more than on the semantic ones. As a consequence, a referenced Ecore model can contain more concepts than are actually covered by the Xtext grammar. As a result, not everything that is possibly expressed in the EMF model can be serialized back into a textual representation with regards to the grammar. So if you want to use Xtext to serialize your models as described above, it is good to have a couple of things in mind:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>Prefer optional rule calls (cardinality 
						<span class="emphasis"><em>?</em></span> or 
						<span class="emphasis"><em>*</em></span>) to mandatory ones (cardinality 
						<span class="emphasis"><em>+</em></span> or default), such that missing references will not obstruct serialization. 
					</p>
</li>
<li class="listitem">
<p>You should not use an Xtext-Editor on the same model instance as a self-synchronizing other editor, e.g. a canonical GMF editor (see :#gmf_integration_stage_1 for details). The Xtext parser replaces re-parsed subtrees of the AST rather than modifying it, so elements will become stale. As the Xtext editor continuously re-parses the model on changes, this will happen rather often. It is safer to synchronize editors more loosely, e.g. on file changes. </p>
</li>
<li class="listitem">
<p>Implement an 
						<span class="emphasis"><em>IFragmentProvider</em></span>:#fragmentProvider to make the XtextResource return stable fragments for its contained elements, e.g. based on composite names rather than order of appearance.
					</p>
</li>
<li class="listitem">
<p>Implement an 
						<span class="emphasis"><em>IQualifiedNameProvider</em></span> and an 
						<span class="emphasis"><em>IScopeProvider</em></span>:#scoping to make the names of all linkable elements in cross-references unique. 
					</p>
</li>
<li class="listitem">
<p>Provide an 
						<span class="emphasis"><em>IFormatter</em></span>:#formatting to improve the readability of the generated textual models.  
					</p>
</li>
<li class="listitem">
<p>Register an 
						<span class="emphasis"><em>IReferableElementsUnloader</em></span> to turn deleted/replaced model elements into EMF proxies. Design the rest of your application such that it does never keep references to  
						<span class="emphasis"><em>EObjects</em></span> or to cope with proxies. That will improve the stability of your application drastically.
					</p>
</li>
<li class="listitem">
<p>Xtext will register an EMF 
						<span class="emphasis"><em>ResourceFactory</em></span>, so resources with the file extension you entered when generating the Xtext plug-ins will be automatically loaded in an 
						<span class="emphasis"><em>XtextResource</em></span> when you use EMF&rsquo;s 
						<span class="emphasis"><em>ResourceSet</em></span> API to load it.
					</p>
</li>
</ul>
</div>
</div>
<div class="section" title="Integration with GMF Editors">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="gmf_integration"></a>Integration with GMF Editors</h2>
</div>
</div>
</div>
<p>The 
				<a class="ulink" href="http://www.eclipse.org/modeling/gmp/?project=gmf" target="_new">Graphical Modeling Framework (GMF)</a> allows to create graphical diagram editors for Ecore models. To illustrate how to build a GMF on top of an 
				<span class="emphasis"><em>XtextResource</em></span> we have provided an example. You must have the Helios version 2.3 of GMF Notation, Runtime and Tooling and their dependencies installed in your workbench to run the example. With other versions of GMF it might work to regenerate the diagram code. Choose 
				<span class="emphasis"><em>New-&gt;Examples-&gt;Xtext-&gt;Xtext GMF Integration</em></span> to import it into your workbench. The example consists of a number of plug-ins
			</p>
<table id="N122DF">
<tr>
					
<td>Plug-in</td>
					<td>Framework</td>
					<td>Purpose</td>
					<td>Contents</td>
				
</tr>
<tr>
					
<td>o.e.x.example.gmf</td>
					<td>Xtext</td>
					<td>Xtext runtime plug-in</td>
					<td>Grammar, derived metamodel and language infrastructure</td>
				
</tr>
<tr>
					
<td>o.e.x.e.g.ui</td>
					<td>Xtext</td>
					<td>Xtext UI plug-in</td>
					<td>Xtext editor and services</td>
				
</tr>
<tr>
					
<td>o.e.x.e.g.edit</td>
					<td>EMF</td>
					<td>EMF.edit plug-in</td>
					<td>UI services generated from the metamodel</td>
				
</tr>
<tr>
					
<td>o.e.x.e.g.models</td>
					<td>GMF</td>
					<td>GMF design models</td>
					<td>Input for the GMF code generator</td>
				
</tr>
<tr>
					
<td>o.e.x.e.g.diagram</td>
					<td>GMF</td>
					<td>GMF diagram editor</td>
					<td>Purely generated from the GMF design models</td>
				
</tr>
<tr>
					
<td>o.e.x.e.g.d.extensions</td>
					<td>GMF and Xtext</td>
					<td>GMF diagram editor extensions</td>
					<td>Manual extensions to the generated GMF editor for integration with Xtext</td>
				
</tr>
<tr>
					
<td>o.e.x.gmf.glue</td>
					<td>Xtext and GMF</td>
					<td>Glue code</td>
					<td>Generic code to integrate Xtext and GMF</td>
				
</tr>
</table>
<p>We will elaborate the example in three stages.</p>
<div class="section" title="Stage 1: Make GMF Read and Write the Semantic Model As Text">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="gmf_integration_stage_1"></a>Stage 1: Make GMF Read and Write the Semantic Model As Text</h3>
</div>
</div>
</div>
<p>A diagram editor in GMF by default manages two resources: One for the semantic model, that is the model we&rsquo;re actually interested in for further processing. In our example it is a model representing entities and datatypes. The second resource holds the notation model. It represents the shapes you see in the diagram and their graphical properties. Notation elements reference their semantic counterparts. An entity&rsquo;s name would be in the semantic model, while the font to draw it in the diagram would be stored the notation model. Note that in the integration example we&rsquo;re only trying to represent the semantic resource as text.</p>
<p>To keep the semantic model and the diagram model in sync, GMF uses a so called 
					<span class="emphasis"><em>CanonicalEditPolicy</em></span>. This component registers as a listener to the semantic model and automatically updates diagram elements when their semantic counterparts change, are added or are removed. Some notational information can be derived from the semantic model by some default mapping, but usually there is a lot of graphical stuff that the user wants to change to make the diagram look better.   
				</p>
<p>In an Xtext editor, changes in the text are transfered to the underlying 
					<span class="emphasis"><em>XtextResource</em></span> by a call to the method 
					<span class="emphasis"><em>org.eclipse.xtext.resource.XtextResource.update(int, int, String)</em></span>, which will trigger a partial parsing of the dirty text region and a replacement of the corresponding subtree in the AST model (semantic model). 
				</p>
<p>Having an Xtext editor and a canonical GMF editor on the same resource can therefore lead to loss of notational information, as a change in the Xtext editor will remove a subtree in the AST, causing the  
					<span class="emphasis"><em>CanonicalEditPolicy</em></span> to remove all notational elements, even though it was customized by the user. The Xtext rebuilds the AST and the notation model is restored using the default mapping. It is therefore not recommended to let an Xtext editor and a canonical GMF editor work on the same resource.    
				</p>
<p>In this example, we let each editor use its own memory instance of the model and synchronize on file changes only. Both frameworks already synchronize with external changes to the edited files out-of-the-box. In the glue code, a 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.gmf.glue/src/org/eclipse/xtext/gmf/glue/concurrency/ConcurrentModificationObserver.java?root=Modeling_Project&view=co" target="_new">ConcurrentModificationObserver</a> warns the user if she tries to edit the same file with two different model editors concurrently.
				</p>
<p>In the example, we started with writing an Xtext grammar for an entity language. As explained above, we preferred optional assignments and rather covered mandatory attributes in a validator. Into the bargain, we added some services to improve the EMF integration, namely a formatter, a fragment provider and an unloader. Then we let Xtext generate the language infrastructure. From the derived Ecore model and its generator model, we generated the edit plug-in (needed by GMF) and added some fancier icons. </p>
<p>From the GMF side, we followed the default procedure and created a gmfgraph model, a gmftool model and a gmfmap model referring to the Ecore model derived form the Xtext grammar. We changed some settings in the gmfgen model derived by GMF from the gmfmap model, namely to enable printing and to enable validation and validation decorators. Then we generated the diagram editor.     </p>
<p>Voil&agrave;, we now have a diagram editor that reads/writes its semantic model as text. Also note that the validator from Xtext is already integrated in the diagram editor via the menu bar. </p>
<div class="section" title="Stage 2: Calling the Xtext Parser to Parse GMF Labels">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="Stage2CallingtheXtextParsertoParseGMFLabels"></a>Stage 2: Calling the Xtext Parser to Parse GMF Labels</h4>
</div>
</div>
</div>
<p>GMF&rsquo;s generated parser for the labels is a bit poor: It will work on attributes only, and will fail for cross-references, e.g. an attibute&rsquo;s type. So why not use the Xtext parser to process the user&rsquo;s input? </p>
<p>An 
						<span class="emphasis"><em>XtextResource</em></span> keeps track of it&rsquo;s concrete syntax representation by means of a so called node model (see :#parser_rules for a more detailed description). The node model represents the parse tree and provides information on the offset, length and text that has been parsed to create a semantic model element. The nodes are attached to their semantic elements by means of a node adapter.    
					</p>
<p>We can use the node adapter to access the text block that represents an attribute, and call the Xtext parser to parse the user input. The example code is contained in  
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.gmf.glue/src/org/eclipse/xtext/gmf/glue/edit/part/AntlrParserWrapper.java?root=Modeling_Project&view=co" target="_new">AntlrParserWrapper</a>. 
						<span class="emphasis"><em>SimplePropertyWrapperEditPartOverride</em></span> shows how this is integrated into the generated GMF editor. Use the 
						<span class="emphasis"><em>EntitiesEditPartFactoryOverride</em></span> to instantiate it and the 
						<span class="emphasis"><em>EntitiesEditPartProviderOverride</em></span> to create the overridden factory, and register the latter to the extension point. Note that this is a non-invasive way to extend generated GMF editors.
					</p>
<p>When you test the editor, you will note that the node model will be corrupt after editing a few labels. This is because the node model is only updated by the Xtext parser and not by the serializer. So we need a way to automatically call the (partial) parser every time the semantic model is changed. You will find the required classes in the package 
						<span class="emphasis"><em>org.eclipse.xtext.gmf.glue.editingdomain</em></span>. To activate node model reconciling, you have to add a line 
					</p>
<div class="literallayout">
<p>
<code class="code">XtextNodeModelReconciler.adapt(editingDomain);<br>

<br>

</code>
</p>
</div>
<p>in the method 
						<span class="emphasis"><em>createEditingDomain()</em></span> of the generated 
						<span class="emphasis"><em>EntitiesDocumentProvider</em></span>. To avoid changing the generated code, you can modify the code generation template for that class by setting
					</p>
<div class="literallayout">
<p>
<code class="code">Dynamic&nbsp;Templates&nbsp;-&gt;&nbsp;true<br>
	&nbsp;&nbsp;&nbsp;Template&nbsp;Directory&nbsp;-&gt;&nbsp;"org.eclipse.xtext.example.gmf.models/templates"<br>
	&nbsp;&nbsp;&nbsp;<br>

</code>
</p>
</div>
<p>in the 
						<span class="emphasis"><em>GenEditorGenerator</em></span> and 
					</p>
<div class="literallayout">
<p>
<code class="code">Required&nbsp;Plugins&nbsp;-&gt;&nbsp;"org.eclipse.xtext.gmf.glue"&nbsp;<br>

<br>

</code>
</p>
</div>
<p>in the 
						<span class="emphasis"><em>GenPlugin</em></span> element of the gmfgen before generating the diagram editor anew.
					</p>
</div>
<div class="section" title="Stage 3: A Popup Xtext Editor (experimental)">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="Stage3APopupXtextEditorexperimental"></a>Stage 3: A Popup Xtext Editor (experimental)</h4>
</div>
</div>
</div>
<p>
						
<span class="emphasis"><em>SimplePropertyPopupXtextEditorEditPartOverride</em></span> demonstrates how to spawn an Xtext editor to edit a model element. The editor pops up in its control and shows only the section of the selected element. It is a fully fledged Xtext editor, with support of validation, code assist and syntax highlighting. The edited text is only transfered back to the model if it does not have any errors.   
					</p>
<p>Note that there still are synchronization issues, that&rsquo;s why we keep this one marked as experimental.</p>
</div>
</div>
</div>
</div>
<div class="chapter" title="Chapter&nbsp;11.&nbsp;Migrating from Xtext 0.7.x to 1.0">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="migrating_from_0_7"></a>Chapter&nbsp;11.&nbsp;Migrating from Xtext 0.7.x to 1.0</h2>
</div>
</div>
</div>
<p>Most of the tasks when migrating to Xtext 1.0 can be automated. Some changes will be necessary in the manually written code where you have to carefully
			verify that your implementation is still working with Xtext 1.0. A reliable test-suite helps a lot. </p>
<p>The grammar language is fully backward compatible. You should not have to apply any changes in the primary artifact. However, we introduced some additional
			validation rules that mark inconsistencies in your grammar. If you get any warnings in the grammar editor, it should be straight forward to fix them.</p>
<p>
			
<span class="emphasis"><em>Tip: You&rsquo;ll learn something about the new features if you compare a freshly created Xtext project based on 0.7.x with a new Xtext project based on 1.0. Especially the new fragments in the workflow are a good indicator for useful new features.</em></span> 
		
</p>
<div class="section" title="Take the Shortcut">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="TaketheShortcut"></a>Take the Shortcut</h2>
</div>
</div>
</div>
<p>If you haven&rsquo;t made too many customizations to the generated defaults and if you&rsquo;re not referencing many classes of your Xtext language from the outside, you might consider starting with a new Xtext project, copying your grammar and then manually restoring your changes step by step. If that does not work for you, go on reading!</p>
</div>
<div class="section" title="Migrating Step By Step">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="MigratingStepByStep"></a>Migrating Step By Step</h2>
</div>
</div>
</div>
<p>Before you start the migration to Xtext 1.0, you should make sure that no old plug-ins are in your target platform. Some plug-ins from Xtext 0.7.x have been merged and 
				do no longer exist. </p>
<p>
				
<span class="emphasis"><em>Tip: The following steps try to use the Eclipse compiler to spot any source-incompatible changes while fixing them with only a few well described user actions. Doing these steps in another order causes most likely a higher effort.</em></span>
			
</p>
<div class="section" title="Update the Plug-in Dependencies and Import Statements">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="UpdatethePluginDependenciesandImportStatements"></a>Update the Plug-in Dependencies and Import Statements</h3>
</div>
</div>
</div>
<p>You should update the constraints from version 
					<span class="emphasis"><em>0.7.x</em></span> to 
					<span class="emphasis"><em>[1.0.0,2.0.0)</em></span> in your manifest files if you specified any concrete versions.
					Make sure that your 
					<span class="emphasis"><em>dsl.ui</em></span>-projects do not refer to the plug-in 
					<span class="emphasis"><em>org.eclipse.xtext.ui.common</em></span> or 
					<span class="emphasis"><em>org.eclipse.xtext.ui.core</em></span> but to 
					<span class="emphasis"><em>org.eclipse.xtext.ui</em></span> instead. The arguably easiest way is a global text-based search and replace across the manifest files. The bundle 
					<span class="emphasis"><em>org.eclipse.xtext.log4j</em></span> is obsolete as well. The generator will create 
					<span class="emphasis"><em>import-package</em></span> entries in the manifests later on.
				</p>
<p>The next step is to fix the import statements in your classes to match the refactored naming scheme in Xtext. Perform a global search for "
					<span class="emphasis"><em>import org.eclipse.xtext.ui.common.</em></span>" and 
					"
					<span class="emphasis"><em>import org.eclipse.xtext.ui.core.</em></span>" and replace the matches with "
					<span class="emphasis"><em>import org.eclipse.xtext.ui.</em></span>". This fixes most of the problems in the manually written code. 
				</p>
</div>
<div class="section" title="Rename the Packages in the dsl.ui-Plug-in">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="RenamethePackagesinthedsl.uiPlugin"></a>Rename the Packages in the dsl.ui-Plug-in</h3>
</div>
</div>
</div>
<p>We changed the naming pattern for artifacts in the 
					<span class="emphasis"><em>dsl.ui</em></span>-plug-in to match the OSGI conventions. The easiest way to update your existing projects is to apply a 
&bdquo;					Rename Package&rdquo; refactoring on the packages in the 
					<span class="emphasis"><em>src</em></span>- and 
					<span class="emphasis"><em>src-gen</em></span> folder 
					<span class="bold"><strong>before</strong></span> you re-run the workflow that regenerates your language. Make sure you ticked &bdquo;Rename sub-packages&rdquo; in the dialog. It is error-prone to enable the search in non-Java files as this will perform incompatible changes in the manifest files. Furthermore, it is important to perform the rename operation in the 
					<span class="emphasis"><em>src-gen</em></span> folder, too. This ensures that the references in your manually written code are properly updated.
				</p>
</div>
<div class="section" title="Update the Workflow">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="UpdatetheWorkflow"></a>Update the Workflow</h3>
</div>
</div>
</div>
<p>The 
					<span class="emphasis"><em>JavaScopingFragment</em></span> does no longer exist. It has been superseded by the 
					<span class="emphasis"><em>ImportURIScopingFragment</em></span> in combination with the 
					<span class="emphasis"><em>SimpleNamesFragment</em></span>.
					Please replace  
				</p>
<div class="literallayout">
<p>
<code class="code">&lt;fragment&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;class="org.eclipse.xtext.generator.scoping.JavaScopingFragment"/&gt;<br>

</code>
</p>
</div>
<p>with</p>
<div class="literallayout">
<p>
<code class="code">&lt;fragment&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;class="org.eclipse.xtext.generator.scoping.ImportURIScopingFragment"/&gt;<br>
&lt;fragment&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;class="org.eclipse.xtext.generator.exporting.SimpleNamesFragment"/&gt;<br>

</code>
</p>
</div>
<p>The 
					<span class="emphasis"><em>PackratParserFragment</em></span> has been abandoned as well. It is save to remove the reference to that one if it is activated in your workflow. After you&rsquo;ve changed your workflow, it should be possible to regenerate your language without any errors in the console. It is ok to have compilation errors prior to executing the workflow.
				</p>
</div>
<div class="section" title="MANIFEST.MF and plugin.xml">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="MANIFEST.MFandplugin.xml"></a>MANIFEST.MF and plugin.xml</h3>
</div>
</div>
</div>
<p>The previous rename package refactoring updated most of the entries in the 
					<span class="emphasis"><em>MANIFEST.MF</em></span> and and some entries in the 
					<span class="emphasis"><em>plugin.xml</em></span>. Others have to be fixed manually. The Eclipse compiler will point to many of the remaining problems in the manifest files but it is unlikely that it will spot the erroneous references in the 
					<span class="emphasis"><em>plugin.xml</em></span>.
				</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>In the generated UI plug-in&rsquo;s 
							<span class="emphasis"><em>MANIFEST.MF</em></span>, remove the package exports of no longer existing packages and make sure the bundle activator points to the newly generated one (with 
							<span class="emphasis"><em>.ui.</em></span> in its package name).  
						</p>
</li>
<li class="listitem">
<p>It was already mentioned that the plug-ins 
							<span class="emphasis"><em>org.eclipse.xtext.ui.core</em></span> and 
							<span class="emphasis"><em>org.eclipse.xtext.ui.common</em></span> have been merged into a new single plug-in 
							<span class="emphasis"><em>org.eclipse.xtext.ui</em></span>. The same happened to the respective Java packages. Change eventually remaining bundle-dependencies in all manifests. 
						</p>
</li>
<li class="listitem">
<p>The plug-in 
							<span class="emphasis"><em>org.eclipse.xtext.log4j</em></span> no longer exists. We use a package import of 
							<span class="emphasis"><em>org.apache.log4j</em></span> instead. Also remove the buddy registration. 
						</p>
</li>
<li class="listitem">
<p>Due to renamed packages, you have to fix all references to classes therein in the 
							<span class="emphasis"><em>plugin.xml</em></span>. A diff with the _plugin.xml___gen_ will be a great help. If you haven&rsquo;t added a lot manually, consider merging these into the generated version instead of going the other way around. Note that warnings in the 
							<span class="emphasis"><em>plugin.xml</em></span> can be considered to be real errors most of the time. Make sure
						</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="circle">
<li class="listitem">
<p>the 
									<span class="emphasis"><em>ExecutableExtensionFactory</em></span> has the 
									<span class="emphasis"><em>.ui.</em></span> package prefix
								</p>
</li>
<li class="listitem">
<p>classes from 
									<span class="emphasis"><em>org.eclipse.xtext.ui.common</em></span> and 
									<span class="emphasis"><em>org.eclipse.xtext.ui.core</em></span> are now usually somewhere in 
									<span class="emphasis"><em>org.eclipse.xtext.ui</em></span>. They are also referenced by the 
									<span class="emphasis"><em>ExecutableExtensionFactory</em></span> and thus not covered by the editor&rsquo;s validation. 
								</p>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>A number of new features are being registered in the 
							<span class="emphasis"><em>plugin.xml</em></span>, e.g. 
							<span class="emphasis"><em>Find references</em></span>, 
							<span class="emphasis"><em>Quick Outline</em></span>, and 
							<span class="emphasis"><em>Quick Fixes</em></span>. You can enable them by manually copying the respective entries from _plugin.xml___gen_ to  
							<span class="emphasis"><em>plugin.xml</em></span>.
						</p>
</li>
<li class="listitem">
<p>To run MWE2 workflows later on, you must change the plug-in dependencies from 
							<span class="emphasis"><em>org.eclipse.emf.mwe.core</em></span> to 
							<span class="emphasis"><em>org.eclipse.emf.mwe2.launch</em></span> in your manifest. Optional resolution is fine.
						</p>
</li>
</ul>
</div>
</div>
<div class="section" title="Noteworthy API Changes">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="NoteworthyAPIChanges"></a>Noteworthy API Changes </h3>
</div>
</div>
</div>
<p>The 
					<span class="emphasis"><em>src</em></span> folders are generated once, so existing code will not be overwritten but has to be updated manually. At least one new class has appeared in your 
					<span class="emphasis"><em>src</em></span>-folder of the 
					<span class="emphasis"><em>ui</em></span> plug-in. there will now be a 
					<span class="emphasis"><em>StandaloneSetup</em></span> inheriting form the generated 
					<span class="emphasis"><em>StandaloneSetupGenerated</em></span> to allow customization.
				</p>
<p>You will face a couple of compilation problems due to changes in the API. Here&rsquo;s a list of the most prominent changes. It is usually only necessary to change your code, if you face any compilation problems.</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>The method 
							<span class="emphasis"><em>IScopeProvider.getScope(EObject,EClass)</em></span> has been removed. Use  
							<span class="emphasis"><em>IScopeProvider.getScope(EObject,EReference)</em></span> instead. 
						</p>
</li>
<li class="listitem">
<p>Renamed 
							<span class="emphasis"><em>DefaultScopeProvider</em></span> to 
							<span class="emphasis"><em>SimpleNameScopeProvider</em></span>. There have been further significant changes in the scoping API that allow for optimized implementations. Consult the 
							<a class="link" href="#scoping" title="Scoping">section on scoping</a> for details.
						</p>
</li>
<li class="listitem">
<p>The return type of 
							<span class="emphasis"><em>AbstractInjectableValidator.getEPackages()</em></span> was changed from 
							<span class="emphasis"><em>List&lt;? extends EPackage&gt;</em></span> to 
							<span class="emphasis"><em>List&amp;lt;EPackage&gt;</em></span>.
						</p>
</li>
<li class="listitem">
<p>The parser interfaces now use 
							<span class="emphasis"><em>java.io.Reader</em></span> instead of 
							<span class="emphasis"><em>java.io.InputStream</em></span> to explicitly address encoding. Have a look at the 
							<a class="link" href="#encoding" title="Encoding in Xtext">section on encoding</a> for details.
						</p>
</li>
<li class="listitem">
<p>The handling of 
							<span class="emphasis"><em>ILabelProvider</em></span> in various contexts has been refactored. The former base class 
							<span class="emphasis"><em>DefaultLabelProvider</em></span> no longer exists. Use the 
							<span class="emphasis"><em>DefaultEObjectLabelProvider</em></span> instead. See the 
							<a class="link" href="#labelProvider" title="Label Provider">section on label providers</a> for details. 
						</p>
</li>
<li class="listitem">
<p>We have introduced a couple of new packages to better separate concerns. Most classes should be easy to relocate. </p>
</li>
<li class="listitem">
<p>The runtime and UI modules have separate base classes 
							<span class="emphasis"><em>DefaultRuntimeModule</em></span> and 
							<span class="emphasis"><em>DefaultUiModule</em></span> now. We use Guice&rsquo;s module overrides to combine them with the newly introduced 
							<span class="emphasis"><em>SharedModule</em></span>.  You have to add a constructor the your 
							<span class="emphasis"><em>UiModule</em></span> that takes an 
							<span class="emphasis"><em>AbstractUiPlugin</em></span> as argument and pass that one to the super constructor. 
							<span class="emphasis"><em>Tip: There is an Eclipse quick fix available for that one.</em></span>
						
</p>
</li>
<li class="listitem">
<p>The interfaces 
							<span class="emphasis"><em>ILexicalHighlightigConfiguration</em></span> and 
							<span class="emphasis"><em>ISemanticHighlightingConfiguration</em></span> have been merged into 
							<span class="emphasis"><em>IHighlightingConfiguration</em></span>.
						</p>
</li>
<li class="listitem">
<p>The 
							<span class="emphasis"><em>DefaultTemplateProposalProvider</em></span> takes an additional, injectable constructor parameter of type 
							<span class="emphasis"><em>ContextTypeIdHelper</em></span>.
						</p>
</li>
<li class="listitem">
<p>The 
							<span class="emphasis"><em>HyperlinkHelper</em></span> uses field injection instead of constructor injection. The method 
							<span class="emphasis"><em>createHyperlinksByOffset</em></span> should be overridden instead of the former 
							<span class="emphasis"><em>findCrossLinkedEObject</em></span>.
						</p>
</li>
<li class="listitem">
<p>The API to skip a node in the outline has changed. Instead of returning the _HIDDEN_NODE_ you&rsquo;ll have to implement 
							<span class="emphasis"><em>boolean consumeNode(MyType)</em></span> and return 
							<span class="emphasis"><em>false</em></span>.
						</p>
</li>
<li class="listitem">
<p>The 
							<span class="emphasis"><em>Readonly*Storage</em></span> implementations have been removed. There is a new API to open editors for objects with a given URI. Please use the 
							<span class="emphasis"><em>IURIEditorOpener</em></span> to create an editor or the 
							<span class="emphasis"><em>IStorage2UriMapper</em></span> to obtain an 
							<span class="emphasis"><em>IStorage</em></span> for a given URI.
						</p>
</li>
<li class="listitem">
<p>The interfaces 
							<span class="emphasis"><em>IStateAccess</em></span> and 
							<span class="emphasis"><em>IEObjectHandle</em></span> have been moved along with the 
							<span class="emphasis"><em>IUnitOfWork</em></span> to the package 
							<span class="emphasis"><em>org.eclipse.xtext.util.concurrent</em></span>.
						</p>
</li>
<li class="listitem">
<p>The 
							<span class="emphasis"><em>ValidationJobFactory</em></span> is gone. Please implement a custom 
							<span class="emphasis"><em>IResourceValidator</em></span> instead.
						</p>
</li>
<li class="listitem">
<p>The grammar elements 
							<span class="emphasis"><em>Alternatives</em></span> and 
							<span class="emphasis"><em>Group</em></span> have a new common super type 
							<span class="emphasis"><em>CompoundElement</em></span>. The methods 
							<span class="emphasis"><em>getGroups</em></span> and 
							<span class="emphasis"><em>getTokens</em></span> have been refactored to 
							<span class="emphasis"><em>getElements</em></span>.
						</p>
</li>
<li class="listitem">
<p>Completion proposals take a 
							<span class="emphasis"><em>StyledString</em></span> instead of a plain string as display string.
						</p>
</li>
<li class="listitem">
<p>The 
							<span class="emphasis"><em>AbstractLabelProvider</em></span> does no longer expose its 
							<span class="emphasis"><em>IImageHelper</em></span>. Use 
							<span class="emphasis"><em>convertToImage</em></span> instead or inject your own 
							<span class="emphasis"><em>IImageHelper</em></span>.
						</p>
</li>
<li class="listitem">
<p>The implementation-classes from 
							<span class="emphasis"><em>org.eclipse.xtext.index</em></span> were superseded by the builder infrastructure. Use the 
							<span class="emphasis"><em>QualifiedNamesFragment</em></span> and the 
							<span class="emphasis"><em>ImportNamespacesScopingFragment</em></span> instead of the 
							<span class="emphasis"><em>ImportedNamespacesScopingFragment</em></span>. Please refer to the section about the builder infrastructure for details.
						</p>
</li>
<li class="listitem">
<p>All the Xtend-based fragments were removed. </p>
</li>
<li class="listitem">
<p>
							
<span class="emphasis"><em>ILinkingService.getLinkText</em></span> was removed. Have a look at the 
							<span class="emphasis"><em>LinkingHelper</em></span> and the 
							<span class="emphasis"><em>CrossReferenceSerializer</em></span> if you relied on this method.
						</p>
</li>
<li class="listitem">
<p>The 
							<span class="emphasis"><em>SerializerUtil</em></span> was renamed to 
							<span class="emphasis"><em>Serializer</em></span>. There were other heavy refactorings that involved the serializer and its components (like e.g. the 
							<span class="emphasis"><em>ITransientValueService</em></span>) but it should be pretty straight forward to migrate existing client code.
						</p>
</li>
<li class="listitem">
<p>The method-signatures of the 
							<span class="emphasis"><em>IFragmentProvider</em></span> have changed. The documentation will give a clue on how to update existing implementations.
						</p>
</li>
<li class="listitem">
<p>Some static methods were removed from utility classes such as 
							<span class="emphasis"><em>EcoreUtil2</em></span> and 
							<span class="emphasis"><em>ParsetreeUtil</em></span> in favor of more sophisticated implementations.
						</p>
</li>
</ul>
</div>
</div>
</div>
<div class="section" title="Now Go For The New Features">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="NowGoForTheNewFeatures"></a>Now Go For The New Features</h2>
</div>
</div>
</div>
<p>After migrating, some of the new features in Xtext 1.0 will be automatically available. Others require further configuration.
				We recommend reading the sections about</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>
						
<a class="link" href="#index_based" title="Global Scopes Based On External Configuration (e.g. Classpath-Based)">qualified names and namespace imports</a>
					
</p>
</li>
<li class="listitem">
<p>
						
<a class="link" href="#containers" title="About the Index, Containers and Their Manager">the builder infrastructure</a>
					
</p>
</li>
<li class="listitem">
<p>
						
<a class="link" href="#quickfixes" title="Quick Fixes">quick fixes</a>
					
</p>
</li>
<li class="listitem">
<p>
						
<a class="link" href="#unordered_groups" title="Unordered Groups">unordered groups</a>
					
</p>
</li>
<li class="listitem">
<p>
						
<a class="link" href="#quick_outline" title="Quick Outline">quick outline</a>
					
</p>
</li>
<li class="listitem">
<p>
						
<a class="link" href="#MWE2" title="Chapter&nbsp;6.&nbsp;MWE2">MWE2</a>
					
</p>
</li>
<li class="listitem">
<p>
						
<a class="link" href="#jvmtypes" title="Chapter&nbsp;8.&nbsp;Referring to Java Types">refering to Java elements</a>
					
</p>
</li>
</ul>
</div>
<p>For an overview over the new features consult our 
				<a class="ulink" href="http://www.eclipse.org/Xtext/documentation/helios/new_and_noteworthy.php" target="_new">New and Noteworthy</a> online. 
			</p>
</div>
</div>
<div class="chapter" title="Chapter&nbsp;12.&nbsp;The ANTLR IP Issue (Or Which Parser To Use?)">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="antlr_ip_issue"></a>Chapter&nbsp;12.&nbsp;The ANTLR IP Issue (Or Which Parser To Use?)</h2>
</div>
</div>
</div>
<p>In order to be able to parse models written in your language, Xtext needs to provide a special parser 
			for it. The parser is generated from the self defined language grammar. </p>
<p>It is recommended to use the 
			<a class="ulink" href="http://www.antlr.org" target="_new">ANTLR</a> -based parser.
			ANTLR is a very sophisticated parser generator framework which implements a so called LL(*) algorithm.
			It is fast, simple and at the same time has some very nice and sophisticated features. Especially its 
			support for error recovery is much better than what other parser generators provide.
		</p>
<p>Xtext uses ANTLR 3 which comes in two parts: the runtime and the generator.
			Both are shipped under the BSD license and have a clean intellectual property history. 
			However the ANTLR parser generator is unfortunately still implemented in an older version of itself 
			(v 2.x), where it was not possible for the Eclipse Foundation to ensure where exactly every line of 
			code originated. Therefore ANTLR 2 didn&rsquo;t get the required IP approval. Eclipse has a strict IP policy, 
			which makes sure that everything provided by Eclipse can be consumed under the terms of the Eclipse 
			Public License. The details are described in 

			<a class="ulink" href="http://www.eclipse.org/org/documents/Eclipse_IP_Policy.pdf" target="_new">this document</a>. That is why we are not 
			allowed to ship Xtext with the ANTLR generator but only with the IP approvied runtime components. We 
			have to provide it separately and for your convenience you&rsquo;ll be asked to download the ANTLR generator 
			when you run your language generator for the first time. You can even download it directly or install 
			an additional plug-in into Eclipse: 
		</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>
					
<a class="ulink" href="http://download.itemis.com/antlr-generator-3.0.1.jar" target="_new">http://download.itemis.com/antlr-generator-3.0.1.jar</a>
				
</p>
</li>
<li class="listitem">
<p>or use the update site at 
					<a class="ulink" href="http://download.itemis.com/updates" target="_new">http://download.itemis.com/updates</a>
				
</p>
</li>
</ul>
</div>
<p>The workflow will not bother you with this issue on subsequent executions as the archive will be stored
			in your project&rsquo;s root directory and can thereby be reused during the next run. </p>
<p>
			
<span class="bold"><strong>IMPORTANT</strong></span> :

			<span class="italic">Although if you use the non-IP approved ANTLR generator, you can still ship any languages and the IDEs you&rsquo;ve developed with Xtext without any worrying, because it is not needed at runtime</span>
		
</p>
</div>
</div>
</body>
</html>
