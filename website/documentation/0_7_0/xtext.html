<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Xtext User Guide</title>
<link href="book.css" rel="stylesheet" type="text/css">
<meta content="DocBook XSL Stylesheets V1.75.1" name="generator">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="book" title="Xtext User Guide">
<div class="titlepage">
<div>
<div>
<h1 class="title">
<a name="N10001"></a>Xtext User Guide</h1>
</div>
</div>
<hr>
</div>
<div class="toc">
<p>
<b>Table of Contents</b>
</p>
<dl>
<dt>
<span class="chapter"><a href="#Overview">1. Overview</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="section"><a href="#WhatisXtext">What is Xtext?</a></span>
</dt>
<dt>
<span class="section"><a href="#DSL">What is a domain-specific language</a></span>
</dt>
<dt>
<span class="section"><a href="#getting-started">Getting Started</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="chapter"><a href="#grammarLanguage">2. The Grammar Language</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="section"><a href="#Firstanexample">First an example</a></span>
</dt>
<dt>
<span class="section"><a href="#syntax">The Syntax</a></span>
</dt>
<dt>
<span class="section"><a href="#metamodelInference">Ecore model inference</a></span>
</dt>
<dt>
<span class="section"><a href="#grammarImport">Importing existing Ecore models</a></span>
</dt>
<dt>
<span class="section"><a href="#grammarMixins">Grammar Mixins</a></span>
</dt>
<dt>
<span class="section"><a href="#Defaulttokens">Default tokens</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="chapter"><a href="#configuration">3. Configuration</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="section"><a href="#generator">The Generator</a></span>
</dt>
<dt>
<span class="section"><a href="#dependencyInjection">Dependency Injection in Xtext with Google Guice</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="chapter"><a href="#RuntimeConcepts">4. Runtime Concepts</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="section"><a href="#RuntimesetupISetup">Runtime setup (ISetup)</a></span>
</dt>
<dt>
<span class="section"><a href="#SetupwithinEclipseEquinoxOSGi">Setup within Eclipse-Equinox (OSGi)</a></span>
</dt>
<dt>
<span class="section"><a href="#validation">Validation</a></span>
</dt>
<dt>
<span class="section"><a href="#linking">Linking</a></span>
</dt>
<dt>
<span class="section"><a href="#scoping">Scoping</a></span>
</dt>
<dt>
<span class="section"><a href="#valueconverter">Value Converter</a></span>
</dt>
<dt>
<span class="section"><a href="#serialization">Serialization</a></span>
</dt>
<dt>
<span class="section"><a href="#emf_integration">Integration with EMF</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="chapter"><a href="#IDEconcepts">5. IDE concepts</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="section"><a href="#labelProvider">Label Provider</a></span>
</dt>
<dt>
<span class="section"><a href="#contentAssist">Content Assist</a></span>
</dt>
<dt>
<span class="section"><a href="#templates">Template Proposals</a></span>
</dt>
<dt>
<span class="section"><a href="#outline">Outline View</a></span>
</dt>
<dt>
<span class="section"><a href="#hyperlinking">Hyperlinking</a></span>
</dt>
<dt>
<span class="section"><a href="#formatting">Formatting (Pretty Printing)</a></span>
</dt>
<dt>
<span class="section"><a href="#highlighting">Syntax Coloring</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="chapter"><a href="#from_oaw_to_tmf">6. From oAW to TMF</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="section"><a href="#why_rewrite">Why a rewrite?</a></span>
</dt>
<dt>
<span class="section"><a href="#migration_overview">Migration overview</a></span>
</dt>
<dt>
<span class="section"><a href="#Xtend_based_apis">Where are the Xtend-based APIs?</a></span>
</dt>
<dt>
<span class="section"><a href="#differences">Differences</a></span>
</dt>
<dt>
<span class="section"><a href="#NewFeatures">New Features</a></span>
</dt>
<dt>
<span class="section"><a href="#MigrationSupport">Migration Support</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="chapter"><a href="#antlr_ip_issue">7. The ANTLR IP issue (or which parser to use?)</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="section"><a href="#WhatifIdonotwanttousenonIPapprovedcode">What if I do not want to use non IP-approved code</a></span>
</dt>
</dl>
</dd>
</dl>
</div>
<div class="chapter" title="Chapter&nbsp;1.&nbsp;Overview">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="Overview"></a>Chapter&nbsp;1.&nbsp;Overview</h2>
</div>
</div>
</div>
<div class="section" title="What is Xtext?">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="WhatisXtext"></a>What is Xtext?</h2>
</div>
</div>
</div>
<p>Xtext is a framework for the development of 
				<a class="link" href="#DSL" title="What is a domain-specific language">domain-specific languages</a> and other textual programming languages. It is tightly integrated with the 
				<a class="ulink" href="http://www.eclipse.org/emf" target="_new">Eclipse Modeling Framework (EMF)</a> and leverages the Eclipse Platform in order to provide a language-specific integrated development environment (IDE). 
			</p>
<p>In contrast to common parser generators (like e.g. JavaCC or ANTLR), Xtext derives much more than just a parser and lexical analyzer (lexer) from an input grammar. 
				The grammar language is used to describe and generate:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>an incremental, ANTLR 3 based parser and lexer to read your models from text,</p>
</li>
<li class="listitem">
<p>Ecore models (optional),</p>
</li>
<li class="listitem">
<p>a serializer to write your models back to text,</p>
</li>
<li class="listitem">
<p>a linker, to establish cross links between model elements,</p>
</li>
<li class="listitem">
<p>an implementation of the EMF Resource interface with full support for loading and saving EMF models, and</p>
</li>
<li class="listitem">
<p>an integration of the language into your Eclipse IDE.</p>
</li>
</ul>
</div>
<p>Some of the IDE features, that are either derived from the grammar or easily implementable, are</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>
						
<a class="link" href="#highlighting" title="Syntax Coloring">syntax coloring</a>,
					</p>
</li>
<li class="listitem">
<p>
						
<a class="link" href="#hyperlinking" title="Hyperlinking">model navigation (F3, etc.)</a>,
					</p>
</li>
<li class="listitem">
<p>
						
<a class="link" href="#contentAssist" title="Content Assist">code completion</a>,
					</p>
</li>
<li class="listitem">
<p>
						
<a class="link" href="#outline" title="Outline View">outline view</a>, and
					</p>
</li>
<li class="listitem">
<p>
						
<a class="link" href="#templates" title="Template Proposals">code templates</a>.
					</p>
</li>
</ul>
</div>
<p>The generated artifacts are wired up through 
				<a class="ulink" href="http://code.google.com/p/google-guice/" target="_new">Google Guice</a>, a dependency injection framework which makes it easy to exchange certain functionality in a non-invasive manner.
			</p>
<p>Although Xtext aims at supporting fast iterative development of domain-specific languages, it can be used to implement IDEs for general purpose programming languages as well.</p>
</div>
<div class="section" title="What is a domain-specific language">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="DSL"></a>What is a domain-specific language</h2>
</div>
</div>
</div>
<p>A domain-specific language (DSL) is a small programming language, which focuses on a particular domain.
				Such a domain can be more or less anything. The idea is that its concepts and notation is as close as possible to
				what you have in mind when you think about a solution in that domain. Of course we are talking about problems which can
				be solved or processed by computers somehow.</p>
<p>The opposite of a DSL is a so called GPL, a General Purpose Language such as Java or any other common programming language.
				With a GPL you can solve every computer problem, but it might not always be the best way to solve it.</p>
<p>Imagine you want to remove the core from an apple. You could of course use a Swiss army knife to cut it out, and this is reasonable if you have to do it just once or twice. But if you need to do that on a regular basis it might be more efficient to use an apple corer.</p>
<p>There are a couple of well-known examples of DSLs. For instance SQL is actually a DSL which focuses on querying relational databases. Other DSLs are regular expressions or even languages provided by tools like MathLab. Also most XML languages are actually domain-specific languages. The whole purpose of XML is to allow for easy creation of new languages. Unfortunately with XML you are not able to change the concrete syntax, which is the major problem with it. The concrete syntax of XML is way too verbose. Also a generic syntax for everything is a compromise.</p>
<p>Xtext is a sophisticated framework that helps to implement your very own DSL with appropriate IDE support. There is no such limitation as with XML, you are free to define your concrete syntax as you like. It may be as concise and suggestive as possible being a best match for your particular domain. The hard task of reading your model, working with it and writing it back to your syntax is greatly simplified by Xtext.</p>
</div>
<div class="section" title="Getting Started">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="getting-started"></a>Getting Started</h2>
</div>
</div>
</div>
<p>In this mini-tutorial you will implement your first language with Xtext and create an editor from that. 
				<a class="ulink" href="http://www.eclipse.org/Xtext/download" target="_new">Download and install the latest version of Xtext</a>, set up a fresh workspace, take a deep breath and follow the instructions.  As soon as you have finished this chapter you will have an editor that understands input files of the following format. We will refer to this snippet as an example of our &ldquo;target syntax&rdquo; later on:
			</p>
<div class="literallayout">
<p>
<code class="code">type&nbsp;String<br>
type&nbsp;Bool<br>

<br>
entity&nbsp;Session&nbsp;{<br>
&nbsp;&nbsp;property&nbsp;Title:&nbsp;String<br>
&nbsp;&nbsp;property&nbsp;IsTutorial&nbsp;:&nbsp;Bool<br>
}<br>

<br>
entity&nbsp;Conference&nbsp;{<br>
&nbsp;&nbsp;property&nbsp;Name&nbsp;:&nbsp;String<br>
&nbsp;&nbsp;property&nbsp;Attendees&nbsp;:&nbsp;Person[]<br>
&nbsp;&nbsp;property&nbsp;Speakers&nbsp;:&nbsp;Speakers[]<br>
}<br>

<br>
entity&nbsp;Person&nbsp;{<br>
&nbsp;&nbsp;property&nbsp;Name&nbsp;:&nbsp;String<br>
}<br>

<br>
entity&nbsp;Speaker&nbsp;extends&nbsp;Person&nbsp;{<br>
&nbsp;&nbsp;property&nbsp;Sessions&nbsp;:&nbsp;Session[]<br>
}<br>

<br>

</code>
</p>
</div>
<div class="section" title="Create an Xtext project">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="CreateanXtextproject"></a>Create an Xtext project</h3>
</div>
</div>
</div>
<p>Use the Xtext wizard to create a new project</p>
<p>	File -&gt; New -&gt; Project...  -&gt; Xtext -&gt; Xtext project</p>
<p>Choose a sensible project name, language name and file extension, e.g.</p>
<table id="N10081">
<tr>
						
<td>Main project name: 	</td>
						<td>org.xtext.example.start	</td>
					
</tr>
<tr>
						
<td>Language name: 		</td>
						<td>org.xtext.example.Entities	</td>
					
</tr>
<tr>
						
<td>DSL-File extension: 	</td>
						<td>entity	</td>
					
</tr>
</table>
<p>Uncheck &ldquo;Generate Generator project&rdquo;, you will not need it this time. Click on Finish.</p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/getting-started-wizard.png"></div>
<p>
				
</p>
</div>
<div class="section" title="Project layout">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Projectlayout"></a>Project layout</h3>
</div>
</div>
</div>
<p>In the Package Explorer you can see two new projects. In 
					<code class="code">org.xtext.example.start</code> you can define the grammar and configure the runtime aspects of your language. The editor, outline view and code completion goes into 
					<code class="code">org.xtext.example.start.ui</code>. Both projects consist of generated classes derived from your grammar and manual code such as the grammar itself or further classes to differentiate from the default behavior.
				</p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/getting-started-project-layout.png"></div>
<p>
				
</p>
<p>It is good to be clear and unambiguous whether the code is generated or is to be manipulated by the developer. Thus, the generated code should be held separately from the manual code. We follow this pattern by having a folder src/ and a folder src-gen/ in each project. Keep in mind not to make changes in the src-gen/ folder. They will be overwritten by the generator.</p>
</div>
<div class="section" title="Build your own grammar">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Buildyourowngrammar"></a>Build your own grammar</h3>
</div>
</div>
</div>
<p>The wizard will automatically open the example grammar file 
					<code class="code">Entities.xtext</code> from the first project in the editor. A grammar has two purposes. First, it is used to describe the concrete syntax of your language. Second, it contains information about how a parser shall create a model during parsing.
				</p>
<p>Ignore the generated sample grammar, delete everything after "
					<code class="code">Model :</code>" to the end. 
					The entry rule for the parser will be called 
					<code class="code">Model</code>. As a 
					<code class="code">Model</code> consists of one or more 
					<code class="code">Entity</code> entries, this rule delegates to another rule named 
					<code class="code">Entity</code>, which will be defined later on.
					As we can have one ore more entities within a model, the cardinality is &ldquo;+&rdquo;. Each rule is terminated with a semicolon. So our first rule reads as
				</p>
<div class="literallayout">
<p>
<code class="code">Model&nbsp;:<br>
&nbsp;&nbsp;Entity+;&nbsp;<br>

<br>

</code>
</p>
</div>
<p>
					
<span class="italic">
						<span class="bold"><strong>Please note</strong></span>: If you encounter strange errors while copying and pasting these snippets to your Eclipse editor your documentation viewer most likely has inserted characters different from {space} into your clipboard. Reenter these &ldquo;fillers&rdquo; or type the text by hand to be sure everything works fine.
					</span> 
				
</p>
<p>An Xtext grammar does not only describe rules for the parser but also the structure of the resulting abstract syntax tree. Usually, each parser rule will create a new node in that tree. The type of that node can be specified after the rule name using the keyword 
					<code class="code">returns</code>. If the type&rsquo;s name is the same as the rule name, it can be omitted as in our case.
				</p>
<p>The parser will create a new element of type 
					<code class="code">Model</code> when it enters the rule 
					<code class="code">Model</code>, and a new element of type 
					<code class="code">Entity</code> every time it enters the rule 
					<code class="code">Entity</code>. To connect these AST elements, we have to define the name of a reference. In our case, we call that reference 
					<span class="emphasis"><em>entities</em></span>. We specify it using the assignment operator "
					<code class="code">+=</code>", which denotes a multi valued feature. 
				</p>
<p>As a result, we modify the first rule to</p>
<div class="literallayout">
<p>
<code class="code">Model&nbsp;:<br>
&nbsp;&nbsp;(elements&nbsp;+=&nbsp;Entity)+;<br>
	
<br>

</code>
</p>
</div>
<p>The next rule on our list is the rule 
					<code class="code">Entity</code>. Looking at our target syntax, each entity begins with the keyword 
					<code class="code">entity</code> followed by the entity&rsquo;s name and an opening curly brace (we will handle the 
					<code class="code">extends</code> clause in a second step). Then, an entity defines a number of properties and ends with a closing curly brace. 
				</p>
<div class="literallayout">
<p>
<code class="code">Entity&nbsp;returns&nbsp;Entity:<br>
&nbsp;&nbsp;'entity'&nbsp;name=ID&nbsp;'{'<br>
&nbsp;&nbsp;&nbsp;&nbsp;(properties+=Property)*<br>
&nbsp;&nbsp;'}'<br>
;<br>
	
<br>

</code>
</p>
</div>
<p>Instead of creating a new AST node for the name, we rather want the name to be an attribute of the 
					<code class="code">Entity</code> class. Therefore we use the terminal rule 
					<code class="code">ID</code>, which results in a string. The assignment operator "
					<code class="code">=</code>" denotes a single valued feature, and the asterisk a cardinality of 0..n.
					In our target syntax, some entities refer to an existing entity as their super type after the keyword 
					<code class="code">extends</code>. Note that this is a cross-reference, as the super type itself must be defined somewhere else. To define a cross-reference we use square brackets. Optional parts have the cardinality &ldquo;?&rdquo;. The complete rule now reads:
				</p>
<div class="literallayout">
<p>
<code class="code">Entity&nbsp;returns&nbsp;Entity:<br>
&nbsp;&nbsp;'entity'&nbsp;name=ID&nbsp;('extends'&nbsp;extends=[Entity])?&nbsp;'{'<br>
&nbsp;&nbsp;&nbsp;&nbsp;(properties+=Property)*<br>
&nbsp;&nbsp;'}'<br>
;<br>
	
<br>

</code>
</p>
</div>
<p>We have not specified the rule 
					<code class="code">Property</code>, yet. In our target syntax, properties can refer to simple types such as &ldquo;String&rdquo; or &ldquo;Bool&rdquo; as well as entities. To make this easy we will first introduce a common supertype 
					<code class="code">Type</code> each 
					<code class="code">Property</code> can refer to.
				</p>
<p>Change  the rule 
					<code class="code">Model</code> and introduce a new rule 
					<code class="code">Type</code> and 
					<code class="code">SimpleType</code>:
				</p>
<div class="literallayout">
<p>
<code class="code">Model&nbsp;:<br>
&nbsp;&nbsp;(elements+=Type)*;<br>

<br>
Type:<br>
&nbsp;&nbsp;SimpleType&nbsp;|&nbsp;Entity;<br>
	
<br>
SimpleType:<br>
&nbsp;&nbsp;'type'&nbsp;name=ID;<br>
&nbsp;<br>

</code>
</p>
</div>
<p>Models new consist of types where a 
					<code class="code">Type</code> can either be a 
					<code class="code">SimpleType</code>  or the 
					<code class="code">Entity</code> you already know. Our rule 
					<code class="code">Type</code> will just delegate to either of them, using the "
					<code class="code">|</code>" alternatives operator. The combination of simple data types and entites this way introduces a common super type 
					<code class="code">Type</code> both 
					<code class="code">Entity</code> and 
					<code class="code">SimpleType</code> derive from. This allows you to refer to both types of elements with a single cross-reference.
				</p>
<p>A 
					<code class="code">Property</code> consist of a keyword, a name, a colon and a cross-reference to an arbitrary 
					<code class="code">Type</code>. The multiplicity is either many or one. The presence of the postfix &ldquo;[]&rdquo; (technically a keyword) should trigger a boolean flag in the AST model. This is the purpose of the assignment operator "
					<code class="code">?=</code>". Our last parser rule is:
				</p>
<div class="literallayout">
<p>
<code class="code">Property:<br>
&nbsp;&nbsp;'property'&nbsp;name=ID&nbsp;':'&nbsp;type=[Type]&nbsp;(many?='[]')?;<br>
	
<br>

</code>
</p>
</div>
<p>In the end your grammar editor should look like this:</p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/getting-started-grammar.png"></div>
<p>
				
</p>
</div>
<div class="section" title="Generate language artifacts">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Generatelanguageartifacts"></a>Generate language artifacts</h3>
</div>
</div>
</div>
<p>Save the grammar and make sure that no error markers appear. Then, locate the file GenerateEntities.mwe next to the grammar file in the package explorer view. From its context menu, choose</p>
<p>	Run As -&gt; MWE Workflow.</p>
<p>That will trigger the Xtext language generator. You will see its logging messages in the Console view.</p>
</div>
<div class="section" title="Test the generated editor">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Testthegeneratededitor"></a>Test the generated editor</h3>
</div>
</div>
</div>
<p>If code generation succeeded, right-click on the Xtext project and choose</p>
<p>	Run As -&gt; Eclipse Application.</p>
<p>This will spawn a new Eclipse workbench with your projects as plug-ins installed. 
					In the new workbench, create a new project (File -&gt; New -&gt; Project...  -&gt; General -&gt; Project) and therein a new file with the file extension you chose in the beginning. This will open the generated entity editor.</p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/getting-started-editor.png"></div>
<p>
				
</p>
</div>
</div>
</div>
<div class="chapter" title="Chapter&nbsp;2.&nbsp;The Grammar Language">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="grammarLanguage"></a>Chapter&nbsp;2.&nbsp;The Grammar Language</h2>
</div>
</div>
</div>
<p>The 
			<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/Xtext.xtext?root=Modeling_Project&view=markup" target="_new">grammar language</a> 
			is the corner stone of Xtext and is defined in itself. Actually it is a DSL to create DSLs, so what would be more helpful than developing the Xtext language with Xtext?
		</p>
<p>The grammar language is a domain-specific language, carefully designed for the description of textual languages based on 
			<a class="ulink" href="http://en.wikipedia.org/wiki/LL_parser" target="_new">LL(*)-Parsing</a> that is like 
			<a class="ulink" href="http://www.artima.com/lejava/articles/antlr_3.html" target="_new">ANTLR3's parsing strategy</a>.
			The main idea is to describe the concrete syntax and how an EMF-based in-memory model is created during parsing. 
		</p>
<div class="section" title="First an example">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Firstanexample"></a>First an example</h2>
</div>
</div>
</div>
<p>To get an idea of how it works we&rsquo;ll start by implementing a 
				<a class="ulink" href="http://martinfowler.com/dslwip/Intro.html" target="_new">simple example</a> introduced by Martin Fowler.
				It&rsquo;s mainly about describing state machines used as the (un)lock mechanism of secret compartments. People who have secret compartments control their access in a very old-school way, e.g. by opening the door first and turning on the light afterwards. Then the secret compartment, for instance a panel, opens up. One of those state machines could look like this:
			</p>
<div class="literallayout">
<p>
<code class="code">events<br>
&nbsp;&nbsp;doorClosed&nbsp;&nbsp;D1CL<br>
&nbsp;&nbsp;drawOpened&nbsp;&nbsp;D2OP<br>
&nbsp;&nbsp;lightOn&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L1ON<br>
&nbsp;&nbsp;doorOpened&nbsp;&nbsp;D1OP<br>
&nbsp;&nbsp;panelClosed&nbsp;PNCL<br>
end<br>
&nbsp;<br>
resetEvents<br>
&nbsp;&nbsp;doorOpened<br>
end<br>
&nbsp;<br>
commands<br>
&nbsp;&nbsp;unlockPanel&nbsp;PNUL<br>
&nbsp;&nbsp;lockPanel&nbsp;&nbsp;&nbsp;PNLK<br>
&nbsp;&nbsp;lockDoor&nbsp;&nbsp;&nbsp;&nbsp;D1LK<br>
&nbsp;&nbsp;unlockDoor&nbsp;&nbsp;D1UL<br>
end<br>
&nbsp;<br>
state&nbsp;idle<br>
&nbsp;&nbsp;actions&nbsp;{unlockDoor&nbsp;lockPanel}<br>
&nbsp;&nbsp;doorClosed&nbsp;=&gt;&nbsp;active<br>
end<br>
&nbsp;<br>
state&nbsp;active<br>
&nbsp;&nbsp;drawOpened&nbsp;=&gt;&nbsp;waitingForLight<br>
&nbsp;&nbsp;lightOn&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;waitingForDraw<br>
end<br>
&nbsp;<br>
state&nbsp;waitingForLight<br>
&nbsp;&nbsp;lightOn&nbsp;=&gt;&nbsp;unlockedPanel<br>
end<br>
&nbsp;<br>
state&nbsp;waitingForDraw<br>
&nbsp;&nbsp;drawOpened&nbsp;=&gt;&nbsp;unlockedPanel<br>
end<br>
&nbsp;<br>
state&nbsp;unlockedPanel<br>
&nbsp;&nbsp;actions&nbsp;{unlockPanel&nbsp;lockDoor}<br>
&nbsp;&nbsp;panelClosed&nbsp;=&gt;&nbsp;idle<br>
end<br>

<br>

</code>
</p>
</div>
<p>So, we have a bunch of declared events, commands and states. Within states there are references to declared actions, which should be executed when entering such a state.
				Also there are transitions consisting of a reference to an event and a state. Please read 
				<a class="ulink" href="http://martinfowler.com/dslwip/Intro.html" target="_new">Martin's description</a> if it is not clear enough.
			</p>
<p>In order to get a complete IDE for this little language from Xtext, you need to write the following grammar:</p>
<div class="literallayout">
<p>
<code class="code">grammar&nbsp;my.pack.SecretCompartments&nbsp;<br>
&nbsp;&nbsp;&nbsp;with&nbsp;org.eclipse.xtext.common.Terminals<br>

<br>
generate&nbsp;secretcompartment&nbsp;"http://www.eclipse.org/secretcompartment"<br>
&nbsp;<br>
Statemachine&nbsp;:<br>
&nbsp;&nbsp;'events'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(events+=Event)+<br>
&nbsp;&nbsp;'end'<br>
&nbsp;&nbsp;('resetEvents'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(resetEvents+=[Event])+<br>
&nbsp;&nbsp;'end')?<br>
&nbsp;&nbsp;'commands'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(commands+=Command)+<br>
&nbsp;&nbsp;'end'<br>
&nbsp;&nbsp;(states+=State)+;<br>
&nbsp;<br>
Event&nbsp;:<br>
&nbsp;&nbsp;name=ID&nbsp;code=ID;<br>
&nbsp;<br>
Command&nbsp;:<br>
&nbsp;&nbsp;name=ID&nbsp;code=ID;<br>
&nbsp;<br>
State&nbsp;:<br>
&nbsp;&nbsp;'state'&nbsp;name=ID<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;('actions'&nbsp;'{'&nbsp;(actions+=[Command])+&nbsp;'}')?<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(transitions+=Transition)*<br>
&nbsp;&nbsp;'end';<br>
&nbsp;<br>
Transition&nbsp;:<br>
&nbsp;&nbsp;event=[Event]&nbsp;'=&gt;'&nbsp;state=[State];<br>

<br>

</code>
</p>
</div>
</div>
<div class="section" title="The Syntax">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="syntax"></a>The Syntax</h2>
</div>
</div>
</div>
<p>In the following the different concepts of the grammar language are explained. </p>
<div class="section" title="Language Declaration">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="LanguageDeclaration"></a>Language Declaration</h3>
</div>
</div>
</div>
<p>The first line  </p>
<div class="literallayout">
<p>
<code class="code">grammar&nbsp;my.pack.SecretCompartments&nbsp;with&nbsp;org.eclipse.xtext.common.Terminals<br>

</code>
</p>
</div>
<p>declares the name of the grammar. Xtext leverages Java&rsquo;s class path mechanism. This means that the name can be any valid Java qualifier. The file name needs to correspond to the grammar name and have the file extension &lsquo;xtext&rsquo;. This means that the name has to be 
					<code class="code">SecretCompartments.xtext</code> and must be placed in a package 
					<code class="code">my.pack</code> somewhere on your project&rsquo;s class path.
				</p>
<p>The first line is also used to declare any used language (for mechanism details see 
					<a class="link" href="#grammarMixins" title="Grammar Mixins">Grammar Mixins</a>).
				</p>
</div>
<div class="section" title="EPackage declarations">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="EPackagedeclarations"></a>EPackage declarations</h3>
</div>
</div>
</div>
<p>Xtext parsers instantiate Ecore models (aka meta model). An Ecore model basically consists of an EPackage containing EClasses, EDatatypes and EEnums.
					Xtext can infer Ecore models from a grammar (see 
					<a class="link" href="#metamodelInference" title="Ecore model inference">Ecore model inference</a>) but it is also possible to instantiate existing Ecore models. You can even mix this and use multiple existing Ecore models and infer some others from one grammar. 
				</p>
<div class="section" title="EPackage generation">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="EPackagegeneration"></a>EPackage generation</h4>
</div>
</div>
</div>
<p>The easiest way to get started is to let Xtext infer the Ecore model from your grammar. This is what is done in the secret compartment example. To do so just state:</p>
<div class="literallayout">
<p>
<code class="code">generate&nbsp;secretcompartment&nbsp;'http://www.eclipse.org/secretcompartment'<br>

</code>
</p>
</div>
<p>That statement means: generate an EPackage with the name 
						<code class="code">secretcompartment</code> and the nsURI 
						<code class="code">http://www.eclipse.org/secretcompartment</code>. Actually these are the properties that are required to create an EPackage. 
						The whole algorithm used to derive complete Ecore models from Xtext grammars is described in the section 
						<a class="link" href="#metamodelInference" title="Ecore model inference">Ecore model inference</a>.
					</p>
</div>
<div class="section" title="EPackage import">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="EPackageimport"></a>EPackage import</h4>
</div>
</div>
</div>
<p>If you already have an existing EPackage, you can import it using either a namespace URI or a resource URI. An 
						<a class="ulink" href="http://www.ietf.org/rfc/rfc2396.txt" target="_new">URI</a> (Uniform Resource Identifier) provides a simple and extensible means for identifying an abstract or physical resource. For details about the EMF implementation of this concept, please see its 
						<a class="ulink" href="http://help.eclipse.org/help32/topic/org.eclipse.emf.doc/references/javadoc/org/eclipse/emf/common/util/URI.html" target="_new">documentation</a>.
					</p>
<div class="section" title="Using namespace URIs to import existing EPackages">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="UsingnamespaceURIstoimportexistingEPackages"></a>Using namespace URIs to import existing EPackages</h5>
</div>
</div>
</div>
<p>You can import an existing EPackage with the following statement:</p>
<div class="literallayout">
<p>
<code class="code">import&nbsp;'http://www.eclipse.org/secretcompartment'<br>

</code>
</p>
</div>
<p>Note that if you use a namespace URI, the corresponding EPackage needs to be installed into the workbench. Otherwise the editor cannot find it.
							At runtime (i.e. when starting the generator) you need to make sure that the corresponding EPackage is registered in the 
							<code class="code">EPackage.Registry.INSTANCE</code>. If you use MWE to drive your code generator, you need to add the following lines to your workflow file:
						</p>
<div class="literallayout">
<p>
<code class="code">&lt;bean&nbsp;class="org.eclipse.emf.mwe.utils.StandaloneSetup"&nbsp;<br>
&nbsp;&nbsp;platformUri="${runtimeProject}/.."&gt;<br>
&nbsp;&nbsp;&lt;registerGeneratedEPackage&nbsp;value="my.pack.SecretcompartmentPackage"/&gt;<br>
&lt;/bean&gt;<br>

<br>

</code>
</p>
</div>
<p>Using namespace URIs is typically only interesting when common Ecore models are used, such as Ecore itself or the UML meta model. If you&rsquo;re developing the EPackage together with the DSL but don&rsquo;t want to have it derived from the grammar for some reason, we suggest to use a resource URI.</p>
</div>
<div class="section" title="Using resource URIs to import existing EPackages">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="UsingresourceURIstoimportexistingEPackages"></a>Using resource URIs to import existing EPackages</h5>
</div>
</div>
</div>
<p>If the EPackage you want to use is somewhere in your workspace you should refer to it by a 
							<code class="code">platform:/resource/</code>-URI.
							Platform URIs are a special EMF concept, which allow for some kind of transparency between workspace projects and installed bundles. Consult the EMF documentation (we recommend the book) for details.
						</p>
<p>An import statement referring to an Ecore file by a platform:/resource/ URI looks like this: </p>
<div class="literallayout">
<p>
<code class="code">import&nbsp;'platform:/resource/project/src/my/pack/SecretCompartments.ecore'<br>

</code>
</p>
</div>
<p>If you want to mix generated and imported Ecore models you&rsquo;ll have to configure the generator fragment in your MWE file responsible for generating the Ecore classes (
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/ecore/EcoreGeneratorFragment.java?root=Modeling_Project&view=co" target="_new">EcoreGeneratorFragment</a>) with resource URIs that point to the genmodels for the referenced Ecore models.
							Example:
						</p>
<div class="literallayout">
<p>
<code class="code">&lt;fragment&nbsp;class="org.eclipse.xtext.generator.ecore.EcoreGeneratorFragment"<br>
&nbsp;&nbsp;genModels=<br>
&nbsp;&nbsp;&nbsp;&nbsp;"platform:/resource/project/src/my/pack/SecretCompartments.genmodel"/&gt;<br>

<br>

</code>
</p>
</div>
</div>
</div>
<div class="section" title="Ecore model aliases for packages">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="Ecoremodelaliasesforpackages"></a>Ecore model aliases for packages</h4>
</div>
</div>
</div>
<p>If you want to use multiple EPackages you need to specify aliases in the following way:</p>
<div class="literallayout">
<p>
<code class="code">generate&nbsp;secretcompartment&nbsp;'http://www.eclipse.org/secretcompartment'<br>
import&nbsp;'http://www.eclipse.org/anotherPackage'&nbsp;as&nbsp;another<br>

<br>

</code>
</p>
</div>
<p>When referring to a type somewhere in the grammar you need to qualify the reference using that alias (example 
						<code class="code">another::CoolType</code>). We&rsquo;ll see later where such type references occur.
					</p>
<p>It is also supported to put multiple EPackage imports into one alias. This is no problem as long as there are not any two EClassifiers with the same name. In such cases none of them can be referenced. It is even possible to &lsquo;import&rsquo; multiple and &lsquo;generate&rsquo; one Ecore model and all of them are declared for the same alias. If you do so, for a reference to an EClassifier first the imported EPackages are scanned before it is assumed that a type needs to by generated into the to-be-generated package.</p>
<p>Example:</p>
<div class="literallayout">
<p>
<code class="code">generate&nbsp;toBeGenerated&nbsp;'http://www.eclipse.org/toBeGenerated'<br>
import&nbsp;'http://www.eclipse.org/packContainingClassA'<br>
import&nbsp;'http://www.eclipse.org/packContainingClassB'<br>

<br>

</code>
</p>
</div>
<p>With the declaration above </p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>a reference to type 
								<code class="code">ClassA</code> would be linked to the EClass contained in 
								<code class="code">http://www.eclipse.org/packContainingClassA</code>, 
							</p>
</li>
<li class="listitem">
<p>a reference to type 
								<code class="code">ClassB</code> would be linked to the EClass contained in 
								<code class="code">http://www.eclipse.org/packContainingClassB</code>, 
							</p>
</li>
<li class="listitem">
<p>a reference to type 
								<code class="code">NotYetDefined</code> would be linked to a newly created EClass in 
								<code class="code">http://www.eclipse.org/toBeGenerated</code>.
							</p>
</li>
</ol>
</div>
<p>Note, that using this feature is not recommended, because it might cause problems, which are hard to track down.
						For instance, a reference to 
						<code class="code">classA</code> would as well be linked to a newly created EClass, because the corresponding type in 
						<code class="code">http://www.eclipse.org/packContainingClassA</code> is spelled with a capital letter.
					</p>
</div>
</div>
<div class="section" title="Rules">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Rules"></a>Rules</h3>
</div>
</div>
</div>
<p>The default parsing is based on a home-grown packrat parser. It is advised to substitute it by an ANTLR parser through the Xtext service mechanism. ANTLR is a sophisticated parser generator framework based on an LL(*) 
					<a class="ulink" href="http://bit.ly/ANTLR_LL_star_algorithm" target="_new">parsing algorithm</a>, that works quite well for Xtext. Please download the plugin de.itemis.xtext.antlr (from update site 
					<code class="code">http://download.itemis.com/updates/</code>) and use the ANTLR Parser instead of the packrat parser (cf. 
					<a class="ulink" href="http://www.eclipse.org/Xtext/developers/workspaceSetup.php" target="_new">Xtext Workspace Setup</a>).
				</p>
<p>Basically parsing can be separated in the following phases. </p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>lexing</p>
</li>
<li class="listitem">
<p>parsing</p>
</li>
<li class="listitem">
<p>linking</p>
</li>
<li class="listitem">
<p>validation</p>
</li>
</ol>
</div>
<div class="section" title="Terminal Rules">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="TerminalRules"></a>Terminal Rules</h4>
</div>
</div>
</div>
<p>In the first stage, i.e. lexing, a sequence of characters (the text input) is transformed into a sequence of so called tokens. In this context, a token is sort of a strongly typed part of the input sequence. It consists of one or more characters and was matched by a particular terminal rule or keyword and therefore represents an atomic symbol.
						Terminal rules are also referred to as token rules or lexer rules. There is an informal naming convention that names of terminal rules are all upper-case.</p>
<p>In the secret compartments example there are no explicitly defined terminal rules, since it only uses the ID rule which is inherited from the grammar 
						<code class="code">org.eclipse.xtext.common.Terminals</code> (cf. 
						<a class="link" href="#grammarMixins" title="Grammar Mixins">Grammar Mixins</a>).
						Therein the ID rule is defined as follows:
					</p>
<div class="literallayout">
<p>
<code class="code">terminal&nbsp;ID&nbsp;:&nbsp;<br>
&nbsp;&nbsp;('^')?('a'..'z'|'A'..'Z'|'_')&nbsp;('a'..'z'|'A'..'Z'|'_'|'0'..'9')*;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>

</code>
</p>
</div>
<p>It says that a Token ID starts with an optional &lsquo;^&rsquo; character (caret), followed by a letter (&lsquo;a&rsquo;..&lsquo;z&rsquo;|&lsquo;A&rsquo;..&lsquo;Z&rsquo;) or underscore (&lsquo;_&rsquo;) followed by any number of letters, underscores and numbers (&lsquo;0&rsquo;..&lsquo;9&rsquo;). </p>
<p>The caret is used to escape an identifier for cases where there are conflicts with keywords. It is removed by the ID rule&rsquo;s 
						<a class="link" href="#valueconverter" title="Value Converter">ValueConverter</a>. 
					</p>
<p>This is the formal definition of terminal rules:</p>
<div class="literallayout">
<p>
<code class="code">TerminalRule&nbsp;:<br>
&nbsp;&nbsp;'terminal'&nbsp;name=ID&nbsp;('returns'&nbsp;type=TypeRef)?&nbsp;':'&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;alternatives=TerminalAlternatives&nbsp;';'<br>
;<br>

<br>

</code>
</p>
</div>
<p>Note, that 
						<span class="emphasis"><em>the order of terminal rules is crucial for your grammar</em></span>, as they may hide each other. This is especially important for newly introduced rules in connection with mixed rules from used grammars. 
					</p>
<p>If you for instance want to add a rule to allow fully qualified names in addition to simple IDs, you should implement it as a 
						<a class="link" href="#datatypeRules" title="Data type rules">data type rule</a>, instead of adding another terminal rule.
					</p>
<div class="section" title="Return types">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="Returntypes"></a>Return types</h5>
</div>
</div>
</div>
<p>A terminal rule returns a value, which is a string (type 
							<code class="code">ecore::EString</code>) by default.
							However, if you want to have a different type you can specify it. For instance, the rule &lsquo;INT&rsquo; is defined as:
						</p>
<div class="literallayout">
<p>
<code class="code">terminal&nbsp;INT&nbsp;returns&nbsp;ecore::EInt&nbsp;:&nbsp;<br>
&nbsp;&nbsp;('0'..'9')+;<br>

<br>

</code>
</p>
</div>
<p>This means that the terminal rule &lsquo;INT&rsquo; returns instances of 
							<code class="code">ecore::EInt</code>. It is possible to define any kind of data type here, which just needs to be an instance of 
							<code class="code">ecore::EDataType</code>.
							In order to tell the parser how to convert the parsed string to a value of the declared data type, you need to provide your own implementation of 
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/conversion/IValueConverterService.java?root=Modeling_Project&view=co" target="_new">IValueConverterService</a> (cf. 
							<a class="link" href="#valueconverter" title="Value Converter">value converters</a>). The value converter is also the point where you can remove things like quotes from string literals or the caret (&lsquo;^&rsquo;) from identifiers. Its implementation needs to be registered as a service (cf. 
							<a class="link" href="#dependencyInjection" title="Dependency Injection in Xtext with Google Guice">Service Framework</a>).
						</p>
</div>
</div>
<div class="section" title="Extended Backus-Naur form expressions">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="ExtendedBackusNaurformexpressions"></a>Extended Backus-Naur form expressions</h4>
</div>
</div>
</div>
<p>Token rules are described using &ldquo;Extended Backus-Naur Form&rdquo;-like (EBNF) expressions. The different expressions are described in the following.
						The one thing all of these expressions have in common is the cardinality operator.
						There are four different possible cardinalities</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>exactly one (the default, no operator)</p>
</li>
<li class="listitem">
<p>one or none (operator &ldquo;?&rdquo;)</p>
</li>
<li class="listitem">
<p>any (zero or more, operator &ldquo;*&rdquo;)</p>
</li>
<li class="listitem">
<p>one or more (operator &ldquo;+&rdquo;)</p>
</li>
</ol>
</div>
<div class="section" title="Keywords / Characters">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="Keywords"></a>Keywords / Characters</h5>
</div>
</div>
</div>
<p>Keywords are a kind of token rule literals. 
							The &lsquo;ID&rsquo; rule in 
							<code class="code">org.eclipse.xtext.common.Terminals</code> for instance starts with a keyword:
						</p>
<div class="literallayout">
<p>
<code class="code">terminal&nbsp;ID&nbsp;:&nbsp;'^'?&nbsp;....&nbsp;;<br>

</code>
</p>
</div>
<p>The question mark sets the cardinality to &ldquo;none or one&rdquo; (i.e. optional) like explained above.</p>
<p>Note that a keyword can have any length and contain arbitrary characters.</p>
</div>
<div class="section" title="Character Ranges">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="CharacterRanges"></a>Character Ranges</h5>
</div>
</div>
</div>
<p>A character range can be declared using the &lsquo;..&rsquo; operator.</p>
<p>Example:</p>
<div class="literallayout">
<p>
<code class="code">terminal&nbsp;INT&nbsp;returns&nbsp;ecore::EInt:&nbsp;('0'..'9')+;<br>

</code>
</p>
</div>
<p>In this case an INT is comprised of one or more (note the &lsquo;+&rsquo; operator) characters between (and including) &lsquo;0&rsquo; and &lsquo;9&rsquo;.</p>
</div>
<div class="section" title="Wildcard">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="Wildcard"></a>Wildcard</h5>
</div>
</div>
</div>
<p>If you want to allow any character you can simple write the wildcard operator &lsquo;.&rsquo; (dot):
							Example:</p>
<div class="literallayout">
<p>
<code class="code">FOO&nbsp;:&nbsp;'f'&nbsp;.&nbsp;'o';<br>

</code>
</p>
</div>
<p>The rule above would allow expressions like &lsquo;foo&rsquo;, &lsquo;f0o&rsquo; or even &lsquo;f\no&rsquo;.</p>
</div>
<div class="section" title="Until Token">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="UntilToken"></a>Until Token</h5>
</div>
</div>
</div>
<p>With the until token it is possible to state that everything should be consumed until a certain token occurs.
							The multiline comment is implemented this way:</p>
<div class="literallayout">
<p>
<code class="code">terminal&nbsp;ML_COMMENT	:&nbsp;'/*'&nbsp;-&gt;&nbsp;'*/';<br>

</code>
</p>
</div>
<p>This is the rule for Java-style comments that begin with &lsquo;/*&rsquo; and end with &lsquo;*/&rsquo;.</p>
</div>
<div class="section" title="Negated Token">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="NegatedToken"></a>Negated Token</h5>
</div>
</div>
</div>
<p>All the tokens explained above can be inverted using a preceding explanation mark:</p>
<div class="literallayout">
<p>
<code class="code">terminal&nbsp;ML_COMMENT	:&nbsp;'/*'&nbsp;(!'*/')+;<br>

</code>
</p>
</div>
</div>
<div class="section" title="Rule Calls">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="RuleCalls"></a>Rule Calls</h5>
</div>
</div>
</div>
<p>Rules can refer to other rules. This is done by writing the name of the rule to be called.
							We refer to this as rule calls. Rule calls in terminal rules can only point to terminal rules.</p>
<p>Example:</p>
<div class="literallayout">
<p>
<code class="code">terminal&nbsp;QUALIFIED_NAME&nbsp;:&nbsp;ID&nbsp;('.'&nbsp;ID)*;<br>

</code>
</p>
</div>
</div>
<div class="section" title="Alternatives">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="Alternatives"></a>Alternatives </h5>
</div>
</div>
</div>
<p>Using alternatives one can state multiple different alternatives.
							For instance, the whitespace rule uses alternatives like this:</p>
<div class="literallayout">
<p>
<code class="code">terminal&nbsp;WS&nbsp;:&nbsp;('&nbsp;'|'\t'|'\r'|'\n')+;<br>

</code>
</p>
</div>
<p>That is a WS can be made of one or more whitespace characters (including &lsquo; &rsquo;,&lsquo;\t&rsquo;,&lsquo;\r&rsquo;,&lsquo;\n&rsquo;).</p>
</div>
<div class="section" title="Groups">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="Groups"></a>Groups</h5>
</div>
</div>
</div>
<p>Finally, if you put tokens one after another, the whole sequence is referred to as a group.
							Example:</p>
<div class="literallayout">
<p>
<code class="code">terminal&nbsp;ASCII&nbsp;:&nbsp;'0x'&nbsp;('0'..'7')&nbsp;('0'..'9'|'A'..'F');<br>

</code>
</p>
</div>
<p>That is the 2-digit hexadecimal code of ascii characters.</p>
</div>
</div>
</div>
<div class="section" title="Parser Rules">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="ParserRules"></a>Parser Rules</h3>
</div>
</div>
</div>
<p>The parser reads a sequence of terminals and walks through the parser rules. Hence a parser rule &ndash; contrary to a terminal rule &ndash; does not produce a single terminal token but a tree of non-terminal and terminal tokens. They lead to a so called parse tree (in Xtext it is also referred as node model). Furthermore, parser rules are handled as kind of a building plan for the creation of the EObjects that form the semantic model (the linked abstract syntax graph or AST). Due to this fact, parser rules are even called production rules. The different constructs like actions and assignments are used to derive types and initialize the semantic objects accordingly. </p>
<div class="section" title="Extended Backus-Naur Form expressions">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="ExtendedBackusNaurFormexpressions"></a>Extended Backus-Naur Form expressions</h4>
</div>
</div>
</div>
<p>Not all the expressions that are available in terminal rules can be used in parser rules. Character ranges, wildcards, the until token and the negation are only available for terminal rules. </p>
<p>The elements that are available in parser rules as well as in terminal rules are</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>
								
<a class="link" href="#Groups" title="Groups">groups</a>, 
							</p>
</li>
<li class="listitem">
<p>
								
<a class="link" href="#Alternatives" title="Alternatives">alternatives</a>, 
							</p>
</li>
<li class="listitem">
<p>
								
<a class="link" href="#Keywords" title="Keywords / Characters">keywords</a> and 
							</p>
</li>
<li class="listitem">
<p>
								
<a class="link" href="#RuleCalls" title="Rule Calls">rule calls</a>.
							</p>
</li>
</ol>
</div>
<p>In addition to these elements, there are some expressions used to direct how the AST is constructed, which are listed and explained in the following.</p>
<div class="section" title="Assignments">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="assignments"></a>Assignments </h5>
</div>
</div>
</div>
<p>Assignments are used to assign the parsed information to a feature of the current object. The type of the current object, its EClass, is specified by the return type of the parser rule. If it is not explicitly stated it is implied that the type&rsquo;s name equals the rule&rsquo;s name. The type of the feature is infered from the right hand side of the assignment.</p>
<p>Example:</p>
<div class="literallayout">
<p>
<code class="code">State&nbsp;:<br>
&nbsp;&nbsp;'state'&nbsp;name=ID<br>
&nbsp;&nbsp;&nbsp;&nbsp;('actions'&nbsp;'{'&nbsp;(actions+=[Command])+&nbsp;'}')?<br>
&nbsp;&nbsp;&nbsp;&nbsp;(transitions+=Transition)*<br>
&nbsp;&nbsp;'end'<br>
;<br>

<br>

</code>
</p>
</div>
<p>The syntactic declaration for states in the state machine example starts with a keyword &lsquo;state&rsquo; followed by an assignment:</p>
<div class="literallayout">
<p>
<code class="code">name=ID<br>

</code>
</p>
</div>
<p>The left hand side refers to a feature '
							<code class="code">name</code>' of the current object (which has the EClass &lsquo;State&rsquo; in this case). 
							The right hand side can be a rule call, a keyword, a cross reference (explained later) or even an alternative comprised by the former.
							The type of the feature needs to be compatible with the type of the expression on the right. As ID returns an EString in this case, the feature '
							<code class="code">name</code>' needs to be of type EString as well.
						</p>
<p>
							
<span class="bold"><strong>Assignment Operators</strong></span>
						
</p>
<p>There are three different assignment operators, each with different semantics.</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>The simple equal sign &ldquo;=&rdquo; is the straight forward assignment, and used for features which take only one element.</p>
</li>
<li class="listitem">
<p>The &ldquo;+=&rdquo; sign (the add operator) expects a multi valued feature and adds the value on the right hand to that feature, which is a list feature.</p>
</li>
<li class="listitem">
<p>The &ldquo;?=&rdquo; sign (boolean assignment operator) expects a feature of type EBoolean and sets it to true if the right hand side was consumed independently from the concrete value of the right hand side.</p>
</li>
</ol>
</div>
<p>The used assignment operator does not effect the cardinality of the expected symbols on the right hand side. </p>
</div>
<div class="section" title="Cross References">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="CrossReferences"></a>Cross References </h5>
</div>
</div>
</div>
<p>A unique feature of Xtext is the ability to declare crosslinks in the grammar. In traditional compiler construction the crosslinks are not established during parsing but in a later linking phase. This is the same in Xtext, but we allow to specify crosslink information in the grammar. This information is used by the linker.
							The syntax for crosslinks is:</p>
<div class="literallayout">
<p>
<code class="code">CrossReference&nbsp;:<br>
&nbsp;&nbsp;'['&nbsp;type=TypeRef&nbsp;('|'&nbsp;^terminal=CrossReferenceableTerminal&nbsp;)?&nbsp;']'<br>
;<br>

<br>

</code>
</p>
</div>
<p>For example, the transition is made up of two cross references, pointing to an event and a state:</p>
<div class="literallayout">
<p>
<code class="code">Transition&nbsp;:<br>
&nbsp;&nbsp;event=[Event]&nbsp;'=&gt;'&nbsp;state=[State]<br>
;<br>

<br>

</code>
</p>
</div>
<p>It is important to understand that the text between the square brackets does not refer to another rule, but to a type!
							This is sometimes confusing, because one usually uses the same name for the rules and the returned types.
							That is if we had named the type for events differently like in the following the cross reference needs to be adapted as well:</p>
<div class="literallayout">
<p>
<code class="code">Transition&nbsp;:<br>
&nbsp;&nbsp;event=[MyEvent]&nbsp;'=&gt;'&nbsp;state=[State]<br>
;<br>
&nbsp;<br>
Event&nbsp;returns&nbsp;MyEvent&nbsp;:&nbsp;....;<br>

<br>

</code>
</p>
</div>
<p>Looking at the syntax definition of cross references, there is an optional part starting with a vertical bar (pipe) followed by &lsquo;CrossReferenceableTerminal&rsquo;. This is the part describing the concrete text, from which the crosslink later should be established.
							If the terminal is omitted, it is expected to be an ID.</p>
<p>You may even use alternatives as the referencable terminal. This way, either an ID or a STRING may be used as the referencable terminal, as it is possible in many SQL dialects.</p>
<div class="literallayout">
<p>
<code class="code">TableRef:&nbsp;table=[Table|(ID|STRING)];<br>

</code>
</p>
</div>
<p>Have a look at the 
							<a class="link" href="#linking" title="Linking">linking section</a> in order to understand how linking is done.
						</p>
</div>
<div class="section" title="Simple Actions">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="SimpleActions"></a>Simple Actions </h5>
</div>
</div>
</div>
<p>By default the object to be returned by a parser rule is created lazily on the first assignment. Then the type of the EObject to be created is determined from the specified return type or the rule name if no explicit return type is specified.
							With Actions however, the creation of returned EObject can be made explicit. Xtext supports two kinds of Actions:</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>simple actions, and</p>
</li>
<li class="listitem">
<p>assigned actions.</p>
</li>
</ol>
</div>
<p>If at some point you want to enforce the creation of a specific type you can use alternatives or simple actions.
							In the following example TypeB must be a subtype of TypeA. An expression 
							<code class="code">A ident</code> should create an instance of TypeA, whereas 
							<code class="code">B ident</code> should instantiate TypeB.
						</p>
<p>Example with alternatives:</p>
<div class="literallayout">
<p>
<code class="code">MyRule&nbsp;returns&nbsp;TypeA&nbsp;:<br>
&nbsp;&nbsp;"A"&nbsp;name=ID&nbsp;|<br>
&nbsp;&nbsp;MyOtherRule<br>
;&nbsp;<br>
&nbsp;<br>
MyOtherRule&nbsp;returns&nbsp;TypeB&nbsp;:<br>
&nbsp;&nbsp;"B"&nbsp;name&nbsp;=&nbsp;ID<br>
;<br>

<br>

</code>
</p>
</div>
<p>Example with simple actions:  </p>
<div class="literallayout">
<p>
<code class="code">MyRule&nbsp;returns&nbsp;TypeA&nbsp;:<br>
&nbsp;&nbsp;"A"&nbsp;name=ID&nbsp;|<br>
&nbsp;&nbsp;"B"&nbsp;{TypeB}&nbsp;name=ID<br>
;&nbsp;<br>

<br>

</code>
</p>
</div>
<p>Generally speaking, the instance is created as soon as the parser hits the first assignment. However, actions allow to explicitly instantiate any EObject. The notation 
							<code class="code">{TypeB}</code> will create an instance of TypeB and assign it to the result of the parser rule. This allows parser rules without any assignment and object creation without the need to introduce unnecessary rules.
						</p>
</div>
<div class="section" title="Unassigned rule calls">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="Unassignedrulecalls"></a>Unassigned rule calls </h5>
</div>
</div>
</div>
<p>We previously explained, that the EObject to be returned is created lazily when the first assignment occurs or when a simple action is evaluated. There is another way one can set the EObject to be returned, which we call an &ldquo;unassigned rule call&rdquo;.</p>
<p>Unassigned rule calls (the name suggests it) are rule calls to other parser rules, which are not used within an assignment. If there is no feature the returned value shall be assigned to, the value is assigned to the &ldquo;to-be-returned&rdquo; result of the calling rule.</p>
<p>With unassigned rule calls one can, for instance, create rules which just dispatch between several other rules:</p>
<div class="literallayout">
<p>
<code class="code">AbstractToken&nbsp;:<br>
&nbsp;&nbsp;TokenA&nbsp;|<br>
&nbsp;&nbsp;TokenB&nbsp;|<br>
&nbsp;&nbsp;TokenC<br>
;<br>

<br>

</code>
</p>
</div>
<p>As 
							<code class="code">AbstractToken</code> could possibly return an instance of 
							<code class="code">TokenA</code>, 
							<code class="code">TokenB</code> or 
							<code class="code">TokenC</code> its type must by a super type of these types.
							It is now for instance as well possible to further change the state of the AST element by assigning additional things.
						</p>
<p>Example:</p>
<div class="literallayout">
<p>
<code class="code">AbstractToken&nbsp;:<br>
&nbsp;&nbsp;(&nbsp;TokenA&nbsp;|<br>
&nbsp;&nbsp;&nbsp;&nbsp;TokenB&nbsp;|<br>
&nbsp;&nbsp;&nbsp;&nbsp;TokenC&nbsp;)&nbsp;(cardinality=('?'|'+'|'*'))?<br>
;<br>

<br>

</code>
</p>
</div>
<p>This way the &lsquo;cardinality&rsquo; is optional (last question mark) and can be represented by a question mark, a plus, or an asterisk. It will be assigned to either an EObject of type 
							<code class="code">TokenA</code>,  
							<code class="code">TokenB</code>, or 
							<code class="code">TokenC</code> which are all subtypes of 
							<code class="code">AbstractToken</code>. The rule in this example will never create an instance of 
							<code class="code">AbstractToken</code> directly.
						</p>
</div>
<div class="section" title="Assigned Actions">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="grammarActions"></a>Assigned Actions </h5>
</div>
</div>
</div>
<p>LL parsing has some significant advantages over LR algorithms. The most important ones for Xtext are, that the generated code is much simpler to understand and debug and that it is easier to recover from errors. Especially ANTLR has a very nice generic error recovery mechanism. This allows to construct an AST even if there are syntactic errors in the text. You wouldn&rsquo;t get any of the nice IDE features as soon as there is one little error, if we hadn&rsquo;t error recovery.</p>
<p>However, LL also has some drawbacks. The most important one is that it does not allow left recursive grammars.
							For instance, the following is not allowed in LL based grammars, because &ldquo;Expression '+' Expression&rdquo; is left recursive:</p>
<div class="literallayout">
<p>
<code class="code">Expression&nbsp;:<br>
&nbsp;&nbsp;Expression&nbsp;'+'&nbsp;Expression&nbsp;|<br>
&nbsp;&nbsp;'('&nbsp;Expression&nbsp;')'<br>
&nbsp;&nbsp;INT<br>
;<br>

<br>

</code>
</p>
</div>
<p>Instead one has to rewrite such things by &ldquo;left-factoring&rdquo; it:</p>
<div class="literallayout">
<p>
<code class="code">Expression&nbsp;:<br>
&nbsp;&nbsp;TerminalExpression&nbsp;('+'&nbsp;Expression)?<br>
;<br>
&nbsp;<br>
TerminalExpression&nbsp;:<br>
&nbsp;&nbsp;'('&nbsp;Expression&nbsp;')'&nbsp;|<br>
&nbsp;&nbsp;INT<br>
;<br>

<br>

</code>
</p>
</div>
<p>In practice this is always the same pattern and therefore not that problematic. 
							However, by simply applying the Xtext AST construction features we&rsquo;ve covered so far, a grammar ...</p>
<div class="literallayout">
<p>
<code class="code">Expression&nbsp;:<br>
&nbsp;&nbsp;{Operation}&nbsp;left=TerminalExpression&nbsp;(op='+'&nbsp;right=Expression)?<br>
;<br>
&nbsp;<br>
TerminalExpression&nbsp;returns&nbsp;Expression:<br>
&nbsp;&nbsp;'('&nbsp;Expression&nbsp;')'&nbsp;|<br>
&nbsp;&nbsp;{IntLiteral}&nbsp;value=INT<br>
;<br>

<br>

</code>
</p>
</div>
<p>... would result in unwanted elements in the AST.
							For instance the expression &ldquo; ( 42 ) &rdquo; would result in a tree like this:</p>
<div class="literallayout">
<p>
<code class="code">Operation&nbsp;{<br>
&nbsp;&nbsp;left=Operation&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;left=IntLiteral&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value=42<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;}<br>
}<br>

<br>

</code>
</p>
</div>
<p>Typically one would only want to have one instance of 
							<code class="code">IntLiteral</code> instead.
						</p>
<p>One can solve this problem using a combination of unassigned rule calls and assigned actions:</p>
<div class="literallayout">
<p>
<code class="code">Expression&nbsp;:<br>
&nbsp;&nbsp;TerminalExpression&nbsp;({Operation.left=current}&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;op='+'&nbsp;right=Expression)?<br>
;<br>
&nbsp;<br>
TerminalExpression&nbsp;returns&nbsp;Expression:<br>
&nbsp;&nbsp;'('&nbsp;Expression&nbsp;')'&nbsp;|<br>
&nbsp;&nbsp;{IntLiteral}&nbsp;value=INT<br>
;<br>

<br>

</code>
</p>
</div>
<p>In the example above 
							<code class="code">{Operation.left=current}</code> is a so called tree rewrite action, which creates a new instance of the stated EClass (Operation in this case) and assigns the element currently to-be-returned (
							<code class="code">current</code> variable) to a feature of the newly created object (in this case feature &lsquo;left&rsquo; of the Operation instance).
							In Java these semantics could be expressed as:
						</p>
<div class="literallayout">
<p>
<code class="code">Operation&nbsp;temp&nbsp;=&nbsp;new&nbsp;Operation();<br>
temp.setLeft(current);<br>
current&nbsp;=&nbsp;temp;<br>

<br>

</code>
</p>
</div>
</div>
</div>
</div>
<div class="section" title="Hidden terminal symbols">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Hiddenterminalsymbols"></a>Hidden terminal symbols</h3>
</div>
</div>
</div>
<p>Because parser rules describe not a single token, but a sequence of patterns in the input, it is necessary to define the interesting parts of the input. Xtext introduces the concept of hidden tokens to handle semantically unimportant things like whitespaces, comments, etc. in the input sequence gracefully. It is possible to define a set of terminal symbols, that are hidden from the parser rules and automatically skipped when they are recognized. Nevertheless, they are transparently woven into the node model, but not relevant for the semantic model. </p>
<p>Hidden terminals may (or may not) appear between any other terminals in any cardinality. They can be described per rule or for the whole grammar. When 
					<a class="link" href="#grammarMixins" title="Grammar Mixins">reusing a single grammar</a> its definition of hidden tokens is reused as well. The grammar 
					<code class="code">org.eclipse.xtext.common.Terminals</code> comes with a reasonable default and hides all comments and whitespace from the parser rules.
				</p>
<p>If a rule defines hidden symbols, you can think of a kind of scope that is automatically introduced. Any rule that is called from the declaring rule uses the same hidden terminals as the calling rule, unless it defines other hidden tokens itself.</p>
<div class="literallayout">
<p>
<code class="code">Person&nbsp;hidden(WS,&nbsp;ML_COMMENT,&nbsp;SL_COMMENT):&nbsp;<br>
&nbsp;&nbsp;name=Fullname&nbsp;age=INT&nbsp;';'<br>
;<br>

<br>
Fullname:&nbsp;<br>
&nbsp;&nbsp;(firstname=ID)?&nbsp;lastname=ID<br>
;<br>

<br>

</code>
</p>
</div>
<p>The sample rule &ldquo;Person&rdquo; defines multiline comments (ML_COMMENT), single-line comments (SL_COMMENT), and whitespace (WS) to be allowed between the &lsquo;Fullname&rsquo; and the &lsquo;age&rsquo;. Because the rule &lsquo;Fullname&rsquo; does not introduce another set of hidden terminals, it allows the same symbols to appear between &lsquo;firstname&rsquo; and &lsquo;lastname&rsquo; as the calling rule &lsquo;Person&rsquo;. Thus, the following input is perfectly valid for the given grammar snippet:</p>
<div class="literallayout">
<p>
<code class="code">John&nbsp;/*&nbsp;comment&nbsp;*/&nbsp;Smith&nbsp;//&nbsp;line&nbsp;comment<br>
/*&nbsp;comment&nbsp;*/<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;42&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;//&nbsp;line&nbsp;comment<br>

<br>

</code>
</p>
</div>
<p>A list of all default terminals like WS can be found in section 
					<a class="link" href="#grammarMixins" title="Grammar Mixins">Grammar Mixins</a>.
				</p>
</div>
<div class="section" title="Data type rules">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="datatypeRules"></a>Data type rules</h3>
</div>
</div>
</div>
<p>Data type rules are parsing-phase rules, which create instances of EDataType instead of EClass. Thinking about it, one may discover that they are quite similar to terminal rules.
					However, the nice thing about data type rules is that they are actually parser rules and are therefore </p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>context sensitive and </p>
</li>
<li class="listitem">
<p>allow for use of hidden tokens.</p>
</li>
</ol>
</div>
<p>If you, for instance, want to define a rule to consume Java-like qualified names (e.g. &ldquo;foo.bar.Baz&rdquo;)
					you could write:</p>
<div class="literallayout">
<p>
<code class="code">QualifiedName&nbsp;:<br>
&nbsp;&nbsp;ID&nbsp;('.'&nbsp;ID)*<br>
;<br>

<br>

</code>
</p>
</div>
<p>This looks similar to the terminal rule we&rsquo;ve defined above in order to explain rule calls.
					However, the difference is that because it is a parser rule and therefore only valid in certain contexts, it won&rsquo;t conflict with the rule ID.
					If you had defined it as a terminal rule, it would possibly hide the ID rule.</p>
<p>In addition when this has been defined as a data type rule, it is allowed to use hidden tokens (e.g. &ldquo;/* comment **/&rdquo;) between the IDs and dots (e.g. 
					<code class="code">foo/* comment */. bar . Baz"</code>)
				</p>
<p>Return types can be specified in the same way as in terminal rules:</p>
<div class="literallayout">
<p>
<code class="code">QualifiedName&nbsp;returns&nbsp;ecore::EString&nbsp;:&nbsp;<br>
&nbsp;&nbsp;ID&nbsp;('.'&nbsp;ID)*<br>
;<br>

<br>

</code>
</p>
</div>
<p>Note that if a rule does not call another parser rule and does neither contain any actions nor 
					<a class="link" href="#assignments" title="Assignments">assignments</a>, it is considered to be a data type rule and the data type EString is implied if none has been explicitly declared.
				</p>
<p>For conversion again value converters are responsible (cf. 
					<a class="link" href="#valueconverter" title="Value Converter">value converters</a>).
				</p>
</div>
<div class="section" title="Enum Rules">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="EnumRules"></a>Enum Rules</h3>
</div>
</div>
</div>
<p>Enum rules return enumeration literals from strings. They can be seen as a shortcut for data type rules with specific value converters.
					The main advantage of enum rules is their simplicity, type safety and therefore nice validation. Furthermore it is possible to infer enums and their respective literals during the Ecore model transformation.</p>
<p>If you want to define a ChangeKind 
					<a class="ulink" href="http://help.eclipse.org/stable/index.jsp?topic=/org.eclipse.emf.doc/references/javadoc/org/eclipse/emf/ecore/change/impl/package-summary.html" target="_new">org.eclipse.emf.ecore.change/model/Change.ecore</a> with &lsquo;ADD&rsquo;, &lsquo;MOVE&rsquo; and &lsquo;REMOVE&rsquo; you could write:
				</p>
<div class="literallayout">
<p>
<code class="code">enum&nbsp;ChangeKind&nbsp;:<br>
&nbsp;&nbsp;ADD&nbsp;|&nbsp;MOVE&nbsp;|&nbsp;REMOVE<br>
;<br>

<br>

</code>
</p>
</div>
<p>It is even possible to use alternative literals for your enums or reference an enum value twice:</p>
<div class="literallayout">
<p>
<code class="code">enum&nbsp;ChangeKind&nbsp;:<br>
&nbsp;&nbsp;ADD&nbsp;=&nbsp;'add'&nbsp;|&nbsp;ADD&nbsp;=&nbsp;'+'&nbsp;|&nbsp;<br>
&nbsp;&nbsp;MOVE&nbsp;=&nbsp;'move'&nbsp;|&nbsp;MOVE&nbsp;=&nbsp;'-&gt;'&nbsp;|&nbsp;<br>
&nbsp;&nbsp;REMOVE&nbsp;=&nbsp;'remove'&nbsp;|&nbsp;REMOVE&nbsp;=&nbsp;'-'<br>
;<br>

<br>

</code>
</p>
</div>
<p>Please note, that Ecore does not support unset values for enums. If you formulate a grammar like</p>
<div class="literallayout">
<p>
<code class="code">Element:&nbsp;"element"&nbsp;name=ID&nbsp;(value=SomeEnum)?;<br>

</code>
</p>
</div>
<p>with the input of</p>
<div class="literallayout">
<p>
<code class="code">element&nbsp;Foo<br>

</code>
</p>
</div>
<p>the resulting value of the element 
					<code class="code">Foo</code> will hold the enum value with the internal representation of &lsquo;0&rsquo; (zero). When generating the EPackage from your grammar this will be the first literal you define. As a workaround you could introduce a dedicated none-value or order the enums accordingly. Note that it is not possible to define an enum literal with an empty textual representation.
				</p>
<div class="literallayout">
<p>
<code class="code">enum&nbsp;Visibility:&nbsp;<br>
&nbsp;&nbsp;package&nbsp;|&nbsp;private&nbsp;|&nbsp;protected&nbsp;|&nbsp;public<br>
;<br>
&nbsp;<br>

</code>
</p>
</div>
<p>You can overcome this by modifying the infered Ecore model through a 
					<a class="link" href="#customPostProcessing" title="Customized Post Processing">model to model transformation</a>.
				</p>
</div>
</div>
<div class="section" title="Ecore model inference">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="metamodelInference"></a>Ecore model inference</h2>
</div>
</div>
</div>
<p>The Ecore model (or meta model) of a textual language describes the structure of its abstract syntax trees (AST). </p>
<p>Xtext uses Ecore&rsquo;s EPackages to define Ecore models. Ecore models are declared to be either inferred (generated) from the grammar or imported. 
				By using the &lsquo;generate&rsquo; directive, one tells Xtext to derive an EPackage from the grammar. </p>
<div class="section" title="Type and Package Generation">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="TypeandPackageGeneration"></a>Type and Package Generation</h3>
</div>
</div>
</div>
<p>Xtext creates</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>an EPackage</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="circle">
<li class="listitem">
<p>for each generate-package declaration. After the directive &lsquo;generate&rsquo; a list of parameters follows. The &lsquo;name&rsquo; of the EPackage will be set to the first parameter, its &lsquo;nsURI&rsquo; to the second parameter. An optional alias as the third parameter allows to distinguish generated EPackages later. Only one generated package declaration per alias is allowed.</p>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>an EClass</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="circle">
<li class="listitem">
<p>for each return type of a parser rule. If a parser rule does not define a return type, an implicit one with the same name as the rule itself is assumed. You can specify more than one rule that return the same type but only one EClass will be generated.</p>
</li>
<li class="listitem">
<p>for each type defined in an action or a cross reference.</p>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>an EEnum</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="circle">
<li class="listitem">
<p>for each return type of an enum rule.</p>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>an EDatatype</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="circle">
<li class="listitem">
<p>for each return type of a terminal rule or a data type rule.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p>All EClasses, EEnums and EDatatypes are added to the EPackage referred to by the alias provided in the type reference they were created from.</p>
</div>
<div class="section" title="Feature and Type Hierarchy Generation">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="FeatureandTypeHierarchyGeneration"></a>Feature and Type Hierarchy Generation</h3>
</div>
</div>
</div>
<p>While walking through the grammar, the algorithm keeps track of a set of the currently possible return types to add features to. </p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>Entering a parser rule the set contains only the return type of the rule. </p>
</li>
<li class="listitem">
<p>Entering a group in an alternative the set is reset to the same state it was in when entering the first group of this alternative. </p>
</li>
<li class="listitem">
<p>Leaving an alternative the set contains the union of all types at the end of each of its groups.</p>
</li>
<li class="listitem">
<p>After an optional element, the set is reset to the same state it was before entering it. </p>
</li>
<li class="listitem">
<p>After a mandatory (non-optional) rule call or mandatory action the set contains only the return type of the called rule or action. </p>
</li>
<li class="listitem">
<p>An optional rule call does not modify the set.</p>
</li>
<li class="listitem">
<p>A rule call is optional, if its cardinality is &lsquo;?&rsquo; or &lsquo;*&rsquo;.</p>
</li>
</ul>
</div>
<p>While iterating the parser rules Xtext creates</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>an EAttribute in each current return type</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="circle">
<li class="listitem">
<p>of type EBoolean for each feature assignment using the &lsquo;?=&rsquo; operator. No further EReferences or EAttributes will be generated from this assignment.</p>
</li>
<li class="listitem">
<p>for each assignment with the &lsquo;=&rsquo; or &lsquo;+=&rsquo; operator calling a terminal rule. Its type will be the return type of the called rule.</p>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>an EReference in each current return type</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="circle">
<li class="listitem">
<p>for each assignment with the &lsquo;=&rsquo; or &lsquo;+=&rsquo; operator in a parser rule calling a parser rule. The EReference&rsquo;s type will be the return type of the called parser rule.</p>
</li>
<li class="listitem">
<p>for each assigned action. The reference&rsquo;s type will be set to the return type of the current calling rule. </p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p>Each EAttribute or EReference takes its name from the assignment or action that caused it. Multiplicities will be 0...1 for assignments with the &lsquo;=&rsquo; operator and 0...* for assignments with the &lsquo;+=&rsquo; operator. </p>
<p>Furthermore, each type that is added to the currently possible return types automatically extends the current return type of the parser rule. You can specify additional common super types by means of &ldquo;artificial&rdquo; parser rules, that are never called, e.g.</p>
<div class="literallayout">
<p>
<code class="code">CommonSuperType:<br>
&nbsp;&nbsp;SubTypeA&nbsp;|&nbsp;SubTypeB&nbsp;|&nbsp;SubTypeC;<br>

<br>

</code>
</p>
</div>
</div>
<div class="section" title="Enum Literal Generation">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="EnumLiteralGeneration"></a>Enum Literal Generation</h3>
</div>
</div>
</div>
<p>For each alternative defined in an enum rule, the transformer creates an enum literal, when another literal with the same name cannot be found. The &lsquo;literal&rsquo; property of the generated enum literal is set to the right hand side of the declaration. If it is omitted, you will get an enum literal with equal &lsquo;name&rsquo; and &lsquo;literal&rsquo; attributes.</p>
<div class="literallayout">
<p>
<code class="code">enum&nbsp;MyGeneratedEnum:<br>
&nbsp;&nbsp;NAME&nbsp;=&nbsp;'literal'&nbsp;|&nbsp;EQUAL_NAME_AND_LITERAL;<br>

<br>

</code>
</p>
</div>
</div>
<div class="section" title="Feature Normalization">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="FeatureNormalization"></a>Feature Normalization</h3>
</div>
</div>
</div>
<p>In the next step the generator examines all generated EClasses and lifts up similar features to super types if there is more than one subtype and the feature is defined in every subtypes. This does even work for multiple super types.</p>
</div>
<div class="section" title="Customized Post Processing">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="customPostProcessing"></a>Customized Post Processing</h3>
</div>
</div>
</div>
<p>As a last step, the generator invokes the post processor for every generated Ecore model. The post processor expects an Xtend file with name 
					<code class="code">&lt;MyDsl&gt;PostProcessor.ext</code> (if the name of the grammar file is 
					<code class="code">MyDsl.xtext</code>) in the same folder as the grammar file. Further, for a successful invocation, the Xtend file must declare an extension with signature 
					<code class="code">process(xtext::GeneratedMetamodel)</code>. E.g.
				</p>
<div class="literallayout">
<p>
<code class="code">process(xtext::GeneratedMetamodel&nbsp;this)&nbsp;:<br>
&nbsp;&nbsp;process(ePackage)<br>
;<br>
&nbsp;<br>
process(ecore::EPackage&nbsp;this)&nbsp;:<br>
&nbsp;&nbsp;...&nbsp;do&nbsp;something<br>
;<br>

<br>

</code>
</p>
</div>
<p>The invoked extension can then augment the generated Ecore model in place. Some typical use cases are to:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>set default values for attributes,</p>
</li>
<li class="listitem">
<p>add container references as opposites of existing containment references, or</p>
</li>
<li class="listitem">
<p>add operations with implementation using a body annotation.</p>
</li>
</ul>
</div>
<p>Great care must be taken to not modify the Ecore model in a way preventing the Xtext parser from working correctly (e.g. removing or renaming model elements).</p>
</div>
<div class="section" title="Error Conditions">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="ErrorConditions"></a>Error Conditions</h3>
</div>
</div>
</div>
<p>The following conditions cause an error</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>An EAttribute or EReference has two different types or different cardinality.</p>
</li>
<li class="listitem">
<p>There is an EAttribute and an EReference with the same name in the same EClass.</p>
</li>
<li class="listitem">
<p>There is a cycle in the type hierarchy.</p>
</li>
<li class="listitem">
<p>An new EAttribute, EReference or super type is added to an imported type.</p>
</li>
<li class="listitem">
<p>An EClass is added to an imported EPackage.</p>
</li>
<li class="listitem">
<p>An undeclared alias is used. </p>
</li>
<li class="listitem">
<p>An imported Ecore model cannot be loaded.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="section" title="Importing existing Ecore models">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="grammarImport"></a>Importing existing Ecore models</h2>
</div>
</div>
</div>
<p>With the import directive in Xtext you can refer to existing Ecore models and reuse the types that are declared in an EPackage. Xtext uses this technique itself to leverage Ecore data types.</p>
<div class="literallayout">
<p>
<code class="code">import&nbsp;'http://www.eclipse.org/emf/2002/Ecore'&nbsp;as&nbsp;ecore<br>

</code>
</p>
</div>
<p>Specify an explicit return type to reuse such imported types. Note that this even works for terminal rules.</p>
<div class="literallayout">
<p>
<code class="code">terminal&nbsp;INT&nbsp;returns&nbsp;ecore::EInt&nbsp;:&nbsp;('0'..'9')+;<br>

</code>
</p>
</div>
</div>
<div class="section" title="Grammar Mixins">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="grammarMixins"></a>Grammar Mixins</h2>
</div>
</div>
</div>
<p>Xtext supports the reuse of existing grammars. Grammars that are created via the Xtext wizard use 
				<code class="code">org.eclipse.xtext.common.Terminals</code> by default which introduces a common set of terminal rules and defines reasonable defaults for hidden terminals.
			</p>
<div class="literallayout">
<p>
<code class="code">grammar&nbsp;org.xtext.example.MyDsl&nbsp;with&nbsp;org.eclipse.xtext.common.Terminals<br>
&nbsp;<br>
generate&nbsp;myDsl&nbsp;'http://www.xtext.org/example/MyDsl'<br>
&nbsp;<br>
...&nbsp;some&nbsp;rules<br>

<br>

</code>
</p>
</div>
<p>Mixing in another grammar makes the rules defined in that grammar referable. It is also possible to overwrite rules from the used grammar. </p>
<p>Example :</p>
<div class="literallayout">
<p>
<code class="code">grammar&nbsp;my.SuperGrammar<br>
...<br>
RuleA&nbsp;:&nbsp;"a"&nbsp;stuff=RuleB;<br>
RuleB&nbsp;:&nbsp;"{"&nbsp;name=ID&nbsp;"}";<br>

<br>
grammar&nbsp;my.SubGrammar&nbsp;with&nbsp;my.SuperGrammar<br>

<br>
Model&nbsp;:&nbsp;(ruleAs+=RuleA)*;<br>

<br>
//&nbsp;overrides&nbsp;my.SuperGrammar.RuleB<br>
RuleB&nbsp;:&nbsp;'['&nbsp;name=ID&nbsp;']';<br>

<br>

</code>
</p>
</div>
<p>Note that declared terminal rules always get a higher priority then imported terminal rules.</p>
</div>
<div class="section" title="Default tokens">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Defaulttokens"></a>Default tokens</h2>
</div>
</div>
</div>
<p>Xtext ships with a default set of predefined, reasonable and often required terminal rules. This grammar is defined as follows:</p>
<div class="literallayout">
<p>
<code class="code">grammar&nbsp;org.eclipse.xtext.common.Terminals&nbsp;<br>
&nbsp;&nbsp;hidden(WS,&nbsp;ML_COMMENT,&nbsp;SL_COMMENT)<br>

<br>
import&nbsp;"http://www.eclipse.org/emf/2002/Ecore"&nbsp;as&nbsp;ecore<br>

<br>
terminal&nbsp;ID&nbsp;:&nbsp;<br>
&nbsp;&nbsp;'^'?('a'..'z'|'A'..'Z'|'_')&nbsp;('a'..'z'|'A'..'Z'|'_'|'0'..'9')*&nbsp;;<br>
terminal&nbsp;INT&nbsp;returns&nbsp;ecore::EInt:&nbsp;('0'..'9')+&nbsp;;<br>
terminal&nbsp;STRING	:&nbsp;<br>
&nbsp;&nbsp;'"'&nbsp;(&nbsp;'\\'&nbsp;('b'|'t'|'n'|'f'|'r'|'"'|"'"|'\\')&nbsp;|&nbsp;!('\\'|'"')&nbsp;)*&nbsp;'"'&nbsp;|<br>
&nbsp;&nbsp;"'"&nbsp;(&nbsp;'\\'&nbsp;('b'|'t'|'n'|'f'|'r'|'"'|"'"|'\\')&nbsp;|&nbsp;!('\\'|"'")&nbsp;)*&nbsp;"'";&nbsp;<br>
terminal&nbsp;ML_COMMENT	:&nbsp;'/*'&nbsp;-&gt;&nbsp;'*/'&nbsp;;<br>
terminal&nbsp;SL_COMMENT&nbsp;	:&nbsp;'//'&nbsp;!('\n'|'\r')*&nbsp;('\r'?&nbsp;'\n')?&nbsp;;<br>
terminal&nbsp;WS		:&nbsp;('&nbsp;'|'\t'|'\r'|'\n')+&nbsp;;<br>
terminal&nbsp;ANY_OTHER:	.&nbsp;;<br>

</code>
</p>
</div>
</div>
</div>
<div class="chapter" title="Chapter&nbsp;3.&nbsp;Configuration">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="configuration"></a>Chapter&nbsp;3.&nbsp;Configuration</h2>
</div>
</div>
</div>
<div class="section" title="The Generator">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="generator"></a>The Generator</h2>
</div>
</div>
</div>
<p>Xtext provides lots of generic implementations for your language&rsquo;s
				infrastructure but also uses code generation to generate some of the 
				components. Those generated components are for instance the parser, the 
				serializer, the Ecore model and a couple of convenient base classes for 
				content assist etc.</p>
<p>The generator also contributes to shared project resources such as the 
				plugin.xml, Manifest.MF and the 
				<a class="link" href="#guicemodules" title="Modules">Guice modules</a>.
			</p>
<p>Xtext&rsquo;s generator leverages the 
				<a class="ulink" href="http://www.eclipse.org/modeling/emft/?project=mwe" target="_new">modeling workflow engine (MWE)</a> from EMFT.
			</p>
<div class="section" title="A short introduction to MWE">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="short_intro_to_mwe"></a>A short introduction to MWE</h3>
</div>
</div>
</div>
<p>The nice thing about MWE is that it just instantiates Java classes and the configuration is done through setter and adder methods.
					Given the following Java class :</p>
<div class="literallayout">
<p>
<code class="code">package&nbsp;foo;<br>
&nbsp;&nbsp;<br>
public&nbsp;class&nbsp;Person&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;private&nbsp;String&nbsp;name;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;setName(String&nbsp;name)&nbsp;{&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;this.name&nbsp;=&nbsp;name;<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;private&nbsp;final&nbsp;List&lt;Person&gt;&nbsp;children&nbsp;=&nbsp;new&nbsp;ArrayList&lt;Person&gt;();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;addChild(Person&nbsp;child)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;this.children.add(child);<br>
&nbsp;&nbsp;}<br>
}<br>
&nbsp;&nbsp;<br>

</code>
</p>
</div>
<p>one can create a family tree this way:</p>
<div class="literallayout">
<p>
<code class="code">&lt;x&nbsp;class="foo.Person"&gt;<br>
&nbsp;&nbsp;&lt;name&nbsp;value="Grandpa"/&gt;<br>
&nbsp;&nbsp;&lt;child&nbsp;class="foo.Person"&nbsp;name="Father"&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;child&nbsp;name="Son"/&gt;<br>
&nbsp;&nbsp;&lt;/child&gt;<br>
&lt;/x&gt;<br>

<br>

</code>
</p>
</div>
<p>These couple of lines will, when interpreted by MWE, result in an 
					object tree consisting of three instances of 
					<code class="code">foo.Person</code>:

					</p>
<div class="mediaobject">
<img src="images/family_tree.png"></div>
<p>
				
</p>
<p>The root element can have an arbitrary name, with one exception: If the
					name is 
					<code class="code">workflow</code> and no class attribute is provided, it is assumed 
					that an instance of 
					<code class="code">org.eclipse.emf.mwe.internal.core.Workflow</code> shall 
					be instantiated. This instance will be the root of a workflow model used 
					in generator workflow configurations. However, as you can see in the example
					above one can instantiate arbitrary Java object models. This is 
					conceptually very close to the dependency injection and the XML language 
					in the 
					<a class="ulink" href="http://www.springframework.org" target="_new">Spring Framework</a>. 
				</p>
<p>As explained above the element 
					<span class="emphasis"><em>name</em></span> '
					<code class="code">x</code>' is ignored in this case. The attribute 
					<code class="code">class</code>
					tells MWE which class to use in order to create the object node. The 
					created object is populated according to the XML description: 
					For each XML attribute MWE calls a corresponding setter or adder method 
					passing in the value (there are configurable value 
					converters, but usually Boolean and String is all you need). The same 
					procedure is applied for each child element. In the case of XML elements 
					a single attribute 
					<code class="code">value</code> is used and interpreted as if it was an 
					attribute in the parent element. That is:
				</p>
<div class="literallayout">
<p>
<code class="code">&lt;foo&gt;&lt;name&nbsp;value="bar"/&gt;&lt;/foo&gt;<br>

</code>
</p>
</div>
<p>means the same as</p>
<div class="literallayout">
<p>
<code class="code">&lt;foo&nbsp;name="bar"/&gt;<br>

</code>
</p>
</div>
<p>Obviously the latter is far more readable and should be preferred. However, 
					as soon as you want to add multiple values to the same &lsquo;adder&rsquo; method you 
					will need to use the first syntax because you cannot define the same 
					attribute twice in XML.</p>
<p>If an element does not have an attribute 
					<code class="code">value</code>, the engine looks for an 
					attribute called 
					<code class="code">class</code>. If it finds one, the class is instantiated by means 
					of the default constructor (there is no support for factories as of now.). 
					If not, the class is inferred by looking at the argument&rsquo;s type of the current 
					setter method.
				</p>
<p>Due to this shortcut it is valid to write:</p>
<div class="literallayout">
<p>
<code class="code">&lt;child&nbsp;name="Son"/&gt;<br>

</code>
</p>
</div>
<p>The 
					<code class="code">addChild</code> method takes a 
					<code class="code">foo.Person</code> as an argument. As this is a 
					concrete class which has a default constructor it can be instantiated.
				</p>
<p>
					
<span class="bold"><strong>Tip</strong></span>

					<span class="italic">Whenever you are in an *.mwe file and wonder what kind of configuration the underlying component may accept: Just use JDT&rsquo;s open type action (CTRL+Shift+T) open the source file of the class in question, use the quick outline view (CTRL+O, use CTRL+O twice to see inherited members as well) and type &lsquo;set&rsquo; or &lsquo;add&rsquo; and you will see the available modifiers. Note that we plan to replace the XML syntax with an Xtext-based implementation as soon as possible.</span>
				
</p>
<p>This is the basic idea of the MWE language. There are of course a couple of additional concepts and features in the language and we also have not yet talked about the runtime workflow model. Please consult the MWE reference documentation (available through Eclipse help) for additional information.</p>
</div>
<div class="section" title="General Architecture">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="GeneralArchitecture"></a>General Architecture </h3>
</div>
</div>
</div>
<p>Now that you know a bit about MWE, you are ready to learn about the concepts and architecture of Xtext&rsquo;s language generator. 
					An instance of Xtext&rsquo;s generator is configured with general information about source folders and projects and consists of any number of language configurations. 
					For each language configuration a URI pointing to its grammar file and the file extensions for the DSL must be provided. 
					In addition, a language is configured with a list of 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/IGeneratorFragment.java?root=Modeling_Project&view=co" target="_new">IGeneratorFragment</a>s.
					The whole generator is composed of theses fragments. We have fragments for generating parsers, the serializer, the EMF code, the outline view, etc.

					</p>
<div class="mediaobject">
<img src="images/generator-structure.png"></div>
<p>
				
</p>
<div class="section" title="Generator Fragments">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="generator_fragment"></a>Generator Fragments</h4>
</div>
</div>
</div>
<p>Each fragment gets the grammar of the language as an EMF model passed in. A fragment is able to generate code in one of the configured locations and contribute to several shared artifacts. The main interface 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/IGeneratorFragment.java?root=Modeling_Project&view=co" target="_new">IGeneratorFragment</a> is supported by a convenient abstract base class 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/AbstractGeneratorFragment.java?root=Modeling_Project&view=co" target="_new">AbstractGeneratorFragment</a>, which by default delegates to an Xpand template with the same qualified name as the class and delegates some of the calls to Xpand template definitions.
					</p>
<p>We suggest to have a look at the fragment we have written for label providers (
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/ui/generator/labeling/LabelProviderFragment.java?root=Modeling_Project&view=co" target="_new">LabelProviderFragment</a>). It is pretty trivial and at the same time uses the most important call backs. In addition, the structure is not cluttered with too much extra noise so that the whole package (as of Xtext 0.7.0) can serve as a template to write your own fragment.
					</p>
</div>
<div class="section" title="Configuration">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="Configuration"></a>Configuration</h4>
</div>
</div>
</div>
<p>As already explained we use MWE from EMFT in order to instantiate, configure and execute this structure of components. 
						In the following we see an exemplary Xtext generator configuration written in MWE configuration code:  </p>
<div class="literallayout">
<p>
<code class="code">
<br>
&lt;workflow&gt;<br>
	&lt;property&nbsp;file="org/xtext/example/GenerateMyDsl.properties"/&gt;<br>
	
<br>
	&lt;property&nbsp;name="runtimeProject"&nbsp;value="../${projectName}"/&gt;<br>
	
<br>
	&lt;bean&nbsp;class="org.eclipse.emf.mwe.utils.StandaloneSetup"<br>
		platformUri="${runtimeProject}/.."/&gt;<br>
	
<br>
	&lt;component&nbsp;class="org.eclipse.emf.mwe.utils.DirectoryCleaner"<br>
		directory="${runtimeProject}/src-gen"/&gt;<br>
	&lt;component&nbsp;class="org.eclipse.emf.mwe.utils.DirectoryCleaner"<br>
		directory="${runtimeProject}.ui/src-gen"/&gt;<br>
	
<br>
	&lt;component&nbsp;class="org.eclipse.xtext.generator.Generator"&gt;<br>
		&lt;pathRtProject&nbsp;value="${runtimeProject}"/&gt;<br>
		&lt;pathUiProject&nbsp;value="${runtimeProject}.ui"/&gt;<br>
		&lt;projectNameRt&nbsp;value="${projectName}"/&gt;<br>
		&lt;projectNameUi&nbsp;value="${projectName}.ui"/&gt;<br>
		
<br>
		&lt;language&nbsp;uri="${grammarURI}"&nbsp;fileExtensions="${file.extensions}"&gt;<br>
			&lt;!--&nbsp;Java&nbsp;API&nbsp;to&nbsp;access&nbsp;grammar&nbsp;elements&nbsp;<br>
				(required&nbsp;by&nbsp;several&nbsp;other&nbsp;fragments)&nbsp;--&gt;<br>
			&lt;fragment&nbsp;class=<br>
				"org.eclipse.xtext.generator.grammarAccess.GrammarAccessFragment"/&gt;<br>
			
<br>
			&lt;!--&nbsp;a&nbsp;lot&nbsp;more&nbsp;simple&nbsp;fragments&nbsp;--&gt;<br>
			&lt;!--&nbsp;...&nbsp;&nbsp;--&gt;<br>
		
<br>
			&lt;!--&nbsp;a&nbsp;sample&nbsp;fragment&nbsp;with&nbsp;a&nbsp;property&nbsp;--&gt;<br>
			&lt;fragment&nbsp;class=<br>
				"org.eclipse.xtext.generator.validation.JavaValidatorFragment"&gt;<br>
				&lt;composedCheck&nbsp;value="org.eclipse.xtext.validation.ImportUriValidator"/&gt;<br>
			&lt;/fragment&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--&nbsp;more&nbsp;simple&nbsp;fragments&nbsp;--&gt;<br>
			&lt;!--&nbsp;...&nbsp;&nbsp;--&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
		&lt;/language&gt;<br>
	&lt;/component&gt;<br>
&lt;/workflow&gt;<br>

<br>

</code>
</p>
</div>
<p>Here the root element is a workflow which accepts 
						<span class="italic">bean</span> s and 
						<span class="italic">component</span> s. The 
						<code class="code">&lt;property/&gt;</code> element is a first class concept of MWE&rsquo;s configuration language and essentially acts as a preprocessor, which replaces all occurrences of 
						<code class="code">${propertyName}</code> with the given value. Property declarations can be defined in-line (
						<code class="code">&lt;property name="foo" value="bar"/&gt;</code>) or by means of a property file import (
						<code class="code">&lt;property file="foo.properties"/&gt;</code>) which is performed before the actual tree is created. In this example we first import a properties file and after that declare a property 
						<code class="code">runtimeProject</code> which already uses a property imported from the previously imported file. 
					</p>
<p>The method 
						<code class="code">Workflow.setBean()</code> does nothing but provides a means to apply global side-effects, which unfortunately is required by some projects. In this example we do a so called 
						<span class="italic">EMF stand alone setup</span>. This class initializes a bunch of things for a non-OSGi environment that are otherwise configured by means of extension points, e.g. EMF&rsquo;s 
						<code class="code">EPackage.Registry</code>.
					</p>
<p>Following the 
						<code class="code">&lt;bean/&gt;</code> element there are three 
						<code class="code">&lt;component/&gt;</code> elements. The 
						<code class="code">Workflow.addComponent()</code> method awaits instances of 
						<code class="code">IWorkflowComponent</code>, which is the primary concept of MWE&rsquo;s workflow model. Xtext&rsquo;s generator is an instance of 
						<code class="code">IWorkflowComponent</code> and can therefore be used within MWE workflows. 
					</p>
</div>
</div>
<div class="section" title="Standard generator fragments">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Standardgeneratorfragments"></a>Standard generator fragments</h3>
</div>
</div>
</div>
<p>In the following table the most important standard generator fragments are listed. Please refer to the Javadocs for more detailed documentation.</p>
<table id="N10704">
<tr>
						
<th>Class</th>
						<th>Generated Artifacts</th>
					
</tr>
<tr>
						
<td>
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/ecore/EcoreGeneratorFragment.java?root=Modeling_Project&view=co" target="_new">EcoreGeneratorFragment</a>
						</td>
						<td>EMF code for generated models</td>
					
</tr>
<tr>
						
<td>XtextAntlrGeneratorFragment</td>
						<td>ANTLR grammar, parser, lexer and related services.</td>
					
</tr>
<tr>
						
<td>
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/grammarAccess/GrammarAccessFragment.java?root=Modeling_Project&view=co" target="_new">GrammarAccessFragment</a>
						</td>
						<td>Access to the grammar</td>
					
</tr>
<tr>
						
<td>
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/resourceFactory/ResourceFactoryFragment.java?root=Modeling_Project&view=co" target="_new">ResourceFactoryFragment</a>
						</td>
						<td>EMF resource factory</td>
					
</tr>
<tr>
						
<td>
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/parseTreeConstructor/ParseTreeConstructorFragment.java?root=Modeling_Project&view=co" target="_new">ParseTreeConstructorFragment</a>
						</td>
						<td>Model-to-text serialization</td>
					
</tr>
<tr>
						
<td>
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/scoping/JavaScopingFragment.java?root=Modeling_Project&view=co" target="_new">JavaScopingFragment</a>
						</td>
						<td>Java-based scoping</td>
					
</tr>
<tr>
						
<td>
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/validation/JavaValidatorFragment.java?root=Modeling_Project&view=co" target="_new">JavaValidatorFragment</a>
						</td>
						<td>Java-based model validation</td>
					
</tr>
<tr>
						
<td>
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/validation/CheckFragment.java?root=Modeling_Project&view=co" target="_new">CheckFragment</a>
						</td>
						<td>Xpand/Check-based model validation</td>
					
</tr>
<tr>
						
<td>
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/formatting/FormatterFragment.java?root=Modeling_Project&view=co" target="_new">FormatterFragment</a>
						</td>
						<td>Code formatter</td>
					
</tr>
<tr>
						
<td>
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/ui/generator/labeling/LabelProviderFragment.java?root=Modeling_Project&view=co" target="_new">LabelProviderFragment</a>
						</td>
						<td>Label provider</td>
					
</tr>
<tr>
						
<td>
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/ui/generator/outline/OutlineNodeAdapterFactoryFragment.java?root=Modeling_Project&view=co" target="_new">OutlineNodeAdapterFactoryFragment</a>
						</td>
						<td>Outline view configuration</td>
					
</tr>
<tr>
						
<td>
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/ui/generator/outline/TransformerFragment.java?root=Modeling_Project&view=co" target="_new">TransformerFragment</a>
						</td>
						<td>Outline view configuration</td>
					
</tr>
<tr>
						
<td>
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/ui/generator/contentAssist/JavaBasedContentAssistFragment.java?root=Modeling_Project&view=co" target="_new">JavaBasedContentAssistFragment</a>
						</td>
						<td>Java-based content assist</td>
					
</tr>
<tr>
						
<td>XtextAntlrUiGeneratorFragment</td>
						<td>Content assist helper based on ANTLR</td>
					
</tr>
<tr>
						
<td>
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/ui/generator/projectWizard/SimpleProjectWizardFragment.java?root=Modeling_Project&view=co" target="_new">SimpleProjectWizardFragment</a>
						</td>
						<td>New project wizard</td>
					
</tr>
</table>
<p>
					
<span class="italic">
						<span class="bold"><strong>Important</strong></span> Due to
					</span> 
					<a class="link" href="#antlr_ip_issue" title="Chapter&nbsp;7.&nbsp;The ANTLR IP issue (or which parser to use?)">IP-Problems</a> 
					<span class="italic">with the code generator shipped with ANTLR 3 we&rsquo;re not allowed to ship this fragment at Eclipse. Therefore you&rsquo;ll have to download it separately from http://download.itemis.com or use the update site at 
						<span class="bold"><strong>http://download.itemis.com/updates/</strong></span>.
					</span>
				
</p>
</div>
</div>
<div class="section" title="Dependency Injection in Xtext with Google Guice">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="dependencyInjection"></a>Dependency Injection in Xtext with Google Guice</h2>
</div>
</div>
</div>
<p>In Xtext, there are many Java classes which implement logic, behavior, or supply configuration. These classes implement Java interfaces and are typically only supposed to be accessed through these interfaces, which makes their implementations interchangeable. This is where Xtext utilizes 
				<a class="ulink" href="http://code.google.com/p/google-guice/" target="_new">Google Guice</a>: 
			</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>Guice manages the instantiation of the classes: instead of constructing a class with 
						<code class="code">new</code>, the <code class="code">@Inject</code> annotation instructs Guice to supply an object for a certain interface. Such an object is called 
						<a class="link" href="#guiceservice" title="Services">Service</a>.
					</p>
</li>
<li class="listitem">
<p>Guice allows to configure which implementations are to be supplied for which interface. This configuration consists of so-called 
						<a class="link" href="#guicemodules" title="Modules">modules</a>.
					</p>
</li>
</ul>
</div>
<div class="section" title="Services">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="guiceservice"></a>Services</h3>
</div>
</div>
</div>
<p>The most parts of Xtext are implemented as 
					<span class="emphasis"><em>services</em></span>. A service is an object which implements a certain interface and which is instantiated and provided by Guice. Nearly every concept of the Xtext framework can be understood as this sort of 
					<span class="emphasis"><em>service</em></span>: The 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui.core/src/org/eclipse/xtext/ui/core/editor/XtextEditor.java?root=Modeling_Project&view=co" target="_new">XtextEditor</a>, the 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/resource/XtextResource.java?root=Modeling_Project&view=co" target="_new">XtextResource</a>, the 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/parser/IParser.java?root=Modeling_Project&view=co" target="_new">IParser</a> and even fine grained concepts as the 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui.core/src/org/eclipse/xtext/ui/core/editor/contentassist/PrefixMatcher.java?root=Modeling_Project&view=co" target="_new">PrefixMatcher</a> for the content assist are configured and provided by Guice.
				</p>
<p>Xtext ships with generic default implementations for most or the services or uses 
					<a class="link" href="#generator" title="The Generator">generator fragments</a> to automatically generate service implementations for a grammar. Thereby, Xtext strives to provide meaningful implementations out of the box and to allow customization wherever needed. Developers are encouraged to subclass existing services and configure them for their languages in their 
					<a class="link" href="#guicemodules" title="Modules">modules</a>.  
				</p>
<p>When Guice instantiates an object, it also supplies this instance with all its dependent services. All a service does is to request &ldquo;some implementation for a certain interface&rdquo; using the <code class="code">@Inject</code>-annotation. Based on the 
					<a class="link" href="#guicemodules" title="Modules">modules configuration</a> Guice decides which class to instantiate or which object to reuse. 
				</p>
<p>For example, Guice can automatically initialize member variables with the needed services. </p>
<div class="literallayout">
<p>
<code class="code">
<br>
public&nbsp;class&nbsp;MyLanguageLinker&nbsp;extends&nbsp;Linker&nbsp;{<br>

<br>
&nbsp;&nbsp;@Inject<br>
&nbsp;&nbsp;private&nbsp;IScopeProvider&nbsp;scopeProvider;<br>

<br>
&nbsp;&nbsp;@Inject(optional=true)<br>
&nbsp;&nbsp;private&nbsp;IXtext2EcorePostProcessor&nbsp;postProcessor;<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;(...)<br>
}<br>

<br>

</code>
</p>
</div>
<p>Furthermore, Guice can pass the needed services as method parameters or event into a constructor call.</p>
<div class="literallayout">
<p>
<code class="code">
<br>
public&nbsp;class&nbsp;MyLanguageGrammarAccess&nbsp;implements&nbsp;IGrammarAccess&nbsp;{<br>
	
<br>
&nbsp;&nbsp;private&nbsp;final&nbsp;GrammarProvider&nbsp;grammarProvider;<br>

<br>
&nbsp;&nbsp;private&nbsp;TerminalsGrammarAccess&nbsp;gaTerminals;<br>

<br>
&nbsp;&nbsp;@Inject<br>
&nbsp;&nbsp;public&nbsp;MyLanguageGrammarAccess(GrammarProvider&nbsp;grammarProvider,<br>
&nbsp;&nbsp;&nbsp;&nbsp;TerminalsGrammarAccess&nbsp;gaTerminals)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;this.grammarProvider&nbsp;=&nbsp;grammarProvider;<br>
&nbsp;&nbsp;&nbsp;&nbsp;this.gaTerminals&nbsp;=&nbsp;gaTerminals;<br>
&nbsp;&nbsp;}<br>
	
<br>
&nbsp;&nbsp;(...)<br>
}<br>

<br>

</code>
</p>
</div>
<p>For further details, please refer to the 
					<a class="ulink" href="http://code.google.com/docreader/#p=google-guice&s=google-guice&t=UsersGuide" target="_new">Google Guice Documentation</a>
				
</p>
</div>
<div class="section" title="Modules">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="guicemodules"></a>Modules</h3>
</div>
</div>
</div>
<p>The configuration of services for a language built with  Xtext is done via modules:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>Modules bind arbitrary Java interfaces to their implementation classes or directly to instances of their implementation classes. Such a binding is sort of a configurable mapping.</p>
</li>
<li class="listitem">
<p>A module itself is a plain Java class.</p>
</li>
<li class="listitem">
<p>Modules can inherit from each other and override bindings that are declared in super-modules. This concept is put on top of plain Guice modules by Xtext.</p>
</li>
<li class="listitem">
<p>In Xtext, there is a 
							<a class="link" href="#guicedefaultmodule" title="Default Module">generic default module</a> for all languages, there are automatically 
							<a class="link" href="#guicegeneratedmodule" title="Generated Modules">generated modules</a> and there are modules which are 
							<a class="link" href="#guicemanualmodules" title="Modules intended for customization">intended to be customized manually</a>.  
						</p>
</li>
<li class="listitem">
<p>Furthermore, Xtext distinguishes between modules for runtime-services and modules related to services needed for the user interface. The UI module extends the runtime module.</p>
</li>
</ul>
</div>
<p>In total, this leads to five modules for a typical Xtext Language. They are visualized in the image below. The image is further explained in the following subsections. </p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/modules_hierarchy.png"></div>
<p>
				
</p>
<div class="section" title="Modules intended for customization">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="guicemanualmodules"></a>Modules intended for customization</h4>
</div>
</div>
</div>
<p>When the 
						<a class="link" href="#generator" title="The Generator">generator</a> runs the first time, it creates two modules named 
						<code class="code">&lt;MyLanguage&gt;RuntimeModule</code> and 
						<code class="code">&lt;MyLanguage&gt;UIModule</code>. They are placed in the language&rsquo;s root-package in the 
						<code class="code">src/</code>-folder of the language&rsquo;s runtime-project and the language&rsquo;s UI-project. Both are initially empty and will never be overwritten by the generator. They are 
						<a class="link" href="#guicecustomize" title="Changing Configuration">intended for customization</a>. By default, they extend a 
						<a class="link" href="#guicegeneratedmodule" title="Generated Modules">generated module</a>.  
					</p>
</div>
<div class="section" title="Generated Modules">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="guicegeneratedmodule"></a>Generated Modules</h4>
</div>
</div>
</div>
<p>The fully generated modules are called 
						<code class="code">Abstract&lt;MyLanguage&gt;RuntimeModule</code> and 
						<code class="code">Abstract&lt;MyLanguage&gt;UiModule</code> respectively. They contain all components which have been generated specifically for the language at hand. What goes into these modules depends on the fragments you use in the generator.
					</p>
<p>
						
<span class="bold"><strong>Note</strong></span>: 
						<span class="emphasis"><em>This modules are replaced on every subsequent execution of the generator. Don&rsquo;t put any custom code into them. Manually written code has go into the 
							<a class="link" href="#guicemanualmodules" title="Modules intended for customization">concrete subclasses</a>.
						</em></span>
					
</p>
</div>
<div class="section" title="Default Module">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="guicedefaultmodule"></a>Default Module</h4>
</div>
</div>
</div>
<p>Finally the fully generated modules extend the 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/service/DefaultRuntimeModule.java?root=Modeling_Project&view=co" target="_new">DefaultRuntimeModule</a>, which contains all the default configuration. The default configuration consists of all components for which we have generic default implementations.
					</p>
</div>
<div class="section" title="Changing Configuration">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="guicecustomize"></a>Changing Configuration</h4>
</div>
</div>
</div>
<p>We use the primary modules (
						<code class="code">&lt;MyLanguage&gt;RuntimeModule</code> and 
						<code class="code">&lt;MyLanguage&gt;UiModule</code>) in order to change the configuration. 
						These classes are initially empty and have been generated to allow customization.
					</p>
<p>In order to provide a simple and convenient way, the default module extends the 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/service/AbstractGenericModule.java?root=Modeling_Project&view=co" target="_new">AbstractGenericModule</a>. 
						It does not provide any bindings itself but comes up with a convenient and declarative way to specify mappings. The default API provided by Guice is based on fluent API and a builder pattern.
						This is also very readable but does not allow submodules to change any of the bindings.   
						The 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/service/AbstractGenericModule.java?root=Modeling_Project&view=co" target="_new">AbstractGenericModule</a> allows to declare and override bindings in all subclasses like this:
					</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;Class&lt;?&nbsp;extends&nbsp;IFooService&gt;&nbsp;bindIFooService()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;MyFooServiceImpl.class;<br>
}<br>

<br>

</code>
</p>
</div>
<p>Such a method will be interpreted as a binding from 
						<code class="code">IFooService</code> to 
						<code class="code">MyFooServiceImpl.class</code>. Note that you simply have to override a method from a super class (e.g. from the generated or default module) in order to change the respective binding. For example, in the picture above, the 
						<code class="code">DefaultRuntimeModule</code> configures the 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/formatting/IFormatter.java?root=Modeling_Project&view=co" target="_new">IFormatter</a> to be implemented by the 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/formatting/impl/OneWhitespaceFormatter.java?root=Modeling_Project&view=co" target="_new">OneWhitespaceFormatter</a>. The 
						<code class="code">AbstractMyLanguageModule</code> overrides this binding by mapping the 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/formatting/IFormatter.java?root=Modeling_Project&view=co" target="_new">IFormatter</a> to 
						<code class="code">MyLanguageFormatter</code>.
						The type to type binding will create a new instance of the given target type for each dependency. If you want to make it a singleton and thereby ensure only one instance to be created and reused for all dependencies you can add the following annotation:
					</p>
<div class="literallayout">
<p>
<code class="code">@SingletonBinding<br>
public&nbsp;Class&lt;?&nbsp;extends&nbsp;IFooService&gt;&nbsp;bindIFooService()&nbsp;{<br>
&nbsp;&nbsp;return&nbsp;MyFooServiceImpl.class;<br>
}<br>

<br>

</code>
</p>
</div>
<p>In addition if the creation of the type causes any necessary side effects, so you want it to be instantiated eagerly, you can set the 
						<code class="code">eager</code> property to true. This is shown in the following snippet:
					</p>
<div class="literallayout">
<p>
<code class="code">@SingletonBinding(eager=true)<br>
public&nbsp;Class&lt;?&nbsp;extends&nbsp;IFooService&gt;&nbsp;bindIFooService()&nbsp;{<br>
&nbsp;&nbsp;return&nbsp;MyFooServiceImpl.class;<br>
}<br>

<br>

</code>
</p>
</div>
<p>One more way of specify a binding is currently supported: If you need to control the way, the instance is created, you can declare a type to object mapping:</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;IFooService&nbsp;bindIFooService()&nbsp;{<br>
&nbsp;&nbsp;return&nbsp;new&nbsp;MyFooServiceImpl();<br>
}<br>

<br>

</code>
</p>
</div>
<p>
						
<span class="italic">Note that, although this is a convenient and simple way, you have of course also the full power of Guice, i.e. you can override the Guice method 
							<code class="code">void configure(Binder)</code> and use the afore mentioned fluent API to do whatever you want.
						</span>
					
</p>
</div>
</div>
</div>
</div>
<div class="chapter" title="Chapter&nbsp;4.&nbsp;Runtime Concepts">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="RuntimeConcepts"></a>Chapter&nbsp;4.&nbsp;Runtime Concepts</h2>
</div>
</div>
</div>
<p>TMF Xtext itself and every language infrastructure developed with Xtext is configured and wired-up using 
			<a class="link" href="#dependencyInjection" title="Dependency Injection in Xtext with Google Guice">dependency injection</a>. Xtext may be used in different environments which introduce different constraints. Especially important is the difference between OSGi managed containers and plain vanilla Java programs. To honor these differences Xtext uses the concept of 
			<code class="code">ISetup</code>-implementations in normal mode and uses Eclipse&rsquo;s extension mechanism when it should be configured in an OSGi environment.   
		</p>
<div class="section" title="Runtime setup (ISetup)">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="RuntimesetupISetup"></a>Runtime setup (ISetup)</h2>
</div>
</div>
</div>
<p>For each language there is an implementation of 
				<code class="code">ISetup</code> generated. It implements a method called 
				<code class="code">doSetup()</code>, which can be called to do the initialization of the language infrastructure. This class is intended to be used for runtime and unit testing, only.
			</p>
<p>The setup method returns an 
				<code class="code">Injector</code>, which can further be used to obtain a parser, etc. It also registers the ResourceFactory and generated EPackages at the respective global registries provided by EMF. So basically you can just run the setup and start using EMF API to load and store models of your language.
			</p>
</div>
<div class="section" title="Setup within Eclipse-Equinox (OSGi)">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="SetupwithinEclipseEquinoxOSGi"></a>Setup within Eclipse-Equinox (OSGi)</h2>
</div>
</div>
</div>
<p>Within Eclipse we have a generated 
				<code class="code">Activator</code>, which creates a Guice injector using the 
				<a class="ulink" href="guicemodules" target="_new">modules</a>.
				In addition an 
				<code class="code">IExecutableExtensionFactory</code> is generated for each language, which is used to create 
				<code class="code">ExecutableExtensions</code>.
				This means that everything which is created via extension points is managed by Guice as well, i.e. you can declare dependencies and get them injected upon creation. 
			</p>
<p>The only thing you have to do in order to use this factory is to prefix the class with the factory 
				<code class="code">&lt;MyLanguageName&gt;ExecutableExtensionFactory</code> name followed by a colon.
			</p>
<div class="literallayout">
<p>
<code class="code">&lt;extension<br>
&nbsp;&nbsp;point="org.eclipse.ui.editors"&gt;<br>
&nbsp;&nbsp;&lt;editor<br>
&nbsp;&nbsp;&nbsp;&nbsp;class="&lt;MyLanguageName&gt;ExecutableExtensionFactory:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;org.eclipse.xtext.ui.core.editor.XtextEditor"<br>
&nbsp;&nbsp;&nbsp;&nbsp;contributorClass=<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"org.eclipse.ui.editors.text.TextEditorActionContributor"<br>
&nbsp;&nbsp;&nbsp;&nbsp;default="true"<br>
&nbsp;&nbsp;&nbsp;&nbsp;extensions="ecoredsl"<br>
&nbsp;&nbsp;&nbsp;&nbsp;id="org.eclipse.xtext.example.EcoreDsl"<br>
&nbsp;&nbsp;&nbsp;&nbsp;name="EcoreDsl&nbsp;Editor"&gt;<br>
&nbsp;&nbsp;&lt;/editor&gt;<br>
&lt;/extension&gt;<br>

<br>

</code>
</p>
</div>
</div>
<div class="section" title="Validation">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="validation"></a>Validation</h2>
</div>
</div>
</div>
<p>Static analysis or validation is one of the most interesting aspects when developing a programming language. The users of your languages will be grateful
				if they get informative feedback as they type. 
				In Xtext there are basically three different kinds of validation.</p>
<div class="section" title="Syntactical Validation">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="syntactical_validation"></a>Syntactical Validation</h3>
</div>
</div>
</div>
<p>The syntactical correctness of any textual input is validated automatically by the parser. The error messages are generated by the underlying parser technology and cannot be customized using a general hook.
					Any syntax errors can be retrieved from the Resource using the common EMF API:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>
							
<code class="code">org.eclipse.emf.ecore.resource.Resource.getErrors()</code>
						
</p>
</li>
<li class="listitem">
<p>
							
<code class="code">org.eclipse.emf.ecore.resource.Resource.getWarnings()</code>
						
</p>
</li>
</ul>
</div>
</div>
<div class="section" title="Crosslink Validation">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="linking_validation"></a>Crosslink Validation</h3>
</div>
</div>
</div>
<p>Any broken crosslinks can be checked generically. As crosslink resolution is done lazily (see 
					<a class="link" href="#linking" title="Linking">linking</a>), any broken links are resolved lazily as well.
					If you want to validate whether all links are valid, you will have to navigate through the model so that all installed EMF proxies get resolved. This is done automatically in the editor.
				</p>
<p>Any unresolvable crosslinks will be reported and can be obtained through:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>
							
<code class="code">org.eclipse.emf.ecore.resource.Resource.getErrors()</code>
						
</p>
</li>
<li class="listitem">
<p>
							
<code class="code">org.eclipse.emf.ecore.resource.Resource.getWarnings()</code>
						
</p>
</li>
</ul>
</div>
</div>
<div class="section" title="Custom Validation">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="custom_validation"></a>Custom Validation</h3>
</div>
</div>
</div>
<p>In addition to the afore mentioned kinds of validation, which are more or less done automatically, you can specify additional constraints specific for your Ecore model.
					We leverage existing EMF API (mainly 
					<code class="code">EValidator</code>) and have put some convenience stuff on top. 
					Basically all you need to do is to make sure that an 
					<code class="code">EValidator</code> is registered for your 
					<code class="code">EPackage</code>. The registry for 
					<code class="code">EValidators</code> (
					<code class="code">EValidator.Registry.INSTANCE</code>) can only be filled programmatically.
					That means contrary to the EPackage and 
					<code class="code">Resource.Factory</code> registries there is no Equinox extension point to populate the validator registry.
				</p>
<p>For Xtext we provide a 
					<a class="link" href="#generator_fragment" title="Generator Fragments">generator fragment</a> for the convenient Java-based 
					<code class="code">EValidator</code> API. Just add the following fragment to your generator configuration and you are good to go:
				</p>
<div class="literallayout">
<p>
<code class="code">&lt;fragment&nbsp;class=<br>
&nbsp;&nbsp;"org.eclipse.xtext.generator.validation.JavaValidatorFragment"/&gt;<br>

<br>

</code>
</p>
</div>
<p>The generator will provide you with two Java classes. An abstract class generated to 
					<code class="code">src-gen/</code> which extends the library class 
					<code class="code">AbstractDeclarativeValidator</code>. This one just registers the EPackages for which this validator introduces constraints.
					The other class is a subclass of that abstract class and is generated to the 
					<code class="code">src/</code> folder in order to be edited by you. That&rsquo;s where you put the constraints in.
				</p>
<p>The purpose of the 
					<code class="code">AbstractDeclarativeValidator</code> is to allow you to write constraints in a declarative way &ndash; as the class name already suggests. That is instead of writing exhaustive if-else constructs or extending the generated EMF switch you just have to add the <code class="code">@Check</code> annotation to any method and it will be invoked automatically when validation takes place.
					Moreover you can state for what type the respective constraint method is, just by declaring a typed parameter. This also lets you avoid any type casts.  
					In addition to the reflective invocation of validation methods the 
					<code class="code">AbstractDeclarativeValidator</code> provides a couple of convenient assertions.
				</p>
<p>All in all this is very similar to how JUnit works. Here is an example:</p>
<div class="literallayout">
<p>
<code class="code">
<br>
public&nbsp;class&nbsp;DomainmodelJavaValidator&nbsp;<br>
&nbsp;&nbsp;extends&nbsp;AbstractDomainmodelJavaValidator&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;@Check<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;checkTypeNameStartsWithCapital(Type&nbsp;type)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!Character.isUpperCase(type.getName().charAt(0)))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;warning("Name&nbsp;should&nbsp;start&nbsp;with&nbsp;a&nbsp;capital",&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;	DomainmodelPackage.TYPE__NAME);<br>
&nbsp;&nbsp;}<br>
}<br>

<br>

</code>
</p>
</div>
</div>
<div class="section" title="Validation with the Check language">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="check_based_validation"></a>Validation with the Check language</h3>
</div>
</div>
</div>
<p>In addition to the Java-based validation code you can use the language Check (from M2T/Xpand) to implement constraint checks against your model. To do so, you have to configure the 
					<a class="link" href="#generator" title="The Generator">generator</a> with the

					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/validation/CheckFragment.java?root=Modeling_Project&view=co" target="_new">CheckFragment</a>.
					Please note, that you can combine both types of validation in your project. 
				</p>
<div class="literallayout">
<p>
<code class="code">&lt;fragment&nbsp;class=<br>
&nbsp;&nbsp;"org.eclipse.xtext.generator.validation.CheckFragment"/&gt;<br>
&nbsp;&nbsp;<br>

</code>
</p>
</div>
<p>After regenerating your language artifacts you will find three new files &ldquo;YourLanguageChecks.chk&rdquo;, &ldquo;YourLanguageFastChecks.chk&rdquo; and &ldquo;YourLanguageExpensiveChecks.chk&rdquo; in the 
					<code class="code">src/</code> folder in the sub-package 
					<code class="code">validation</code>.  The checks in these files will be executed when saving a file, while typing (FastChecks) or when triggering the validation explicitly (ExpensiveChecks). When using Check the example of the previous chapter could be written like this.
				</p>
<div class="literallayout">
<p>
<code class="code">context&nbsp;Type#name&nbsp;WARNING&nbsp;"Name&nbsp;should&nbsp;start&nbsp;with&nbsp;a&nbsp;capital":<br>
&nbsp;&nbsp;name.toFirstUpper()&nbsp;==&nbsp;name;&nbsp;&nbsp;<br>

<br>

</code>
</p>
</div>
<p>Each check works in a specific context (here: 
					<code class="code">Type</code>) and can further denote a feature to which a warning or error should be attached to (here: 
					<code class="code">name</code>). Each check could either be a 
					<code class="code">WARNING</code> or an 
					<code class="code">ERROR</code> with a given string to explain the situation. The essential part of each check is an invariant that must hold true for the given context. If it fails the check will produce an issue with the provided explanation.
				</p>Please read more about the Check language as well as the underlying expression language in Xpand&rsquo;s reference documentation which is shipped as Eclipse help. 
			</div>
</div>
<div class="section" title="Linking">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="linking"></a>Linking</h2>
</div>
</div>
</div>
<p>The linking feature allows for specification of cross references within an Xtext grammar.
				The following things are needed for the linking:</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>declaration of a crosslink in the grammar (at least in the Ecore model)</p>
</li>
<li class="listitem">
<p>specification of linking semantics</p>
</li>
</ol>
</div>
<div class="section" title="Declaration of crosslinks">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Declarationofcrosslinks"></a>Declaration of crosslinks</h3>
</div>
</div>
</div>
<p>In the grammar a cross reference is specified using square brackets.</p>
<div class="literallayout">
<p>
<code class="code">CrossReference&nbsp;:<br>
&nbsp;&nbsp;'['&nbsp;ReferencedEClass&nbsp;('|'&nbsp;terminal=AbstractTerminal)?&nbsp;']'<br>
;<br>

<br>

</code>
</p>
</div>
<p>Example:</p>
<div class="literallayout">
<p>
<code class="code">ReferringType&nbsp;:<br>
&nbsp;&nbsp;'ref'&nbsp;referencedObject=[Entity|(ID|STRING)]<br>
;<br>

<br>

</code>
</p>
</div>
<p>The 
					<a class="link" href="#metamodelInference" title="Ecore model inference">Ecore model inference</a> would create an 
					<code class="code">EClass</code> &lsquo;ReferringType&rsquo; with an 
					<code class="code">EReference</code> &lsquo;referencedObject&rsquo; of type &lsquo;Entity&rsquo; (containment=false). The referenced object would be identified either by an ID or a STRING and the surrounding information in the current context (see 
					<a class="link" href="#scoping" title="Scoping">scoping</a>). 
				</p>
<p>Example: While parsing a given input string, say</p>
<div class="literallayout">
<p>
<code class="code">ref&nbsp;Entity01<br>

</code>
</p>
</div>
<p>Xtext produces an instance of &lsquo;ReferringType&rsquo;. After this parsing step it enters the linking phase and tries to find an instance of '&lsquo;Entity&rsquo;' using the parsed text &lsquo;Entity01&rsquo;. The input </p>
<div class="literallayout">
<p>
<code class="code">ref&nbsp;"EntityWith&#402;&divide;&lsaquo;"<br>

</code>
</p>
</div>
<p>would work analogously. This is not an ID (umlauts are not allowed), but a STRING (as it is apparent from the quotation marks).</p>
</div>
<div class="section" title="Specification of linking semantics">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Specificationoflinkingsemantics"></a>Specification of linking semantics</h3>
</div>
</div>
</div>
<p>The 
					<code class="code">ILinker</code> implementation that is used by default is the 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/linking/lazy/LazyLinker.java?root=Modeling_Project&view=co" target="_new">LazyLinker</a>. It installs 
					<code class="code">EObject</code> proxies for all crosslinks, which are then resolved on demand.
					The actual cross reference resolution is done by 
					<code class="code">LazyLinkingResource.getEObject(String)</code> and delegates to an implementation of the 
					<code class="code">ILinkingService</code>.
					Although the default linking behavior is appropriate in many cases there might be scenarios where this is not sufficient. For each grammar a custom linking service can be implemented and configured. It fulfills the following interface:
				</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;interface&nbsp;ILinkingService&nbsp;{<br>

<br>
&nbsp;&nbsp;/**<br>
&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;all&nbsp;{@link&nbsp;EObject}s&nbsp;referenced&nbsp;by&nbsp;the&nbsp;given&nbsp;link&nbsp;text&nbsp;in&nbsp;the<br>
&nbsp;&nbsp;&nbsp;*&nbsp;given&nbsp;context.&nbsp;But&nbsp;does&nbsp;not&nbsp;set&nbsp;the&nbsp;references&nbsp;or&nbsp;modifies&nbsp;the&nbsp;passed<br>
&nbsp;&nbsp;&nbsp;*&nbsp;information&nbsp;somehow<br>
&nbsp;&nbsp;&nbsp;*/<br>
&nbsp;&nbsp;List&lt;EObject&gt;&nbsp;getLinkedObjects(<br>
&nbsp;&nbsp;&nbsp;&nbsp;EObject&nbsp;context,&nbsp;EReference&nbsp;reference,&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;AbstractNode&nbsp;node)&nbsp;throws&nbsp;IllegalNodeException;<br>

<br>
&nbsp;&nbsp;/**<br>
&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;the&nbsp;textual&nbsp;representation&nbsp;of&nbsp;a&nbsp;given&nbsp;object&nbsp;as&nbsp;it&nbsp;would&nbsp;be<br>
&nbsp;&nbsp;&nbsp;*&nbsp;serialized&nbsp;in&nbsp;the&nbsp;given&nbsp;context.<br>
&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;the&nbsp;text&nbsp;representation.<br>
&nbsp;&nbsp;&nbsp;*/<br>
&nbsp;&nbsp;String&nbsp;getLinkText(EObject&nbsp;object,&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;EReference&nbsp;reference,&nbsp;EObject&nbsp;context);<br>
}<br>

<br>

</code>
</p>
</div>
<p>The method 
					<code class="code">getLinkedObjects</code> is directly related to this topic whereas 
					<code class="code">getLinkText</code> addresses complementary functionality: it is used for serialization.
				</p>
<p>A simple implementation of the linking service (the 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/linking/impl/DefaultLinkingService.java?root=Modeling_Project&view=co" target="_new">DefaultLinkingService</a>) is shipped with Xtext and used for any grammar per default. It uses the default implementation of 
					<code class="code">IScopeProvider</code> to compute the linking candidates.
				</p>
</div>
<div class="section" title="Default linking semantics">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Defaultlinkingsemantics"></a>Default linking semantics</h3>
</div>
</div>
</div>
<p>The default implementation for all languages looks within the current file for an EObject of the respective type. In the example above this would be an &ldquo;Entity&rdquo; which by convention has a 
					<code class="code">name</code> attribute set to &lsquo;Entity01&rsquo;. 
				</p>
<p>Given the grammar :</p>
<div class="literallayout">
<p>
<code class="code">Model&nbsp;:&nbsp;<br>
&nbsp;&nbsp;(stuff+=(Ref|Entity))*<br>
;<br>

<br>
Ref&nbsp;:&nbsp;<br>
&nbsp;&nbsp;'ref'&nbsp;referencedObject=[Entity|ID]&nbsp;';'<br>
;<br>

<br>
Entity&nbsp;:&nbsp;<br>
&nbsp;&nbsp;'entity'&nbsp;name=ID&nbsp;';'<br>
;<br>

<br>

</code>
</p>
</div>
<p>In the following model:</p>
<div class="literallayout">
<p>
<code class="code">ref&nbsp;Entity01;<br>
entity&nbsp;Entity01;<br>

<br>

</code>
</p>
</div>
<p>the 
					<code class="code">ref</code> would be linked to the declared entity (
					<code class="code">entity Entity01;</code>). Nearly any aspect is configurable, especially the name of the identifying attribute may be overridden for a particular type.
				</p>
<div class="section" title="Default Imports">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="defaultImports"></a>Default Imports</h4>
</div>
</div>
</div>
<p>There is a default implementation for inter-resource references, which as well uses convention.
						Each string in a model which is assigned to an EAttribute with the name 
						<code class="code">importURI</code>, will be interpreted as an URI and used to be loaded using the 
						<code class="code">ResourceSet</code> of the current resource.
					</p>
<p>For example, given the following grammar :</p>
<div class="literallayout">
<p>
<code class="code">Model&nbsp;:&nbsp;<br>
&nbsp;&nbsp;(imports+=Import)*<br>
&nbsp;&nbsp;(stuff+=(Ref|Entity))*<br>
;<br>

<br>
Import&nbsp;:<br>
&nbsp;&nbsp;'import'&nbsp;importURI=STRING&nbsp;';'<br>
;<br>

<br>
Ref&nbsp;:&nbsp;<br>
&nbsp;&nbsp;'ref'&nbsp;referencedObject=[Entity|ID]&nbsp;';'<br>
;<br>

<br>
Entity&nbsp;:&nbsp;<br>
&nbsp;&nbsp;'entity'&nbsp;name=ID&nbsp;';'<br>
;<br>

<br>

</code>
</p>
</div>
<p>It would be possible to write three files in that language where the first references the other two, like this:</p>
<div class="literallayout">
<p>
<code class="code">//file&nbsp;model.dsl<br>
import&nbsp;"model1.dsl";<br>
import&nbsp;"model2.dsl";<br>
&nbsp;<br>
ref&nbsp;Foo;<br>
entity&nbsp;Bar;<br>

<br>

</code>
</p>
</div>
<div class="literallayout">
<p>
<code class="code">//file&nbsp;model1.dsl&nbsp;<br>
entity&nbsp;Stuff;<br>

<br>

</code>
</p>
</div>
<div class="literallayout">
<p>
<code class="code">//file&nbsp;model2.dsl<br>
entity&nbsp;Foo;<br>

<br>

</code>
</p>
</div>
<p>The linking candidates for the reference 
						<code class="code">Foo</code> will be 
						<code class="code">Bar</code>, 
						<code class="code">Stuff</code> and 
						<code class="code">Foo</code> in that order. They will be computed by the 
						<a class="link" href="#scoping" title="Scoping">ScopeProvider</a>. 
					</p>
</div>
</div>
</div>
<div class="section" title="Scoping">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="scoping"></a>Scoping</h2>
</div>
</div>
</div>
<p>An 
				<code class="code">IScopeProvider</code> is responsible for providing an 
				<code class="code">IScope</code> for a given context 
				<code class="code">EObject</code> and 
				<code class="code">EReference</code> (declared or inherited by the object&rsquo;s 
				<code class="code">EClass</code>). The returned 
				<code class="code">IScope</code> should contain all target candidates for the given object and cross reference.
			</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;interface&nbsp;IScopeProvider&nbsp;{<br>

<br>
&nbsp;&nbsp;/**<br>
&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;a&nbsp;scope&nbsp;for&nbsp;the&nbsp;given&nbsp;context.&nbsp;The&nbsp;scope&nbsp;provides&nbsp;access&nbsp;to&nbsp;<br>
&nbsp;&nbsp;&nbsp;*&nbsp;the&nbsp;compatible&nbsp;visible&nbsp;EObjects&nbsp;for&nbsp;a&nbsp;given&nbsp;reference.<br>
&nbsp;&nbsp;&nbsp;*<br>
&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;context&nbsp;the&nbsp;element&nbsp;from&nbsp;which&nbsp;an&nbsp;element&nbsp;shall&nbsp;be&nbsp;referenced<br>
&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;reference&nbsp;the&nbsp;reference&nbsp;to&nbsp;be&nbsp;used&nbsp;to&nbsp;filter&nbsp;the&nbsp;elements.<br>
&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;{@link&nbsp;IScope}&nbsp;representing&nbsp;the&nbsp;inner&nbsp;most&nbsp;{@link&nbsp;IScope}&nbsp;for&nbsp;<br>
&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;passed&nbsp;context&nbsp;and&nbsp;reference.<br>
&nbsp;&nbsp;&nbsp;*/<br>
&nbsp;&nbsp;public&nbsp;IScope&nbsp;getScope(EObject&nbsp;context,&nbsp;EReference&nbsp;reference);<br>

<br>
&nbsp;&nbsp;/**<br>
&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;a&nbsp;scope&nbsp;for&nbsp;a&nbsp;given&nbsp;context.&nbsp;The&nbsp;scope&nbsp;contains&nbsp;any&nbsp;visible,&nbsp;<br>
&nbsp;&nbsp;&nbsp;*&nbsp;type-compatible&nbsp;element.<br>
&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;context&nbsp;the&nbsp;element&nbsp;from&nbsp;which&nbsp;an&nbsp;element&nbsp;shall&nbsp;be&nbsp;referenced<br>
&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;type&nbsp;the&nbsp;(super)type&nbsp;of&nbsp;the&nbsp;elements.<br>
&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;{@link&nbsp;IScope}&nbsp;representing&nbsp;the&nbsp;inner&nbsp;most&nbsp;{@link&nbsp;IScope}&nbsp;for<br>
&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;passed&nbsp;context&nbsp;and&nbsp;type.<br>
&nbsp;&nbsp;&nbsp;*/<br>
&nbsp;&nbsp;public&nbsp;IScope&nbsp;getScope(EObject&nbsp;context,&nbsp;EClass&nbsp;type);<br>
}<br>

<br>

</code>
</p>
</div>
<p>A single 
				<code class="code">IScope</code> represents an element of a linked list of scopes. That means that a scope can be nested within an outer scope.
				For instance Java has multiple kinds of scopes (object scope, type scope, etc.).
			</p>
<p>For Java one would create the scope hierarchy as commented in the following example:</p>
<div class="literallayout">
<p>
<code class="code">//&nbsp;file&nbsp;contents&nbsp;scope<br>
import&nbsp;static&nbsp;my.Constants.STATIC;<br>

<br>
public&nbsp;class&nbsp;ScopeExample&nbsp;{&nbsp;//&nbsp;class&nbsp;body&nbsp;scope<br>
&nbsp;&nbsp;private&nbsp;Object&nbsp;field&nbsp;=&nbsp;STATIC;<br>

<br>
&nbsp;&nbsp;private&nbsp;void&nbsp;method(String&nbsp;param)&nbsp;{&nbsp;//&nbsp;method&nbsp;body&nbsp;scope<br>
&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;localVar&nbsp;=&nbsp;"bar";<br>
&nbsp;&nbsp;&nbsp;&nbsp;innerBlock:&nbsp;{&nbsp;//&nbsp;block&nbsp;scope<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;innerScopeVar&nbsp;=&nbsp;"foo";<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Object&nbsp;field&nbsp;=&nbsp;innerScopeVar;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;the&nbsp;scope&nbsp;hierarchy&nbsp;at&nbsp;this&nbsp;point&nbsp;would&nbsp;look&nbsp;like&nbsp;this:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;blockScope{field,innerScopeVar}-&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;methodScope{localVar,&nbsp;param}-&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;classScope{field}-&gt;&nbsp;('field'&nbsp;is&nbsp;overlayed)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;fileScope{STATIC}-&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;classpathScope{'all&nbsp;qualified&nbsp;names&nbsp;of&nbsp;accessible&nbsp;static&nbsp;fields'}&nbsp;-&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;NULLSCOPE{}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;field.add(localVar);<br>
&nbsp;&nbsp;}<br>
}<br>

<br>

</code>
</p>
</div>
<p>In fact the class path scope should also reflect the order of class path entries.
				For instance:</p>
<div class="literallayout">
<p>
<code class="code">classpathScope{stuff&nbsp;from&nbsp;bin/}<br>
-&gt;&nbsp;classpathScope{stuff&nbsp;from&nbsp;foo.jar/}<br>
-&gt;&nbsp;...<br>
-&gt;&nbsp;classpathScope{stuff&nbsp;from&nbsp;JRE&nbsp;System&nbsp;Library}<br>
-&gt;&nbsp;NULLSCOPE{}<br>

<br>

</code>
</p>
</div>
<p>Please find the motivation behind this and some additional details in 
				<a class="ulink" href="http://blog.efftinge.de/2009/01/xtext-scopes-and-emf-index.html" target="_new">this blog post</a> .
			</p>
<p>The default implementation would produce this hierarchy of scopes for the model from the last example in the 
				<a class="link" href="#defaultImports" title="Default Imports">previous chapter</a>:
			</p>
<div class="literallayout">
<p>
<code class="code">//file&nbsp;model.dsl<br>
import&nbsp;"model1.dsl";<br>
import&nbsp;"model2.dsl";<br>
&nbsp;<br>
ref&nbsp;Foo;<br>
entity&nbsp;Bar;<br>

<br>

</code>
</p>
</div>
<div class="literallayout">
<p>
<code class="code">//file&nbsp;model1.dsl&nbsp;<br>
entity&nbsp;Stuff;<br>

<br>

</code>
</p>
</div>
<div class="literallayout">
<p>
<code class="code">//file&nbsp;model2.dsl<br>
entity&nbsp;Foo;<br>

<br>

</code>
</p>
</div>
<div class="literallayout">
<p>
<code class="code">Scope&nbsp;(model.dsl)&nbsp;{<br>
&nbsp;&nbsp;parent&nbsp;:&nbsp;Scope&nbsp;(model1.dsl)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;parent&nbsp;:&nbsp;Scope&nbsp;(model2.dsl)&nbsp;{}<br>
&nbsp;&nbsp;}<br>
}<br>

<br>

</code>
</p>
</div>
<p>When enumerating the scope&rsquo;s content, the first, most specialized scope would return 
				<code class="code">Bar</code>, its parent would provide 
				<code class="code">Stuff</code> and the outermost scope adds 
				<code class="code">Foo</code>. The linker will iterate the scope in that order and abort when it finds a matching 
				<code class="code">ScopedElement</code>. 
			</p>
<div class="section" title="Declarative Scope Provider">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="DeclarativeScopeProvider"></a>Declarative Scope Provider</h3>
</div>
</div>
</div>
<p>As always there is an implementation that allows to specify scoping in a declarative way (extend 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/scoping/impl/AbstractDeclarativeScopeProvider.java?root=Modeling_Project&view=co" target="_new">AbstractDeclarativeScopeProvider</a> for this purpose). It looks up methods which have either of the following two signatures:
				</p>
<div class="literallayout">
<p>
<code class="code">IScope&nbsp;scope_&lt;ContextReference&gt;(&lt;ContextType&gt;&nbsp;ctx,&nbsp;EReference&nbsp;ref)<br>

</code>
</p>
</div>
<div class="literallayout">
<p>
<code class="code">IScope&nbsp;scope_&lt;TypeToReturn&gt;(&lt;ContextType&gt;&nbsp;ctx,&nbsp;EClass&nbsp;type)<br>

</code>
</p>
</div>
<p>The former is used when evaluating the scope for a specific cross reference and here 
					<code class="code">&lt;ContextReference&gt;</code> corresponds to the name of this reference (prefixed with the name of the reference&rsquo;s declaring type and separated by an underscore). The 
					<code class="code">ref</code> parameter represents this cross reference.
				</p>
<p>The latter method signature is used when computing the scope for a given element type and is applicable to all cross references of that type. Here 
					<code class="code">&lt;TypeToReturn&gt;</code> is the name of that type which also corresponds to the 
					<code class="code">type</code> parameter. 
				</p>
<p>So if you for example have a state machine with a  
					<span class="emphasis"><em>Transition</em></span> object owned by its source 
					<span class="emphasis"><em>State</em></span> and you want to compute all reachable states (i.e. potential target states), the corresponding method could be declared as follows (assuming the cross reference is declared by the 
					<span class="emphasis"><em>Transition</em></span> type and is called 
					<span class="emphasis"><em>target</em></span>):
				</p>
<div class="literallayout">
<p>
<code class="code">IScope&nbsp;scope_Transition_target(Transition&nbsp;this,&nbsp;EReference&nbsp;ref)<br>

</code>
</p>
</div>
<p>If such a method does not exist, the implementation will try to find one for the context object&rsquo;s container. Thus in the example this would match a method with the same name but 
					<span class="emphasis"><em>State</em></span> as the type of the first parameter. It will keep on walking the containment hierarchy until a matching method is found. This container delegation allows to reuse the same scope definition for elements in different places of the containment hierarchy. Also it may make the method easier to implement as the elements comprising the scope are quite often owned or referenced by a container of the context object. In the example the 
					<span class="emphasis"><em>State</em></span> objects could for instance be owned by a containing 
					<span class="emphasis"><em>StateMachine</em></span> object.
				</p>
<p>If no method specific to the cross reference in question was found for any of the objects in the containment hierarchy, the implementation will start looking for methods matching the other signature (with the 
					<span class="emphasis"><em>EClass</em></span> parameter). Again it will first attempt to match the context object. Thus in the example the signature first matched would be:
				</p>
<div class="literallayout">
<p>
<code class="code">IScope&nbsp;scope_State(Transition&nbsp;this,&nbsp;EClass&nbsp;type)<br>

</code>
</p>
</div>
<p>If no such method exists, the implementation will again try to find a method matching the context object&rsquo;s container objects. In the case of the state machine example you might want to declare the scope with available states at the state machine level:</p>
<div class="literallayout">
<p>
<code class="code">IScope&nbsp;scope_State(StateMachine&nbsp;this,&nbsp;EClass&nbsp;type)<br>

</code>
</p>
</div>
<p>This scope can now be used for any cross references of type 
					<span class="emphasis"><em>State</em></span> for context objects owned by the state machine.
				</p>
</div>
</div>
<div class="section" title="Value Converter">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="valueconverter"></a>Value Converter</h2>
</div>
</div>
</div>
<p>Value converters are registered to convert the parsed text into a certain data type instance and vice versa.
				The primary hook is called 
				<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/conversion/IValueConverterService.java?root=Modeling_Project&view=co" target="_new">IValueConverterService</a> and the concrete implementation can be registered via the runtime &ldquo;Guice module&rdquo;#guicecustomize.
				To do so override the corresponding binding in your runtime module like shown in this example:
			</p>
<div class="literallayout">
<p>
<code class="code">@Override<br>
public&nbsp;Class&lt;?&nbsp;extends&nbsp;IValueConverterService&gt;&nbsp;bindIValueConverterService()&nbsp;{<br>
&nbsp;&nbsp;return&nbsp;MySpecialValueConverterService.class;<br>
}<br>

<br>

</code>
</p>
</div>
<div class="section" title="Annotation based value converters">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Annotationbasedvalueconverters"></a>Annotation based value converters</h3>
</div>
</div>
</div>
<p>The most simple way to register additional value converters is to make use of 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/conversion/impl/AbstractAnnotationBasedValueConverterService.java?root=Modeling_Project&view=co" target="_new">AbstractAnnotationBasedValueConverterService</a>, which allows to
					declaratively register an 
					<code class="code">IValueConverter</code> via an annotated method. 
				</p>
<p>The implementation for the default token grammar looks like </p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;DefaultTerminalConverters&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;extends&nbsp;AbstractAnnotationBasedValueConverterService&nbsp;{<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;(..)<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;@ValueConverter(rule&nbsp;=&nbsp;"ID")<br>
&nbsp;&nbsp;public&nbsp;IValueConverter&lt;String&gt;&nbsp;ID()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;AbstractNullSafeConverter&lt;String&gt;()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;String&nbsp;internalToValue(String&nbsp;string,&nbsp;AbstractNode&nbsp;node)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;string.startsWith("^")&nbsp;?&nbsp;string.substring(1)&nbsp;:&nbsp;string;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;String&nbsp;internalToString(String&nbsp;value)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(GrammarUtil.getAllKeywords(getGrammar()).contains(value))&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;"^"+value;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;value;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;};<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;...&nbsp;&nbsp;some&nbsp;other&nbsp;value&nbsp;converter<br>
}<br>

<br>

</code>
</p>
</div>
<p>If you use the common terminals grammar 
					<code class="code">org.eclipse.xtext.common.Terminals</code> you should subclass 
					<code class="code">DefaultTerminalConverters</code> and override or add additional value converters by adding the respective methods.
				</p>
<p>Imagine, you would want to add a rule BIG_DECIMAL creating BigDecimals, it would look like this one:</p>
<div class="literallayout">
<p>
<code class="code">@ValueConverter(rule&nbsp;=&nbsp;"BIG_DECIMAL")<br>
public&nbsp;IValueConverter&lt;BigDecimal&gt;&nbsp;BIG_DECIMAL()&nbsp;{<br>
&nbsp;&nbsp;return&nbsp;new&nbsp;AbstractToStringConverter&lt;BigDecimal&gt;()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;BigDecimal&nbsp;internalToValue(String&nbsp;string,&nbsp;AbstractNode&nbsp;node)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;BigDecimal.valueOf(string);<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;};<br>
}<br>

<br>

</code>
</p>
</div>
</div>
</div>
<div class="section" title="Serialization">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="serialization"></a>Serialization</h2>
</div>
</div>
</div>
<p>Serialization is the process of transforming an EMF model into its textual representation. Thereby, serialization complements parsing and lexing.</p>
<p>In Xtext, the process of serialization is split into three steps:</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>Matching the model elements with the grammar rules and creating a stream of tokens. This is done by the 
						<a class="link" href="#parsetreeconstructor" title="Parse Tree Constructor">parse tree constructor</a>.
					</p>
</li>
<li class="listitem">
<p>Mixing existing hidden tokens (whitespace, comments, etc.) into the token stream. This is done by the 
						<a class="link" href="#hiddentokenmerger" title="Hidden Token Merger">hidden token merger</a>.
					</p>
</li>
<li class="listitem">
<p>Adding needed whitespace or replacing all whitespace using a 
						<a class="link" href="#formatting" title="Formatting (Pretty Printing)">formatter</a>.  
					</p>
</li>
</ol>
</div>
<p>Serialization is invoked when calling 
				<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/resource/XtextResource.java?root=Modeling_Project&view=co" target="_new">XtextResource</a>
				<code class="code">.save(...)</code>. Furthermore, 
				<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/parsetree/reconstr/SerializerUtil.java?root=Modeling_Project&view=co" target="_new">SerializerUtil</a> provides resource-independent support for serialization.
			</p>
<div class="section" title="The Contract">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="serializationcontract"></a>The Contract</h3>
</div>
</div>
</div>
<p>The contract of serialization says that a model that is serialized to its textual representation and then loaded (parsed) again should yield a loaded model that equals the original model. Please be aware that this does 
					<span class="emphasis"><em>not</em></span> imply, that loading a textual representation and serializing it back produces identical textual representations. For example, this is the case when a default value is used in a textual representation and the assignment is optional. Another example is:
				</p>
<div class="literallayout">
<p>
<code class="code">MyRule:<br>
&nbsp;&nbsp;(xval+=ID&nbsp;|&nbsp;yval+=INT)*;<br>
&nbsp;&nbsp;<br>

</code>
</p>
</div>
<p>
					
<code class="code">MyRule</code> in this example reads 
					<code class="code">ID</code>- and 
					<code class="code">INT</code>-elements which may occur in an arbitrary order in the textual representation. However, when serializing the model all 
					<code class="code">ID</code>-elements will be written first and then all 
					<code class="code">INT</code>-elements. If the order is important it can be preserved by storing all elements in the same list &ndash; which may require wrapping the 
					<code class="code">ID</code>- and 
					<code class="code">INT</code>-elements into objects.   
				</p>
</div>
<div class="section" title="Parse Tree Constructor">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="parsetreeconstructor"></a>Parse Tree Constructor</h3>
</div>
</div>
</div>
<p>The parse tree constructor usually does not need to be customized since it is automatically derived from the 
					<a class="link" href="#grammarLanguage" title="Chapter&nbsp;2.&nbsp;The Grammar Language">Xtext Grammar</a>. However, it can be a good idea to look into it to understand its error messages and its runtime performance.
				</p>
<p>For serialization to succeed, the parse tree constructor must be able to 
					<span class="emphasis"><em>consume</em></span> every element of the to-be-serialized EMF model. To 
					<span class="emphasis"><em>consume</em></span> means, in this context, to write the element to the textual representation of the model. This can turn out to be a not-so-easy to fulfill requirement, since a grammar usually introduces implicit constraints to the EMF model. Example:
				</p>
<div class="literallayout">
<p>
<code class="code">MyRule:<br>
&nbsp;&nbsp;(sval+=ID&nbsp;ival+=INT)*;<br>
	
<br>

</code>
</p>
</div>
<p>This example introduces the constraint  
					<code class="code">sval.size() == ival.size()</code>. Models which violate this constraint are sort of valid EMF models, but they can not be serialized. To check whether a model complies with all constraints introduced by the grammar, the only way is currently to invoke the parse tree constructor. If this changes at some day, there will be news in 
					<a class="ulink" href="https://bugs.eclipse.org/bugs/show_bug.cgi?id=239565" target="_new">bugzilla 239565</a>.
				</p>
<p>For the parse tree constructor, this can lead to the scenarios, where</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>a model element can not be consumed. This can have the following reasons/solutions:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="circle">
<li class="listitem">
<p>The model element should not be stored in the model.</p>
</li>
<li class="listitem">
<p>The grammar needs an assignment which would consume the model element.</p>
</li>
<li class="listitem">
<p>The 
									<a class="link" href="#transientvalues" title="Transient Values">transient value service</a> could be used to indicate that this model element should not be consumed. 
								</p>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>an assignment in the grammar has no corresponding model element. The parse tree constructor considers a model element not to be present if it is 
							<span class="emphasis"><em>unset</em></span> or equals its default value. However, the parse tree constructor may serialize default values if this is required by a grammar constraint to be able to serialize another model element. The following solution may help to solve such a scenario:
						</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="circle">
<li class="listitem">
<p>A model element should be added to the model.</p>
</li>
<li class="listitem">
<p>The assignment in the grammar should be made optional.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p>To understand error messages and performance issues of the parse tree constructor it is important to know that it implements a backtracking algorithm. This basically means that the grammar is used to specify the structure of a tree in which one path (from the root node to a leaf node) is a valid serialization of a specific model. The parse tree constructor&rsquo;s task is to find this path &ndash; with the condition, that all model elements are consumed while walking this path. The parse tree constructor&rsquo;s strategy is to take the most promising branch first (the one that would consume the most model elements). If the branch leads to a dead end (for example, if a model element needs to be consumed that is not present in the model), the parse tree constructor goes back the path until a different branch can be taken. This behavior has two consequences:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>In case of an error, the parse tree constructor has found only dead ends but no leaf. It cannot tell which dead end is actually erroneous. Therefore, the error message lists dead ends of the longest paths, a fragment of their serialization and the reason why the path could not be continued at this point. The developer has to judge on his own which reason is the actual error.</p>
</li>
<li class="listitem">
<p> For reasons of performance, it is critical that the parse tree constructor takes the most promising branch first and detects wrong branches early. One way to achieve this is to avoid having many rules which return the same type and which are called from within the same alternative in the grammar.   </p>
</li>
</ul>
</div>
</div>
<div class="section" title="Transient Values">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="transientvalues"></a>Transient Values</h3>
</div>
</div>
</div>
<p>Transient values are values or model elements which are not persisted (written to the textual representation in the serialization phase). If a model contains model elements which can not be serialized with the current grammar, it is critical to mark them transient using the 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/parsetree/reconstr/ITransientValueService.java?root=Modeling_Project&view=co" target="_new">ITransientValueService</a>, or serialization will fail. The default implementation marks all model elements transient, that are 
					<span class="emphasis"><em>unset</em></span> or equal to their default value.  
				</p>
</div>
<div class="section" title="Unassigned Text">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="unassignedtext"></a>Unassigned Text</h3>
</div>
</div>
</div>
<p>Unassigned text can be necessary due to data type rule calls or terminal rule calls which do not reside within an assignment. Example:</p>
<div class="literallayout">
<p>
<code class="code">PluralRule:<br>
&nbsp;&nbsp;'contents:'&nbsp;count=INT&nbsp;Plural;<br>
&nbsp;&nbsp;<br>
terminal&nbsp;Plural:&nbsp;<br>
&nbsp;&nbsp;'item'&nbsp;|&nbsp;'items';<br>
&nbsp;&nbsp;<br>

</code>
</p>
</div>
<p>Valid models for this example are 
					<code class="code">contents 1 item</code> or 
					<code class="code">contents 5 items</code>. However, it is not stored in the semantic model whether the keyword 
					<code class="code">item</code> or 
					<code class="code">items</code> has been parsed. This is due to the fact that the rule call 
					<code class="code">Plural</code> is unassigned. However, the 
					<a class="link" href="#parsetreeconstructor" title="Parse Tree Constructor">parse tree constructor</a> needs to decide which value to write during serialization. This decision can be be made by implementing the 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/parsetree/reconstr/IUnassignedTextSerializer.java?root=Modeling_Project&view=co" target="_new">IUnassignedTextSerializer</a>.  
				</p>
</div>
<div class="section" title="Cross Reference Serializer">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="crossreferenceserializer"></a>Cross Reference Serializer</h3>
</div>
</div>
</div>
<p>The cross reference serializer specifies which values are to be written to the textual representation for cross references. This behavior can be customized by implementing 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/parsetree/reconstr/ICrossReferenceSerializer.java?root=Modeling_Project&view=co" target="_new">ICrossReferenceSerializer</a>. The default implementation delegates to 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/linking/ILinkingService.java?root=Modeling_Project&view=co" target="_new">ILinkingService</a>, which may be the better place for customization.
				</p>
</div>
<div class="section" title="Hidden Token Merger">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="hiddentokenmerger"></a>Hidden Token Merger</h3>
</div>
</div>
</div>
<p>After the 
					<a class="link" href="#parsetreeconstructor" title="Parse Tree Constructor">parse tree constructor</a> has done its job to create a stream of tokens which are to be written to the textual representation, the hidden token merger (
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/parsetree/reconstr/IHiddenTokenMerger.java?root=Modeling_Project&view=co" target="_new">IHiddenTokenMerger</a>) mixes existing hidden tokens into this token stream. The default implementation uses the hidden tokens (whitespace, line breaks, comments) from the node model. The 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/parsetree/reconstr/IHiddenTokenMerger.java?root=Modeling_Project&view=co" target="_new">IHiddenTokenMerger</a> is the factory for a 
					<a class="link" href="#tokenstream" title="Token Stream">token stream</a> which is fed by the 
					<a class="link" href="#parsetreeconstructor" title="Parse Tree Constructor">parse tree constructor</a> and which writes to another token stream.  
				</p>
</div>
<div class="section" title="Token Stream">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="tokenstream"></a>Token Stream</h3>
</div>
</div>
</div>
<p>The 
					<a class="link" href="#parsetreeconstructor" title="Parse Tree Constructor">parse tree constructor</a>, the 
					<a class="link" href="#hiddentokenmerger" title="Hidden Token Merger">hidden token merger</a> and the 
					<a class="link" href="#formatting" title="Formatting (Pretty Printing)">formatter</a> use an 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/parsetree/reconstr/ITokenStream.java?root=Modeling_Project&view=co" target="_new">ITokenStream</a> for their output, and the latter two for their input as well. This makes them chainable. Token streams can be converted to a 
					<code class="code">String</code> using the 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/parsetree/reconstr/impl/TokenStringBuffer.java?root=Modeling_Project&view=co" target="_new">TokenStringBuffer</a> and to an 
					<code class="code">OutputStream</code> using the 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/parsetree/reconstr/impl/TokenOutputStream.java?root=Modeling_Project&view=co" target="_new">TokenOutputStream</a>. Maybe there will be an implementation to reconstruct a node model as well at some point in the future. While providing fast output due to the stream pattern, token streams allow easy manipulation of the stream, such as mixing in whitespace or manipulating them.    
				</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;interface&nbsp;ITokenStream&nbsp;{<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;close()&nbsp;throws&nbsp;IOException;<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;writeHidden(<br>
&nbsp;&nbsp;&nbsp;&nbsp;EObject&nbsp;grammarElement,&nbsp;String&nbsp;value)&nbsp;throws&nbsp;IOException;<br>
&nbsp;&nbsp;public&nbsp;void&nbsp;writeSemantic(<br>
&nbsp;&nbsp;&nbsp;&nbsp;EObject&nbsp;grammarElement,&nbsp;String&nbsp;value)&nbsp;throws&nbsp;IOException;<br>
}<br>

<br>
&nbsp;<br>

</code>
</p>
</div>
</div>
</div>
<div class="section" title="Integration with EMF">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="emf_integration"></a>Integration with EMF</h2>
</div>
</div>
</div>
<p>Xtext relies heavily on EMF internally, but it can also be used as the serialization back-end of other EMF-based tools.</p>
<div class="section" title="XtextResource Implementation">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="XtextResourceImplementation"></a>XtextResource Implementation</h3>
</div>
</div>
</div>
<p>Xtext provides an implementation of EMF&rsquo;s resource, the 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/resource/XtextResource.java?root=Modeling_Project&view=co" target="_new">XtextResource</a>. This does not only encapsulate the parser that converts text to an EMF model but also the serializer working the opposite direction. That way, an Xtext model just looks like any other Ecore-based model from the outside, making it amenable for the use by other EMF based tools. In fact, the Xpand templates in the generator plug-in created by the Xtext wizard do not make any assumption on the fact that the model is described in Xtext, and they would work fine with any model based on the same Ecore model of the language. So in the ideal case, you can switch the serialization format of your models to your self-defined DSL by just replacing the resource implementation used by your other modeling tools. 
				</p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/emf-integration.png"></div>
<p>
				
</p>
<p>The generator fragment 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/generator/resourceFactory/ResourceFactoryFragment.java?root=Modeling_Project&view=co" target="_new">ResourceFactoryFragment</a> registers a factory for the 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/resource/XtextResource.java?root=Modeling_Project&view=co" target="_new">XtextResource</a> to EMF&rsquo;s resource factory registry, such that all tools using the default mechanism to resolve a resource implementation will automatically get that resource implementation.   
				</p>
<p>Using a self-defined textual syntax as the primary storage format has a number of advantages over the default XMI serialization, e.g.</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>You can use well-known and easy-to-use tools and techniques for manipulation, such as text editors, regular expressions, or stream editors.</p>
</li>
<li class="listitem">
<p>You can use the same tools for version control as you use for source code. Merging and diffing is performed in a syntax the developer is familiar with. </p>
</li>
<li class="listitem">
<p>It is impossible to break the model such that it cannot be reopened in the editor again. </p>
</li>
<li class="listitem">
<p>Models can be fixed using the same tools, even if they have become incompatible with a new version of the Ecore model.</p>
</li>
</ul>
</div>
<p>Xtext targets easy to use and naturally feeling languages. It focuses on the lexical aspects of a language a bit more than on the semantic ones. As a consequence, a referenced Ecore model can contain more concepts than are actually covered by the Xtext grammar. As a result, not everything that is possibly expressed in the EMF model can be serialized back into a textual representation with regards to the grammar. So if you want to use Xtext to serialize your models as described above, it is good to have a couple of things in mind:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>Prefer optional rule calls (cardinality 
							<code class="code">?</code> or 
							<code class="code">*</code>) to mandatory ones (cardinality 
							<code class="code">+</code> or default), such that missing references will not obstruct serialization. 
						</p>
</li>
<li class="listitem">
<p>You should never use an Xtext-Editor on the same model instance as a self-synchronizing other editor, e.g. a canonical GMF editor. The Xtext parser replaces re-parsed subtrees of the AST rather than modifying it, so elements will become stale. Additional information, such as graphical properties in the case of GMF, attached to these elements are likely to be lost. As the Xtext editor continuously re-parses the model on changes, this will happen rather often. It is safer to synchronize editors on file changes. </p>
</li>
<li class="listitem">
<p>Implement an 
							<a class="link" href="#fragmentProvider" title="Fragment Provider (referencing Xtext models from other EMF artifacts)">IFragmentProvider</a> to make the XtextResource return stable fragments for its contained elements, e.g. based on composite names rather than order of appearance.
						</p>
</li>
</ul>
</div>
</div>
<div class="section" title="Fragment Provider (referencing Xtext models from other EMF artifacts)">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="fragmentProvider"></a>Fragment Provider (referencing Xtext models from other EMF artifacts)</h3>
</div>
</div>
</div>
<p>Although inter-Xtext linking is not done by URIs, you may want to be able to reference your 
					<code class="code">EObject</code> from non-Xtext models.
					In those cases URIs are used, which are made up of a part identifying the resource. Each 
					<code class="code">EObject</code> contained in a resource can be identified by a so called 
					<span class="emphasis"><em>fragment</em></span>.
				</p>
<p>A fragment is a part of an EMF URI and needs to be unique per resource.</p>
<p>The generic XMI resource shipped with EMF provides a generic path-like computation of fragments. With an XMI or other binary-like serialization it is also common and possible to use UUIDs.</p>
<p>However with a textual concrete syntax we want to be able to compute fragments out of the given information. We don&rsquo;t want to force people to use UUIDs (i.e. synthetic identifiers) or relative generic paths (very fragile), in order to refer to 
					<code class="code">EObjects</code>.
				</p>
<p>Therefore one can contribute a so called 
					<code class="code">IFragmentProvider</code> per language.
				</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;interface&nbsp;IFragmentProvider&nbsp;extends&nbsp;ILanguageService&nbsp;{<br>
&nbsp;<br>
&nbsp;&nbsp;/**<br>
&nbsp;&nbsp;&nbsp;*&nbsp;Computes&nbsp;the&nbsp;local&nbsp;ID&nbsp;of&nbsp;the&nbsp;given&nbsp;object.&nbsp;<br>
&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;obj<br>
&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;EObject&nbsp;to&nbsp;compute&nbsp;the&nbsp;fragment&nbsp;for<br>
&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;the&nbsp;fragment,&nbsp;which&nbsp;can&nbsp;be&nbsp;an&nbsp;arbitrary&nbsp;string&nbsp;but&nbsp;must&nbsp;be&nbsp;<br>
&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unique&nbsp;within&nbsp;a&nbsp;resource.&nbsp;Return&nbsp;null&nbsp;to&nbsp;use&nbsp;default&nbsp;<br>
&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;implementation<br>
&nbsp;&nbsp;&nbsp;*/<br>
&nbsp;&nbsp;String&nbsp;getFragment(EObject&nbsp;obj);<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;/**<br>
&nbsp;&nbsp;&nbsp;*&nbsp;Locates&nbsp;an&nbsp;EObject&nbsp;in&nbsp;a&nbsp;resource&nbsp;by&nbsp;its&nbsp;fragment.&nbsp;<br>
&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;the&nbsp;EObject&nbsp;<br>
&nbsp;&nbsp;&nbsp;*/<br>
&nbsp;&nbsp;EObject&nbsp;getEObject(Resource&nbsp;resource,&nbsp;String&nbsp;fragment);<br>
}<br>

<br>

</code>
</p>
</div>
<p>Note that the currently available default fragment provider does nothing (i.e. falls back to the default behavior of EMF).</p>
</div>
</div>
</div>
<div class="chapter" title="Chapter&nbsp;5.&nbsp;IDE concepts">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="IDEconcepts"></a>Chapter&nbsp;5.&nbsp;IDE concepts</h2>
</div>
</div>
</div>
<p>For the following part we will refer to a concrete example grammar in order to explain certain aspect of the UI more clearly. The used example grammar is as follows:</p>
<div class="literallayout">
<p>
<code class="code">grammar&nbsp;org.eclipse.text.documentation.Sample&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;org.eclipse.xtext.common.Terminals<br>

<br>
generate&nbsp;gen&nbsp;'http://www.eclipse.org/xtext/documentation/Sample'&nbsp;as&nbsp;gen<br>

<br>
Model&nbsp;:<br>
&nbsp;&nbsp;"model"&nbsp;intAttribute=INT&nbsp;(stringDescription=STRING)?&nbsp;"{"&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rules&nbsp;+=&nbsp;AbstractRule)*&nbsp;<br>
&nbsp;&nbsp;"}"&nbsp;<br>
;<br>

<br>
AbstractRule:<br>
&nbsp;&nbsp;RuleA&nbsp;|&nbsp;RuleB<br>
;<br>

<br>
RuleA&nbsp;:<br>
&nbsp;&nbsp;&nbsp;"RuleA"&nbsp;"("&nbsp;name&nbsp;=&nbsp;ID&nbsp;")"&nbsp;;<br>

<br>
RuleB&nbsp;return&nbsp;gen::CustomType:<br>
&nbsp;&nbsp;&nbsp;"RuleB"&nbsp;"("&nbsp;ruleA&nbsp;=&nbsp;[RuleA]&nbsp;")"&nbsp;;<br>

<br>

</code>
</p>
</div>
<p></p>
<div class="section" title="Label Provider">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="labelProvider"></a>Label Provider</h2>
</div>
</div>
</div>
<p>A nice part of the Eclipse tooling that comes with Xtext is the outline view. It shows the structure of your model as a tree and allows quick navigation to model elements. Thus it helps to get an overview on the current state in the editor at a glance. To make the appearance of the outline more appealing it is very easy possible to provide customization for the label and the image that is used for an element. Actually this customization will be used at various places in your IDE, for example in the window that displays completion proposals when content assist was invoked. (Customizing the structure of the outline is described in a separate 
				<a class="link" href="#outline" title="Outline View">chapter</a>).
			</p>
<p>The LabelProvider is the service which is used to compute the image for model elements and &ndash; as its name suggests &ndash; the label that represents an element. What you basically have to do is to provide an implementation for two methods which read 
				<code class="code">Image getImage(Object)</code> and 
				<code class="code">String getText(Object)</code> respectively. As this tends to be cumbersome due to 
				<code class="code">instanceof</code> and cast orgies, Xtext ships with a reasonable and convenient default implementation.
			</p>
<div class="section" title="DefaultLabelProvider">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="DefaultLabelProvider"></a>DefaultLabelProvider</h3>
</div>
</div>
</div>
<p>The default implementation of the 
					<code class="code">LabelProvider</code> interface utilizes the polymorphic dispatcher idiom to implement an external visitor as the requirements of the LabelProvider are kind of a best match for this pattern. It comes down to the fact that the only thing you need to do is to implement a method that matches a specific signature. It either provides a image filename or the text to be used to represent your model element. Have a look at following example to get a more detailed idea about the 
					<code class="code">DefaultLabelProvider</code>.
				</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;SampleLabelProvider&nbsp;extends&nbsp;DefaultLabelProvider&nbsp;{<br>

<br>
&nbsp;&nbsp;String&nbsp;text(RuleA&nbsp;rule)&nbsp;{<br>
		return&nbsp;"Rule:&nbsp;"&nbsp;+&nbsp;rule.getName();<br>
	}<br>
	
<br>
	String&nbsp;image(RuleA&nbsp;rule)&nbsp;{<br>
		return&nbsp;"ruleA.gif";<br>
	}<br>
	
<br>
	String&nbsp;image(RuleB&nbsp;rule)&nbsp;{<br>
		return&nbsp;"ruleB.gif";<br>
	}<br>
	
<br>
}<br>
	
<br>

</code>
</p>
</div>
<p></p>
<p>The declarative implementation of the label itself is pretty straightforward. The image in turn is expected to be found in a file named 
					<code class="code">icons/&lt;result of image-method&gt;</code> in your plugin. This path is actually configurable by google guice. Have a look at the 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui.core/src/org/eclipse/xtext/ui/core/PluginImageHelper.java?root=Modeling_Project&view=co" target="_new">PluginImageHelper</a> to learn about the customizing possibilities.
				</p>
<p>What is especially nice about the default implementation is the actual reason for its class name: It provides very reasonable defaults. To compute the label for a certain model element, it will at first have a look for an EAttribute that is called 
					<code class="code">name</code> and try to use this one. If it cannot find a feature like this, it will try to use the first feature, that can be used best as a label. At worst it will return the class name of the model element, which is kind of unlikely to happen.
				</p>
<p>More advanced usage patterns of the 
					<code class="code">DefaultLabelProvider</code> include a dispatching to an error handler called 
					<code class="code">String error_text(Object, Exception)</code> and 
					<code class="code">String error_image(Object, Exception)</code> respectively.  
				</p>
</div>
</div>
<div class="section" title="Content Assist">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="contentAssist"></a>Content Assist</h2>
</div>
</div>
</div>
<p>The Xtext generator, amongst other things, generates the following two content assist (CA) related artifacts:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>an abstract proposal provider class named 
						<code class="code">'Abstract[Language]ProposalProvider'</code> generated into the 
						<code class="code">src-gen</code> folder within the 
						<code class="code">ui</code> project
					</p>
</li>
<li class="listitem">
<p>a concrete descendent in the 
						<code class="code">src</code>-folder of the 
						<code class="code">ui</code> project 
						<code class="code">ProposalProvider</code>
					
</p>
</li>
</ul>
</div>
<p>First we will investigate the generated 
				<code class="code">Abstract[Language]ProposalProvider</code> with methods that look like this:
			</p>
<div class="section" title="ProposalProvider">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="ProposalProvider"></a>ProposalProvider</h3>
</div>
</div>
</div>
<div class="literallayout">
<p>
<code class="code">public&nbsp;void&nbsp;complete[TypeName]_[FeatureName](<br>
&nbsp;&nbsp;EObject&nbsp;model,&nbsp;<br>
&nbsp;&nbsp;Assignment&nbsp;assignment,&nbsp;<br>
&nbsp;&nbsp;ContentAssistContext&nbsp;context,&nbsp;<br>
&nbsp;&nbsp;ICompletionProposalAcceptor&nbsp;acceptor)&nbsp;{<br>
&nbsp;&nbsp;//&nbsp;clients&nbsp;may&nbsp;override<br>
}<br>

<br>
public&nbsp;void&nbsp;complete_[RuleName](<br>
&nbsp;&nbsp;EObject&nbsp;model,&nbsp;<br>
&nbsp;&nbsp;RuleCall&nbsp;ruleCall,&nbsp;<br>
&nbsp;&nbsp;ContentAssistContext&nbsp;context,&nbsp;<br>
&nbsp;&nbsp;ICompletionProposalAcceptor&nbsp;acceptor)&nbsp;{<br>
&nbsp;&nbsp;//&nbsp;clients&nbsp;may&nbsp;override<br>
}<br>

<br>

</code>
</p>
</div>
<p>The snippet above indicates that the generated ProposalProvider class contains a 
					<code class="code">complete*</code>-method for each assigned feature in the grammar and for each rule. The brackets are place-holders that should give a clue about the naming scheme used to create the various entry points for clients. The generated proposal provider falls back to some default behavior for cross references. Furthermore it inherits the logic that was introduced in reused grammars. 
				</p>
<p>Clients who want to customize the behavior may override the methods from the 
					<code class="code">AbstractProposalProvider</code> or introduce new methods with specialized parameters. The framework dispatches method calls according to the current context to the most concrete implementation, that can be found.
				</p>
<p>It is important to know, that for a given offset in a model file, many possible grammar elements exist. The framework dispatches to the method declarations for any valid element. That means, that a bunch of '&lsquo;complete.*&rsquo;' methods may be called.</p>
</div>
<div class="section" title="Sample Implementation">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="SampleImplementation"></a>Sample Implementation</h3>
</div>
</div>
</div>
<p>To provide a dummy proposal for the description of a model object, you may introduce a specialization of the generated method and implement it as follows. This will give &lsquo;Description for model #7&rsquo; for a model with the intAttribute '7'</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;void&nbsp;completeModel_StringDescription&nbsp;(<br>
&nbsp;&nbsp;Model&nbsp;model,&nbsp;<br>
&nbsp;&nbsp;Assignment&nbsp;assignment,&nbsp;<br>
&nbsp;&nbsp;ContentAssistContext&nbsp;context,&nbsp;<br>
&nbsp;&nbsp;ICompletionProposalAcceptor&nbsp;acceptor)&nbsp;{<br>
&nbsp;&nbsp;//&nbsp;call&nbsp;implementation&nbsp;in&nbsp;superclass<br>
&nbsp;&nbsp;super.completeModel_StringDescription(<br>
&nbsp;&nbsp;&nbsp;&nbsp;model,&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;assignment,&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;context,&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;acceptor);<br>

<br>
&nbsp;&nbsp;//&nbsp;compute&nbsp;the&nbsp;plain&nbsp;proposal<br>
&nbsp;&nbsp;String&nbsp;proposal&nbsp;=&nbsp;"Description&nbsp;for&nbsp;model&nbsp;#"&nbsp;+&nbsp;model.getIntAttribute();<br>

<br>
&nbsp;&nbsp;//&nbsp;convert&nbsp;it&nbsp;to&nbsp;a&nbsp;valid&nbsp;STRING-terminal<br>
&nbsp;&nbsp;proposal&nbsp;=&nbsp;getValueConverter().toString(proposal,&nbsp;"STRING");<br>

<br>
&nbsp;&nbsp;//&nbsp;create&nbsp;the&nbsp;completion&nbsp;proposal<br>
&nbsp;&nbsp;//&nbsp;the&nbsp;result&nbsp;may&nbsp;be&nbsp;null&nbsp;as&nbsp;the&nbsp;createCompletionProposal(..)&nbsp;methods&nbsp;<br>
&nbsp;&nbsp;//&nbsp;check&nbsp;for&nbsp;valid&nbsp;prefixes<br>
&nbsp;&nbsp;//&nbsp;and&nbsp;terminal&nbsp;token&nbsp;conflicts<br>
&nbsp;&nbsp;ICompletionProposal&nbsp;completionProposal&nbsp;=&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;createCompletionProposal(proposal,&nbsp;contentAssistContext);<br>

<br>
&nbsp;&nbsp;//&nbsp;register&nbsp;the&nbsp;proposal,&nbsp;the&nbsp;acceptor&nbsp;handles&nbsp;null-values&nbsp;gracefully<br>
&nbsp;&nbsp;acceptor.accept(completionProposal);<br>
}<br>

<br>

</code>
</p>
</div>
</div>
</div>
<div class="section" title="Template Proposals">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="templates"></a>Template Proposals</h2>
</div>
</div>
</div>
<p>Xtext-based editors automatically support code templates. That means that you get the corresponding preference page where users can add and change template proposals. If you want to ship a couple of default templates, you have to put a file named 
				<code class="code">templates.xml</code> inside the 
				<code class="code">templates</code> directory of the generated ui-plugin. This file contains templates in a format as described in the 
				<a class="ulink" href="http://help.eclipse.org/ganymede/topic/org.eclipse.cdt.doc.user/tasks/cdt_t_imp_code_temp.htm" target="_new">Eclipse online help</a> .
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/preferences_templates.png"></div>
<p>
			
</p>
<p>By default Xtext registers ContextTypes for each Rule (
				<code class="code">.[RuleName]</code>) and for each keyword (
				<code class="code">.kw_[keyword]</code>), as long as the keywords are valid identifiers. If you don&rsquo;t like these defaults you&rsquo;ll have to subclass 
				<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui.common/src/org/eclipse/xtext/ui/common/editor/templates/XtextTemplateContextTypeRegistry.java?root=Modeling_Project&view=co" target="_new">XtextTemplateContextTypeRegistry</a> and configure it via 
				<a class="link" href="#guicemanualmodules" title="Modules intended for customization">Guice</a>. 
			</p>
<p>In addition to the standard template proposal extension mechanism, Xtext ships with a predefined set of TemplateVariableResolvers to resolve special variable types inside a given template (i.e. TemplateContext). Besides the standard template variables available in 
				<code class="code">org.eclipse.jface.text.templates.GlobalTemplateVariables</code> like ${user}, ${date}, ${time}, ${cursor}, etc., these TemplateVariableResolver support the automatic resolving of CrossReferences (type 
				<code class="code">CrossReferences</code>) and Enumerations (type 
				<code class="code">Enum</code>) like it is explained in the following sections.
			</p>
<div class="section" title="CrossReference TemplateVariableResolver">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="CrossReferenceTemplateVariableResolver"></a>CrossReference TemplateVariableResolver</h3>
</div>
</div>
</div>
<p>Xtext comes with a specific template variable resolver 
					<code class="code">org.eclipse.jface.text.templates.TemplateVariableResolver</code>) called 
					<code class="code">CrossReferenceResolver</code>, which can be used to place cross references within a template.
				</p>
<p>The syntax is as follows:</p>
<div class="literallayout">
<p>
<code class="code">${displayText:CrossReference('MyType.myRef')}<br>

</code>
</p>
</div>
<p>For example the following template:</p>
<div class="literallayout">
<p>
<code class="code">&lt;template&nbsp;name="transition"&nbsp;description="event&nbsp;transition"&nbsp;id="transition"<br>
&nbsp;&nbsp;&nbsp;&nbsp;context="org.eclipse.xtext.example.FowlerDsl.Transition"&nbsp;enabled="true"&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;${event:CrossReference('Transition.event')}&nbsp;=&gt;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;	${state:CrossReference('Transition.state')<br>
&lt;/template&gt;<br>

<br>

</code>
</p>
</div>
<p>yields the text 
					<code class="code">event =&gt; state</code> and allows selecting any events and states using a drop down.
				</p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/templates_crossref.png"></div>
<p>
				
</p>
</div>
<div class="section" title="Enumeration TemplateVariableResolver">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="EnumerationTemplateVariableResolver"></a>Enumeration TemplateVariableResolver</h3>
</div>
</div>
</div>
<p>The 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui.common/src/org/eclipse/xtext/ui/common/editor/templates/EnumTemplateVariableResolver.java?root=Modeling_Project&view=co" target="_new">EnumTemplateVariableResolver</a> resolves a template variable to 
					<code class="code">EEnumLiteral</code> literals
					which are assignment-compatible to the enumeration type declared as the first parameter of the the 
					<code class="code">Enum</code> 
					<code class="code">TemplateVariable</code>. 
				</p>The syntax is as follows:   
				<div class="literallayout">
<p>
<code class="code">${displayText:Enum('Visibility')<br>

</code>
</p>
</div>
<p>For example the following template (taken from the domainmodel example):</p>
<div class="literallayout">
<p>
<code class="code">&lt;template&nbsp;name="Operation"&nbsp;description="template&nbsp;for&nbsp;an&nbsp;Operation"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;id="org.eclipse.xtext.example.Domainmodel.Operation"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;context="org.eclipse.xtext.example.Domainmodel.Operation"&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;	enabled="true"&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${visibility:Enum('Visibility')}&nbsp;op&nbsp;${name}(${cursor}):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${type:CrossReference('Operation.type')}<br>
&lt;/template&gt;<br>

<br>

</code>
</p>
</div>
<p>yields the text 
					<code class="code">public op name(): type</code> where the display text &lsquo;public&rsquo; is replaced with a drop down filled with the literal values as defined in the Visibility 
					<code class="code">EENumeration</code>. Also, &lsquo;name&rsquo; and &lsquo;type&rsquo; are placeholders.
				</p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/templates_enum.png"></div>
<p>
				
</p>
</div>
</div>
<div class="section" title="Outline View">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="outline"></a>Outline View</h2>
</div>
</div>
</div>
<p>Xtext provides an outline view to help you navigate your models. By default, it provides a hierarchical view on your model and allows you to sort tree elements alphabetically. Selecting an element in the outline will highlight the corresponding element in the text editor. Users can choose to synchronize the outline with the editor selection by clicking the 
				<span class="emphasis"><em>Link with Editor</em></span> button.
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/sample_outline.png"></div>
<p>
			
</p>
<p>You can customize various aspects of the outline by providing implementation for its various interfaces. The following sections show how to do this.</p>
<div class="section" title="Influencing the outline structure">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Influencingtheoutlinestructure"></a>Influencing the outline structure</h3>
</div>
</div>
</div>
<p>In its default implementation, the outline view shows the containment hierarchy of your model. This should be sufficient in most cases. If you want to adjust the structure of the outline, i.e., by omitting a certain kind of node or by introducing additional even virtual nodes, you customize the outline by implementing 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui.common/src/org/eclipse/xtext/ui/common/editor/outline/transformer/ISemanticModelTransformer.java?root=Modeling_Project&view=co" target="_new">ISemanticModelTransformer</a>.
				</p>
<p>The Xtext wizard creates an empty transformer class (
					<code class="code">MyDslTransformer</code>) for your convenience. To transform the semantic model delivered by the Xtext parser, you need to provide transformation methods for each of the EClasses that are of interest:
				</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;MyDslTransformer&nbsp;extends&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;AbstractDeclarativeSemanticModelTransformer&nbsp;{&nbsp;<br>
&nbsp;&nbsp;/**<br>
&nbsp;&nbsp;&nbsp;*&nbsp;This&nbsp;method&nbsp;will&nbsp;be&nbsp;called&nbsp;by&nbsp;naming&nbsp;convention:<br>
&nbsp;&nbsp;&nbsp;*&nbsp;-&nbsp;method&nbsp;name&nbsp;must&nbsp;be&nbsp;createNode<br>
&nbsp;&nbsp;&nbsp;*&nbsp;-&nbsp;first&nbsp;param:&nbsp;subclass&nbsp;of&nbsp;EObject<br>
&nbsp;&nbsp;&nbsp;*&nbsp;-&nbsp;second&nbsp;param:&nbsp;ContentOutlineNode&nbsp;<br>
&nbsp;&nbsp;&nbsp;*/<br>
&nbsp;&nbsp;public&nbsp;ContentOutlineNode&nbsp;createNode(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Attribute&nbsp;semanticNode,&nbsp;ContentOutlineNode&nbsp;parentNode)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;ContentOutlineNode&nbsp;node&nbsp;=&nbsp;super.newOutlineNode(semanticNode,&nbsp;parentNode);<br>
&nbsp;&nbsp;&nbsp;&nbsp;node.setLabel("special&nbsp;"&nbsp;+&nbsp;node.getLabel());<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;node;<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;public&nbsp;ContentOutlineNode&nbsp;createNode(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Property&nbsp;semanticNode,&nbsp;ContentOutlineNode&nbsp;parentNode)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;ContentOutlineNode&nbsp;node&nbsp;=&nbsp;super.newOutlineNode(semanticNode,&nbsp;parentNode);<br>
&nbsp;&nbsp;&nbsp;&nbsp;node.setLabel("pimped&nbsp;"&nbsp;+&nbsp;node.getLabel());<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;node;<br>
&nbsp;&nbsp;}<br>

<br>
&nbsp;&nbsp;/**<br>
&nbsp;&nbsp;&nbsp;*&nbsp;This&nbsp;method&nbsp;will&nbsp;be&nbsp;called&nbsp;by&nbsp;naming&nbsp;convention:<br>
&nbsp;&nbsp;&nbsp;*&nbsp;-&nbsp;method&nbsp;name&nbsp;must&nbsp;be&nbsp;getChildren<br>
&nbsp;&nbsp;&nbsp;*&nbsp;-&nbsp;first&nbsp;param:&nbsp;subclass&nbsp;of&nbsp;EObject<br>
&nbsp;&nbsp;&nbsp;*/<br>
&nbsp;&nbsp;public&nbsp;List&lt;EObject&gt;&nbsp;getChildren(Attribute&nbsp;attribute)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;attribute.eContents();<br>
&nbsp;&nbsp;}<br>

<br>
&nbsp;&nbsp;public&nbsp;List&lt;EObject&gt;&nbsp;getChildren(Property&nbsp;property)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NO_CHILDREN;<br>
&nbsp;&nbsp;}<br>
}<br>

<br>

</code>
</p>
</div>
<p>To make sure Xtext picks up your new outline transformer, you have to register your implementation with your UI module: </p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;MyDslUiModule&nbsp;extends&nbsp;AbstractMyDslUiModule&nbsp;{<br>

<br>
&nbsp;&nbsp;@Override<br>
&nbsp;&nbsp;public&nbsp;Class&lt;?&nbsp;extends&nbsp;ISemanticModelTransformer&gt;&nbsp;<br>
&nbsp;&nbsp;		bindISemanticModelTransformer()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;MyDslTransformer.class;<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;...<br>
}<br>

<br>

</code>
</p>
</div>
</div>
<div class="section" title="Filtering">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Filtering"></a>Filtering</h3>
</div>
</div>
</div>
<p>Often, you want to allow users to filter the contents of the outline to make it easier to concentrate on the relevant aspects of the model. To add filtering capabilities to your outline, you need to add 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui.common/src/org/eclipse/xtext/ui/common/editor/outline/actions/AbstractFilterAction.java?root=Modeling_Project&view=co" target="_new">AbstractFilterAction</a>s to the outline. Actions can be contributed by implementing and registering a 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui.common/src/org/eclipse/xtext/ui/common/editor/outline/actions/DeclarativeActionBarContributor.java?root=Modeling_Project&view=co" target="_new">DeclarativeActionBarContributor</a>.
				</p>
<p>To register a 
					<code class="code">DeclarativeActionBarContributor</code>, add the following lines to your 
					<code class="code">MyDslUiModule</code> class:
				</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;MyDslUiModule&nbsp;extends&nbsp;AbstractMyDslUiModule&nbsp;{<br>

<br>
&nbsp;&nbsp;@Override<br>
&nbsp;&nbsp;public&nbsp;Class&lt;?&nbsp;extends&nbsp;IActionBarContributor&gt;&nbsp;bindIActionBarContributor()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;MyDslActionBarContributor.class;<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;...<br>
}<br>

<br>

</code>
</p>
</div>
<p>The action bar contributor will look like this:</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;MyDslActionBarContributor&nbsp;extends<br>
&nbsp;&nbsp;&nbsp;&nbsp;DeclarativeActionBarContributor&nbsp;{<br>
&nbsp;&nbsp;public&nbsp;Action&nbsp;addFilterParserRulesToolbarAction(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;XtextContentOutlinePage&nbsp;page)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;FilterFooAction(page);<br>
&nbsp;&nbsp;}<br>
}<br>

<br>

</code>
</p>
</div>
<p>Filter actions must extend 
					<code class="code">AbstractFilterAction</code> (this ensures that the action toggle state is handled correctly):
				</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;FilterFooAction&nbsp;extends&nbsp;AbstractFilterAction&nbsp;{<br>

<br>
&nbsp;&nbsp;public&nbsp;FilterFooAction(XtextContentOutlinePage&nbsp;outlinePage)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;super("Filter&nbsp;Foo",&nbsp;outlinePage);<br>
&nbsp;&nbsp;&nbsp;&nbsp;setToolTipText("Show&nbsp;/&nbsp;hide&nbsp;foo");<br>
&nbsp;&nbsp;&nbsp;&nbsp;setDescription("Show&nbsp;/&nbsp;hide&nbsp;foo");<br>
&nbsp;&nbsp;&nbsp;&nbsp;setImageDescriptor(Activator.getImageDescriptor("icons/foo.gif"));<br>
&nbsp;&nbsp;&nbsp;&nbsp;setDisabledImageDescriptor(<br>
&nbsp;&nbsp;&nbsp;&nbsp;	Activator.getImageDescriptor("icons/foo.gif"));<br>
&nbsp;&nbsp;}<br>

<br>
&nbsp;&nbsp;@Override<br>
&nbsp;&nbsp;protected&nbsp;String&nbsp;getToggleId()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;"FilterFooAction.isChecked";<br>
&nbsp;&nbsp;}<br>
	
<br>
&nbsp;&nbsp;@Override<br>
&nbsp;&nbsp;protected&nbsp;ViewerFilter&nbsp;createFilter()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;FooOutlineFilter();<br>
&nbsp;&nbsp;}<br>

<br>
}<br>

<br>

</code>
</p>
</div>
<p>The filtering itself will be performed by 
					<code class="code">FooOutlineFilter</code>:
				</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;FooOutlineFilter&nbsp;extends&nbsp;ViewerFilter&nbsp;{<br>

<br>
&nbsp;&nbsp;@Override<br>
&nbsp;&nbsp;public&nbsp;boolean&nbsp;select(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Viewer&nbsp;viewer,&nbsp;Object&nbsp;parentElement,&nbsp;Object&nbsp;element)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((parentElement&nbsp;!=&nbsp;null)&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp;&nbsp;(parentElement&nbsp;instanceof&nbsp;ContentOutlineNode))&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ContentOutlineNode&nbsp;parentNode&nbsp;=&nbsp;(ContentOutlineNode)&nbsp;parentElement;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EClass&nbsp;clazz&nbsp;=&nbsp;parentNode.getClazz();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(clazz.equals(MyDslPackage.Literals.ATTRIBUTE))&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;true;<br>
&nbsp;&nbsp;}<br>

<br>
}<br>

<br>

</code>
</p>
</div>
</div>
<div class="section" title="Context menus">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Contextmenus"></a>Context menus</h3>
</div>
</div>
</div>
<p>You might want to register context menu actions for specific elements in the outline, e.g. to allow users of your DSL to invoke a generator or to validate the selected element. As all elements in the outline are 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui.common/src/org/eclipse/xtext/ui/common/editor/outline/ContentOutlineNode.java?root=Modeling_Project&view=co" target="_new">ContentOutlineNode</a>s, you cannot easily register an 
					<a class="ulink" href="http://help.eclipse.org/stable/index.jsp?topic=/org.eclipse.platform.doc.isv/guide/workbench_basicext_popupMenus.htm" target="_new">Object contribution</a>. (Besides, using the extension point 
					<code class="code">org.eclipse.ui.popupMenus</code> is regarded somewhat old school &ndash; you should rather use the new command and expression framework, as depicted below).
				</p>
<p>So to register context menus for specific node types of your Ecore model, you need to do the following:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>register a 
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui.common/src/org/eclipse/xtext/ui/common/editor/outline/actions/IContentOutlineNodeAdapterFactory.java?root=Modeling_Project&view=co" target="_new">IContentOutlineNodeAdapterFactory</a> which will translate 
							<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui.common/src/org/eclipse/xtext/ui/common/editor/outline/ContentOutlineNode.java?root=Modeling_Project&view=co" target="_new">ContentOutlineNode</a>s to their underlying node type
						</p>
</li>
<li class="listitem">
<p>register a menu contribution to add a command / handler pair to the context menu for the specific node types you&rsquo;re interested in.</p>
</li>
</ul>
</div>
<div class="section" title="Registering an IContentOutlineNodeAdapterFactory">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="RegisteringanIContentOutlineNodeAdapterFactory"></a>Registering an 
						<code class="code">IContentOutlineNodeAdapterFactory</code>
					
</h4>
</div>
</div>
</div>
<p>Create a subclass of 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui.common/src/org/eclipse/xtext/ui/common/editor/outline/actions/DefaultContentOutlineNodeAdapterFactory.java?root=Modeling_Project&view=co" target="_new">DefaultContentOutlineNodeAdapterFactory</a> - this class contains some base infrastructure to manage adapters for your node types. In your subclass, you need to override 
						<code class="code">getAdapterList()</code> and return an array of classes. This is the list of classes you want to add context menus to:
					</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;MyDslContentOutlineNodeAdapterFactory&nbsp;extends&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;DefaultContentOutlineNodeAdapterFactory&nbsp;{<br>
&nbsp;&nbsp;@SuppressWarnings("unchecked")<br>
&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;Class[]&nbsp;types&nbsp;=&nbsp;{&nbsp;Attribute.class&nbsp;};<br>

<br>
&nbsp;&nbsp;@SuppressWarnings("unchecked")<br>
&nbsp;&nbsp;public&nbsp;Class[]&nbsp;getAdapterList()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;types;<br>
&nbsp;&nbsp;}<br>
}<br>

<br>

</code>
</p>
</div>
<p>Register this class with your 
						<code class="code">MyDslUiModule</code> to make it available to your DSL editor:
					</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;MyDslUiModule&nbsp;extends&nbsp;AbstractMyDslUiModule&nbsp;{<br>
&nbsp;&nbsp;...<br>
&nbsp;&nbsp;public&nbsp;Class&lt;?&nbsp;extends&nbsp;IContentOutlineNodeAdapterFactory&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bindIContentOutlineNodeAdapterFactory()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;org.example.myDSLContentOutlineNodeAdapterFactory.class;<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;...<br>
}<br>

<br>

</code>
</p>
</div>
</div>
<div class="section" title="Registering a menu contribution">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="Registeringamenucontribution"></a>Registering a menu contribution</h4>
</div>
</div>
</div>
<p>After you have registered the 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui.common/src/org/eclipse/xtext/ui/common/editor/outline/actions/IContentOutlineNodeAdapterFactory.java?root=Modeling_Project&view=co" target="_new">IContentOutlineNodeAdapterFactory</a>, you can add command / handler pairs to the context menu.
					</p>
<p>First, you need to define a command &ndash; it will serve as a handle to glue together the handler and the menu contribution:</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&lt;extension<br>
&nbsp;&nbsp;point="org.eclipse.ui.commands"&gt;<br>
&nbsp;&nbsp;&lt;command<br>
&nbsp;&nbsp;&nbsp;&nbsp;id="org.example.mydsl.ui.editor.outline.SampleOutlineCommand"<br>
&nbsp;&nbsp;&nbsp;&nbsp;name="Sample&nbsp;Command"<br>
&nbsp;&nbsp;&nbsp;&nbsp;description="Just&nbsp;a&nbsp;sample&nbsp;command"&gt;<br>
&nbsp;&nbsp;&lt;/command&gt;<br>
&lt;/extension&gt;<br>

<br>

</code>
</p>
</div>
<p>Next, you need to define a handler which will eventually execute the code to operate on the selected node. Please pay special attention to the attribute 
						<code class="code">commandId</code> - it must match the 
						<code class="code">id</code> attribute of your command. 
					</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&lt;extension<br>
&nbsp;&nbsp;point="org.eclipse.ui.handlers"&gt;<br>
&nbsp;&nbsp;&lt;handler<br>
&nbsp;&nbsp;&nbsp;&nbsp;class="org.example.mydsl.ui.editor.outline.SampleOutlineNodeHandler"<br>
&nbsp;&nbsp;&nbsp;&nbsp;commandId="org.example.mydsl.ui.editor.outline.SampleOutlineCommand"&gt;<br>
&nbsp;&nbsp;&lt;/handler&gt;<br>
&lt;/extension&gt;<br>

<br>

</code>
</p>
</div>
<p>Finally, define a 
						<code class="code">menuContribution</code> to add the command to the context menu:
					</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&lt;extension<br>
&nbsp;&nbsp;point="org.eclipse.ui.menus"&gt;<br>
&nbsp;&nbsp;&lt;menuContribution<br>
&nbsp;&nbsp;&nbsp;&nbsp;locationURI="popup:org.eclipse.xtext.ui.common.outline?after=additions"&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;command<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;commandId="org.example.mydsl.ui.editor.outline.SampleOutlineCommand"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;label="Sample&nbsp;action&nbsp;registered&nbsp;for&nbsp;Attributes"&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;visibleWhen&nbsp;checkEnabled="false"&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;iterate&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;adapt&nbsp;type="org.example.mydsl.Attribute"&nbsp;/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/iterate&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/visibleWhen&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/command&gt;<br>
&nbsp;&nbsp;&lt;/menuContribution&gt;<br>
&lt;/extension&gt;<br>

<br>

</code>
</p>
</div>
<p>Again, pay attention to the 
						<code class="code">commandId</code> attribute. The connection between your node type(s) and the menu contribution is made by the part 
						<code class="code">&lt;adapt type="org.example.mydsl.Attribute" /&gt;</code>. 
					</p>
</div>
</div>
</div>
<div class="section" title="Hyperlinking">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="hyperlinking"></a>Hyperlinking</h2>
</div>
</div>
</div>
<p>The Xtext editor provides hyperlinking support for any tokens corresponding to cross references in your grammar definition. This means that you can either control-click on any of these tokens or hit F3 while the cursor position is at the token in question and this will take you to the referenced model element. As you&rsquo;d expect this works for references to elements in the same resource as well as for references to elements in other resources. In the latter case the referenced resource will first be opened using the corresponding editor.</p>
<div class="section" title="Location Provider">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="locationProvider"></a>Location Provider</h3>
</div>
</div>
</div>
<p>When navigating a hyperlink Xtext will also select the text region corresponding to the referenced model element. Determining this text region is the responsibility of the 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui.core/src/org/eclipse/xtext/ui/core/ILocationInFileProvider.java?root=Modeling_Project&view=co" target="_new">ILocationInFileProvider</a>. The default implementation (
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui.core/src/org/eclipse/xtext/ui/core/DefaultLocationInFileProvider.java?root=Modeling_Project&view=co" target="_new">DefaultLocationInFileProvider</a>) implements a best effort strategy which can be summarized as:
				</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>If the model element&rsquo;s type (i.e. EClass) declares a feature 
							<span class="emphasis"><em>name</em></span> then return the region of the corresponding token(s). As a fallback also check for a feature 
							<span class="emphasis"><em>id</em></span>.
						</p>
</li>
<li class="listitem">
<p>If the model element&rsquo;s parse tree contains any top-level tokens corresponding to 
							<span class="emphasis"><em>ID</em></span> rule calls in the grammar then return a region spanning all those tokens.
						</p>
</li>
<li class="listitem">
<p>As a last resort return the region corresponding to the first keyword token of the referenced model element.</p>
</li>
</ol>
</div>
<div class="section" title="Customized Location Provider">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="CustomizedLocationProvider"></a>Customized Location Provider</h4>
</div>
</div>
</div>
<p>As the default strategy is a best effort it may not always result in the selection you want. If that&rsquo;s the case you can 
						<a class="link" href="#guicecustomize" title="Changing Configuration">override</a> the 
						<code class="code">ILocationInFileProvider</code> binding in the UI module as in the following example:
					</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;MyDslUiModule&nbsp;extends&nbsp;AbstractMyDslUiModule&nbsp;{<br>

<br>
&nbsp;&nbsp;@Override<br>
&nbsp;&nbsp;public&nbsp;Class&lt;?&nbsp;extends&nbsp;ILocationInFileProvider&gt;&nbsp;<br>
&nbsp;&nbsp;		bindILocationInFileProvider()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;MyDslLocationInFileProvider.class;<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;...<br>
}<br>

<br>

</code>
</p>
</div>
<p>Often the default strategy only needs some guidance (e.g. selecting the text corresponding to another feature than 
						<span class="emphasis"><em>name</em></span>). In that case you can simply subclass 
						<code class="code">DefaultLocationInFileProvider</code> and override the methods 
						<code class="code">getIdentifierFeature</code> and / or 
						<code class="code">useKeyword</code> to guide the first and last steps of the strategy as described above (see 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.xtext.ui/src/org/eclipse/xtext/xtext/ui/XtextLocationInFileProvider.java?root=Modeling_Project&view=co" target="_new">XtextLocationInFileProvider</a> for an example).
					</p>
</div>
</div>
</div>
<div class="section" title="Formatting (Pretty Printing)">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="formatting"></a>Formatting (Pretty Printing)</h2>
</div>
</div>
</div>
<p>A formatter can be implemented via the 
				<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/formatting/IFormatter.java?root=Modeling_Project&view=co" target="_new">IFormatter</a> service. Technically speaking, a formatter is a 
				<a class="link" href="#tokenstream" title="Token Stream">Token Stream</a> which inserts/removes/modifies hidden tokens (whitespace, line-breaks, comments).
			</p>
<p>The formatter is invoked during the 
				<a class="link" href="#serialization" title="Serialization">serialization phase</a> and when the user triggers formatting in the editor (for example, using the CTRL+SHIFT+F shortcut).
			</p>
<p>Xtext ships with two formatters:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>The 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/formatting/impl/OneWhitespaceFormatter.java?root=Modeling_Project&view=co" target="_new">OneWhitespaceFormatter</a> simply writes one whitespace between all tokens.
					</p>
</li>
<li class="listitem">
<p>The 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/formatting/impl/AbstractDeclarativeFormatter.java?root=Modeling_Project&view=co" target="_new">AbstractDeclarativeFormatter</a> allows advanced configuration using a 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/formatting/impl/FormattingConfig.java?root=Modeling_Project&view=co" target="_new">FormattingConfig</a>. Both are explained in the 
						<a class="link" href="#declarativeformatter" title="Declarative Formatter">next chapter</a>.
					</p>
</li>
</ul>
</div>
<div class="section" title="Declarative Formatter">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="declarativeformatter"></a>Declarative Formatter   </h3>
</div>
</div>
</div>
<p>A declarative formatter can be implemented by sub-classing {org.eclipse.xtext/src/org.eclipse.xtext.formatting.impl.AbstractDeclarativeFormatter}, as shown in the following example:</p>
<div class="literallayout">
<p>
<code class="code">
<br>
public&nbsp;class&nbsp;ExampleFormatter&nbsp;extends&nbsp;AbstractDeclarativeFormatter&nbsp;{<br>

<br>
&nbsp;&nbsp;@Override<br>
&nbsp;&nbsp;protected&nbsp;void&nbsp;configureFormatting(FormattingConfig&nbsp;c)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;ExampleLanguageGrammarAccess&nbsp;f&nbsp;=&nbsp;getGrammarAccess();<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;c.setAutoLinewrap(120);<br>

<br>
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Line<br>
&nbsp;&nbsp;&nbsp;&nbsp;c.setLinewrap(2).after(f.getLineAccess().getSemicolonKeyword_1());<br>
&nbsp;&nbsp;&nbsp;&nbsp;c.setNoSpace().before(f.getLineAccess().getSemicolonKeyword_1());<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;TestIndentation<br>
&nbsp;&nbsp;&nbsp;&nbsp;c.setIndentation(<br>
&nbsp;&nbsp;&nbsp;&nbsp;		f.getTestIndentationAccess().getLeftCurlyBracketKeyword_1(),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f.getTestIndentationAccess().getRightCurlyBracketKeyword_3());<br>
&nbsp;&nbsp;&nbsp;&nbsp;c.setLinewrap().after(<br>
&nbsp;&nbsp;&nbsp;&nbsp;		f.getTestIndentationAccess().getLeftCurlyBracketKeyword_1());<br>
&nbsp;&nbsp;&nbsp;&nbsp;c.setLinewrap().after(<br>
&nbsp;&nbsp;&nbsp;&nbsp;		f.getTestIndentationAccess().getRightCurlyBracketKeyword_3());<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Param<br>
&nbsp;&nbsp;&nbsp;&nbsp;c.setNoLinewrap().around(f.getParamAccess().getColonKeyword_1());<br>
&nbsp;&nbsp;&nbsp;&nbsp;c.setNoSpace().around(f.getParamAccess().getColonKeyword_1());<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;comments<br>
&nbsp;&nbsp;&nbsp;&nbsp;c.setNoLinewrap().before(f.getSL_COMMENTRule());<br>
&nbsp;&nbsp;}<br>
}<br>

<br>

</code>
</p>
</div>
<p>The formatter has to implement the method 
					<code class="code">configureFormatting(...)</code> which is supposed to declaratively set up a 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/formatting/impl/FormattingConfig.java?root=Modeling_Project&view=co" target="_new">FormattingConfig</a>.
				</p>
<p>The 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/formatting/impl/FormattingConfig.java?root=Modeling_Project&view=co" target="_new">FormattingConfig</a> consist general settings and a set of rules:
				</p>
<div class="section" title="General FormattingConfig Settings">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="GeneralFormattingConfigSettings"></a>General FormattingConfig Settings</h4>
</div>
</div>
</div>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>
								
<code class="code">setAutoLinewrap(int)</code>  defines the amount of characters after which a line-break should be dynamically inserted between two tokens. The rule 
								<code class="code">setNoLinewrap()</code> can be used to suppress this behavior locally. The default is 80.
							</p>
</li>
<li class="listitem">
<p>
								
<code class="code">setIndentationSpace(String)</code> defines the string which is used for a single degree of indentation. The default is two whitespace.
							</p>
</li>
<li class="listitem">
<p>
								
<code class="code">setWhitespaceRule(AbstractRule)</code> defines the grammar rule which is used to match whitespace. This is needed by the formatter to identify whitespace and to insert whitespace. The default is the rule named 
								<code class="code">WS</code>.
							</p>
</li>
<li class="listitem">
<p>
								
<code class="code">setIndentation(start, end)</code> increases the level of indentation when the element 
								<code class="code">start</code> is matched and decreases the level when element 
								<code class="code">end</code> is matched. The matching of elements happens in the same way as it does for formatting rules.
							</p>
</li>
</ul>
</div>
</div>
<div class="section" title="FormattingConfig Rules">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="FormattingConfigRules"></a>FormattingConfig Rules</h4>
</div>
</div>
</div>
<p>Per default, the 
						<a class="link" href="#declarativeformatter" title="Declarative Formatter">Declarative Formatter</a> inserts one whitespace between two tokens. Rules can be used to specify a different behavior. They consist of two parts: 
						<span class="emphasis"><em>When</em></span> to apply the rule and 
						<span class="emphasis"><em>what</em></span> to do.
					</p>
<p>To understand 
						<span class="emphasis"><em>when</em></span> a rule is applied think of a stream of tokens whereas each token is associated with the corresponding grammar element. The rules are matched against these grammar elements. The following matching criteria exist.
					</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>
								
<code class="code">after(ele)</code>: The rule is executed after the grammar element 
								<code class="code">ele</code> has been matched. For example, if your grammar uses the keyword &ldquo;;&rdquo; to end lines, this can instruct the formatter to insert a line-break after the semicolon.  
							</p>
</li>
<li class="listitem">
<p>
								
<code class="code">before(ele)</code>: The rule is executed before the matched element. For example, if your grammar contains lists which separate its values with keyword &ldquo;,&rdquo;, you can instruct the formatter to suppress the whitespace before the comma.
							</p>
</li>
<li class="listitem">
<p>
								
<code class="code">around(ele)</code>: This is the same as 
								<code class="code">before(ele)</code> combined with  
								<code class="code">after(ele)</code>.  
							</p>
</li>
<li class="listitem">
<p>
								
<code class="code">between(ele1, ele2)</code>: This matches if 
								<code class="code">ele2</code> directly follows 
								<code class="code">ele1</code>. There may be no other elements in between.
							</p>
</li>
<li class="listitem">
<p>
								
<code class="code">bounds(ele1, ele2)</code>: This is the same as 
								<code class="code">before(ele1)</code> combined with  
								<code class="code">after(ele2)</code>.
							</p>
</li>
<li class="listitem">
<p>
								
<code class="code">range(ele1, ele2)</code>: The rule is enabled when 
								<code class="code">ele1</code> is matched, and disabled when 
								<code class="code">ele2</code> is matched. Thereby, the rule is active for the complete region which is surrounded by 
								<code class="code">ele1</code> and 
								<code class="code">ele2</code>. 
							</p>
</li>
</ul>
</div>
<p>The parameter 
						<code class="code">ele</code> can be a grammar&rsquo;s 
						<code class="code">AbstractElement</code> or a grammar&rsquo;s 
						<code class="code">AbstractRule</code>. However, only elements which represent a token in the textual representation can be matched. This are:
					</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>terminal rules for comments.</p>
</li>
<li class="listitem">
<p>keywords, assignments, call to terminal or data-type rules.</p>
</li>
</ul>
</div>
<p>After having explained how rules can be activated, this is what they can do:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>
								
<code class="code">setLinewrap()</code>: Inserts a line-break at this position.
							</p>
</li>
<li class="listitem">
<p>
								
<code class="code">setLinewrap(int)</code>: Inserts the specified number of line-breaks at this position.
							</p>
</li>
<li class="listitem">
<p>
								
<code class="code">setNoLinewrap()</code>: Suppresses automatic line wrap, which may occur when the line&rsquo;s length exceeds the defined limit.
							</p>
</li>
<li class="listitem">
<p>
								
<code class="code">setNoSpace()</code>: Suppresses the whitespace between tokens at this position. Be aware that between some tokens a whitespace is required to maintain a valid concrete syntax. 
							</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="section" title="Syntax Coloring">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="highlighting"></a>Syntax Coloring</h2>
</div>
</div>
</div>
<p>Besides the already mentioned advanced features like content assist and code formatting the powerful editor for your DSL is capable to mark-up your model-code to improve the overall readability. It is possible to use different colors and fonts according to the meaning of the different parts of your input file. One may want to use some decent colors for large blocks of comment while identifiers, keywords and strings should be colored differently to make it easier to distinguish between them. This kind of text decorating mark-up does not influence the semantics of the various sections but helps to understand the meaning and to find errors in the source code.</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/highlighting.png"></div>
<p>
			
</p>
<p>The highlighting is done in two stages. This allows for sophisticated algorithms that are executed asynchronously to provide advanced coloring while simple pattern matching may be used to highlight parts of the text instantaneously. The latter is called lexical highlighting while the first is based on the meaning of your different model elements and therefore called semantic highlighting.</p>
<p>When you introduce new highlighting styles, the preference page for your DSL is automatically configured and allows the customization of any registered highlighting setting. They are automatically persisted and reloaded on startup.</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/preferences_syntax.png"></div>
<p>
			
</p>
<div class="section" title="Lexical Highlighting">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="LexicalHighlighting"></a>Lexical Highlighting</h3>
</div>
</div>
</div>
<p>The lexical highlighting can be customized by providing implementations of the interface 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui.common/src/org/eclipse/xtext/ui/common/editor/syntaxcoloring/ILexicalHighlightingConfiguration.java?root=Modeling_Project&view=co" target="_new">ILexicalHighlightingConfiguration</a> and the abstract class 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui.common/src/org/eclipse/xtext/ui/common/editor/syntaxcoloring/AbstractTokenScanner.java?root=Modeling_Project&view=co" target="_new">AbstractTokenScanner</a>. The latter fulfills the interface 
					<code class="code">ITokenScanner</code> from the underlying JFace Framework, which may be implemented by clients directly.
				</p>
<p>The 
					<code class="code">ILexicalHighlightingConfiguration</code> is used to register any default style without a specific binding to a pattern in the model file. It is used to populate the preferences page and to initialize the 
					<code class="code">ITextAttributeProvider</code>, which in turn is the component that is used to obtain the actual settings for a style&rsquo;s id. An implementation will usually be very similar to the 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui.common/src/org/eclipse/xtext/ui/common/editor/syntaxcoloring/DefaultLexicalHighlightingConfiguration.java?root=Modeling_Project&view=co" target="_new">DefaultLexicalHighlightingConfiguration</a> and read like this: 
				</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;DefaultLexicalHighlightingConfiguration&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;implements&nbsp;ILexicalHighlightingConfiguration&nbsp;{<br>

<br>
	public&nbsp;static&nbsp;final&nbsp;String&nbsp;KEYWORD_ID&nbsp;=&nbsp;"keyword";<br>
	public&nbsp;static&nbsp;final&nbsp;String&nbsp;COMMENT_ID&nbsp;=&nbsp;"comment";<br>

<br>
	public&nbsp;void&nbsp;configure(IHighlightingConfigurationAcceptor&nbsp;acceptor)&nbsp;{<br>
		acceptor.acceptDefaultHighlighting(KEYWORD_ID,&nbsp;"Keyword",&nbsp;<br>
				keywordTextStyle());<br>
		acceptor.acceptDefaultHighlighting(COMMENT_ID,&nbsp;"Comment",&nbsp;//&nbsp;...<br>
		//&nbsp;...<br>
	}<br>
	
<br>
	public&nbsp;TextStyle&nbsp;keywordTextStyle()&nbsp;{<br>
		TextStyle&nbsp;textStyle&nbsp;=&nbsp;new&nbsp;TextStyle();<br>
		textStyle.setColor(new&nbsp;RGB(127,&nbsp;0,&nbsp;85));<br>
		textStyle.setStyle(SWT.BOLD);<br>
		return&nbsp;textStyle;<br>
	}<br>
	
<br>
	//&nbsp;...<br>
}<br>

<br>

</code>
</p>
</div>
<p>Implementations of the 
					<code class="code">ITokenScanner</code> are responsible for splitting the content of a document into various parts, the so called tokens, and return the highlighting information for each identified range. It is critical that this is done very efficiently because this component is used on each keystroke. Xtext ships with a default implementation that is based on the lexer that is generated by ANTLR which is very lightweight and fast. This default implementation can be customized by clients easily. They simply have to bind another implementation of the 

					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui.common/src/org/eclipse/xtext/ui/common/editor/syntaxcoloring/antlr/AbstractAntlrTokenToAttributeIdMapper.java?root=Modeling_Project&view=co" target="_new">AbstractAntlrTokenToAttributeIdMapper</a>. To get an idea about it, have a look at the 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui.common/src/org/eclipse/xtext/ui/common/editor/syntaxcoloring/antlr/DefaultAntlrTokenToAttributeIdMapper.java?root=Modeling_Project&view=co" target="_new">DefaultAntlrTokenToAttributeIdMapper</a>.
				</p>
</div>
<div class="section" title="Semantic Highlighting">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="SemanticHighlighting"></a>Semantic Highlighting</h3>
</div>
</div>
</div>
<p>The semantic highlighting stage is executed asynchronously in the background and can be used to calculated highlighting states based on the meaning of the different model elements. Users of the editor will notice a very short delay after they have edited the text until the styles are actually applied to the document. This keeps the editor responsive while providing aid when reading and writing your model.</p>
<p>As for the lexical highlighting there exist two interfaces whose implementations work closely together and allow the customization of the semantic highlighting. Namely these are the 

					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui.common/src/org/eclipse/xtext/ui/common/editor/syntaxcoloring/ISemanticHighlightingConfiguration.java?root=Modeling_Project&view=co" target="_new">ISemanticHighlightingConfiguration</a> and 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui.common/src/org/eclipse/xtext/ui/common/editor/syntaxcoloring/ISemanticHighlightingCalculator.java?root=Modeling_Project&view=co" target="_new">ISemanticHighlightingCalculator</a>. While the configuration for the semantic highlighting works the same way as the 
					<code class="code">ILexicalHighlightingConfiguration</code>, the 
					<code class="code">ISemanticHighlightingCalculator</code> is the primary hook to implement the logic that will compute to-be-highlighted ranges based on the model elements. 
				</p>
<p>The framework will pass the XtextResource and an 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui.common/src/org/eclipse/xtext/ui/common/editor/syntaxcoloring/IHighlightedPositionAcceptor.java?root=Modeling_Project&view=co" target="_new">IHighlightedPositionAcceptor</a> to the calculator. It is ensured, that the resource will not be altered externally until the called method 
					<code class="code">provideHighlightingsFor</code> returns. The task is to navigate your semantic model and compute various ranges based on the node information and associate styles with them. This may read similar to the following snippet:
				</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;void&nbsp;provideHighlightingFor(XtextResource&nbsp;resource,&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;IHighlightedPositionAcceptor&nbsp;acceptor)&nbsp;{<br>
	if&nbsp;(resource&nbsp;==&nbsp;null)<br>
		return;<br>
		
<br>
	Iterable&lt;AbstractNode&gt;&nbsp;allNodes&nbsp;=&nbsp;NodeUtil.getAllContents(<br>
	&nbsp;&nbsp;resource.getParseResult().getRootNode());<br>
	for&nbsp;(AbstractNode&nbsp;abstractNode&nbsp;:&nbsp;allNodes)&nbsp;{<br>
		if&nbsp;(abstractNode.getGrammarElement()&nbsp;instanceof&nbsp;CrossReference)&nbsp;{<br>
		&nbsp;&nbsp;acceptor.addPosition(node.getOffset(),&nbsp;node.getLength(),&nbsp;<br>
		&nbsp;&nbsp;&nbsp;&nbsp;SemanticHighlightingConfiguration.CROSS_REF);<br>
		}<br>
	}<br>
}<br>

<br>

</code>
</p>
</div>
<p>This example refers to an implementation of the 
					<code class="code">ISemanticHighlightingConfiguration</code> that registers a style for a cross reference. It is pretty much the same implementation as for the previously mentioned sample of an 
					<code class="code">ILexicalHighlightingConfiguration</code>.
				</p>
<div class="literallayout">
<p>
<code class="code">public&nbsp;class&nbsp;SemanticHighlightingConfiguration&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;implements&nbsp;ISemanticHighlightingConfiguration&nbsp;{<br>
	
<br>
	public&nbsp;final&nbsp;static&nbsp;String&nbsp;CROSS_REF&nbsp;=&nbsp;"CrossReference";&nbsp;<br>

<br>
	public&nbsp;void&nbsp;configure(IHighlightingConfigurationAcceptor&nbsp;acceptor)&nbsp;{<br>
		acceptor.acceptDefaultHighlighting(CROSS_REF,&nbsp;<br>
		&nbsp;&nbsp;"Cross&nbsp;References",&nbsp;crossReferenceTextStyle());<br>
	}<br>
	
<br>
	public&nbsp;TextStyle&nbsp;crossReferenceTextStyle()&nbsp;{<br>
		TextStyle&nbsp;textStyle&nbsp;=&nbsp;new&nbsp;TextStyle();<br>
		textStyle.setStyle(SWT.ITALIC);<br>
		return&nbsp;textStyle;<br>
	}<br>
}<br>

<br>

</code>
</p>
</div>
<p>The implementor of an 
					<code class="code">ISemanticHighlightingCalculator</code> should be aware of performance to ensure a good user experience. It is probably not a good idea to traverse everything of your model when you will only register a few highlighted ranges that can be found easier with some typed method calls. It is strongly advised to use purposeful ways to navigate your model. The parts of Xtext&rsquo;s core that are responsible for the semantic highlighting are pretty optimized in this regard as well. The framework will only update the ranges that actually have been altered, for example. This optimizes the redraw process. It will even move, shrink or enlarge previously announced regions based on a best guess before the next semantic highlighting pass has been triggered after the user has changed the document.
				</p>
</div>
</div>
</div>
<div class="chapter" title="Chapter&nbsp;6.&nbsp;From oAW to TMF">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="from_oaw_to_tmf"></a>Chapter&nbsp;6.&nbsp;From oAW to TMF</h2>
</div>
</div>
</div>
<p>TMF Xtext is a complete rewrite of the Xtext framework previously released with openArchitectureWare 4.3.1 (oAW). We refer to the version from oAW as oAW Xtext whereas the current Xtext version that is hosted at Eclipse.org will be called TMF Xtext to avoid confusion.
			oAW Xtext has been around for about 2 years before TMF Xtext was released in June 2009 and has been used by many people to develop little languages and corresponding Eclipse-based IDE support.</p>
<p>TMF Xtext has been improved in many aspects compared to the former version. While it integrates far better into EMF, it offers new fundamental features as well. The overhauled architecture leads to better performance when working with large models and since the whole framework is wired via dependency injection it is highly customizable. 
			Last not least a test coverage of more than 2.000 unit tests provide confidence in the overall quality of TMF Xtext. We have been using the framework in production environments since one of the earlier milestones.</p>
<p>In this document we want to share the experience we made when migrating existing Xtext projects. The document describes the differences between oAW Xtext and TMF Xtext and is intended to be used as a guide to migrate from oAW Xtext to TMF Xtext.
			For people already familiar with the concepts of oAW Xtext it should also serve as a shortcut to learn TMF Xtext.  </p>
<div class="section" title="Why a rewrite?">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="why_rewrite"></a>Why a rewrite?</h2>
</div>
</div>
</div>
<p>The first thing you might wonder about is why we decided to reimplement the framework from scratch as opposed to use the existing code base and enhance it further on. 
				We decided so because we had learned a lot of lessons from oAW Xtext. Although we wanted to stick with many proven concepts 
				we found the implementation was lacking a solid foundation (the author of these lines is the original author of that non-solid code btw. :-)). The first version of oAW Xtext was basically a proof of concept which was so well received that it had been extended with all kinds of features (some were good, some were bad). Unfortunately code quality, clean and orthogonal concepts and test coverage did not receive the necessary focus.</p>
<p>In addition to this aspects of quality, oAW Xtext suffers from some severe performance problems. The extensive and naive use of Xtend (see next section) prevented many users to use oAW Xtext for growing real-world models.</p>
</div>
<div class="section" title="Migration overview">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="migration_overview"></a>Migration overview</h2>
</div>
</div>
</div>
<p>Although a couple of things have changed we tried to keep good ideas and left many things unchanged. At the same time we wanted to clean up poor concepts and solve the main problems we and you had with oAW Xtext.
				From a bird&rsquo;s eye view if you want to migrate an existing oAW Xtext project to TMF Xtext, you mainly just need to rename the old grammar from *.xtxt to *.xtext and add two lines to the beginning of that document (see below for details). You might also have to change a few keywords, but all in all this is pretty easy and we&rsquo;ve migrated a couple of oAW Xtext projects this way without problems.
				The other aspect where lots of code might have been written for is validation. In oAW Xtext we used Xpand&rsquo;s Check language to define constraints on the Ecore model. Even though this has been one major reason for the lack of scalability in Xtext we decided to keep the Check language as an option for compatibility reasons. Therefore, you do not need to translate your existing checks to a different language. Even better, you can overcome some performance issues by leveraging the newly introduced hooks to control the time of validation (while you type, on save, or on triggering an explicit action). 
				Anyway, if you want to provide a slick user experience validation should run fast while you type. Therefore, we strongly encourage you to implement validation using our 
				<a class="link" href="#custom_validation" title="Custom Validation">declarative Java approach</a>.
			</p>
<p>We&rsquo;ve developed and reviewed a lot of oAW Xtext projects and saw that most of the work was done in the grammar and in the validation view point. 
				Other aspects such as outline view, label provider or content assist have been customized too, but they usually do not contain complicated Xtend code.
				In some projects the exception was linking and content assist which in oAW Xtext usually forces one to write a lot of duplicated code. While working on this we came up with a new concept called &ldquo;scopes&rdquo; that not only streamlines implementation in terms of redundancy. Scopes also increase the overall performance of Xtext.
				But since the concept of scopes was not carved out in oAW Xtext one usually implemented a cluttered and duplicated poor copy through linking and content assist. For obvious reasons, we didn&rsquo;t manage to come up with a good compatibility layer.
				So this is where most of the migration effort will go into if implemented customized linking. But we think the notion of scopes is such a valuable addition that it is worth the refactoring. Also, when looking at existing oAW Xtext projects we found that most projects either didn&rsquo;t change the default linking that much or they came up with their own linking framework anyway.</p>
<p>However, if we have completely misunderstood the situation and your oAW Xtext project cannot be migrated in a reasonable amount of time, please tell us. We want to help you!</p>
</div>
<div class="section" title="Where are the Xtend-based APIs?">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Xtend_based_apis"></a>Where are the Xtend-based APIs?</h2>
</div>
</div>
</div>
<p>One of the nice things with oAW Xtext was the use of Xtend to allow customizing different aspects of the generated language infrastructure.
				Xtend is a part of the template language Xpand, which is shipped with oAW (and now is included in M2T Xpand). It provides a nicer expression syntax than Java.
				Especially the existence of higher-order functions for collections is extremely handy when working with models.
				In addition to the nice syntax, it provides dynamic polymorphic dispatch, which means that declaring e.g. label computation for an Ecore model is very convenient and type safe at the same time.
				In Java one usually has to write instanceof and cast orgies. </p>
<div class="section" title="Xtend is hard to debug">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Xtend_is_hard_to_debug"></a>Xtend is hard to debug</h3>
</div>
</div>
</div>
<p>While the aforementioned features allow the convenient specification of label and icon providers, outline views, content assist and linking, Xtend is interpreted and therefore hard to debug. Because of that Xpand is shipped with a special debugger facility. Unfortunately, this debugger cannot be used in the context of Xtext since it implies that the Xtend functions have to be called from a workflow. This is not and cannot be the case for Xtext Editors.
					As a result one has to debug his way through the interpreter, which is hard and inconvenient (even for us, who have written that interpreter).</p>
</div>
<div class="section" title="Xtend is slow">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Xtend_is_slow"></a>Xtend is slow</h3>
</div>
</div>
</div>
<p>But the problematic debugging in the context of Xtext was not the main reason why there are no Xtend-based APIs beside Check in TMF Xtext. The main reason is that Xtend is too slow to be evaluated &ldquo;inside&rdquo; the editor again and again while you type. 
					While Xtend&rsquo;s performance is sufficient when run in a code generator, it is just too slow to be executed on keystroke (or 500ms after the last keystroke, which is when the reconciler reparses, links and validates the model). Xtend is relatively slow, because it supports polymorphic dispatch (the cool feature mentioned above), which means that for each invocation it matches at runtime which function is the best match and it has to do so on each call. Also Xtend supports a pluggable typesystem, where you can adapt to other existing type systems such as JavaBeans or Ecore. This is very powerful and flexible but introduces another indirection layer. Last but not least the code is interpreted and not compiled. The price we pay for all these nice features is reduced performance.</p>
<p>In addition to these scalability problems we have designed some core APIs (e.g. scopes) around the idea of Iterables, which allows for lazy resolution of elements. As Xtend does not know the concept of Iterators you would have to work with lists all the time. Copying collections over and over again is far more expensive than chaining Iterables through filters and transformers like we do with Google Collections in TMF Xtext.</p>
</div>
<div class="section" title="Convenient Java">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Convenient_Java"></a>Convenient Java</h3>
</div>
</div>
</div>
<p>To summarize the dilemma we had to find a way to allow for convenient, scalable and debuggable APIs. Ultimately we wanted to provide neat DSLs for every view point, which provide all these things. However, we had to prioritize our efforts with the available resources in mind. 
					As a result we found ways and means to tweak Java as good as possible to allow for relatively convenient, high performing implementations. </p>
<p>Java is fast and can easily be debugged but ranks behind Xtend regarding convenience. We address this with different approaches to make Java development in the context of Xtext as comfortable as possible.</p>
<p>Most of the APIs in TMF Xtext use polymorphic dispatching, which mimics the behavior known from Xtend. Another valuable feature of Xtend while working with oAW Xtext is static type checking while working with the inferred Ecore model whereas in Java the work with dynamic Ecore classes was rather cumbersome. Since TMF Xtext generates static Ecore classes per default you get static typing in Java as well. Additionally, the use of 
					<a class="ulink" href="http://code.google.com/p/google-collections" target="_new">Google Collections</a> reduces the pain when navigating over your model to extract information. 
				</p>
<p>With these techniques an ILabelProvider that handles your own EClasses 
					<code class="code">Property</code> and 
					<code class="code">Entity</code> can be written like this:
				</p>
<div class="literallayout">
<p>
<code class="code">
<br>
public&nbsp;class&nbsp;DomainModelLabelProvider&nbsp;extends&nbsp;DefaultLabelProvider&nbsp;{<br>

<br>
&nbsp;&nbsp;String&nbsp;label(Entity&nbsp;e)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;e.getName();<br>
&nbsp;&nbsp;}<br>

<br>
&nbsp;&nbsp;String&nbsp;image(Property&nbsp;p)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;p.isMultiValue()&nbsp;?&nbsp;"complexProperty.gif":&nbsp;"simpleProperty.gif";<br>
&nbsp;&nbsp;}<br>

<br>
&nbsp;&nbsp;String&nbsp;image(Entity&nbsp;e)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;"entity.gif";<br>
&nbsp;&nbsp;}<br>

<br>
}<br>
&nbsp;&nbsp;<br>

</code>
</p>
</div>
<p>As you can see this is very similar to the way one describes labels and icons in oAW Xtext, but has the advantage that it is easier to test and to debug, faster and can be used everywhere an ILabelProvider is expected in Eclipse.</p>
</div>
<div class="section" title="Conclusion">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="conclusion"></a>Conclusion</h3>
</div>
</div>
</div>
<p>Just to get it right, Xtend is a very powerful language and we still use it for its main purpose: code generation and model transformation. The whole generator in TMF Xtext is written in Xpand and Xtend and its performance is at least in our experience sufficient for that use case. Actually we were able to increase the runtime performance of Xpand by about 60% for the Galileo release of M2T Xpand. But still, live execution in the IDE and on typing is very critical and one has to think about every millisecond in this area. </p>
<p>As an alternative to the Java APIs we also considered other JVM languages. We like static typing and think it is especially important when processing typed models (which evolve heavily). That&rsquo;s why Groovy or JRuby were no alternatives. Using Scala would have been a very good match, but we didn&rsquo;t want to require knowledge of Scala so we didn&rsquo;t use it and stuck to Java. </p>
</div>
</div>
<div class="section" title="Differences">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="differences"></a>Differences</h2>
</div>
</div>
</div>
<p>In this section differences between oAW Xtext and TMF Xtext are outlined and explained. We&rsquo;ll start from the APIs such as the grammar language and the validation and finish with the different hooks for customizing linking and several UI aspects, such as outline view and content assist. We&rsquo;ll also try to map some of the oAW Xtext concepts to their counterparts in TMF Xtext.</p>
<div class="section" title="Differences in the grammar language">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="differenced_grammar_language"></a>Differences in the grammar language</h3>
</div>
</div>
</div>
<p>When looking at a TMF Xtext grammar the first time it looks like one has to provide additional information which was not necessary in oAW Xtext. In oAW Xtext *.xtxt files started with the first production rule where in TMF Xtext one has to declare the name of the language followed by declaration of one or more used/generated Ecore models:</p>
<p>TMF Xtext heading information</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;&nbsp;grammar&nbsp;my.namespace.Language&nbsp;with&nbsp;org.eclipse.xtext.common.Terminals<br>
&nbsp;&nbsp;generate&nbsp;myDsl&nbsp;"http://www.namespace.my/2009/MyDSL"<br>
&nbsp;<br>
&nbsp;&nbsp;FirstRule&nbsp;:&nbsp;...<br>

<br>

</code>
</p>
</div>
<p>In oAW Xtext this information was provided through the generator (actually it is contained in the *.properties file) but we found that these things are very important for a complete description of a grammar. Therefore we made that information becoming a part of the grammar language in order to have self-describing grammars and allow for sophisticated static analysis, etc.. </p>
<p>Apart from the first two lines the grammar languages of both versions are more or less compatible. The syntax for all the different EBNF concepts (alternatives, groups, cardinalities) is similar.
					Also assignments are syntactically and semantically identical in both versions. 
					However in TMF Xtext some concepts have been generalized and improved:</p>
<div class="section" title="String rules become Datatype rules">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="differences_datatype_rules"></a>String rules become Datatype rules</h4>
</div>
</div>
</div>
<p>The very handy String rules are still present in TMF Xtext but we generalized them so that you don&rsquo;t need to write the &lsquo;String&rsquo; keyword in front of them and at the same time these rules can not only produce EStrings but (as the name suggests) any kind of EDataType. Every parser rule that neither includes assignments nor calls any other that does, returns an EDataType containing the consumed data. Per default this is an EString but you can now simply create a parser rule returning other EDataTypes as well (see 
						<a class="link" href="#datatypeRules" title="Data type rules">Datatype rules</a>).
					</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;&nbsp;Float&nbsp;returns&nbsp;ecore::EDouble&nbsp;:&nbsp;INT&nbsp;('.'&nbsp;INT)?;<br>

</code>
</p>
</div>
</div>
<div class="section" title="Enum rules">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="differences_enum_rules"></a>Enum rules</h4>
</div>
</div>
</div>
<p>Enum rules have not changed significantly. The keyword has changed to be all lower case (&lsquo;enum&rsquo; instead of &lsquo;Enum&rsquo;).
						Also the right-hand side of the assignment is now optional. That is in oAW Xtext:</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;&nbsp;Enum&nbsp;MyEnum&nbsp;:&nbsp;foo='foo'&nbsp;|&nbsp;bar='bar';<br>
&nbsp;&nbsp;<br>

</code>
</p>
</div>
<p>becomes</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;&nbsp;enum&nbsp;MyEnum&nbsp;:&nbsp;foo='foo'&nbsp;|&nbsp;bar='bar';<br>
&nbsp;&nbsp;&nbsp;<br>

</code>
</p>
</div>
<p>and because the name of the literal equals the literal value one can omit the right-hand side in this case and write:</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;&nbsp;enum&nbsp;MyEnum&nbsp;:&nbsp;foo&nbsp;|&nbsp;bar;<br>

<br>

</code>
</p>
</div>
</div>
<div class="section" title="Native rules">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="differences_native_rules"></a>Native rules</h4>
</div>
</div>
</div>
<p>Another improvement is that we could replace the blackbox native rules with full-blown EBNF syntax. 
						That is native rules become terminal rules and are no longer written as a string literal containing ANTLR syntax.</p>
<p>Example :</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;&nbsp;Native&nbsp;FOO&nbsp;:&nbsp;"'f'&nbsp;'o'&nbsp;'o'";<br>

</code>
</p>
</div>
<p>becomes</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;&nbsp;terminal&nbsp;FOO&nbsp;:&nbsp;'f'&nbsp;'o'&nbsp;'o';<br>

</code>
</p>
</div>
<p>See the 
						<a class="link" href="#TerminalRules" title="Terminal Rules">reference documentation</a> for all the different expressions possible in terminal rules.
					</p>
</div>
<div class="section" title="No URI terminal rule anymore">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="differences_no_URI_token"></a>No URI terminal rule anymore</h4>
</div>
</div>
</div>
<p>We decided to remove the URI terminal. The only reason for the existence was to mark the model somehow so that the framework knows what information to use in order to load referenced models. Instead we decided to solve this similar to how we imply other defaults: by convention.</p>
<p>So instead of using a special token which is syntactically a STRING token, the default import mechanism now looks for EAttributes of type EString with the name &lsquo;importURI&rsquo;.
						That is if you&rsquo;ve used the URI token like this:</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;&nbsp;Import&nbsp;:&nbsp;'import'&nbsp;myReference=URI;<br>

</code>
</p>
</div>
<p>you&rsquo;ll have to rewrite it that way</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;&nbsp;Import&nbsp;:&nbsp;'import'&nbsp;importURI=STRING;<br>

</code>
</p>
</div>
<p>Although this changes your Ecore model, one usually never used this reference explicitly as it was only there to be used by the default import mechanism. So we assume and hope that changing the reference is not a big deal for you. </p>
</div>
<div class="section" title="Return types">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="differences_return_types"></a>Return types</h4>
</div>
</div>
</div>
<p>The syntax to explicitly declare the return type of a rule has changed. In oAW Xtext (where this was marked as &lsquo;experimental&rsquo;) the syntax was:</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;&nbsp;MyRule&nbsp;[MyType]&nbsp;:&nbsp;foo=ID;&nbsp;&nbsp;<br>

</code>
</p>
</div>
<p>in TMF Xtext we have a keyword for this :</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;&nbsp;MyRule&nbsp;returns&nbsp;MyType&nbsp;:&nbsp;foo=ID;<br>

</code>
</p>
</div>
<p>This is a bit more verbose, but at the same time more readable. And as you don&rsquo;t have to write the return type in most situations, it&rsquo;s good to have a more explicit, readable syntax.</p>
</div>
</div>
<div class="section" title="Differences in Linking">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="differences_linking"></a>Differences in Linking</h3>
</div>
</div>
</div>
<p>The linking has been completely redesigned. In oAW Xtext linking was done in a very naive way: To find an element one queries a list of all &lsquo;visible&rsquo; EObjects, then filters out what is not needed and tries to find a match by comparing the text written for the crosslink with the value returned by the 
					<code class="code">id()</code> extension. As a side-effect of 
					<code class="code">link_feature()</code> the reference is set.
				</p>
<p>The code about selecting and filtering 
					<code class="code">allElements()</code> usually has been duplicated in the corresponding content assist function, so that linking and content assist are semantically in sync. If you&rsquo;re good (we usually were not) you externalized that piece of code and reused the same extension in content assist and linking. 
				</p>
<p>To put it bluntly this approach could be summarized in two steps:</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>Give me the whole universe including every unregarded object in the uncharted backwaters of the unfashionable end of the western spiral arm of the galaxy and squeeze it into an Arraylist </p>
</li>
<li class="listitem">
<p>From this, select the one I need</p>
</li>
</ol>
</div>
<p>This was not only very expensive but also lacks an important abstraction: the notion of scopes.</p>
<div class="section" title="The idea of scopes">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="differences_linking_sopes"></a>The idea of scopes</h4>
</div>
</div>
</div>
<p>In TMF Xtext we&rsquo;ve introduced scopes and scope providers that are responsible for creating scopes. A scope is basically a set of name-&gt;value pairs. Scopes are implemented upon Iterables and are nested to build a hierarchy. With scopes we declare &ldquo;visible&rdquo; objects in a lazy and cost-saving way where the linker only navigates as far as necessary to find matching objects. The content assist reuses this set of visible objects to offer only reachable objects. </p>
<p>When the linking has to be customized scoping is where most of the semantics typically goes into. By implementing an 
						<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/scoping/IScopeProvider.java?root=Modeling_Project&view=co" target="_new">IScopeProvider</a> for your language linking and content assist will automatically be kept in sync since both use the scope provider.
					</p>
<p>The provided default implementation is semantically mostly identical to how the default linking worked in oAW Xtext: </p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>Elements which have an attribute &lsquo;name&rsquo; will be made visible by their name</p>
</li>
<li class="listitem">
<p>Referenced resources will be put on the (outer) scope by using the &lsquo;importURI&rsquo;- naming convention and will only be loaded if necessary</p>
</li>
<li class="listitem">
<p>The available elements are filtered by the expected type (i.e. the type of the reference to be linked)</p>
</li>
</ol>
</div>
</div>
<div class="section" title="Migration">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="differences_linking_migration"></a>Migration</h4>
</div>
</div>
</div>
<p>We expect the migration of linking to be very simple if you&rsquo;ve not changed the default semantics that much. We&rsquo;ve already migrated a couple of projects and it wasn&rsquo;t too hard to do so.
						If you have changed linking (and also content assist) a lot, you&rsquo;ll have to translate the semantics to the IScopeProvider concept. This might be a bit of work, but it is worth the effort as this will clean up your code base and better separate concerns.</p>
</div>
</div>
<div class="section" title="Differences in UI customizing">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="differences_ui"></a>Differences in UI customizing</h3>
</div>
</div>
</div>
<p>In oAW Xtext several UI services such as content assist, outline view or the label provider have been customized using Xtend. In TMF Xtext there is no Xtend API for these aspects. Extensive model computations for the content assist is most probably not necessary anymore- it reuses scopes. And since we provide a declarative Java API that mimics the polymorphic dispatch and relies on static Ecore classes you will gain nearly the same expressiveness as before while increasing maintainability and performance.</p>
<p>Beside the API change in favor of Java we have to mention that in TMF Xtext the outline view does not support multiple view points so far. This is just because we didn&rsquo;t manage to get this included. We don&rsquo;t think that view points are a bad idea in general, but we decided that other things were more important.</p>
</div>
</div>
<div class="section" title="New Features">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="NewFeatures"></a>New Features</h2>
</div>
</div>
</div>
<p>This section provides an overview of new possibilities with TMF Xtext compared to oAW Xtext. Please note that this list is neither complete nor does it explain every aspect in detail to keep this document tight.</p>
<div class="section" title="Dependency Injection with Google Guice">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="DependencyInjectionwithGoogleGuice"></a>Dependency Injection with Google Guice</h3>
</div>
</div>
</div>
<p>Beyond the mentioned architectural overhaul that carve out separate concerns in a meaningful way these different classes of TMF Xtext are wired using 
					<a class="ulink" href="http://code.google.com/p/google-guice" target="_new">Google Guice</a>  and can easily replaced by or combined with your own implementation. We could have foreseen some common needs for adaption but with this mechanism you can virtually change every aspect of Xtext without duplicating an unmanageable amount of code.
				</p>
</div>
<div class="section" title="Improvements on Grammar Level">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="ImprovementsonGrammarLevel"></a>Improvements on Grammar Level</h3>
</div>
</div>
</div>
<p>The Xtext grammar language introduces some new features, too. Read the chapter 
					<a class="link" href="#grammarLanguage" title="Chapter&nbsp;2.&nbsp;The Grammar Language">grammar language</a> to understand the details about all the improvements that have been implemented.
				</p>
<p>
					
<a class="link" href="#grammarMixins" title="Grammar Mixins">Grammar mixins</a> allow you to extend existing languages and change their concrete and abstract syntax. However the abstract syntax (i.e. the Ecore model) can only be extended. This allows you to reuse existing validations, code generators, interpreters or other code which has been written against those types.
				</p>
<p>In oAW Xtext common terminals like ID, INT, STRING, ML_COMMENT, SL_COMMENT and WS (whitespace) were hard coded into the grammar language and couldn&rsquo;t be removed and hardly overridden. In TMF Xtext these terminals are imported through the newly introduced grammar mixin mechanism from the shipped grammar 
					<code class="code">org.eclipse.xtext.common.Terminals</code> per default. This means that they are still there but reside in a libraries now. You don&rsquo;t have to use them and you can come up with your own set of reusable rules. 
				</p>
<p>
					
<a class="link" href="#grammarImport" title="Importing existing Ecore models">Reusing existing Ecore models</a> in oAW Xtext didn&rsquo;t work well and we communicated this by flagging this feature as &lsquo;experimental&rsquo;. In TMF Xtext importing existing Ecore models is fully supported. Moreover, it is possible to import a couple of different EPackages and generate some at the same time, so that the generated Ecore models extend or refer to the existing Ecore models.
				</p>
<p>The grammar language gained one new concept that is of great value when writing left-factored grammars (e.g. expressions). With actions one can do minor AST rewritings within a rule to overcome degenerated ASTs. You will find an 
					<a class="link" href="#grammarActions" title="Assigned Actions">in-depth explanation of actions</a> in the dedicated chapter in the reference documentation.
				</p>
</div>
<div class="section" title="Fine-grained control for validation">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="differences_validation"></a>Fine-grained control for validation</h3>
</div>
</div>
</div>
<p>In order to make more expensive validations possible without slowing down the editor, TMF Xtext supports three different validation hooks.  </p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>FAST constraints are triggered by the reconciler (i.e. 500 ms after the last keystroke) and on save.</p>
</li>
<li class="listitem">
<p>NORMAL constraints are executed on save only.</p>
</li>
<li class="listitem">
<p>EXPENSIVE constraints are executed through an action which is available through the context menu.</p>
</li>
</ol>
</div>
<p>Please note that when using Xtext models for code generation the checks of all three categories will be performed. </p>
<p>Beside this it is now possible to add information about the feature which is validated.</p>
<div class="literallayout">
<p>
<code class="code">
<br>
&nbsp;&nbsp;context&nbsp;Entity#name&nbsp;ERROR&nbsp;"Name&nbsp;should&nbsp;start&nbsp;with&nbsp;a&nbsp;capital&nbsp;"+this.name+"."&nbsp;:<br>
&nbsp;&nbsp;&nbsp;&nbsp;this.name.toFirstUpper()&nbsp;==&nbsp;this.name;<br>

</code>
</p>
</div>
<p>If you add the name of a feature prepended by a hash (&lsquo;#&rsquo;) in Check, the editor will only mark the value of the feature (name), not the whole object (Entity). Both concepts, control over validation time as well as pointing to a specific feature, complement one another in Check and Java based validation.</p>
</div>
</div>
<div class="section" title="Migration Support">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="MigrationSupport"></a>Migration Support</h2>
</div>
</div>
</div>
<p>In this document we tried to explain why we decided to change some aspects of Xtext&rsquo;s architecture. We consider most changes as minor but when it comes to scopes you will face a conceptual enhancement that did not exist in oAW Xtext. We tried to explain why it is not easily possible to come up with an adapter for scoping.</p>
<p>That said you might not have the time to do the migration and wished to have advice for migrating, especially from oAW linking to TMF linking. You&rsquo;re welcome to ask any questions in the newsgroup and we&rsquo;ll try to help you as much as possible in order to get your projects migrated. Also, if you don&rsquo;t want to do the migration yourself we (itemis AG) can do the work for you or help you with that. </p>
</div>
</div>
<div class="chapter" title="Chapter&nbsp;7.&nbsp;The ANTLR IP issue (or which parser to use?)">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="antlr_ip_issue"></a>Chapter&nbsp;7.&nbsp;The ANTLR IP issue (or which parser to use?)</h2>
</div>
</div>
</div>
<p>In order to be able to parse models written in your language, Xtext needs to provide a special parser for it.
			The parser is generated from the language grammar. </p>
<p>Currently it is recommended to use the 
			<a class="ulink" href="http://www.antlr.org" target="_new">ANTLR-based</a> parser.
			ANTLR is a very sophisticated parser generator framework based on a so called LL(*) algorithm.
			It is fast, simple and at the same time has some very nice and sophisticated features. Especially its 
			support for error recovery is much better than what other parser generators provide.
		</p>
<p>ANTLR comes in two parts: the runtime and the generator.
			Both are shipped under the BSD license and have a clean intellectual property history. 
			However the generator is still implemented in an older version of ANTLR (v 2.x), where it was not possible for the Eclipse Foundation 
			to be sure where exactly every line of code originated. Therefore ANTLR v 2.x didn&rsquo;t get the required approval.
			Eclipse has a strict IP policy, which makes sure that everything provided by Eclipse can be consumed under the terms of the Eclipse Public License.
			The details are described in 
			<a class="ulink" href="http://www.eclipse.org/org/documents/Eclipse_IP_Policy.pdf" target="_new">this document</a>.
		</p>
<p>Unfortunately as the generator of ANTLR V3 needs ANTLR V2 it is as well not yet IP approved.
			That is why we are not allowed to ship Xtext with the ANTLR generator (the runtime is IP approved), but have to provide it separately via update-site at:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>
					
<a class="ulink" href="http://download.itemis.com/updates/" target="_new">http://download.itemis.com/updates/</a>
				
</p>
</li>
</ul>
</div>
<p>
			
<span class="bold"><strong>IMPORTANT</strong></span> :

			<span class="italic">Although if you use the non-IP approved ANTLR generator, you can still ship any languages and the IDEs you&rsquo;ve developed with Xtext without any worrying, because the 
				<span class="bold"><strong>ANTLR runtime is IP approved</strong></span>
			</span>
		
</p>
<div class="section" title="What if I do not want to use non IP-approved code">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="WhatifIdonotwanttousenonIPapprovedcode"></a>What if I do not want to use non IP-approved code</h2>
</div>
</div>
</div>
<p>If you, against all recommendations, need to stick to a fully IP approved generator, you can use the parser generator we&rsquo;ve developed.
				But be warned, although it&rsquo;s fully functional and equally fast, it does not have any error recovery.
				This makes the editing experience in the editor more or less unacceptable.</p>
</div>
</div>
</div>
</body>
</html>
